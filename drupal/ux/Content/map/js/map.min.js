var map, facilityGraphics = []; define.amd.jQuery = !0, require(["esri/map", "esri/graphic", "esri/SpatialReference", "esri/graphicsUtils", "esri/InfoTemplate", "esri/Color", "esri/domUtils", "esri/tasks/locator", "esri/tasks/query", "esri/tasks/GeometryService", "esri/tasks/IdentifyTask", "esri/tasks/IdentifyParameters", "esri/toolbars/draw", "esri/toolbars/edit", "esri/symbols/SimpleFillSymbol", "esri/symbols/SimpleLineSymbol", "esri/symbols/SimpleMarkerSymbol", "esri/symbols/TextSymbol", "esri/symbols/Font", "esri/symbols/PictureMarkerSymbol", "esri/layers/GraphicsLayer", "esri/layers/ArcGISDynamicMapServiceLayer", "esri/layers/ArcGISTiledMapServiceLayer", "esri/layers/ImageParameters", "esri/layers/FeatureLayer", "esri/layers/LayerDrawingOptions", "esri/renderers/SimpleRenderer", "esri/geometry/webMercatorUtils", "esri/geometry/Polygon", "esri/geometry/Point", "esri/geometry/Extent", "esri/dijit/Basemap", "esri/dijit/BasemapLayer", "esri/dijit/BasemapGallery", "esri/dijit/Popup", "esri/dijit/PopupTemplate", "dojo/number", "dojo/dom-construct", "dojo/parser", "dojo/_base/array", "dojo/_base/event", "dojo/dom", "dojo/dom-style", "dojo/_base/connect", "dijit/registry", "dijit/Menu", "dojo/dom-class", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dijit/Tooltip", "dijit/form/Button", "dijit/form/Textarea", "dijit/form/ToggleButton", "dojo/on", "dojo/domReady!"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M) { function N(a) { yb = yb.concat(a.layer.tileInfo.lods), zb++, 2 === zb && setTimeout(function () { P() }, 2e3) } function O() { sb = new u, tb = new u, qb = new w("https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer", { displayLevels: [15, 16, 17, 18, 19], opacity: .6 }), qb.on("load", N), rb = new w("https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer", { displayLevels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] }), rb.on("load", N) } function P() { var b = new I({ anchor: "right", fillSymbol: new o(o.STYLE_SOLID, new p(p.STYLE_SOLID, new f([255, 0, 0]), 2), new f([255, 255, 0, .25])) }, dojo.create("div")); map = new a("map", { center: [-87.8, 33.8], zoom: 5, lods: yb, infoWindow: b, logo: !1, showAttribution: !1 }), map.on("load", Q), map.addLayer(rb), map.addLayer(qb), dojo.addClass(map.infoWindow.domNode, "myTheme"), pb = new h("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"), pb.outSpatialReference = map.spatialReference, dojo.connect(pb, "onAddressToLocationsComplete", mb), map.addLayer(tb), xb = (new o).setColor(new f([80, 0, 110, .1])); var c = "Sub-Facility Data", d = "<b>Name:</b> ${PRIMARY_NA}<br/><b>Address:</b> ${LOCATION_A}<BR/><b>City:</b> ${CITY_NAME}<BR/><b>County:</b> ${COUNTY_NAM}<br/><b>State:</b> ${STATE_CODE}<BR/><b>Zip Code:</b> ${POSTAL_COD}<br/><b>Program:</b> ${PGM_SYS_AC}<br/><b>Interest Type:</b> ${INTEREST_T}<br/><b>Subfacility ID:</b> ${SUB_ID}<br/><b>Substance(s):</b> <a target='_blank' href='http://iaspub.epa.gov/sor_internet/registry/substreg/searchandretrieve/advancedsearch/externalSearch.do?p_type=SRSITN&p_value=${OnsiteSubstance1_ID}'>${OnsiteSubstance1}</a>, <a target='_blank' href='http://iaspub.epa.gov/sor_internet/registry/substreg/searchandretrieve/advancedsearch/externalSearch.do?p_type=SRSITN&p_value=${OnsiteSubstance2_ID}'>${OnsiteSubstance2}</a>", g = new e(c, d); vb = new v("https://arcgis.cgiclouddemo.com/arcgis/rest/services/EEPortal/FRS_Subfac_Examples/MapServer"), map.addLayer(vb), vb.setVisibleLayers([0]), ub = new y("https://arcgis.cgiclouddemo.com/arcgis/rest/services/EEPortal/FRS_Subfac_Examples/MapServer/0", { mode: y.MODE_ONDEMAND, outFields: ["*"], infoTemplate: g }), map.addLayer(ub), ub.hide(), vb.hide(), dojo.connect(b, "onSetFeatures", function () { var a = b.getSelectedFeature(); setTimeout(function () { map.centerAt(a.geometry) }, 100) }), dojo.connect(map, "onClick", function (a) { ob(); var b = new i; b.geometry = X(map, a.mapPoint, 10); var c = ub.selectFeatures(b, y.SELECTION_NEW); Ab || null !== c && c.length > 0 && (map.infoWindow.setFeatures([c]), map.infoWindow.show(a.mapPoint)); B.webMercatorToGeographic(a.mapPoint); db(a), kb(a), c.addCallback(function () { }) }) } function Q() { ob(); var a = new q, f = "<b>Street:</b> ${Street}<br /><b>City:</b> ${City}<br /><b>State:</b> ${State}<br /><b>Zip:</b> ${Zip}<br /><b>Facility ID:</b> ${RegistryID}<br /><b>Programs:</b> ${Programs}<br /><b>Facility Report:</b> <a target='_blank' href='http://iaspub.epa.gov/enviro/fii_query_detail.disp_program_facility?p_registry_id=110005712096'>Open</a><br/><b>Compliance History:</b> <a target='_blank' href='http://www.epa-echo.gov/cgi-bin/get1cReport.cgi?tool=echo&IDNumber=110005712096'>Open</a><br/><b>Currently In Compliance:</b> Yes<br/><input type='button' onclick='javascript:showSubLayers(${ID});' class='detailsButton' value='Display Sub-Facilities'/>&nbsp;&nbsp;", g = "<b>Street:</b> ${Street}<br /><b>City:</b> ${City}<br /><b>State:</b> ${State}<br /><b>Zip:</b> ${Zip}<br /><b>Facility ID:</b> ${RegistryID}<br /><b>Programs:</b> ${Programs}<br /><b>Facility Report:</b> <a target='_blank' href='http://iaspub.epa.gov/enviro/fii_query_detail.disp_program_facility?p_registry_id=110005712096'>Open</a><br/><b>Compliance History:</b> <a target='_blank' href='http://www.epa-echo.gov/cgi-bin/get1cReport.cgi?tool=echo&IDNumber=110005712096'>Open</a><br/><b>Currently In Compliance:</b> No<br/><input type='button' onclick='javascript:showSubLayers(${ID});' class='detailsButton' value='Display Sub-Facilities'/>&nbsp;&nbsp;", h = new e("${Name}", f), i = new e("${Name}", g), j = location.pathname.split("/"); urlFolder = j[1], a = t("/" + urlFolder + "/content/map/img/facility.png", 22, 22), symbolLightPurple = t("/" + urlFolder + "/content/map/img/facility_lightpurple.png", 22, 22); var k = { ID: 0, Name: "ABC Corp. Facility 2", Street: "5000 RICHMOND ST", City: "PHILADELPHIA", State: "PA", Zip: "19137", TRIFID: "19137RHMND5000R", Lat: 40.002765, Long: -75.064065, RegistryID: 110000492413, Programs: "CAA, ICIS, NPDES, RCRA, TRI, TSCA", Type_of_Facility: "http://epa.versiform.net/Forms/Edit/185010/764" }, l = new D([k.Long, k.Lat], new c({ wkid: 4326 })), m = { ID: 1, Name: "ABC Corp. Facility 8", Street: "2800 CHRISTIAN STREET", City: "PHILADELPHIA", State: "PA", Zip: "19146", TRIFID: "19146SCHYL2800C", Lat: 39.942639, Long: -75.187189, RegistryID: 110000337029, Programs: "CAA, CAMDBS, E-GGRT, EGRID, EIS, ICIS, OIL, NPDES, RCRA, TRI", Type_of_Facility: "http://epa.versiform.net/Forms/Edit/185010/764" }, n = new D([m.Long, m.Lat], new c({ wkid: 4326 })), o = { ID: 2, Name: "ABC Corp. Facility 4", Street: "1001 S. 4TH AVE.", City: "LAUREL", State: "MS", Zip: "39440", TRIFID: "39440MSNTCSOUTH", Lat: 31.678996, Long: -89.130307, RegistryID: 110000377164, Programs: "CAA, RCRA, EIS, ICIS, OIL, NPDES, TRI" }, p = new D([o.Long, o.Lat], new c({ wkid: 4326 })), r = { ID: 3, Name: "ABC Corp. Facility 11", Street: "13050 TEXAS HIGHWAY 185", City: "PORT LAVACA", State: "TX", Zip: "77414", TRIFID: "77979BPCHMTEXAS", Lat: 28.565803, Long: -96.836644, RegistryID: 110000502867, Programs: "CAA, NPDES, RCRA, TSCA, TRI" }, s = new D([r.Long, r.Lat], new c({ wkid: 4326 })), u = new b(l, a, k, h); sb.add(u), facilityGraphics.push(u), u = new b(n, a, m, h), sb.add(u), facilityGraphics.push(u), u = new b(p, symbolLightPurple, o, i), sb.add(u), facilityGraphics.push(u), u = new b(s, a, r, h), sb.add(u), facilityGraphics.push(u), Gb = [k, m, o, r], map.addLayer(sb), map.setExtent(d.graphicsExtent(facilityGraphics)) } function R() { T(), map.setExtent(d.graphicsExtent(facilityGraphics).expand(1.4)) } function S(a) { map.graphics.clear(), Db ? T() : ($("#targetFacility").val(a), ub.show(), vb.show(), $("#selectButton").show(), $("#filterSubs").show(), $("#addButton").show(), Db = !0) } function T() { map.graphics.clear(), ub.hide(), vb.hide(), $("#selectButton").hide(), $("#filterSubs").hide(), $("#addButton").hide(), $(".toolbarButtonError").hide(), Db = !1 } function U(a) { var b = []; map.graphics.clear(), a.length > 1 ? (b[0] = "INTEREST_T = '" + a + "'", ub.setDefinitionExpression(b[0])) : (b[0] = "", ub.setDefinitionExpression(b[0])), vb.setLayerDefinitions(b) } function V(a) { var b = Gb[a]; $("#fname").val(b.Name), $("#fstreet").val(b.Street), $("#fcity").val(b.City), $("#fstate").val(b.State), $("#fzip").val(b.Zip), $("#flat").val(b.Lat.toFixed(6)), $("#flong").val(b.Long.toFixed(6)), $("#fid").val(b.RegistryID), $(".changeAddress").show(), $(".toolbarButtonFlip").show(), map.infoWindow.setFeatures([facilityGraphics[a]]), map.infoWindow.show(facilityGraphics[a].geometry) } function W(a, b, c, d, e, f, g, h) { sessionStorage.name = a, sessionStorage.address = c + " " + d + ", " + e + " " + f, sessionStorage.city = d, sessionStorage.state = e, sessionStorage.zip = f, sessionStorage.lat = g, sessionStorage["long"] = h, sessionStorage.regId = b, sessionStorage.firstName = $("#firstName").val(), sessionStorage.lastName = $("#lastName").val(), sessionStorage.phoneNumber = $("#phoneNumber").val(), sessionStorage.areaCode = $("#areaCode").val(), sessionStorage.email = $("#email").val(), sessionStorage.userOrg = $("#userOrg").val() } function X(a, b, d) { var e = a.extent.getWidth() / a.width, f = d * e; return new E(b.x - f, b.y - f, b.x + f, b.y + f, new c({ wkid: 4326 })) } function Y(a, b, c, d, e, f, g, h) { sessionStorage.clear(), W(a, b, c, d, e, f, g, h); var i = Math.ceil(75 * $(document).width() / 100), j = Math.ceil(75 * $(document).height() / 100); parent.$.fancybox({ hideOnContentClick: !1, width: i, height: j, type: "iframe", scrolling: "yes", showCloseButton: "true", beforeClose: function () { sessionStorage.clear() }, afterClose: function () { sessionStorage.clear() }, closeClick: !0, href: "../eEnterprisePortalDemo/Content/map/error/error_report.html" }) } function Z() { Cb ? (wb.deactivate(), Cb = !1, $("#selectButton").removeClass("addMode")) : (wb.activate(m.EXTENT), Cb = !0, map.graphics.clear(), $("#selectButton").addClass("addMode")) } function _() { if (Eb.length > 0) { ab(); var a = Math.ceil(40 * $(document).width() / 100), b = Math.ceil(75 * $(document).height() / 100); parent.$.fancybox({ hideOnContentClick: !1, width: a, height: b, type: "iframe", scrolling: "yes", showCloseButton: "true", beforeClose: function () { alert("close"), sessionStorage.clear() }, afterClose: function () { alert("close1"), sessionStorage.clear() }, closeClick: !0, href: "../eEnterprisePortalDemo/Content/map/error/error_report_custom.html" }) } else alert("Please select sub-facility features.") } function ab() { sessionStorage.firstName = $("#firstName").val(), sessionStorage.lastName = $("#lastName").val(), sessionStorage.phoneNumber = $("#phoneNumber").val(), sessionStorage.areaCode = $("#areaCode").val(), sessionStorage.email = $("#email").val(), sessionStorage.userOrg = $("#userOrg").val(), sessionStorage.features = JSON.stringify(Eb) } function bb(a) { map.infoWindow.isShowing === !0 && (map.infoWindow.clearFeatures(), map.infoWindow.hide()), map.centerAndZoom(facilityGraphics[a].geometry, 16), T(), map.infoWindow.setFeatures([facilityGraphics[a]]), map.infoWindow.show(facilityGraphics[a].geometry) } function cb() { Ab ? (Ab = !1, $("#newLocButton").removeClass("addMode")) : (Ab = !0, map.infoWindow.hide(), $("#newLocButton").addClass("addMode")) } function db(a) { if (Ab) { $("#collectionMethod").val("Selected from map"); var b = B.webMercatorToGeographic(a.mapPoint); fb(b.y, b.x), eb() } } function eb() { map.graphics.clear(); var a = $("#flong").val(), d = $("#flat").val(), e = new q; e.setStyle(q.STYLE_CROSS), e.setOutline(new p(p.STYLE_SOLID, new f([222, 0, 0]), 2)), e.setColor(new f("#70B3AA")), e.setSize(12); var g = new D([a, d], new c({ wkid: 4326 })), h = new b(g, e); map.graphics.add(h), map.centerAndZoom(g, 17) } function fb(a, b) { $(".valueChanged").removeClass("valueChanged"), $("#flong").val(b.toFixed(6)).addClass("valueChanged"), $("#flat").val(a.toFixed(6)).addClass("valueChanged"), setTimeout(function () { gb() }, 1100) } function gb() { $(".valueChanged").removeClass("valueChanged") } function hb() { if (navigator.geolocation) { navigator.geolocation.getCurrentPosition(function (a) { ib(a) }) } else alert("Sorry, your browser does not support geolocation") } function ib(a) { $("#collectionMethod").val("HTML5 derived current location"), html5Lat = a.coords.latitude, html5Lon = a.coords.longitude, html5TimeStamp = a.timestamp, html5Accuracy = a.coords.accuracy, map.graphics.clear(); var d = new q; d.setStyle(q.STYLE_CROSS), d.setOutline(new p(p.STYLE_SOLID, new f([222, 0, 0]), 2)), d.setColor(new f("#70B3AA")), d.setSize(12); var e = new D([html5Lon, html5Lat], new c({ wkid: 4326 })), g = new b(e, d); map.graphics.add(g), map.centerAndZoom(e, 17), fb(html5Lat, html5Lon) } function jb() { Bb ? (Bb = !1, $("#addButton").removeClass("addMode")) : (Bb = !0, $("#addButton").addClass("addMode")) } function kb(a) { if (Bb) { var c = (B.webMercatorToGeographic(a.mapPoint), new q); c.setStyle(q.STYLE_CIRCLE), c.setColor(new f("#70B3AA")), c.setSize(12); var d = $("#targetFacility").val(), g = Gb[d], h = Fb.length, i = "<b>Name:</b> <input type='text' style='width:170px;' value='${Name}'/><br /><b>Street:</b> ${Street}<br /><b>City:</b> ${City}<br /><b>State:</b> ${State}<br /><b>Zip:</b> ${Zip}<br /><b>Facility ID:</b> ${RegistryID}<br /><b>Sub Facility ID:</b> <input type='text' style='width:40px;' value=''/><br /><b>Interest Type:</b> <select onchange='changeType(" + h + ",this.value)'><option></option><option value='1'>AIR MAJOR</option><option value='2'>LQG</option><option value='3'>NPDES MAJOR</option><option value='4'>RMP REPORTER</option><option value='5'>TRI REPORTER</option></select><br /><input type='button' class='detailsButton' value='Save'/>&nbsp;&nbsp;", j = new e("${Name}", i), k = new b(a.mapPoint, c, g, j); map.graphics.add(k), Fb.push(k), Bb = !1, $("#addButton").removeClass("addMode") } } function lb() { map.graphics.clear(), $(".valueChanged").removeClass("valueChanged"); var a = $("#fstreet").val() + " " + $("#fcity").val() + " " + $("#fstate").val() + ", " + $("#fzip").val(), b = { SingleLine: a }; pb.outSpatialReference = map.spatialReference; var c = { address: b, outFields: ["Loc_name"] }; pb.addressToLocations(c) } function mb(a) { var c = new q, d = new e("Location", "Address: ${address}<br />Score: ${score}<br />Source locator: ${locatorName}"); c.setStyle(q.STYLE_SQUARE), c.setColor(new f([153, 0, 51, .75])); var g; dojo.every(a, function (a) { if (a.score > 80) { var e = { address: a.address, score: a.score, locatorName: a.attributes.Loc_name }; g = a.location; var f = new b(g, c, e, d); map.graphics.add(f); var h = a.address, i = new s("13pt", s.STYLE_NORMAL, s.VARIANT_NORMAL, s.WEIGHT_BOLD, "Helvetica"), j = new r(h, i, new dojo.Color("#666633")); j.setOffset(0, 8), map.graphics.add(new b(g, j)); var k = B.webMercatorToGeographic(g); return fb(k.y, k.x), $("#collectionMethod").val("Geocoded address"), !1 } }), void 0 !== g && map.centerAndZoom(g, 16) } function nb(a, b) { map.centerAndZoom(a, b) } function ob() { map.resize(), map.reposition() } M.parse(), dojo.ready(O); var pb, qb, rb, sb, tb, ub, vb, wb, xb, yb = [], zb = 0, Ab = !1, Bb = !1, Cb = !1, Db = !1, Eb = [], Fb = [], Gb = []; window.zoomToFacility = bb, window.editAddress = V, window.showSubLayers = S, window.hideSubLayers = T, window.beginLocate = R, window.engageAddSubMode = jb, window.activateToolbar = Z, window.multiErrors = _, window.getHTML5Location = hb, window.locate = lb, window.showErrorReport = Y, window.engageAddMode = cb, window.removeValueChangedClass = gb, window.locateCoords = eb, window.mapCenterAndZoomGlobal = nb, window.filterSubLayer = U });