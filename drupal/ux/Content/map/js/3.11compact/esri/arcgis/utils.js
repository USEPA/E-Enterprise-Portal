// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(r,k,g,s,n,f,u,e,b,c){r=r([b],{declaredClass:"esri.layers._OnDemandMode",constructor:function(l){this.featureLayer=l;this._featureMap={};this._queryErrorHandler=g.hitch(this,this._queryErrorHandler)},initialize:function(l){this.inherited(arguments);var b=this.featureLayer,
d=b._srInfo;this._gridLayer=new c(new u(d?d.valid[0]:l.extent.xmin,l.extent.ymax,l.spatialReference),{width:b._tileWidth,height:b._tileHeight},{width:l.width,height:l.height},d);this._cellMap={};this._gridLayer.setResolution(l.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(l){this._init&&(2>l?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(l){var b=this._gridLayer,d=l.geometry,c=[];if(d)for(var c=b.getCellsInExtent("point"===d.type?{xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y}:d.getExtent(),!1).cells,b=this._cellMap,h,a=l.attributes[this.featureLayer.objectIdField],p,q,t,d=0;d<c.length;d++)h=c[d],p=h.latticeID,q=h.row,t=h.col,p?h=b[p]=b[p]||h:(b[q]=b[q]||{},h=b[q][t]=b[q][t]||h),h.features=
h.features||[],h.features.push(l),this._addFeatureIIf(a,l),this._incRefCount(a)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var b=this.map;this._zoomConnect=k.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=k.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=k.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){k.disconnect(this._zoomConnect);
k.disconnect(this._panConnect);k.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,c=this.map;b.suspended||(b._fireUpdateStart(),this._clearIIf(),(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(c.extent),this._sendRequest())},_panHandler:function(b){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&b)},_getRequestId:function(b,c){return("_"+b.name+b.layerId+b._ulid+"_"+c.resolution+
"_"+(c.latticeID||c.row+"_"+c.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(b){this._exceeds=!1;var c=this.featureLayer,d=this.map;b=b||d.extent;d=this._gridLayer.getCellsInExtent(b,c.latticeTiling).cells;if(!c.isEditable())var g=this._cellMap,d=s.filter(d,function(a){if(a.lattice){if(g[a.latticeID])return!1}else if(g[a.row]&&g[a.row][a.col])return!1;return!0});var h=c.getOutFields(),a=c.getDefinitionExpression(),p=c._getOffsettedTE(c._mapTimeExtent),q=c.supportsAdvancedQueries?c.getOrderByFields():
null,t=c._usePatch,x=this._ioQueue,w,m=this,z=this._drawFeatures,A,f,L;this._pending=this._pending||0;for(w=0;w<d.length;w++){A=d[w];f=new e;f.geometry=A.extent||A.lattice;f.outFields=h;f.where=a;c.latticeTiling&&A.extent&&(f.spatialRelationship=e.SPATIAL_REL_CONTAINS);f.returnGeometry=!0;f.timeExtent=p;f.maxAllowableOffset=c._maxOffset;c._ts&&(f._ts=(new Date).getTime());f.orderByFields=q;f.multipatchOption=c.multipatchOption;L=null;if(t&&(L=this._getRequestId(c,A),this._isPending(L)))continue;this._pending++;
x.push(c._task.execute(f,function(){var a=A;return function(p){z.apply(m,[p,a])}}.call(this),this._queryErrorHandler,L))}this._removeOldCells(b);this._endCheck()},_drawFeatures:function(b,c){this._exceeds=this._exceeds||b.exceededTransferLimit;this._finalizeIO();var d=this.map.extent,e=c.extent,h=c.row,a=c.col,p=this.featureLayer.objectIdField,q=b.features,t=this._gridLayer,x=this._cellMap,w=c.latticeID,m=w?x[w]:x[h]&&x[h][a];if(c.resolution!=t._resolution||(w?w!==t.getLatticeID(d):!t.intersects(e,
d)))m&&this._removeCell(h,a,w);else if(m)this._updateCell(m,q);else{c.features=q;w?x[w]=c:(x[h]=x[h]||{},x[h][a]=c);e=q.length;for(d=0;d<e;d++)h=q[d],a=h.attributes[p],this._addFeatureIIf(a,h),this._incRefCount(a)}this._endCheck()},_queryErrorHandler:function(b){this._finalizeIO();this.featureLayer._errorHandler(b);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var c=this.featureLayer,d=c._trackManager;
d&&(d.clearTracks(),d.addFeatures(c.graphics),c._ager&&s.forEach(c.graphics,function(b){b._shape&&c._repaint(b)}),d.moveLatestToFront(),d.drawTracks());this.featureLayer._fireUpdateEnd(b&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)c.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=s.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});b&&s.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(b){var c=
this._cellMap,d=this._gridLayer,e,h;for(e in c)if(c[e]){var a=c[e],p=a.latticeID,q=0,t=0;if(p)q++,p!==d.getLatticeID(b)&&(this._removeCell(null,null,p),t++);else for(h in a)a[h]&&(q++,d.intersects(a[h].extent,b)||(this._removeCell(e,h),t++));t===q&&delete c[e]}},_updateCell:function(b,c){var d=this.featureLayer,e=d.objectIdField,d=d._selectedFeatures,h,a=c.length;b.features=b.features||[];for(h=0;h<a;h++){var p=c[h],q=p.attributes[e],t=this._addFeatureIIf(q,p);t===p?(this._incRefCount(q),b.features.push(t)):
q in d||(t.setGeometry(p.geometry),t.setAttributes(p.attributes))}},_removeCell:function(b,c,d){var e=this._cellMap,h=this.featureLayer,a=h.objectIdField,p=d?e[d]:e[b]&&e[b][c];if(p){d?delete e[d]:delete e[b][c];b=p.features;for(c=0;c<b.length;c++)d=b[c].attributes[a],this._decRefCount(d),d in h._selectedFeatures||this._removeFeatureIIf(d)}}});n("extend-esri")&&g.setObject("layers._OnDemandMode",r,f);return r})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(r,k,g,s,n,f){return r([f,n],{_onMap:function(f){var e=this.constructor._onMap,b;if(!e||!e.FINAL)delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0;f=f.toLowerCase();e[f]?b=this[e[f].method]:(f=this._onCamelCase(f),this[f]&&(b=f));return b},on:function(f,e){var b=this._onMap(f),c=f.replace(/\-/g,""),l="on"+c in this.domNode;return b||!l?this.inherited(arguments):this.own(s(this.domNode,c,e))[0]},emit:function(f,e,b){var c,l,y,d=f.toLowerCase(),g=this.constructor._onMap||
this.registerConnectEvents();l=this[this._onMap(d)];e=e||{};e.target||(e.target=this);l&&(g&&g[d])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},g[d].argKeys)(e),y=k.mixin({},arguments),y[2]=c,y[0]=g[d].name.replace(/^on/,""));return this.inherited(y||arguments)}})})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ./MapImageLayer ./MapImage ./FeatureLayer ../renderers/HeatmapRenderer ../tasks/query".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d,v){function h(){}r=r(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){var p=a.renderer;this.sourceLayer=a;this.heatmapRenderer=p;this._hndls=[]},initialize:function(a){this.map=a;this.sourceLayer.setDrawMode(!1);var p=this,b=this.imageLayer=new c({className:"heatmapImgLyr"});!this.heatmapRenderer&&(this.sourceLayer&&this.sourceLayer.renderer)&&(this.heatmapRenderer=
this.sourceLayer.renderer);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._scRenderHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);a.addLayer(b);f(["../workers/heatmapCalculator"],function(a){p._calculator=new a(k.mixin({width:p.map.width,height:p.map.height},p._getOptions()));p._setupRenderer()})},destroy:function(){this._removeHandlers();
this._scRenderHandle.remove();this.map.removeLayer(this.imageLayer);this.sourceLayer.setRenderer(null);this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=this._scRenderHandle=null},_handleRendererChange:function(a){var p=a.renderer,b=p instanceof d;this.heatmapRenderer?b?this.heatmapRenderer=p:this._removeRenderer(a):b&&(this.heatmapRenderer=p,this._setupRenderer())},_setupRenderer:function(){var a=this._hndls,p=this.sourceLayer,b=this.map;p._originalDraw=p._draw;p._draw=h;
var c=this;a.push(p.on("update-end",function(a){c.recalculateHeatmap()}));a.push(p.on("suspend",function(a){c.imageLayer.suspend()}));a.push(p.on("resume",function(a){c.imageLayer.resume()}));a.push(s.after(p,"redraw",this.recalculateHeatmap));a.push(b.on("layer-remove",function(a){a.layer==c.sourceLayer&&b.removeLayer(c.imageLayer)}));p.mode!==y.MODE_ONDEMAND&&a.push(b.on("resize, zoom-end, pan-end",function(a){setTimeout(c.recalculateHeatmap,16)}));p.graphics&&p.graphics.length&&this.recalculateHeatmap()},
_removeRenderer:function(a){a=a.target;a._draw=a._originalDraw;delete a._originalDraw;a.setDrawMode(!0);this.heatmapRenderer=null;this._removeHandlers();this._hndls=[]},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,p=this.imageLayer,c=this.map,d=this.heatmapRenderer,h=this.map.extent,w=this.map.width,m=this.map.height,z=this._calculator,
e=this,y=function(y){y=y.features;var f=[],g=y.length,L=0,v,O=c.toScreen(new b(0,0)),s=O.x,O=O.y,r=c.getResolution(),u=0;c.extent._parts&&(u=n.map(c.extent._parts,function(p){return Math.abs(a._intersects(c,p.extent)[0])}),u.sort(function(a,p){return p-a}),u=u[0]);for(;g--;)v=y[g],v.geometry&&(v={x:Math.abs(Math.ceil(v.geometry.x/r+s)),y:Math.abs(Math.floor(v.geometry.y/r-O)),attributes:v.attributes},v.x>c.width&&(v.x-=u),0>v.x&&(v.x+=u),f[L++]=v);y=z.calculateImageData(k.mixin({screenPoints:f,mapinfo:{extent:[h.xmin,
h.ymin,h.xmax,h.ymax],resolution:c.getResolution()},width:w,height:m},e._getOptions()));y=d.getSymbol({geometry:c.extent,attributes:{size:[w,m],imageData:y}});y=new l({extent:c.extent,href:y.url});p.addImage(y);setTimeout(function(){var a=p._mapImages.slice(0,-1),b=a.length;if(1E3<b)a=p._mapImages[b],p.removeAllImages(),p.addImage(a);else for(;b--&&a[b];)p.removeImage(a[b])},250)},f={geometry:c.extent,timeExtent:c.timeExtent,spatialRelationship:v.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(f)?
a.queryFeatures(f,y):y({features:a.graphics})},_removeHandlers:function(){for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field}}});e("extend-esri")&&k.setObject("layers.HeatmapManager",r,u);return r})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),
function(r,k,g,s,n,f,u){var e={_isElementShown:function(b){var c=s.get(b);return"hidden"!=c.visibility&&"collapsed"!=c.visibility&&"none"!=c.display&&"hidden"!=g.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return g.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var c;try{var l=b.contentDocument;if("designMode"in l&&"on"==l.designMode)return!0;c=l.body}catch(y){try{c=b.contentWindow.document.body}catch(d){return!1}}return c&&
("true"==c.contentEditable||c.firstChild&&"true"==c.firstChild.contentEditable);default:return"true"==b.contentEditable}},effectiveTabIndex:function(b){return g.get(b,"disabled")?void 0:g.has(b,"tabIndex")?+g.get(b,"tabIndex"):e.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=e.effectiveTabIndex(b)},isFocusable:function(b){return-1<=e.effectiveTabIndex(b)},_getTabNavigable:function(b){function c(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&
a.name&&a.name.toLowerCase()}var l,y,d,v,h,a,p={},q=e._isElementShown,t=e.effectiveTabIndex,x=function(b){for(b=b.firstChild;b;b=b.nextSibling)if(!(1!=b.nodeType||9>=f("ie")&&"HTML"!==b.scopeName||!q(b))){var m=t(b);if(0<=m){if(0==m)l||(l=b),y=b;else if(0<m){if(!d||m<v)v=m,d=b;if(!h||m>=a)a=m,h=b}m=c(b);g.get(b,"checked")&&m&&(p[m]=b)}"SELECT"!=b.nodeName.toUpperCase()&&x(b)}};q(b)&&x(b);return{first:p[c(l)]||l,last:p[c(y)]||y,lowest:p[c(d)]||d,highest:p[c(h)]||h}},getFirstInTabbingOrder:function(b,
c){var l=e._getTabNavigable(k.byId(b,c));return l.lowest?l.lowest:l.first},getLastInTabbingOrder:function(b,c){var l=e._getTabNavigable(k.byId(b,c));return l.last?l.last:l.highest}};n.mixin(u,e);return e})},"esri/renderers/HeatmapRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct ../sniff ../kernel ../lang ../symbols/PictureMarkerSymbol ./Renderer".split(" "),function(r,k,g,s,n,f,u,e){r=r([e],{declaredClass:"esri.renderer.HeatmapRenderer",colors:null,blurRadius:10,
maxPixelIntensity:100,minPixelIntensity:0,field:null,constructor:function(b){this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1;this._supportTypedArray=window.ArrayBuffer?!0:!1;this._supportsCanvas?this._supportTypedArray?("string"==typeof b&&(b=JSON.parse(b)),k.mixin(this,b),this._canvas=null,this.colors||(this.colors=["rgba(255, 140, 0, 0)","rgba(255, 140, 0, 1)","rgba(255, 0,   0, 1)"]),this.gradient=this._generateGradient(this.colors)):console.log("The HeatmapRenderer requires a browser that supports TypedArrays. IE9 and less do not support TypedArrays."):
console.log("The HeatmapRenderer requires a Canvas enabled Browser.  IE8 and less does not support Canvas.")},getSymbol:function(b){if(!this._supportsCanvas||!this._supportTypedArray)return!1;var c=b.attributes.imageData;b=b.attributes.size;if(!b)return null;var l=this._getContext(b[0],b[1]),y=l.getImageData(0,0,b[0],b[1]);c instanceof ArrayBuffer?c=window.Uint8ClampedArray?new Uint8ClampedArray(c):new Uint8Array(c):c.BYTES_PER_ELEMENT&&1!==c.BYTES_PER_ELEMENT&&(c=window.Uint8ClampedArray?new Uint8ClampedArray(c.buffer):
new Uint8Array(c.buffer));if(window.CanvasPixelArray&&y.data instanceof window.CanvasPixelArray)for(var d=y.data,e=d.length;e--;)d[e]=c[e];else y.data.set(c);l.putImageData(y,0,0);return new u(l.canvas.toDataURL(),b[0],b[1])},setColors:function(b){if(b&&(b instanceof Array||b.colors))this.gradient=this._generateGradient(b.colors||b)},setMaxPixelIntensity:function(b){this.maxPixelIntensity=b},setMinPixelIntensity:function(b){this.minPixelIntensity=b},setField:function(b){this.field=b},setBlurRadius:function(b){this.blurRadius=
b},toJson:function(){var b=k.mixin(this.inherited(arguments),{type:"heatmap",blurRadius:this.blurRadius,colors:this.colors instanceof Uint32Array?null:this.colors,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity,field:this.field});return f.fixJson(b)},_getContext:function(b,c){this._canvas?(this._canvas.width=b,this._canvas.height=c):this._canvas=this._initCanvas(b,c);return this._canvas.getContext("2d")},_initCanvas:function(b,c){var l=g.create("canvas",{id:"hm_canvas-"+
Math.floor(1E3*Math.random()),style:"position: absolute; left: -10000px; top: 0px;"},null);l.width=b;l.height=c;document.body.appendChild(l);return l},_generateGradient:function(b,c){c||(c=512);var l=this._getContext(1,c||512),e=l.createLinearGradient(0,0,0,c),d,f=b.length-1;for(d=0;d<=f;d++)e.addColorStop(d/f,b[d]);l.fillStyle=e;l.fillRect(0,0,1,c);l=l.getImageData(0,0,1,c).data;return l.buffer?new Uint32Array(l.buffer):new Uint32Array((new Uint8Array(l)).buffer)}});s("extend-esri")&&k.setObject("renderer.HeatmapRenderer",
r,n);return r})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(r,k,g,s,n,f,u,e,b,c){r=r([c],{declaredClass:"esri.layers._StreamMode",constructor:function(b,c){this.featureLayer=b;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=k.hitch(this,this._flushDrawBuffer);
this._drawFeatures=k.hitch(this,this._drawFeatures);this._queryErrorHandler=k.hitch(this,this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(b){this._init&&(0===b?this._applyTimeFilter():3===b?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},drawFeature:function(b){var c=this.featureLayer,d=c.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,
this._refreshRate));c._joinField&&this._getFeature(b.attributes[d])?this._drawBuffer.updates.push({oid:b.attributes[d],updates:b}):this._drawBuffer.adds.push(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;b._collection?(b._fireUpdateStart(),b._refresh(!0),b._fireUpdateEnd()):this._fetchArchive()},_drawFeatures:function(b){this._purgeRequests();var c=this.featureLayer;c._create(b.features||[]);c._fireUpdateEnd(null,null)},_applyTimeFilter:function(b){this.inherited(arguments);
this._redrawAllTracks()},_removeFeatures:function(b){var c=this.featureLayer,d=c.objectIdField;b&&g.forEach(b,function(b){b=b.attributes[d];c._unSelectFeatureIIf(b,this);this._decRefCount(b);this._removeFeatureIIf(b)},this)},_addFeatures:function(b){var c=this.featureLayer,d,e,h,a=[],p=[],q=[];d=c._trackManager;e=c.objectIdField;if(d)for(h in b=d.addFeatures(b),b)b.hasOwnProperty(h)&&(a.push(h),b[h].adds&&(p=p.concat(b[h].adds)),b[h].deletes&&(q=q.concat(b[h].deletes)));else p=b;g.forEach(p,function(a){var b=
a.attributes[e];this._addFeatureIIf(b,a);this._incRefCount(b)},this);q.length&&this._removeFeatures(q);d&&d.refreshTracks(a)},_updateFeatures:function(b){var c=this.featureLayer,d,e,h=[];d=c._trackManager;e=c._trackIdField;g.forEach(b,function(a){var b=a.updates;a=this._getFeature(a.oid);var q;if(a){b.geometry&&(a.geometry=b.geometry);b=b.attributes||{};for(q in b)b.hasOwnProperty(q)&&(a.attributes[q]=b[q]);a.visible=this._checkFeatureTimeIntersects(a);d&&a.attributes[e]?h.push(a.attributes[e]):c._repaint(a,
null,!0)}},this);h.length&&d.refreshTracks(h)},_redrawAllTracks:function(){var b=this.featureLayer._trackManager,c;if(b&&(c=b.trimTracks())&&0<c.length)this._removeFeatures(c),b.refreshTracks()},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var b=this._drawBuffer,c=b.adds.splice(0,b.adds.length),b=b.updates.splice(0,b.updates.length),d=this.featureLayer;if(!d)return!1;d.onUpdateStart();this._addFeatures(c);this._updateFeatures(b);d._purge();d.onUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var b=
this._timeoutId,c=this._drawBuffer,d=c.adds,c=c.updates;b&&clearTimeout(b);d.splice(0,d.length);c.splice(0,c.length);this._timeoutId=null},_setRefreshRate:function(b){b=b||0===b?b:200;0>b&&(b=200);this._refreshRate=b},_checkFeatureTimeIntersects:function(b){var c=this.featureLayer,d=c.getMap().timeExtent;return!d||!c.timeInfo||!c.timeInfo.startTimeField&&!c.timeInfo.endTimeField?!0:0<c._filterByTime([b],d.startTime,d.endTime).match.length},_getRequestId:function(b){return("_"+b.name+b.layerId+b._ulid).replace(/[^a-zA-Z0-9\_]+/g,
"_")},_fetchArchive:function(c){var g=this.featureLayer,d,k,h,a,p,q;g._fireUpdateStart();if(c)c=new e(c),d=new u,k=this.map,h=g.getFilter()||{},a=h.where||"1\x3d1",p=h.geometry?b.fromJson(h.geometry):null,h=h.outFields?h.outFields.split(","):["*"],d.geometry=p,d.where=a,d.outFields=h,d.returnGeometry=!0,d.outSpatialReference=new f(k.spatialReference.toJson()),g._usePatch&&(q=this._getRequestId(g),this._cancelPendingRequest(null,q)),c.execute(d,this._drawFeatures,this._queryErrorHandler,q);else return this._fireUpdateEnd({error:"No url provided"}),
!1},_queryErrorHandler:function(b){this._purgeRequests();var c=this.featureLayer;c._errorHandler(b);c._fireUpdateEnd(b)}});s("extend-esri")&&k.setObject("layers._StreamMode",r,n);return r})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(r,k,g,s,
n,f,u,e,b,c,l,y,d,v,h,a){r=r(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){k.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels={},d=this._fieldsMap={};a.fieldInfos&&g.forEach(a.fieldInfos,function(a){c[a.fieldName]=a.label;d[a.fieldName]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return s.fromJson(s.toJson(this.info))},
getTitle:function(){},getContent:function(){},getComponents:function(a){var b=this.info,c=new u,d,h;b.fieldInfos&&(h=g.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));h&&0<h.length&&(d=this._getRelatedRecords({graphic:a,fieldsInfo:h}));d?d.always(k.hitch(this,function(){c.resolve(this._getPopupValues(a))})):c.resolve(this._getPopupValues(a));return c.promise},_getPopupValues:function(a,b){var d=this.info,h=a.getLayer(),w=k.clone(a.attributes)||{},m=
k.clone(w),e=d.fieldInfos,f="",l="",y,F,v,n,s,r=h&&h._getDateOpts&&h._getDateOpts().properties,u={dateFormat:{properties:r,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(n in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(n)){var Q=this._relatedInfo[n],B=this._relatedLayersInfo[n];Q&&(g.forEach(Q.relatedFeatures,function(a){for(s in a.attributes)if(a.attributes.hasOwnProperty(s)&&"esriRelCardinalityOneToOne"===B.relation.cardinality){var b=
this._toRelatedFieldName([B.relation.id,s]);w[b]=m[b]=a.attributes[s]}},this),g.forEach(Q.relatedStatsFeatures,function(a){for(s in a.attributes)if(a.attributes.hasOwnProperty(s)){var b=this._toRelatedFieldName([B.relation.id,s]);w[b]=m[b]=a.attributes[s]}},this))}e&&g.forEach(e,function(a){F=a.fieldName;m[F]=this._formatValue(m[F],F,u);r&&(a.format&&a.format.dateFormat)&&(a=g.indexOf(r,F),-1<a&&r.splice(a,1))},this);if(h){n=h.types;var D=(Q=h.typeIdField)&&w[Q];for(F in w)if(w.hasOwnProperty(F)&&
-1===F.indexOf(this._relatedFieldPrefix)&&(v=w[F],c.isDefined(v))){var C=this._getDomainName(h,n,D,F,v);c.isDefined(C)?m[F]=C:F===Q&&(C=this._getTypeName(h,v),c.isDefined(C)&&(m[F]=C))}}d.title&&(f=this._processFieldsInLinks(this._fixTokens(d.title),w),f=k.trim(c.substitute(m,f,u)||""));if(b)return{title:f};d.description&&(l=this._processFieldsInLinks(this._fixTokens(d.description),w),l=k.trim(c.substitute(m,l,u)||""));e&&(y=[],g.forEach(e,function(a){(F=a.fieldName)&&a.visible&&y.push([a.label||
F,c.substitute(m,"${"+F+"}",u)||""])}));var N,J;d.mediaInfos&&(N=[],g.forEach(d.mediaInfos,function(a){J=0;v=a.value;switch(a.type){case "image":var b=v.sourceURL,b=b&&k.trim(c.substitute(w,this._fixTokens(b)));J=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":J=g.some(v.fields,function(a){return c.isDefined(w[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(J){a=k.clone(a);v=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title),
w):"",p=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption),w):"";a.title=b?k.trim(c.substitute(m,b,u)||""):"";a.caption=p?k.trim(c.substitute(m,p,u)||""):"";if("image"===a.type)v.sourceURL=c.substitute(w,this._fixTokens(v.sourceURL)),v.linkURL&&(v.linkURL=k.trim(c.substitute(w,this._fixTokens(v.linkURL))||""));else{var d,q;g.forEach(v.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))q=this._getRelatedChartInfos(a,v,w,u),q instanceof Array?v.fields=q:v.fields[b]=q;else{var p=
w[a],p=void 0===p?null:p;d=w[v.normalizeField]||0;p&&d&&(p/=d);v.fields[b]={y:p,tooltip:(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(p,a,u,!!d)}}},this)}N.push(a)}},this));return{title:f,description:l,fields:y&&y.length?y:null,mediaInfos:N&&N.length?N:null,formatted:m,editSummary:h&&h.getEditSummary?h.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,d){var h,m,e,f,l,y;h=[];y=this._fromRelatedFieldName(a);l=y[0];m=this._relatedInfo[l];l=this._relatedLayersInfo[l];m&&g.forEach(m.relatedFeatures,
function(m){m=m.attributes;var l,g;for(g in m)if(m.hasOwnProperty(g)&&g===y[1]){l={};f=m[g];b.normalizeField&&(e=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?m[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);f&&e&&(f/=e);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var k=this._fromRelatedFieldName(b.tooltipField)[1];l.tooltip=m[k]+":\x3cbr/\x3e"+this._formatValue(f,m[k],d,!!e)}else l.tooltip=(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(f,
b.tooltipField,d,!!e);else l.tooltip=f;l.y=f;h.push(l)}},this);return"esriRelCardinalityOneToMany"===l.relation.cardinality||"esriRelCardinalityManyToMany"===l.relation.cardinality?h:h[0]},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",
longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"[^\"]+\"/ig,_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_processFieldsInLinks:function(a,b){return a&&a.replace(this._reHref,function(a){return a=c.substitute(b,a)})},_formatValue:function(b,d,h,e){var w=this._fieldsMap[d],m=w&&w.format;d="number"===typeof b&&-1===g.indexOf(h.dateFormat.properties,d)&&(!m||!m.dateFormat);if(!c.isDefined(b)||!w||!c.isDefined(m))return d?this._forceLTR(b):b;var f="",l=[],w=m.hasOwnProperty("places")||
m.hasOwnProperty("digitSeparator"),y=m.hasOwnProperty("digitSeparator")?m.digitSeparator:!0;if(w)f="NumberFormat",l.push("places: "+(c.isDefined(m.places)&&(!e||0<m.places)?Number(m.places):"Infinity")),l.length&&(f+="("+l.join(",")+")");else if(m.dateFormat)f="DateFormat"+this._insertOffset(this._dateFormats[m.dateFormat]||this._dateFormats.shortDateShortTime);else return d?this._forceLTR(b):b;b=c.substitute({myKey:b},"${myKey:"+f+"}",h)||"";w&&!y&&a.group&&(b=b.replace(RegExp("\\"+a.group,"g"),
""));return d?this._forceLTR(b):b},_forceLTR:function(a){var b=e("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=c.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,d,h,e){var m,f;b&&c.isDefined(d)&&g.some(b,function(b){if(b.id==d){if((m=b.domains&&b.domains[h])&&"inherited"===m.type)m=this._getLayerDomain(a,h),f=!0;return!0}return!1},this);!f&&!m&&(m=this._getLayerDomain(a,
h));if(m&&m.codedValues){var l;g.some(m.codedValues,function(a){return a.code==e?(l=a.name,!0):!1});return l}},_getLayerDomain:function(a,b){var c=a.fields;if(c){var d;g.some(c,function(a){return a.name===b?(d=a.domain,!0):!1});return d}},_getTypeName:function(a,b){var c=a.types;if(c){var d;g.some(c,function(a){return a.id==b?(d=a.name,!0):!1});return d}},_getRelatedRecords:function(a){var b=a.graphic,c=new u,d;this._relatedLayersInfo?this._queryRelatedLayers(b).then(k.hitch(this,function(a){this._setRelatedRecords(b,
a);c.resolve(a)}),k.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(k.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(b).then(k.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),k.hitch(this,this._handlerErrorResponse,c))}),k.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var c=a.fieldsInfo,d,e,f={};d=a.graphic.getLayer();
this._relatedLayersInfo||(this._relatedLayersInfo={});g.forEach(c,function(a){var b,c,p,q;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(g.some(d.relationships,function(a){if(a.id==c)return q=a,!0}),q&&(this._relatedLayersInfo[c]={relation:q,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(p=new h,p.statisticType=a.statisticType,p.onStatisticField=b,p.outStatisticFieldName=
b,this._relatedLayersInfo[c].outStatistics.push(p))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&this._relatedLayersInfo[e]&&(a=this._relatedLayersInfo[e].relation,a=d.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=a,f[e]=y({url:a,content:{f:"json"},callbackParamName:"callback"}));return b(f)},_queryRelatedLayers:function(a){var c={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(c[d]=this._queryRelatedLayer({graphic:a,
relatedInfo:this._relatedLayersInfo[d]}));return b(c)},_queryRelatedLayer:function(a){var c,h,e,f,m,l,y,k,L,n;c=a.graphic;h=c.getLayer().url.match(/[0-9]+$/g)[0];k=a.relatedInfo;y=k.relatedLayerInfo;L=k.relatedLayerUrl;n=k.relation;g.some(y.relationships,function(a){if(a.relatedTableId===parseInt(h,10))return e=a,!0},this);e&&(a=new d,g.some(y.fields,function(a){if(a.name===e.keyField)return m=-1!==g.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],
a.type)?"number":"string",!0}),f="string"===m?e.keyField+"\x3d'"+c.attributes[n.keyField]+"'":e.keyField+"\x3d"+c.attributes[n.keyField],a.where=f,a.outFields=k.relatedFields,k.outStatistics&&(0<k.outStatistics.length&&y.supportsStatistics)&&(l=new d,l.where=a.where,l.outFields=a.outFields,l.outStatistics=k.outStatistics),c=new v(L),f=[],f.push(c.execute(a)),l&&f.push(c.execute(l)));return b(f)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var d in b)if(b.hasOwnProperty(d)&&b[d]){var h=
b[d];this._relatedInfo[d]={};this._relatedInfo[d].relatedFeatures=h[0].features;c.isDefined(h[1])&&(this._relatedInfo[d].relatedStatsFeatures=h[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});f("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=r);return r})},
"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(r,k,g,s,n,f,u){n.add("highcontrast",function(){var e=u.doc.createElement("div");e.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(k.blankGif||r.toUrl("./resources/blank.gif"))+'");';u.body().appendChild(e);var b=s.getComputedStyle(e),c=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||
c&&("none"==c||"url(invalid-url:)"==c);8>=n("ie")?e.outerHTML="":u.body().removeChild(e);return b});f(function(){n("highcontrast")&&g.add(u.body(),"dj_a11y")});return n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d,v,h,a,p,q,t,x,w,m,z){function A(a){return function(b){e[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}d.add("dijit-legacy-requires",!v.isAsync);d.add("dojo-bidi",!1);d("dijit-legacy-requires")&&p(0,function(){r(["dijit/_base/manager"])});var O={};s=f("dijit._WidgetBase",[q,w],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:A("lang"),dir:"",_setDirAttr:A("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:s.blankGif||r.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,
d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=u.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,h.mixin(this,a));this.postMixInProperties();this.id||(this.id=z.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=x.body(this.ownerDocument);z.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);k.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(k.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,k.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&h.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();k.forEach(this._connects,h.hitch(this,"disconnect"));k.forEach(this._supportingWidgets,b);this.domNode&&k.forEach(z.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
z.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?e.remove(this.domNode,"widgetId"):c.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||c.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){k.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;h.isObject(a)?
y.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,d){d=3<=arguments.length?d:this.attributeMap[a];k.forEach(h.isArray(d)?d:[d],function(d){var p=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":h.isFunction(c)&&(c=h.hitch(this,c));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;p.tagName?e.set(p,d,c):p.set(d,c);break;case "innerText":p.innerHTML="";p.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":p.innerHTML=c;break;case "class":b.replace(p,c,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(h.isFunction(d))var p=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!h.isFunction(this.focusNode)?"focusNode":"domNode",m=this[d]&&this[d].tagName,e;if(e=m)if(!(e=
O[m])){e=this[d];var q={},f;for(f in e)q[f.toLowerCase()]=!0;e=O[m]=q}f=e;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:f&&c.l in f&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return p||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(b,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var p,h=this["on"+b];h&&(p=h.apply(this,d?d:[c]));this._started&&!this._beingDestroyed&&
a.emit(this.domNode,b.toLowerCase(),c);return p},on:function(b,c){var d=this._onMap(b);return d?g.after(this,d,c,!0):this.own(a(this.domNode,b,c))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?z.findWidgets(this.containerNode):
[]},getParent:function(){return z.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(n.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(t.subscribe(a,h.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:l.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=y.get(this.domNode,"display")},placeAt:function(a,b){var d=!a.tagName&&
z.byId(a);d&&d.addChild&&(!b||"number"===typeof b)?d.addChild(this,b):(d=d&&"domNode"in d?d.containerNode&&!/after|before|replace/.test(b||"")?d.containerNode:d.domNode:u.byId(a,this.ownerDocument),c.place(this.domNode,d,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(h.hitch(this,function(){c&&(c=null,this._destroyed||h.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});d("dojo-bidi")&&
s.extend(m);return s})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d,v,h,a,p,q,t,x,w,m,z,A,O,L,F,H,Z,P,X,$,Q,B,D,C,N,J,E,I,Y,G,T,R,U,ua,aa,ba,ca,da){var ea=t.defaults,K=g(N,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=da;b=b||{};this.showLabels=null!=b.showLabels?b.showLabels:!0;
this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?
!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;
this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=K,c=this.mode=p.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=d.MODE_SNAPSHOT;this._mode=new R(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=
d.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new U(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new ua(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new aa(this),this._isStream=!0}this._initLayer=n.hitch(this,this._initLayer);this._selectHandler=n.hitch(this,this._selectHandler);this._editable=!1;if(n.isObject(a)&&a.layerDefinition)return this._collection=
!0,this.mode=this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._initLayer(a),this;this._task=new Z(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=b.resourceInfo)?this._initLayer(d):(this.source&&(d={source:this.source.toJson()},this._url.query=n.mixin(this._url.query,{layer:u.toJson(d)})),this.gdbVersion&&(this._url.query=
n.mixin(this._url.query,{gdbVersion:this.gdbVersion})),q({url:c,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||(this.currentMode=K.MODE_SNAPSHOT,this._mode=new R(this)),this._isSnapshot=!0,this._featureSet=
a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var d=this.capabilities=a.capabilities;d&&-1!==d.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);p.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):
"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=u.toJson(this._json);if(this.isEditable())delete this._maxOffset;else if(this.currentMode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))this._autoGeneralize=p.isDefined(this._optAutoGen)?this._optAutoGen:this.currentMode===K.MODE_ONDEMAND,delete this._optAutoGen;var d=a.effectiveMinScale||a.minScale,h=a.effectiveMaxScale||a.maxScale;!this._hasMin&&
d&&this.setMinScale(d);!this._hasMax&&h&&this.setMaxScale(h);this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new Q(a.extent);this.initialExtent=new Q(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new w(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===
this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=
this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=p.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:
!0;this._isTable="Table"===this.type;for(var e=this.fields=[],h=a.fields,d=0;d<h.length;d++)e.push(new J(h[d]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){h=a.fields;for(d=0;d<h.length;d++)if(e=h[d],"esriFieldTypeOID"===e.type){this.objectIdField=e.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+p.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!p.isDefined(this._nextId)){h=this.objectIdField;e=-1;if(this._collection&&
h)for(var q=(d=this._featureSet)&&d.features,l=q?q.length:0,t,d=0;d<l;d++)t=(t=q[d].attributes)&&t[h],t>e&&(e=t);this._nextId=e+1}this.globalIdField=a.globalIdField;if(d=this.typeIdField=a.typeIdField)if(d=!this._getField(d)&&this._getField(d,!0))this.typeIdField=d.name;this.visibilityField=a.visibilityField;if(h=a.defaultSymbol)this.defaultSymbol=O.fromJson(h);var g=this.types=[],x=a.types,y,k,e=(d=this.editFieldsInfo)&&d.creatorField,q=d&&d.editorField;t=e||q;l=[];if(x)for(d=0;d<x.length;d++)y=
new I(x[d]),k=y.templates,t&&(k&&k.length)&&(l=l.concat(k)),g.push(y);x=a.templates;y=this.templates=[];if(x)for(d=0;d<x.length;d++)g=new Y(x[d]),t&&l.push(g),y.push(g);for(d=0;d<l.length;d++)if(t=n.getObject("prototype.attributes",!1,l[d]))e&&delete t[e],q&&delete t[q];if(d=a.timeInfo)this.timeInfo=new E(d),this._startTimeField=d.startTimeField,this._endTimeField=d.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?d.trackIdField=this._trackIdField:
this._trackIdField=d.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var d=a.drawingInfo,v;if((e=d&&d.labelingInfo)&&!this.labelingInfo)this.labelingInfo=f.map(e,function(a){return new T(a)}),this._fixLabelExpr();if(!this.renderer)if(d&&d.renderer){if(v=d.renderer,this.setRenderer(H.fromJson(v)),"classBreaks"===v.type&&this.renderer.setMaxInclusive(!0),!this._collection){var s=v.type,h=[];v=this.renderer;switch(s){case "simple":h.push(v.symbol);
break;case "uniqueValue":case "classBreaks":h.push(v.defaultSymbol),h=h.concat(f.map(v.infos,function(a){return a.symbol}))}var h=f.filter(h,p.isDefined),r=this._url.path+"/images/",B=this._getToken();f.forEach(h,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=r+b),B&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+B))})}}else if(h)x=this.types,0<x.length?(v=new F(this.defaultSymbol,this.typeIdField),f.forEach(x,function(a){v.addValue(a.id,a.symbol)})):v=
new L(this.defaultSymbol),this.setRenderer(v);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":s=new m;break;case "esriGeometryPolyline":s=new z;break;case "esriGeometryPolygon":s=new A;break;default:this.hasXYFootprint()&&(s=new A)}this.setRenderer(s?new L(s):null)}s=d&&d.transparency||0;!this.hasOwnProperty("opacity")&&0<s&&(this.opacity=1-s/100);this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||
"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);if((c("ie")||7<=c("trident")||c("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.statistics=a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var P=function(){this.currentMode!==K.MODE_SNAPSHOT&&(this.queryPagination=!1);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?
(s=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new X(s)),this._fcAdded=!0,P.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;P.call(a)})}:P)}},setShowLabels:function(a){this.showLabels=a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||
!a.observationRenderer);if(a){var b=[],a=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],p.isDefined);f.forEach(a,function(a){n.isFunction(a.attributeField)||b.push(a.attributeField);b.push(a.attributeField2);b.push(a.attributeField3)},this);this._rendererFields=f.filter(b,p.isDefined)}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);
this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),c=this._mode,d=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,
"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=d._selectedFeatures[a&&a[d.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);s.disconnect(this._zoomConnect);s.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){var a=this._mode;
a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return f.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=
a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=a&&a.userId;var d=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],n.trim),p=-1<f.indexOf(d,"editing"),h=p&&-1<f.indexOf(d,"create"),b=p&&-1<f.indexOf(d,"update"),d=p&&-1<f.indexOf(d,"delete"),m=this.ownershipBasedAccessControlForFeatures,e=this.editFieldsInfo,q=e&&
e.creatorField,e=e&&e.realm,c=(c=c&&c.attributes)&&q?c[q]:void 0,l=!!this.userIsAdmin,q=!m||l||!(!m.allowOthersToUpdate&&!m.allowUpdateToOthers),m=!m||l||!(!m.allowOthersToDelete&&!m.allowDeleteToOthers);if(l||p&&!h&&!b&&!d)h=b=d=!0;p={canCreate:h,canUpdate:b,canDelete:d};null===c?(p.canUpdate=b&&q,p.canDelete=d&&m):""!==c&&c&&((a=a||this.getUserId())&&e&&(a=a+"@"+e),a.toLowerCase()!==c.toLowerCase()&&(p.canUpdate=b&&q,p.canDelete=d&&m));return p},getUserId:function(){var a;this.loaded&&(a=this.credential&&
this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=p.isDefined(c)?c:(new Date).getTime();var d="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(n.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var h=c.timeValue,m=0;a&&m++;b&&m++;p.isDefined(h)&&m++;1<m&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(p.isDefined(h)?
c.displayPattern:""))}d=d&&p.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=p.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";var d=this.editFieldsInfo,h=d&&d.creatorField,m=d&&d.creationDateField,e=d&&d.editorField,d=d&&d.editDateField,e=(a=a&&a.attributes)&&e?a[e]:void 0,d=a&&d?a[d]:null,h=this._getEditData(a&&h?a[h]:void 0,a&&m?a[m]:null,c);c=this._getEditData(e,d,c);var q;switch(b){case "creation":q=h;break;case "edit":q=c;break;
case "last":q=c||h}q&&(q.action=q===c?"edit":"creation");return q}},_getEditData:function(a,c,d){var h,m,e;p.isDefined(c)&&(m=d-c,e=0>m?"Full":6E4>m?"Seconds":12E4>m?"Minute":36E5>m?"Minutes":72E5>m?"Hour":864E5>m?"Hours":6048E5>m?"WeekDay":"Full");if(void 0!==a||e)h=h||{},h.userId=a,e&&(a=b.format,d=new Date(c),h.minutes=Math.floor(m/6E4),h.hours=Math.floor(m/36E5),h.weekDay=a(d,{datePattern:"EEEE",selector:"date"}),h.formattedDate=a(d,{selector:"date"}),h.formattedTime=a(d,{selector:"time"}),h.displayPattern=
e,h.timeValue=c);return h},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||(this._maxOffset=a);return this},getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&this.currentMode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))if(this._autoGeneralize=a){if((a=this._map)&&a.loaded)this._maxOffset=
Math.floor(a.extent.getWidth()/a.width)}else delete this._maxOffset}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=n.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},
getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);
return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,d){b=b||K.SELECTION_NEW;a=this._getShallowClone(a);var p=this._map,h,m=this,q=x._fixDfd(new e(x._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;p&&(a.outSpatialReference=new w(p.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return h={features:[]},this._selectHandler(h,
b,c,d,q),q;if(p=this._canDoClientSideQuery(a))q._pendingDfd=v(this._doQuery(a,p)),q._pendingDfd.then(function(a){h={features:a};m._selectHandler(h,b,c,d,q)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,d,q,!0),q;var f=this;this._ts&&(a._ts=(new Date).getTime());(q._pendingDfd=this._task.execute(a)).addCallbacks(function(a){f._selectHandler(a,b,c,d,q)},function(a){f._resolve([a],null,d,q,!0)})}return q},getSelectedFeatures:function(){var a=
this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,d;for(d in b)b.hasOwnProperty(d)&&(this._unSelectFeatureIIf(d,c),c._removeFeatureIIf(d));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},
getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,d=function(a,b){var d=c._getField(b,!0);return"["+(d&&d.name||b)+"]"};f.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=b.replace(a,d)})},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],
e:4,f:1}],applyEdits:function(a,b,c,d,p,h){var m=h.assembly,e=h.dfd;this._applyNormalized(a,m&&m[0]);this._applyNormalized(b,m&&m[1]);this.onBeforeApplyEdits(a,b,c);var l={},t=this.objectIdField,m={f:"json"},x=!1;if(this._collection)h={},h.addResults=a?f.map(a,function(){x=!0;return{objectId:this._nextId++,success:!0}},this):null,h.updateResults=b?f.map(b,function(a){x=!0;var b=a.attributes[t];l[b]=a;return{objectId:b,success:!0}},this):null,h.deleteResults=c?f.map(c,function(a){x=!0;return{objectId:a.attributes[t],
success:!0}},this):null,x?this._editHandler(h,a,l,d,p,e):this._resolve([h.addResults,h.updateResults,h.deleteResults],null,d,e);else{a&&0<a.length&&(m.adds=this._convertFeaturesToJson(a,0,1),x=!0);if(b&&0<b.length){for(h=0;h<b.length;h++){var g=b[h];l[g.attributes[t]]=g}m.updates=this._convertFeaturesToJson(b,0,0,1);x=!0}if(c&&0<c.length){b=[];for(h=0;h<c.length;h++)b.push(c[h].attributes[t]);m.deletes=b.join(",");x=!0}if(x){var w=this;return q({url:this._url.path+"/applyEdits",content:n.mixin(m,
this._url.query),callbackParamName:"callback",load:function(b){w._editHandler(b,a,l,d,p,e)},error:function(a){w._resolve([a],null,p,e,!0)}},{usePost:!0})}this._resolve([],null,d,e)}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,
b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,b,c){var d=this._url.path+"/"+a+"/attachments",h=new e(x._dfdCanceller),p=this;h._pendingDfd=q({url:d,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(c){c=c.attachmentInfos;var m;f.forEach(c,function(b){m=l.objectToQuery({gdbVersion:p._url.query&&p._url.query.gdbVersion,
layer:p._url.query&&p._url.query.layer,token:p._getToken()});b.url=d+"/"+b.id+(m?"?"+m:"");b.objectId=a});p._resolve([c],"onQueryAttachmentInfosComplete",b,h)},error:function(a){p._resolve([a],null,c,h,!0)}});return h},addAttachment:function(a,b,c,d){return this._sendAttachment("add",a,b,c,d)},updateAttachment:function(a,b,c,d,h){c.appendChild(y.create("input",{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,c,d,h)},deleteAttachments:function(a,b,c,d){var h=this._url.path+
"/"+a+"/deleteAttachments",p=new e(x._dfdCanceller),m=this;b={f:"json",attachmentIds:b.join(",")};p._pendingDfd=q({url:h,content:n.mixin(b,this._url.query),callbackParamName:"callback",load:n.hitch(this,function(b){b=b.deleteAttachmentResults;b=f.map(b,function(b){b=new G(b);b.attachmentId=b.objectId;b.objectId=a;return b});m._resolve([b],"onDeleteAttachmentsComplete",c,p)}),error:function(a){m._resolve([a],null,d,p,!0)}},{usePost:!0});return p},addType:function(a){var b=this.types;if(b){if(f.some(b,
function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;f.some(b,function(b,d){return b.id==a?(c=d,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=n.isString(a)?u.fromJson(a):n.clone(a)){var a=a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=f.map(this.types||
[],function(a){return a.toJson()});var d=this.renderer,h=this.labelingInfo,p=b.drawingInfo;if((d||h)&&!p)p=b.drawingInfo={};p&&(d&&-1===d.declaredClass.indexOf("TemporalRenderer"))&&(p.renderer=d.toJson());h&&(p.labelingInfo=f.map(h,function(a){return a.toJson()}))}d=null;if(!c||this._fcAdded)d={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};a.featureSet=n.mixin({},a.featureSet||{},d);c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},
onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},
onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},_forceIdentity:function(b){var c=this,d=this._url&&this._url.path;(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&d&&a.id&&a.id._hasPortalSession()&&a.id._doPortalSignIn(d)?a.id.getCredential(d).then(function(){c._findCredential();b.call(c)},function(){b.call(c)}):b.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&
a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===K.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=K.MODE_SNAPSHOT,this._mode=new R(this),this._isSnapshot=!0,this._autoGeneralize=!1},_queryLimit:function(){var a=this,b=new e;this._limitPromise=b.promise;
setTimeout(function(){var c=new P,d=new $;d.statisticType="exceedslimit";d.maxPointCount=a.maxPointCountForAuto;d.maxRecordCount=a.maxRecordCountForAuto;d.maxVertexCount=a.maxVertexCountForAuto;d.outStatisticFieldName="exceedslimit";c.outStatistics=[d];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=n.trim(this.capabilities||""),c=f.map(b?b.split(","):[],n.trim),d=f.map(b?b.toLowerCase().split(","):[],n.trim),b=
f.indexOf(d,"editing"),h,d={Create:f.indexOf(d,"create"),Update:f.indexOf(d,"update"),Delete:f.indexOf(d,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(h in d)-1<d[h]&&a.push(d[h]);a.sort();for(h=a.length-1;0<=h;h--)c.splice(a[h],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);
this._toggleTime(!0);this._updateMaxOffset();var b=this._mode,c=this._map,d=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&!this._trackManager&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer)))this._trackManager=new ba(this),this._trackManager.initialize(c);d&&("colors"in d&&"blurRadius"in d&&"maxPixelIntensity"in d)&&"esriGeometryPoint"==this.geometryType&&(this._heatmapManager=new ca(this),this._heatmapManager.initialize(c));
if(this.mode===K.MODE_AUTO&&this.currentMode===K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.getMaxAllowableOffset())d=this.generalizeForScale,d=this.maxScale?this.maxScale:this.minScale?Math.min(d,this.minScale):Math.min(d,C.getScale(c,this.initialExtent)),this.setMaxAllowableOffset(c.extent.getWidth()/c.width/c.getScale()*d);this._zoomConnect=s.connect(c,"onZoomEnd",this,this._updateMaxOffset)}b&&(a.firstOccurrence?
b.startup():b.resume())},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(a.extent.getWidth()/a.width))},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,this._timeConnect||(this._timeConnect=s.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,s.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=
a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+
a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset=this._maxOffset;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,d=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(d&&c&&c.hasOwnProperty(d))a[c[d]?"show":"hide"]();return this.add.apply(this,
arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map;if(!(this._isTable||!c&&!this._collection))if(!a.text&&!(a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length||a.outStatistics||a.returnDistinctValues)){var d=this._isSnapshot,h=this._isSelOnly,p=a.geometry;if(p)if(!h&&a.spatialRelationship===P.SPATIAL_REL_INTERSECTS&&"extent"===p.type&&(d||c.extent.contains(p)))b.push(1);else return;
if(c=a.objectIds)if(d)b.push(2);else{var p=c.length,m=this._mode,e=0,q;for(q=0;q<p;q++)m._getFeature(c[q])&&e++;if(e===p)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,d)a&&b.push(3);else if(h){if(a)return}else if(c)if(-1!==f.indexOf(b,2))a&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return r.toAbsMid?r.toAbsMid(a):k.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,c){var d=[],h=this._mode,
p=this.objectIdField,m=this,q,l,t=new e,x=new e,g=function(a,b){if(!a.length||!b.length)return a.length?a:b;var c,d,h={};a.length>b.length?(d=a,c=b):(d=b,c=a);for(var m=d.length,e=c.length,q;m--;)q=d[m],h[q.attributes[p]]=!0;for(;e--;)q=c[e],h[q.attributes[p]]||d.push(q);return d};if(-1!==f.indexOf(b,1)){l=this.graphics;q=l.length;var w=this.spatialIndex||this._map&&this._map.spatialIndex,y,z=a.geometry._normalize(null,!0);null==w&&ea.autoSpatialIndexing?y=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(n.hitch(this,
n.partial(this._getFromIndex,z,w)),function(a){x.resolve(n.hitch(this,n.partial(this._filterByExtent,l,z)))}):w&&(y=this._getFromIndex(z,w));y?y.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(d=d.concat(a[b].results));x.resolve(d)}).otherwise(function(a){x.reject(a)}):x.resolve(this._filterByExtent(l,z))}else x.resolve([]);x.then(function(d){var e=[];if(-1!==f.indexOf(b,2)){var l=a.objectIds;for(q=l.length;q--;){var x=h._getFeature(l[q]);x&&e.push(x)}e=g(d,e)}else e=d;-1!==f.indexOf(b,
3)&&m.timeInfo&&(d=a.timeExtent,e=m._filterByTime(0<e.length?e:m.graphics,d.startTime,d.endTime).match);c&&(e=f.map(e,function(a){return a.attributes[p]},this));t.resolve(e)});return t},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return h(f.map(a,function(a){return b.intersects(a,c)}))},_filterByExtent:function(a,b){for(var c=[],d=0,h=a.length;d<h;d++){var p=a[d],m=p.geometry;m&&(this.normalization&&b.length?(b[0].intersects(m)||
b[1].intersects(m))&&c.push(p):b.intersects(m)&&c.push(p))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,h=this._endTimeField,m;this._twoTimeFields||(m=d||h);var e=p.isDefined,q=[],f=[],l,x=a.length,t,g;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(m)for(l=0;l<x;l++)t=a[l],g=t.attributes,d=g[m],d>=b&&d<=c?q.push(t):f.push(t);else for(l=0;l<x;l++)t=a[l],g=t.attributes,m=g[d],g=g[h],m=e(m)?m:-Infinity,g=e(g)?g:Infinity,m>=b&&m<=c||g>=b&&g<=c||b>=m&&c<=g?q.push(t):f.push(t);
return{match:q,noMatch:f}},_resolve:function(a,b,c,d,h){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&x._resDfd(d,a,h)},_getShallowClone:function(a){var b=new P,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,c,d,h){var p=this,m=this._map,q=new e(x._dfdCanceller),f=c,l=function(c,h){if(!h&&("execute"===a||"executeRelationshipQuery"===a)){var m,e;if("execute"===a){m=c.features;e=m.length;for(e-=1;0<=e;e--)if(m[e]._layer=p,!p._isTable){var f=p._mode._getFeature(m[e].attributes[p.objectIdField]);
f&&m.splice(e,1,f)}}else for(f in c)if(c.hasOwnProperty(f)){m=c[f].features;e=m.length;for(e-=1;0<=e;e--)m[e]._layer=p}}p._resolve([c],b,d,q)};if("executeRelationshipQuery"!==a){f=this._getShallowClone(c);f.outFields=this.getOutFields();f.returnGeometry=c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;f.returnGeometry&&(f.multipatchOption=this.multipatchOption);var t;m&&(f.outSpatialReference=new w(m.spatialReference.toJson()));if(!this._applyQueryFilters(f,"execute"===a&&!f.outStatistics)){switch(a){case "execute":t=
new X({features:[]});break;case "executeForIds":t=[];break;case "executeForCount":t=0;break;case "executeForExtent":t={}}l(t,!0);return q}if(c="executeForExtent"!==a&&this._canDoClientSideQuery(f))return q._pendingDfd=v(this._doQuery(f,c,"executeForIds"===a||"executeForCount"===a)),q._pendingDfd.then(function(b){switch(a){case "execute":t=new X;t.features=b;break;case "executeForIds":t=b;break;case "executeForCount":t=b.length}l(t,!0)}),q}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+
this.invalidParams)],null,h,q,!0),q;this._ts&&(f._ts=(new Date).getTime());(q._pendingDfd=this._task[a](f)).addCallbacks(l,function(a){p._resolve([a],null,h,q,!0)});return q},_convertFeaturesToJson:function(a,b,c,d){var h=[],p=this._selectionSymbol,m=this.visibilityField,e,q=this.objectIdField;if(this.loaded&&(c||d))e=f.filter(this.fields,function(a){return!1===a.editable&&(!d||a.name!==q)});for(c=0;c<a.length;c++){var l=a[c],t={},x=l.geometry,g=l.attributes,w=l.symbol;if(x&&(!d||!this.loaded||this.allowGeometryUpdates))t.geometry=
x.toJson();m?(t.attributes=g=n.mixin({},g),g[m]=l.visible?1:0):g&&(t.attributes=n.mixin({},g));t.attributes&&(e&&e.length)&&f.forEach(e,function(a){delete t.attributes[a.name]});w&&w!==p&&(t.symbol=w.toJson());h.push(t)}return b?h:u.toJson(h)},_selectHandler:function(a,b,c,d,h){var p;d=K;switch(b){case d.SELECTION_NEW:this.clearSelection(!0);p=!0;break;case d.SELECTION_ADD:p=!0;break;case d.SELECTION_SUBTRACT:p=!1}d=a.features;var m=this._mode,e=[],q=this.objectIdField,f,l;if(p)for(p=0;p<d.length;p++)f=
d[p],l=f.attributes[q],f=m._addFeatureIIf(l,f),e.push(f),this._selectFeatureIIf(l,f,m);else for(p=0;p<d.length;p++)f=d[p],l=f.attributes[q],this._unSelectFeatureIIf(l,m),l=m._removeFeatureIIf(l),e.push(l||f);this._isSelOnly&&m._applyTimeFilter(!0);this._resolve([e,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,h);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var d=this._selectedFeatures,h=d[a];h||(c._incRefCount(a),d[a]=
b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return h||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,
!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=f.filter(a,function(a,b,c){return!!a&&f.indexOf(c,a)===b}),b=n.clone(this._outFields);if(b){if(-1!==f.indexOf(b,"*"))return b;f.forEach(a,function(a){-1===f.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();f.forEach(b,function(a){"*"!==a&&(this._getField(a)||
console.debug("esri.layers.FeatureLayer: "+p.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection)&&(f.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+p.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},
_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;if(a&&0<this.fields.length){var b=[],c,d,a=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],p.isDefined),h=[].concat(a);f.forEach(a,function(a){f.forEach(a.rendererInfos,function(a){a.renderer&&h.push(a.renderer)})});f.forEach(h,function(a){if((d=a.attributeField)&&!n.isFunction(d))if(c=!this._getField(d)&&this._getField(d,!0))a.attributeField=c.name;if(d=a.attributeField2)if(c=!this._getField(d)&&this._getField(d,
!0))a.attributeField2=c.name;if(d=a.attributeField3)if(c=!this._getField(d)&&this._getField(d,!0))a.attributeField3=c.name;n.isFunction(a.attributeField)||b.push(a.attributeField);b.push(a.attributeField2);b.push(a.attributeField3);if((d=a.rotationInfo&&a.rotationInfo.field)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.rotationInfo.field=c.name;b.push(d)}if(a.proportionalSymbolInfo){if((d=a.proportionalSymbolInfo.field)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,
!0))d=a.proportionalSymbolInfo.field=c.name;b.push(d);this._orderBy||(this._orderBy=[d+" DESC"])}if((d=a.proportionalSymbolInfo.normalizationField)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.proportionalSymbolInfo.normalizationField=c.name;b.push(d)}}if(a.colorInfo){if((d=a.colorInfo.field)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.colorInfo.field=c.name;b.push(d)}if((d=a.colorInfo.normalizationField)&&!n.isFunction(d)){if(c=!this._getField(d)&&
this._getField(d,!0))d=a.colorInfo.normalizationField=c.name;b.push(d)}}if(a.field&&(d=a.field)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.field=c.name;b.push(d)}if(a.opacityInfo){if((d=a.opacityInfo.field)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.opacityInfo.field=c.name;b.push(d)}if((d=a.opacityInfo.normalizationField)&&!n.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.opacityInfo.normalizationField=c.name;b.push(d)}}if(!this._orderBy&&
a.addBreak&&!n.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=[a.attributeField+" DESC"]},this);this._rendererFields=f.filter(b,p.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d,h;f.forEach(a.infos,function(a){if(h=a.symbol){d=0;switch(h.type){case "simplemarkersymbol":d=h.size;break;case "picturemarkersymbol":d=(h.width+h.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":d=h.width;break;case "simplefillsymbol":case "picturefillsymbol":d=
h.outline&&h.outline.width}d&&(b=Math.min(b,d),c=Math.max(c,d))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?f.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;var d;b&&(a=a.toLowerCase());f.some(c,function(c){var h=!1;(h=b?c&&c.name.toLowerCase()===a?!0:!1:c&&
c.name===a?!0:!1)&&(d=c);return h});return d},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:f.map(f.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&f.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,d,h,p){h=a.addResults;var m=a.updateResults;a=a.deleteResults;var e,q,l,t,x=this.objectIdField,g=this._mode,w=this._isTable;e=this.editFieldsInfo;
var y=this.getOutFields()||[],z=e&&e.creatorField,k=e&&e.creationDateField,v=e&&e.editorField,A=e&&e.editDateField;e=e&&e.realm;-1===f.indexOf(y,"*")&&(z&&-1===f.indexOf(y,z)&&(z=null),k&&-1===f.indexOf(y,k)&&(k=null),v&&-1===f.indexOf(y,v)&&(v=null),A&&-1===f.indexOf(y,A)&&(A=null));var y=k||A?(new Date).getTime():null,n=z||v?this.getUserId():void 0;n&&e&&(n=n+"@"+e);if(h)for(e=0;e<h.length;e++)h[e]=new G(h[e]),w||(q=h[e],q.success&&(q=q.objectId,l=b[e],(t=l._graphicsLayer)&&t!==this&&t.remove(l),
t=l.attributes||{},t[x]=q,z&&(t[z]=n),v&&(t[v]=n),k&&(t[k]=y),A&&(t[A]=y),l.setAttributes(t),g._init&&g.drawFeature(l)));if(m)for(e=0;e<m.length;e++)if(m[e]=new G(m[e]),!w&&(q=m[e],q.success)){q=q.objectId;l=c[q];if(b=g._getFeature(q))b.geometry!==l.geometry&&b.setGeometry(B.fromJson(l.geometry.toJson())),this._repaint(b,q);l=b||l;t=l.attributes||{};v&&(t[v]=n);A&&(t[A]=y);l.setAttributes(t)}if(a){c=[];for(e=0;e<a.length;e++)if(a[e]=new G(a[e]),!w&&(q=a[e],q.success&&(q=q.objectId,l=g._getFeature(q))))this._unSelectFeatureIIf(q,
g)&&c.push(l),l._count=0,g._removeFeatureIIf(q);if(0<c.length)this.onSelectionComplete(c,K.SELECTION_SUBTRACT)}this._resolve([h,m,a],"onEditsComplete",d,p)},_sendAttachment:function(a,b,c,d,h){var p=this;return q({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:c,content:n.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var h="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";
c=new G(c["add"===a?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;p._resolve([c],h,d);return c}).addErrback(function(a){p._resolve([a],null,h,null,!0)})},_repaint:function(a,b,c){b=p.isDefined(b)?b:a.attributes[this.objectIdField];(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});n.mixin(K,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,
SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});D._createWrappers(K);c("extend-esri")&&n.setObject("layers.FeatureLayer",K,a);return K})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(r,k,g,s,n,f,u,e,b,c){function l(a,b,c){return h&&
c?function(a,b){return f(a,c,b)}:p?function(c,d){var h=f(c,b,function(a){d.call(this,a);F=(new Date).getTime()}),p=f(c,a,function(a){(!F||(new Date).getTime()>F+1E3)&&d.call(this,a)});return{remove:function(){h.remove();p.remove()}}}:function(b,c){return f(b,a,c)}}function y(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function d(a,b,d){var h=y(a.target);if(t=!a.target.disabled&&h&&h.dojoClick)if(w=(x="useTarget"==t)?h:a.target,x&&a.preventDefault(),m=a.changedTouches?a.changedTouches[0].pageX-
c.global.pageXOffset:a.clientX,z=a.changedTouches?a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY,A=("object"==typeof t?t.x:"number"==typeof t?t:0)||4,O=("object"==typeof t?t.y:"number"==typeof t?t:0)||4,!q){q=!0;var p=function(a){t=x?g.isDescendant(c.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-c.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY),w):t&&(a.changedTouches?a.changedTouches[0].target:a.target)==w&&Math.abs((a.changedTouches?
a.changedTouches[0].pageX-c.global.pageXOffset:a.clientX)-m)<=A&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY)-z)<=O};c.doc.addEventListener(b,function(a){p(a);x&&a.preventDefault()},!0);c.doc.addEventListener(d,function(a){p(a);if(t){L=(new Date).getTime();var b=x?w:a.target;"LABEL"===b.tagName&&(b=g.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:a,d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent("click",!0,
!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){f.emit(b,"click",d);L=(new Date).getTime()},0)}},!0);a=function(a){c.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=L+1E3&&!("INPUT"==b.target.tagName&&s.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==
b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var v=5>u("ios"),h=u("pointer-events")||u("MSPointer"),a=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=u("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),p=u("touch-events"),q,t,x=!1,w,m,z,A,O,L,F,H;h?b(function(){c.doc.addEventListener(a.down,function(b){d(b,a.move,
a.up)},!0)}):p&&b(function(){function a(b){var c=n.delegate(b,{bubbles:!0});6<=u("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}H=c.body();c.doc.addEventListener("touchstart",function(a){F=(new Date).getTime();var b=H;H=a.target;f.emit(b,"dojotouchout",{relatedTarget:H,bubbles:!0});f.emit(H,"dojotouchover",{relatedTarget:b,bubbles:!0});d(a,"touchmove","touchend")},
!0);f(c.doc,"touchmove",function(b){F=(new Date).getTime();var d=c.doc.elementFromPoint(b.pageX-(v?0:c.global.pageXOffset),b.pageY-(v?0:c.global.pageYOffset));d&&(H!==d&&(f.emit(H,"dojotouchout",{relatedTarget:d,bubbles:!0}),f.emit(d,"dojotouchover",{relatedTarget:H,bubbles:!0}),H=d),f.emit(d,"dojotouchmove",a(b))||b.preventDefault())});f(c.doc,"touchend",function(b){F=(new Date).getTime();var d=c.doc.elementFromPoint(b.pageX-(v?0:c.global.pageXOffset),b.pageY-(v?0:c.global.pageYOffset))||c.body();
f.emit(d,"dojotouchend",a(b))})});k={press:l("mousedown","touchstart",a.down),move:l("mousemove","dojotouchmove",a.move),release:l("mouseup","dojotouchend",a.up),cancel:l(e.leave,"touchcancel",h?a.cancel:null),over:l("mouseover","dojotouchover",a.over),out:l("mouseout","dojotouchout",a.out),enter:e._eventHandler(l("mouseover","dojotouchover",a.over)),leave:e._eventHandler(l("mouseout","dojotouchout",a.out))};return r.touch=k})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array",
"dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(r,k,g,s,n){return g("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var f=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);n.parse(f,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,
scope:"dojo"}).then(s.hitch(this,function(f){this._startupWidgets=f;for(var e=0;e<f.length;e++)this._processTemplateNode(f[e],function(b,c){return b[c]},function(b,c,e){return c in b?b.connect(b,c,e):b.on(c,e,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(f,g,e){return g(f,"dojoType")||g(f,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){r.forEach(this._startupWidgets,function(f){f&&(!f._started&&f.startup)&&f.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(r,k,g,s,n,f,u){k=k(null,{declaredClass:"esri.layers._RenderMode",
constructor:function(){this._prefix="jsonp_"+(r._scopeName||"dojo")+"IoScript"},initialize:function(e){this.map=e;this._init=!0},startup:function(){},propertyChangeHandler:function(e){},destroy:function(){this._init=!1},drawFeature:function(e){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(e){(e=this._featureMap[e])&&e._count++},_decRefCount:function(e){(e=this._featureMap[e])&&e._count--},_getFeature:function(e){return this._featureMap[e]},_addFeatureIIf:function(e,
b){var c=this._featureMap,f=c[e],g=this.featureLayer;f||(c[e]=b,g._add(b),b._count=0);return f||b},_removeFeatureIIf:function(e){var b=this._featureMap[e],c=this.featureLayer;if(b){if(b._count)return;delete this._featureMap[e];c._remove(b)}return b},_clearIIf:function(){var e;e=this.featureLayer;var b=e.graphics,c=e._selectedFeatures,f=e.objectIdField;for(e=b.length-1;0<=e;e--){var g=b[e],d=g.attributes[f];d in c?g._count=1:(g._count=0,this._removeFeatureIIf(d))}},_isPending:function(e){return f[this._prefix+
e]?!0:!1},_cancelPendingRequest:function(e,b){if(e=e||f[this._prefix+b])try{e.cancel(),f._validCheck(e)}catch(c){}},_purgeRequests:function(){f._validCheck(null)},_toggleVisibility:function(e){var b=this.featureLayer,c=b.graphics,f=e?"show":"hide",g,d=c.length;e=e&&b._ager;for(g=0;g<d;g++){var k=c[g];k[f]();e&&b._repaint(k)}},_applyTimeFilter:function(e){var b=this.featureLayer;if(b.timeInfo&&!b.suspended){e||b._fireUpdateStart();var c=b._trackManager;c&&c.clearTracks();var f=b.getTimeDefinition(),
g=b._getOffsettedTE(b._mapTimeExtent);g?(g=b._getTimeOverlap(f,g))?(f=b._filterByTime(b.graphics,g.startTime,g.endTime),c&&c.addFeatures(f.match),s.forEach(f.match,function(c){var e=c._shape;c.visible||(c.show(),(e=c._shape)&&e._moveToFront());b._ager&&e&&b._repaint(c)}),s.forEach(f.noMatch,function(b){b.visible&&b.hide()})):this._toggleVisibility(!1):(c&&c.addFeatures(b.graphics),this._toggleVisibility(!0));c&&(c.moveLatestToFront(),c.drawTracks());e||b._fireUpdateEnd()}}});n("extend-esri")&&g.setObject("layers._RenderMode",
k,u);return k})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(r,k,g,s,n,f,u,e,b,c,l){r=r(null,{declaredClass:"esri.layers.FeatureType",constructor:function(f){if(f&&k.isObject(f)){this.id=f.id;this.name=f.name;var d=f.symbol;d&&(this.symbol=u.fromJson(d));var d=f.domains,g,h=this.domains={};for(g in d)if(d.hasOwnProperty(g)){var a=
d[g];switch(a.type){case "range":h[g]=new e(a);break;case "codedValue":h[g]=new b(a);break;case "inherited":h[g]=new c(a)}}if(g=f.templates){d=this.templates=[];for(f=0;f<g.length;f++)d.push(new l(g[f]))}}},toJson:function(){var b={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,e=this.domains,h=this.templates,a=f.fixJson;if(e){var p=b.domains={};for(c in e)e.hasOwnProperty(c)&&(p[c]=e[c]&&e[c].toJson());a(p)}h&&(b.templates=g.map(h,function(a){return a.toJson()}));return a(b)}});
s("extend-esri")&&k.setObject("layers.FeatureType",r,n);return r})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(r,k,g,s,n,f,u,e){r=r(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap={};this.trackLineMap={}},initialize:function(b){this.map=b;var c=this.layer,f=c._getRenderer(),f=f&&f.trackRenderer;if("esriGeometryPoint"===
c.geometryType){var g=this.container=new e._GraphicsLayer({id:c.id+"_tracks",_child:!0});g.loaded=!0;g.onLoad(g);g._setMap(b,c._div);g.setRenderer(f)}},addFeatures:function(b){var c=this.trackMap,e=this.layer,f=e._trackIdField,d=[];g.forEach(b,function(a){var b=a.attributes[f];(c[b]=c[b]||[]).push(a);-1===g.indexOf(d,b)&&d.push(b)});var k=e._startTimeField,h=e.objectIdField,a=function(a,b){var c=a.attributes[k],d=b.attributes[k];return c===d?a.attributes[h]<b.attributes[h]?-1:1:c<d?-1:1};g.forEach(d,
function(b){c[b].sort(a)})},trimTracks:function(b){function c(b){for(b=e[b]||[];b.length>f;)d.push(b.shift())}var e=this.trackMap,f=this.layer.maximumTrackPoints||0,d=[],k;if(!f)return d;if(b)g.forEach(b,function(b){c(b)});else for(k in e)e.hasOwnProperty(k)&&c(k);return d},drawTracks:function(b){function c(a){var b=d[a],c,g,w;g=e.trackLineMap[a];k.remove(g);delete e.trackLineMap[a];if(!b||2>b.length)return!1;g=[];for(c=b.length-1;0<=c;c--)(w=b[c].geometry)&&g.push([w.x,w.y]);b={};b[h]=a;1<g.length&&
(g=new f(new u({paths:[g],spatialReference:n}),null,b),k.add(g),e.trackLineMap[a]=g)}var e=this,k=this.container,d,n,h,a;if(k)if(d=this.trackMap,n=this.map.spatialReference,h=this.layer._trackIdField,b)g.forEach(b,function(a){c(a)});else for(a in d)d.hasOwnProperty(a)&&c(a)},refreshTracks:function(b){function c(a){var b,c;e.drawTracks([a]);if(k&&k.latestObservationRenderer){a=f[a]||[];b=a.length;for(c=0;c<b;c++)d._repaint(a[c],null,!0)}}var e=this,f=this.trackMap,d=this.layer,k=d._getRenderer(),h;
if(b)g.forEach(b,function(a){c(a)});else for(h in f)f.hasOwnProperty(h)&&c(h);this.moveLatestToFront()},moveLatestToFront:function(b){g.forEach(this.getLatestObservations(b),function(b){var e=b._shape;e&&e._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function c(b){b=d[b];return b[b.length-1]}var e=[],f=this.layer._getRenderer(),d=this.trackMap,k;if(!f.latestObservationRenderer)return e;if(b)g.forEach(b,function(b){e.push(c(b))});else for(k in d)d.hasOwnProperty(k)&&
e.push(c(k));return e},clearTracks:function(b){var c=this.getLatestObservations(b),e=this.container,f;b?g.forEach(b,function(b){delete this.trackMap[b];e&&(f=this.trackLineMap[b],e.remove(f),delete this.trackLineMap[b])},this):(this.trackMap={},this.trackLineMap={},e&&e.clear());g.forEach(c,function(b){this._repaint(b,null,!0)},this.layer)},isLatestObservation:function(b){var c=this.trackMap[b.attributes[this.layer._trackIdField]];return c?c[c.length-1]===b:!1},destroy:function(){var b=this.container;
b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});s("extend-esri")&&k.setObject("layers._TrackManager",r,n);return r})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(r,k,g,s,n,f,u,e){r=r(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,c,e,f){this.origin=b;this.cellWidth=
c.width;this.cellHeight=c.height;this.mapWidth=e.width;this.mapHeight=e.height;this.srInfo=f},setResolution:function(b){this._resolution=(b.xmax-b.xmin)/this.mapWidth;this.srInfo&&(b=Math.round(2*this.srInfo.valid[1]/this._resolution),b=Math.round(b/this.cellWidth),this._frameStats=[b,0,b-1])},getCellCoordinates:function(b){var c=this._resolution,e=this.origin;return{row:Math.floor((e.y-b.y)/(this.cellHeight*c)),col:Math.floor((b.x-e.x)/(this.cellWidth*c))}},normalize:function(b){var c=this._frameStats;
if(c){var e=c[0],f=c[1],c=c[2];b<f?(b%=e,b=b<f?b+e:b):b>c&&(b%=e)}return b},intersects:function(b,c){var e=this.srInfo;return e?g.some(c._getParts(e),function(c){return b.intersects(c.extent)}):b.intersects(c)},getCellExtent:function(b,c){var e=this._resolution,g=this.origin,d=this.cellWidth,k=this.cellHeight;return new u(c*d*e+g.x,g.y-(b+1)*k*e,(c+1)*d*e+g.x,g.y-b*k*e,new f(g.spatialReference.toJson()))},getLatticeID:function(b){var c=this.getCellCoordinates({x:b.xmin,y:b.ymax}),e=this.getCellCoordinates({x:b.xmax,
y:b.ymin});b=c.row;var f=e.row,c=this.normalize(c.col),e=this.normalize(e.col);return b+"_"+f+"_"+c+"_"+e},sorter:function(b,c){return b<c?-1:1},getCellsInExtent:function(b,c){var f=this.getCellCoordinates({x:b.xmin,y:b.ymax}),g=this.getCellCoordinates({x:b.xmax,y:b.ymin}),d=f.row,k=g.row,f=f.col,g=g.col,h=[],a,p,q,t=[],x=[],w,m,z,A=[];for(a=d;a<=k;a++)for(p=f;p<=g;p++)q=this.normalize(p),b=this.getCellExtent(a,q),h.push({row:a,col:q,extent:b,resolution:this._resolution}),c&&(t.push(b.xmin,b.xmax),
x.push(b.ymin,b.ymax));f=this.normalize(f);g=this.normalize(g);t.sort(this.sorter);x.sort(this.sorter);p=t.length;for(a=p-1;0<=a;a--)a<p-1&&t[a]===t[a+1]&&t.splice(a,1);p=x.length;for(a=p-1;0<=a;a--)a<p-1&&x[a]===x[a+1]&&x.splice(a,1);if(t.length&&x.length){q=t[0];w=t[t.length-1];m=x[0];z=x[x.length-1];p=t.length;for(a=0;a<p;a++)A.push([[t[a],z],[t[a],m]]);p=x.length;for(a=0;a<p;a++)A.push([[q,x[a]],[w,x[a]]]);a=new e({paths:A,spatialReference:this.origin.spatialReference.toJson()});h.push({latticeID:d+
"_"+k+"_"+f+"_"+g,lattice:a,resolution:this._resolution})}return{minRow:d,maxRow:k,minCol:f,maxCol:g,cells:h}}});s("extend-esri")&&k.setObject("layers._GridLayout",r,n);return r})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(r,k){var g={};r.setObject("dojo.date.stamp",g);g.fromISOString=function(s,n){g._isoRegExp||(g._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var f=g._isoRegExp.exec(s),
r=null;if(f){f.shift();f[1]&&f[1]--;f[6]&&(f[6]*=1E3);n&&(n=new Date(n),k.forEach(k.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return n["get"+b]()}),function(b,e){f[e]=f[e]||b}));r=new Date(f[0]||1970,f[1]||0,f[2]||1,f[3]||0,f[4]||0,f[5]||0,f[6]||0);100>f[0]&&r.setFullYear(f[0]||1970);var e=0,b=f[7]&&f[7].charAt(0);"Z"!=b&&(e=60*(f[8]||0)+(Number(f[9])||0),"-"!=b&&(e*=-1));b&&(e-=r.getTimezoneOffset());e&&r.setTime(r.getTime()+6E4*e)}return r};g.toISOString=
function(g,k){var f=function(b){return 10>b?"0"+b:b};k=k||{};var r=[],e=k.zulu?"getUTC":"get",b="";"time"!=k.selector&&(b=g[e+"FullYear"](),b=["0000".substr((b+"").length)+b,f(g[e+"Month"]()+1),f(g[e+"Date"]())].join("-"));r.push(b);if("date"!=k.selector){b=[f(g[e+"Hours"]()),f(g[e+"Minutes"]()),f(g[e+"Seconds"]())].join(":");e=g[e+"Milliseconds"]();k.milliseconds&&(b+="."+(100>e?"0":"")+f(e));if(k.zulu)b+="Z";else if("time"!=k.selector)var e=g.getTimezoneOffset(),c=Math.abs(e),b=b+((0<e?"-":"+")+
f(Math.floor(c/60))+":"+f(c%60));r.push(b)}return r.join("T")};return g})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(r,k,g,s,n,f,u){f.extend(r,{waiRole:"",waiState:""});return n("dijit._Templated",[k,g],{widgetsInTemplate:!1,constructor:function(){u.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(e,b){var c=this.inherited(arguments),f=b(e,"waiRole");f&&e.setAttribute("role",f);(f=b(e,"waiState"))&&s.forEach(f.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),e.setAttribute("aria-"+b[0],b[1]))});return c}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated ../kernel ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d,v,h,a,p,q){var t=0;k=k([p,v,h],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=s.mixin({},q.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(s.hitch(this,this._handleComponentsSuccess),s.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,d=this.domNode,e=this._prevMedia,h=this._nextMedia;if(1<b){var p=0,q=0;n.forEach(a,function(a){"image"===a.type?p++:-1!==a.type.indexOf("chart")&&q++});p&&(c.set(this._imageCount,"innerHTML",p),f.query(".summary .image",d).removeClass("hidden"));q&&(c.set(this._chartCount,"innerHTML",q),f.query(".summary .chart",d).removeClass("hidden"))}else f.query(".summary",
d).addClass("hidden"),l.add(e,"hidden"),l.add(h,"hidden");a=this._mediaPtr;0===a?l.add(e,"hidden"):l.remove(e,"hidden");a===b-1?l.add(h,"hidden"):l.remove(h,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,d=a.caption,e=f.query(".mediaSection .hzLine",this.domNode)[0];c.set(this._mediaTitle,"innerHTML",b);l[b?"remove":"add"](this._mediaTitle,"hidden");c.set(this._mediaCaption,"innerHTML",d);l[d?"remove":"add"](this._mediaCaption,"hidden");l[b&&
d?"remove":"add"](e,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var h=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],d=a.value.theme||this.chartTheme;s.isString(d)&&(d=d.replace(/\./gi,"/"),-1===d.indexOf("/")&&(d="dojox/charting/themes/"+d));d||(d="./Rainbow");b.push(d);try{var p=this._rid=t++;r(b,function(b,c,d){p===h._rid&&(h._rid=null,h._showChart(a.type,a.value,b,c,d))})}catch(q){console.log("PopupRenderer: error loading modules")}}},_showImage:function(a){l.add(this._mediaFrame,
"image");var b=d.get(this._gallery,"height"),h="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+a.sourceURL+"' /\x3e";a.linkURL&&(h="\x3ca target\x3d'_blank' href\x3d'"+a.linkURL+"'\x3e"+h+"\x3c/a\x3e");c.set(this._mediaFrame,"innerHTML",h);var e=f.query(".esriPopupMediaImage",this._mediaFrame)[0],p=this,q;q=g.connect(e,"onload",function(){g.disconnect(q);q=null;p._imageLoaded(e,b)})},_showChart:function(a,b,c,d,h){l.remove(this._mediaFrame,"image");c=this._chart=new c(y.create("div",{"class":"chart"},
this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});h&&c.setTheme(h);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});n.forEach(b.fields,function(a,b){a.x=b+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",
gap:3});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new d(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),
this._action=null);c.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),d.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var d="";!(b instanceof Error)&&(b&&b.length)&&n.forEach(b,function(a){d+="\x3cli\x3e";d+="\x3ca href\x3d'"+a.url+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";d+="\x3c/li\x3e"});c.set(this._attachmentsList,"innerHTML",d||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},
_handleComponentsSuccess:function(a){if(a){var d=this.showTitle?a.title:"",h=a.description,e=a.fields,p=a.mediaInfos,q=this.domNode,g=this._nls,t=this.template,k=this.graphic;this._prevMedia.title=g.NLS_prevMedia;this._nextMedia.title=g.NLS_nextMedia;c.set(this._title,"innerHTML",d);d||l.add(this._title,"hidden");!h&&e&&(h="",n.forEach(e,function(a){h+="\x3ctr valign\x3d'top'\x3e";h+="\x3ctd class\x3d'attrName'\x3e"+a[0]+"\x3c/td\x3e";h+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,
"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+g.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";h+="\x3c/tr\x3e"}),h&&(h="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+h+"\x3c/table\x3e"));c.set(this._description,"innerHTML",h);h||l.add(this._description,"hidden");f.query("a",this._description).forEach(function(a){c.set(a,"target","_blank")});d&&h?f.query(".mainSection .hzLine",q).removeClass("hidden"):d||h?f.query(".mainSection .hzLine",q).addClass("hidden"):
f.query(".mainSection",q).addClass("hidden");if(d=this._dfd=t.getAttachments(k))d.addBoth(s.hitch(this,this._attListHandler,d)),c.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+g.NLS_searching+"...\x3c/li\x3e"),f.query(".attachmentsSection",q).removeClass("hidden");p&&p.length&&(f.query(".mediaSection",q).removeClass("hidden"),b.setSelectable(this._mediaFrame,!1),this._mediaInfos=p,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(c.set(this._editSummary,"innerHTML",a.editSummary),
p&&p.length&&l.remove(this._mediaBreak,"hidden"),l.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});u("extend-esri")&&s.setObject("dijit._PopupRenderer",k,a);return k})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style ../kernel ../config ../sniff ../domUtils ../geometry/Point ../geometry/webMercatorUtils ./layer".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d){var v=r([d],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(b){this.inherited(arguments,[null,b]);this._mapImages=[];var a=g.hitch;this._panStart=a(this,this._panStart);this._pan=a(this,this._pan);this._extentChange=a(this,this._extentChange);this._zoom=a(this,this._zoom);this._zoomStart=a(this,this._zoomStart);this._scale=a(this,this._scale);this._resize=a(this,this._resize);k.connect(this,"onSuspend",this,this._onSuspend);
k.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,addImage:function(b){var a=this._mapImages.push(b),a=a-1;b._idx=a;b._layer=this;this._div&&this._createImage(b,a)},removeImage:function(b){if(b){var a=b._idx,c=this._mapImages;if(c[a]===b){delete c[a];if(a=b._node)this._clearEvents(a),a.e_idx=a.e_bl=a.e_tr=a.e_l=a.e_t=a.e_w=a.e_h=null,a.parentNode&&(a.parentNode.removeChild(a),n.destroy(a));b._node=b._idx=b._layer=null}}},removeAllImages:function(){var b=this._mapImages,
a,c=b.length;for(a=0;a<c;a++){var d=b[a];d&&this.removeImage(d)}this._mapImages=[]},getImages:function(){var b=this._mapImages,a=[],c,d=b.length;for(c=0;c<d;c++)b[c]&&a.push(b[c]);return a},setOpacity:function(b){this.opacity!=b&&(this._opacityChanged(this.opacity=b),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(c){var a=this._div,d,e;if(a)if(!b("ie")||8<b("ie"))f.set(a,"opacity",c);else{e=a.childNodes;d=e.length;for(a=0;a<d;a++)f.set(e[a],"opacity",c)}},_createImage:function(c,
a){var d=n.create("img");f.set(d,{position:"absolute"});8>=b("ie")&&f.set(d,"opacity",this.opacity);c.rotation&&!(9>b("ie"))&&f.set(d,u._css.names.transform,u._css.rotate(360-c.rotation));c._node=d;d.e_idx=a;d.e_layer=this;d.e_load=k.connect(d,"onload",v.prototype._imageLoaded);d.e_error=k.connect(d,"onerror",v.prototype._imageError);d.e_abort=k.connect(d,"onabort",v.prototype._imageError);d.src=c.href},_imageLoaded:function(b,a){var c=a||b.target||b.currentTarget,d=c.e_layer,e=d._mapImages[c.e_idx],
f=d._map;f&&(f.__zooming||f.__panning||!d._sr)?d._standby.push(c):(d._clearEvents(c),e&&e._node===c&&f&&d._attach(e))},_imageError:function(b){b=b.target||b.currentTarget;var a=b.e_layer,c=a._mapImages[b.e_idx];a._clearEvents(b);c&&(c._node=null)},_clearEvents:function(b){var a=k.disconnect;a(b.e_load);a(b.e_error);a(b.e_abort);b.e_load=b.e_error=b.e_abort=b.e_layer=null},_attach:function(b){var a=b.extent,c=a.spatialReference,d=this._sr,e=this._div,f=b._node,g=new l({x:a.xmin,y:a.ymin,spatialReference:c}),
a=new l({x:a.xmax,y:a.ymax,spatialReference:c});d.equals(c)||(d.isWebMercator()&&4326===c.wkid?(g=y.geographicToWebMercator(g),a=y.geographicToWebMercator(a)):c.isWebMercator()&&4326===d.wkid&&(g=y.webMercatorToGeographic(g),a=y.webMercatorToGeographic(a)));f.e_bl=g;f.e_tr=a;b.visible&&(this._setPos(f,e._left,e._top),(this._active||e).appendChild(f))},_setPos:function(b,a,c){var d=b.e_bl,e=b.e_tr,g=this._map,d=g.toScreen(d),e=g.toScreen(e);a=d.x-a;c=e.y-c;var k=Math.abs(e.x-d.x),d=Math.abs(d.y-e.y),
e={width:k+"px",height:d+"px"},m=this._mapImages[b.e_idx];"css-transforms"===g.navigationMode?e[u._css.names.transform]=u._css.translate(a,c)+(m.rotation?" "+u._css.rotate(360-m.rotation):""):(e.left=a+"px",e.top=c+"px");f.set(b,e);b.e_l=a;b.e_t=c;b.e_w=k;b.e_h=d},managedSuspension:!0,_setMap:function(d,a){this.inherited(arguments);var e=this._div=n.create("div",null,a),g=u._css.names,t={position:"absolute"},k=d.__visibleDelta;if(!b("ie")||8<b("ie"))t.opacity=this.opacity;"css-transforms"===d.navigationMode?
(t[g.transform]=u._css.translate(k.x,k.y),f.set(e,t),e._left=k.x,e._top=k.y,t={position:"absolute",width:d.width+"px",height:d.height+"px",overflow:"visible"},this._active=n.create("div",null,e),f.set(this._active,t),this._passive=n.create("div",null,e),f.set(this._passive,t)):(e._left=0,e._top=0,f.set(e,t));this._standby=[];g=this._mapImages;k=g.length;for(t=0;t<k;t++){var l=g[t];l._node||this._createImage(l,l._idx)}c.hide(e);return e},_unsetMap:function(b,a){this._disconnect();var c=this._div;if(c){var d=
this._mapImages,e,f=d.length;for(e=0;e<f;e++){var g=d[e];if(g){var m=g._node;m&&(this._clearEvents(m),m.e_idx=m.e_bl=m.e_tr=m.e_l=m.e_t=m.e_w=m.e_h=null);g._node=null}}a.removeChild(c);n.destroy(c)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();c.hide(this._div)},_onResume:function(b){b.firstOccurrence&&(this._sr=this._map.spatialReference,this._processStandbyList());b=this._map;var a=this._div,d=b.__visibleDelta;
"css-transforms"===b.navigationMode&&(a._left=d.x,a._top=d.y,f.set(a,u._css.names.transform,u._css.translate(a._left,a._top)));this._redraw("css-transforms"===b.navigationMode);this._connect(b);c.show(a)},_connect:function(b){if(!this._connections){var a=k.connect,c="css-transforms"===b.navigationMode;this._connections=[a(b,"onPanStart",this._panStart),a(b,"onPan",this._pan),a(b,"onExtentChange",this._extentChange),c&&a(b,"onZoomStart",this._zoomStart),c?a(b,"onScale",this._scale):a(b,"onZoom",this._zoom),
c&&a(b,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(s.forEach(this._connections,k.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(b,a){var c=this._div;c._left=this._panL+a.x;c._top=this._panT+a.y;"css-transforms"===this._map.navigationMode?f.set(c,u._css.names.transform,u._css.translate(c._left,c._top)):f.set(c,{left:c._left+"px",top:c._top+"px"})},_extentChange:function(b,a,c){c?this._redraw("css-transforms"===
this._map.navigationMode):a&&this._pan(b,a);this._processStandbyList()},_processStandbyList:function(){var b,a=this._standby;if(a&&a.length)for(b=a.length-1;0<=b;b--)this._imageLoaded(null,a[b]),a.splice(b,1)},_redraw:function(b){if(b){b=this._passive;var a=u._css.names;f.set(b,a.transition,"none");this._moveImages(b,this._active);f.set(b,a.transform,"none")}b=this._active||this._div;var a=this._div._left,c=this._div._top,d,e=b.childNodes.length,g;for(d=0;d<e;d++)g=b.childNodes[d],this._setPos(g,
a,c)},_zoom:function(b,a,c){b=this._div;var d=b._left,e=b._top,g,k=b.childNodes.length,m;for(g=0;g<k;g++){m=b.childNodes[g];var l=m.e_w*a,A=m.e_h*a,n=(c.x-d-m.e_l)*(l-m.e_w)/m.e_w,v=(c.y-e-m.e_t)*(A-m.e_h)/m.e_h,n=isNaN(n)?0:n,v=isNaN(v)?0:v;f.set(m,{left:m.e_l-n+"px",top:m.e_t-v+"px",width:l+"px",height:A+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(b,a){var c=b.childNodes,d;d=c.length;if(0<d)for(d-=1;0<=d;d--)a.appendChild(c[d])},_scale:function(b,
a){var c=u._css.names,d=this._passive;f.set(d,c.transition,a?"none":c.transformName+" "+e.defaults.map.zoomDuration+"ms ease");u._css.matrix(b);f.set(d,c.transform,u._css.matrix(b))},_resize:function(b,a,c){f.set(this._active,{width:a+"px",height:c+"px"});f.set(this._passive,{width:a+"px",height:c+"px"})}});b("extend-esri")&&g.setObject("layers.MapImageLayer",v,u);return v})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),
function(r,k,g,s,n,f,u,e,b){var c=n.delegate(e,{mouseenter:f.enter,mouseleave:f.leave,keypress:g._keypress}),l;g=s("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var c=b;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(b,c){return b.getAttribute(c)},this._attach)||
this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==b)break;for(;!c.nextSibling;)if(c=c.parentNode,c==b)return;c=c.nextSibling}},_processTemplateNode:function(b,c,e){var f=!0,a=this.attachScope||this,g=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(g)for(var q=g.split(/\s*,\s*/);g=q.shift();)n.isArray(a[g])?a[g].push(b):a[g]=b,f="containerNode"!=g,this._attachPoints.push(g);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event")){g=c.split(/\s*,\s*/);for(q=n.trim;c=g.shift();)if(c){var t=
null;-1!=c.indexOf(":")?(t=c.split(":"),c=q(t[0]),t=q(t[1])):c=q(c);t||(t=c);this._attachEvents.push(e(b,c,n.hitch(a,t)))}}return f},_attach:function(b,d,e){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?l||(l=r("./a11yclick")):c[d]||d;return u(b,d,e)},_detachTemplateNodes:function(){var b=this.attachScope||this;k.forEach(this._attachPoints,function(c){delete b[c]});this._attachPoints=[];k.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});n.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return g})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),function(r,k,g,s,n,f,u){r=r([u],{declaredClass:"esri.layers._SnapshotMode",constructor:function(e){this.featureLayer=e;this.pagination=e.queryPagination;this._featureMap={};this._drawFeatures=k.hitch(this,this._drawFeatures);this._queryErrorHandler=
k.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(e){this._init&&(e?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},
drawFeature:function(e){var b=e.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(b,e);this._incRefCount(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var e=this.featureLayer;e._collection?(e._fireUpdateStart(),e._refresh(!0),e._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(e){return("_"+e.name+e.layerId+e._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var e=this.featureLayer;!e._collection&&!e.suspended&&(e._fireUpdateStart(),this._clearIIf(),
this._sendRequest())},_sendRequest:function(e){var b=this.map,c=this.featureLayer,g=c.getDefinitionExpression(),k=new f;k.outFields=c.getOutFields();k.where=g||"1\x3d1";k.returnGeometry=!0;k.outSpatialReference=new n(b.spatialReference.toJson());k.timeExtent=c.getTimeDefinition();k.maxAllowableOffset=c._maxOffset;c._ts&&(k._ts=(new Date).getTime());k.orderByFields=c.supportsAdvancedQueries?c.getOrderByFields():null;k.multipatchOption=c.multipatchOption;this.pagination&&(this._start=k.start=null==
e?0:e,k.num=c.maxRecordCount);var d;c._usePatch&&(d=this._getRequestId(c),this._cancelPendingRequest(null,d));c._task.execute(k,this._drawFeatures,this._queryErrorHandler,d)},_drawFeatures:function(e){this._purgeRequests();var b=e.features,c=this.featureLayer,f=c.objectIdField,g,d=b.length,k=e.exceededTransferLimit&&!c._collection,h,a;for(g=0;g<d;g++)h=b[g],a=h.attributes[f],this._addFeatureIIf(a,h),this._incRefCount(a);this._applyTimeFilter(!0);if(!this.pagination||!k)c._fireUpdateEnd(null,e.exceededTransferLimit?
{queryLimitExceeded:!0}:null);k&&(this.pagination&&this._sendRequest(this._start+c.maxRecordCount),c.onQueryLimitExceeded())},_queryErrorHandler:function(e){this._purgeRequests();var b=this.featureLayer;b._errorHandler(e);b._fireUpdateEnd(e)}});g("extend-esri")&&k.setObject("layers._SnapshotMode",r,s);return r})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(r,k,g,s,n){r=r([n],{declaredClass:"esri.layers._SelectionMode",
constructor:function(f){this.featureLayer=f;this._featureMap={}},propertyChangeHandler:function(f){this._init&&0===f&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});g("extend-esri")&&k.setObject("layers._SelectionMode",r,s);return r})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(r,k,g,s,n,f,u,e){r=r(e,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],
complete:["result"]},constructor:function(b,c){b&&k.isString(b)&&(this._url=u.urlToObject(this.url=b));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=k.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));b&&b.path&&(b.path=b.path.replace(c,"https:"))},_encode:function(b,c,e){var f,d,n={},h,a;for(h in b)if("declaredClass"!==h&&(f=b[h],d=typeof f,
null!==f&&void 0!==f&&"function"!==d))if(k.isArray(f)){n[h]=[];a=f.length;for(d=0;d<a;d++)n[h][d]=this._encode(f[d])}else"object"===d?f.toJson&&(d=f.toJson(e&&e[h]),"esri.tasks.FeatureSet"===f.declaredClass&&d.spatialReference&&(d.sr=d.spatialReference,delete d.spatialReference),n[h]=c?d:g.toJson(d)):n[h]=f;return n},_successHandler:function(b,c,e,g){c&&this[c].apply(this,b);e&&e.apply(null,b);g&&f._resDfd(g,b)},_errorHandler:function(b,c,e){this.onError(b);c&&c(b);e&&e.errback(b)},setNormalization:function(b){this.normalization=
b},onError:function(){}});s("extend-esri")&&(n.Task=r);return r})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(r,k,g){r.DeferredList=function(r,n,f,u,e){var b=[];k.call(this);var c=this;0===r.length&&!n&&this.resolve([0,[]]);var l=0;g.forEach(r,function(e,d){function g(e,a){b[d]=[e,a];l++;l===r.length&&c.resolve(b)}e.then(function(b){n?c.resolve([d,b]):g(!0,b)},function(b){f?c.reject(b):g(!1,b);if(u)return null;throw b;})})};r.DeferredList.prototype=
new k;r.DeferredList.prototype.gatherResults=function(k){k=new r.DeferredList(k,!1,!0,!1);k.addCallback(function(k){var f=[];g.forEach(k,function(g){f.push(g[1])});return f});return k};return r.DeferredList})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(r,k,g,s,n,f){r=s("dijit._OnDijitClickMixin",null,{connect:function(g,e,b){return this.inherited(arguments,[g,"ondijitclick"==e?f:e,b])}});r.a11yclick=
f;return r})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(r,k,g,s){function n(e){if((e.keyCode===r.ENTER||e.keyCode===r.SPACE)&&!/input|button|textarea/i.test(e.target.nodeName))for(e=e.target;e;e=e.parentNode)if(e.dojoClick)return!0}var f;g(document,"keydown",function(e){n(e)?(f=e.target,e.preventDefault()):f=null});g(document,"keyup",function(e){n(e)&&e.target==f&&(f=null,g.emit(e.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,
metaKey:e.metaKey,altKey:e.altKey,_origType:e.type}))});var u=function(e,b){e.dojoClick=!0;return g(e,"click",b)};u.click=u;u.press=function(e,b){var c=g(e,s.press,function(c){("mousedown"!=c.type||k.isLeft(c))&&b(c)}),f=g(e,"keydown",function(c){(c.keyCode===r.ENTER||c.keyCode===r.SPACE)&&b(c)});return{remove:function(){c.remove();f.remove()}}};u.release=function(e,b){var c=g(e,s.release,function(c){("mouseup"!=c.type||k.isLeft(c))&&b(c)}),f=g(e,"keyup",function(c){(c.keyCode===r.ENTER||c.keyCode===
r.SPACE)&&b(c)});return{remove:function(){c.remove();f.remove()}}};u.move=s.move;return u})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(r,k,g,s){g(function(){k("highcontrast")&&r.add(s.body(),"dijit_a11y")});return k})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(r,k,g,s,n,f,u,e){var b=k("dijit._TemplatedMixin",
e,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var e=this.declaredClass,f=this;return u.substitute(b,this,function(b,c){"!"==c.charAt(0)&&(b=s.getObject(c.substr(1),!1,f));if("undefined"==typeof b)throw Error(e+" template:"+c);return null==b?"":"!"==c.charAt(0)?b:this._escapeValue(""+b)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},
buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=r(this.templatePath,{sanitize:!0}));var c=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),e;if(s.isString(c)){if(e=g.toDom(this._stringRepl(c),this.ownerDocument),1!=e.nodeType)throw Error("Invalid template: "+c);}else e=c.cloneNode(!0);this.domNode=e}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var e=this.containerNode;
if(b&&e)for(;b.hasChildNodes();)e.appendChild(b.firstChild)}});b._templateCache={};b.getCachedTemplate=function(c,e,f){var d=b._templateCache,k=c,h=d[k];if(h){try{if(!h.ownerDocument||h.ownerDocument==(f||document))return h}catch(a){}g.destroy(h)}c=u.trim(c);if(e||c.match(/\$\{([^\}]+)\}/g))return d[k]=c;e=g.toDom(c,f);if(1!=e.nodeType)throw Error("Invalid template: "+c);return d[k]=e};f("ie")&&n(window,"unload",function(){var c=b._templateCache,e;for(e in c){var f=c[e];"object"==typeof f&&g.destroy(f);
delete c[e]}});return b})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),function(r,k,g,s,n,f,u,e,b,c,l,y,d,v,h){r=r(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],
"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],
"union-complete":["geometry"]},constructor:function(a){a=k.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=
a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=
a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());return{geometryType:h.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=h.getGeometryType(b);a=a.geometries;var e=[],f={spatialReference:c.toJson()},m=k.mixin;g.forEach(a,function(a,b){e[b]=new d(m(a,
f))});return e},_toProjectGeometry:function(a){var b=a.spatialReference.toJson();return a instanceof l?new d({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new y({paths:[[].concat(a.points)],spatialReference:b})},_fromProjectedGeometry:function(a,b,c){return"esriGeometryEnvelope"===b?(a=a.rings[0],new l(a[0][0],a[0][1],a[2][0],a[2][1],c)):new v({points:a.paths[0],spatialReference:c.toJson()})},project:function(a,c,d,f){var g=k.mixin({},
this._url.query,{f:"json"}),l;a.geometries?(f=d,d=c,c=a.outSR,l=a.geometries[0],g=k.mixin(g,a.toJson())):(l=a[0],g=k.mixin(g,{outSR:c.wkid||s.toJson(c.toJson()),inSR:l.spatialReference.wkid||s.toJson(l.spatialReference.toJson()),geometries:s.toJson(this._encodeGeometries(a))}));var m=h.getJsonType(l),z=this._projectHandler,A=this._errorHandler,r=new n(b._dfdCanceller);r._pendingDfd=e({url:this._url.path+"/project",content:g,callbackParamName:"callback",load:function(a,b){z(a,b,m,c,d,f,r)},error:function(a){A(a,
f,r)}});return r},_projectHandler:function(a,b,c,d,e,f,g){try{var h=this._decodeGeometries(a,c,d);this._successHandler([h],"onProjectComplete",e,g)}catch(k){this._errorHandler(k,f,g)}},onProjectComplete:function(){},simplify:function(a,c,d){var f=a[0].spatialReference,g=k.mixin({},this._url.query,{f:"json",sr:f.wkid?f.wkid:s.toJson(f.toJson()),geometries:s.toJson(this._encodeGeometries(a))}),l=h.getJsonType(a[0]),m=this._simplifyHandler,z=this._errorHandler,A=new n(b._dfdCanceller);A._pendingDfd=
e({url:this._url.path+"/simplify",content:g,callbackParamName:"callback",load:function(a,b){m(a,b,l,f,c,d,A)},error:function(a){z(a,d,A)}});return A},_simplifyHandler:function(a,b,c,d,e,f,g){try{var h=this._decodeGeometries(a,c,d);this._successHandler([h],"onSimplifyComplete",e,g)}catch(k){this._errorHandler(k,f,g)}},onSimplifyComplete:function(){},convexHull:function(a,c,d){var f=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(f.toJson()),geometries:s.toJson(this._encodeGeometries(a))});
var g=this._convexHullHandler,h=this._errorHandler,m=new n(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,m)},error:function(a){h(a,d,m)}});return m},_convexHullHandler:function(a,b,c,d,e,f){try{var g=h.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onConvexHullComplete",d,f)}catch(k){this._errorHandler(k,e,f)}},onConvexHullComplete:function(){},union:function(a,c,d){var f=a[0].spatialReference;
a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(f.toJson()),geometries:s.toJson(this._encodeGeometries(a))});var g=this._unionHandler,h=this._errorHandler,m=new n(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/union",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,m)},error:function(a){h(a,d,m)}});return m},_unionHandler:function(a,b,c,d,e,f){try{var g=h.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onUnionComplete",d,f)}catch(k){this._errorHandler(k,
e,f)}},onUnionComplete:function(){},autoComplete:function(a,c,d,f){var g=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(g.toJson()),polygons:s.toJson(this._encodeGeometries(a).geometries),polylines:s.toJson(this._encodeGeometries(c).geometries)});var h=this._autoCompleteHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,g,d,f,l)},error:function(a){m(a,f,
l)}});return l},_autoCompleteHandler:function(a,b,c,e,f,g){try{var h=a.geometries;a=[];var k,l=h.length;for(k=0;k<l;k++)a[k]=new d({spatialReference:c,rings:h[k].rings});this._successHandler([a],"onAutoCompleteComplete",e,g)}catch(n){this._errorHandler(n,f,g)}},onAutoCompleteComplete:function(){},reshape:function(a,c,d,f){var g=a.spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(g.toJson()),target:s.toJson({geometryType:h.getJsonType(a),geometry:a.toJson()}),reshaper:s.toJson(c.toJson())});
var l=this._reshapeHandler,m=this._errorHandler,z=new n(b._dfdCanceller);z._pendingDfd=e({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,g,d,f,z)},error:function(a){m(a,f,z)}});return z},_reshapeHandler:function(a,b,c,d,e,f){try{var g=h.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onReshapeComplete",d,f)}catch(k){this._errorHandler(k,e,f)}},onReshapeComplete:function(){},cut:function(a,c,d,f){var l=a[0].spatialReference,w=g.map(a,
function(a){return a.toJson()});a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(l.toJson()),target:s.toJson({geometryType:h.getJsonType(a[0]),geometries:w}),cutter:s.toJson(c.toJson())});var m=this._cutHandler,z=this._errorHandler,r=new n(b._dfdCanceller);r._pendingDfd=e({url:this._url.path+"/cut",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,l,d,f,r)},error:function(a){z(a,f,r)}});return r},_cutHandler:function(a,b,c,d,e,f){try{var m=a.geometries,k={};k.cutIndexes=a.cutIndexes;
k.geometries=[];g.forEach(m,function(a){k.geometries.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onCutComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onCutComplete:function(){},intersect:function(a,c,d,f){var g=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:s.toJson(g.toJson()),geometries:s.toJson(this._encodeGeometries(a)),geometry:s.toJson({geometryType:h.getJsonType(c),geometry:c.toJson()})});var l=this._intersectHandler,m=this._errorHandler,z=new n(b._dfdCanceller);
z._pendingDfd=e({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,g,d,f,z)},error:function(a){m(a,f,z)}});return z},_intersectHandler:function(a,b,c,d,e,f){try{var m=[];g.forEach(a.geometries,function(a){m.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([m],"onIntersectComplete",d,f)}catch(k){this._errorHandler(k,e,f)}},onIntersectComplete:function(){},difference:function(a,c,d,f){var g=a[0].spatialReference;a=k.mixin({},this._url.query,
{f:"json",sr:s.toJson(g.toJson()),geometries:s.toJson(this._encodeGeometries(a)),geometry:s.toJson({geometryType:h.getJsonType(c),geometry:c.toJson()})});var l=this._differenceHandler,m=this._errorHandler,z=new n(b._dfdCanceller);z._pendingDfd=e({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,g,d,f,z)},error:function(a){m(a,f,z)}});return z},_differenceHandler:function(a,b,c,d,e,f){try{var m=[];g.forEach(a.geometries,function(a){m.push(h.fromJson(a).setSpatialReference(c))});
this._successHandler([m],"onDifferenceComplete",d,f)}catch(k){this._errorHandler(k,e,f)}},onDifferenceComplete:function(){},buffer:function(a,c,d){var f=k.mixin({},this._url.query,{f:"json"},a.toJson()),g=a.outSpatialReference||a.geometries[0].spatialReference,h=this._bufferHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/buffer",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,l)},error:function(a){m(a,d,l)}});return l},_bufferHandler:function(a,
b,c,e,f,g){try{var h=a.geometries;a=[];var k,l=h.length;for(k=0;k<l;k++)a[k]=new d({spatialReference:c,rings:h[k].rings});this._successHandler([a],"onBufferComplete",e,g)}catch(n){this._errorHandler(n,f,g)}},onBufferComplete:function(){},areasAndLengths:function(a,c,d){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var f=this._areasAndLengthsHandler,g=this._errorHandler,h=new n(b._dfdCanceller);h._pendingDfd=e({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,
b){f(a,b,c,d,h)},error:function(a){g(a,d,h)}});return h},_areasAndLengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onAreasAndLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onAreasAndLengthsComplete:function(){},lengths:function(a,c,d){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var f=this._lengthsHandler,g=this._errorHandler,h=new n(b._dfdCanceller);h._pendingDfd=e({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,
d,h)},error:function(a){g(a,d,h)}});return h},_lengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onLengthsComplete:function(){},labelPoints:function(a,c,d){var f=g.map(a,function(a){return a.toJson()}),h=a[0].spatialReference,f=k.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:s.toJson(h.toJson()),polygons:s.toJson(f)}),l=this._labelPointsHandler,m=this._errorHandler,r=new n(b._dfdCanceller);r._pendingDfd=e({url:this._url.path+
"/labelPoints",content:f,callbackParamName:"callback",load:function(b,e){l(b,e,a,h,c,d,r)},error:function(a){m(a,d,r)}});return r},_labelPointsHandler:function(a,b,c,d,e,f,m){try{var k=[];g.forEach(a.labelPoints,function(a){k.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onLabelPointsComplete",e,m)}catch(l){this._errorHandler(l,f,m)}},onLabelPointsComplete:function(){},relation:function(a,c,d){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var f=this._relationHandler,
g=this._errorHandler,h=new n(b._dfdCanceller);h._pendingDfd=e({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,d,h)},error:function(a){g(a,d,h)}});return h},_relationHandler:function(a,b,c,d,e){try{this._successHandler([a.relations],"onRelationComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onRelationComplete:function(){},trimExtend:function(a,c,d){var f=k.mixin({},this._url.query,{f:"json"},a.toJson()),g=a.sr,h=this._trimExtendHandler,m=this._errorHandler,
l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/trimExtend",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,l)},error:function(a){m(a,d,l)}});return l},_trimExtendHandler:function(a,b,c,d,e,f){try{var g=a.geometries;a=[];var h,k=g.length;for(h=0;h<k;h++)a[h]=new y({spatialReference:c,paths:g[h].paths});this._successHandler([a],"onTrimExtendComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onTrimExtendComplete:function(){},densify:function(a,c,d){var f=k.mixin({},
this._url.query,{f:"json"},a.toJson()),g=a.geometries[0].spatialReference,h=this._densifyHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/densify",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,l)},error:function(a){m(a,d,l)}});return l},_densifyHandler:function(a,b,c,d,e,f){try{var k=[];g.forEach(a.geometries,function(a){k.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onDensifyComplete",d,f)}catch(l){this._errorHandler(l,
e,f)}},onDensifyComplete:function(){},generalize:function(a,c,d){var f=k.mixin({},this._url.query,{f:"json"},a.toJson()),g=a.geometries[0].spatialReference,h=this._generalizeHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/generalize",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,l)},error:function(a){m(a,d,l)}});return l},_generalizeHandler:function(a,b,c,d,e,f){try{var k=[];g.forEach(a.geometries,function(a){k.push(h.fromJson(a).setSpatialReference(c))});
this._successHandler([k],"onGeneralizeComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onGeneralizeComplete:function(){},offset:function(a,c,d){var f=k.mixin({},this._url.query,{f:"json"},a.toJson()),g=a.geometries[0].spatialReference,h=this._offsetHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/offset",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,l)},error:function(a){m(a,d,l)}});return l},_offsetHandler:function(a,b,c,d,e,f){try{var k=
[];g.forEach(a.geometries,function(a){k.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onOffsetComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onOffsetComplete:function(){},distance:function(a,c,d){var f=k.mixin({},this._url.query,{f:"json"},a.toJson()),g=a.geometry1.spatialReference,h=this._distanceHandler,m=this._errorHandler,l=new n(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/distance",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,d,
l)},error:function(a){m(a,d,l)}});return l},_distanceHandler:function(a,b,c,d,e,f){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,c,d){var f={};k.isObject(a.sr)?f.sr=a.sr.wkid||s.toJson(a.sr.toJson()):f.sr=a.sr;f.coordinates=s.toJson(a.coordinates);f.conversionType=a.conversionType||"MGRS";f.conversionMode=a.conversionMode;f.numOfDigits=a.numOfDigits;f.rounding=a.rounding;
f.addSpaces=a.addSpaces;a=k.mixin({},this._url.query,{f:"json"},f);var g=this._toGeoCoordinateHandler,h=this._errorHandler,m=new n(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,c,d,m)},error:function(a){h(a,d,m)}});return m},_toGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onToGeoCoordinateStringComplete:function(){},
fromGeoCoordinateString:function(a,c,d){var f={};k.isObject(a.sr)?f.sr=a.sr.wkid||s.toJson(a.sr.toJson()):f.sr=a.sr;f.strings=s.toJson(a.strings);f.conversionType=a.conversionType||"MGRS";f.conversionMode=a.conversionMode;a=k.mixin({},this._url.query,{f:"json"},f);var g=this._fromGeoCoordinateHandler,h=this._errorHandler,m=new n(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/fromGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,c,d,m)},error:function(a){h(a,
d,m)}});return m},_fromGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onFromGeoCoordinateStringComplete:function(){}});k.mixin(r,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,
UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,
UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,
UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",
UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});f("extend-esri")&&k.setObject("tasks.GeometryService",r,u);return r})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(r,k,g,s,n,f,u,e,b,c,l,
y,d,v,h,a){function p(a){return eval("("+a+")")}function q(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<x){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=x}return b}function t(a,b){var c=a.join();if(!w[c]){for(var d=[],e=0,f=a.length;e<f;e++){var h=a[e];d[d.length]=w[h]=w[h]||g.getObject(h)||~h.indexOf("/")&&(b?b(h):r(h))}e=d.shift();w[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return w[c]}new Date("X");var x=0;
b.after(g,"extend",function(){x++},!0);var w={},m={_clearCache:function(){x++;w={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),f=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);f&&f.length&&s.forEach(f.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||k._scopeName)+"Type",e="data-"+(c.scope||k._scopeName)+"-",f=e+"type",g=e+"mixins",h=
[];s.forEach(a,function(a){var c=d in b?b[d]:a.getAttribute(f)||a.getAttribute(d);if(c){var e=a.getAttribute(g),c=e?[c].concat(e.split(/\s*,\s*/)):[c];h.push({node:a,types:c})}});return this._instantiate(h,b,c)},_instantiate:function(a,b,d,e){function f(a){!b._started&&!d.noStart&&s.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=s.map(a,function(a){var c=a.ctor||t(a.types,d.contextRequire);if(!c)throw Error("Unable to resolve constructor for: '"+a.types.join()+
"'");return this.construct(c,a.node,b,d,a.scripts,a.inherited)},this);return e?c(a).then(f):f(a)},construct:function(a,c,f,m,n,r){function t(a){N&&g.setObject(N,a);for(D=0;D<G.length;D++)b[G[D].advice||"after"](a,G[D].method,g.hitch(a,G[D].func),!0);for(D=0;D<T.length;D++)T[D].call(a);for(D=0;D<R.length;D++)a.watch(R[D].prop,R[D].func);for(D=0;D<U.length;D++)h(a,U[D].event,U[D].func);return a}var u=a&&a.prototype;m=m||{};var w={};m.defaults&&g.mixin(w,m.defaults);r&&g.mixin(w,r);var x;d("dom-attributes-explicit")?
x=c.attributes:d("dom-attributes-specified-flag")?x=s.filter(c.attributes,function(a){return a.specified}):(r=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),x=s.map(r.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==c.nodeName&&"value"==a||"enctype"==b?c.getAttribute(b):c.getAttributeNode(b).value}}));var y=m.scope||k._scopeName;r="data-"+y+"-";var B={};"dojo"!==
y&&(B[r+"props"]="data-dojo-props",B[r+"type"]="data-dojo-type",B[r+"mixins"]="data-dojo-mixins",B[y+"type"]="dojoType",B[r+"id"]="data-dojo-id");for(var D=0,C,y=[],N,J;C=x[D++];){var E=C.name,I=E.toLowerCase();C=C.value;switch(B[I]||I){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":J=C;break;case "data-dojo-id":case "jsid":N=C;break;case "data-dojo-attach-point":case "dojoattachpoint":w.dojoAttachPoint=C;break;case "data-dojo-attach-event":case "dojoattachevent":w.dojoAttachEvent=
C;break;case "class":w["class"]=c.className;break;case "style":w.style=c.style&&c.style.cssText;break;default:if(E in u||(E=q(a)[I]||E),E in u)switch(typeof u[E]){case "string":w[E]=C;break;case "number":w[E]=C.length?Number(C):NaN;break;case "boolean":w[E]="false"!=C.toLowerCase();break;case "function":""===C||-1!=C.search(/[^\w\.]+/i)?w[E]=new Function(C):w[E]=g.getObject(C,!1)||new Function(C);y.push(E);break;default:I=u[E],w[E]=I&&"length"in I?C?C.split(/\s*,\s*/):[]:I instanceof Date?""==C?new Date(""):
"now"==C?new Date:l.fromISOString(C):I instanceof e?k.baseUrl+C:p(C)}else w[E]=C}}for(x=0;x<y.length;x++)B=y[x].toLowerCase(),c.removeAttribute(B),c[B]=null;if(J)try{J=p.call(m.propsThis,"{"+J+"}"),g.mixin(w,J)}catch(Y){throw Error(Y.toString()+" in data-dojo-props\x3d'"+J+"'");}g.mixin(w,f);n||(n=a&&(a._noScript||u._noScript)?[]:v("\x3e script[type^\x3d'dojo/']",c));var G=[],T=[],R=[],U=[];if(n)for(D=0;D<n.length;D++)B=n[D],c.removeChild(B),f=B.getAttribute(r+"event")||B.getAttribute("event"),m=
B.getAttribute(r+"prop"),J=B.getAttribute(r+"method"),y=B.getAttribute(r+"advice"),x=B.getAttribute("type"),B=this._functionFromScript(B,r),f?"dojo/connect"==x?G.push({method:f,func:B}):"dojo/on"==x?U.push({event:f,func:B}):w[f]=B:"dojo/aspect"==x?G.push({method:J,advice:y,func:B}):"dojo/watch"==x?R.push({prop:m,func:B}):T.push(B);a=(n=a.markupFactory||u.markupFactory)?n(w,c,a):new a(w,c);return a.then?a.then(t):t(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(l)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var e=[],f=[],g={},h=(b.scope||k._scopeName)+"Type",m="data-"+(b.scope||k._scopeName)+"-",p=m+"type",l=m+"textdir",m=m+"mixins",q=a.firstChild,n=b.inherited;if(!n){var v=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&v(a.parentNode,b)},n={dir:v(a,"dir"),lang:v(a,"lang"),textDir:v(a,l)},w;for(w in n)n[w]||
delete n[w]}for(var n={inherited:n},u,x;;)if(q)if(1!=q.nodeType)q=q.nextSibling;else if(u&&"script"==q.nodeName.toLowerCase())(E=q.getAttribute("type"))&&/^dojo\/\w/i.test(E)&&u.push(q),q=q.nextSibling;else if(x)q=q.nextSibling;else{var E=q.getAttribute(p)||q.getAttribute(h);w=q.firstChild;if(!E&&(!w||3==w.nodeType&&!w.nextSibling))q=q.nextSibling;else{x=null;if(E){var I=q.getAttribute(m);u=I?[E].concat(I.split(/\s*,\s*/)):[E];try{x=t(u,b.contextRequire)}catch(Y){}x||s.forEach(u,function(a){~a.indexOf("/")&&
!g[a]&&(g[a]=!0,f[f.length]=a)});I=x&&!x.prototype._noScript?[]:null;n={types:u,ctor:x,parent:n,node:q,scripts:I};n.inherited=c(n);e.push(n)}else n={node:q,scripts:u,parent:n};u=I;x=q.stopParser||x&&x.prototype.stopParser&&!b.template;q=w}}else{if(!n||!n.node)break;q=n.node.nextSibling;x=!1;n=n.parent;u=n.scripts}var G=new y;f.length?(d("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+f.join(", ")),(b.contextRequire||r)(f,function(){G.resolve(s.filter(e,function(a){if(!a.ctor)try{a.ctor=
t(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):G.resolve(e);return G.promise},_require:function(a,b){var c=p("{"+a.innerHTML+"}"),d=[],e=[],f=new y,h=b&&b.contextRequire||r,k;for(k in c)d.push(k),e.push(c[k]);h(e,function(){for(var a=0;a<d.length;a++)g.setObject(d[a],arguments[a]);f.resolve(arguments)});
return f.promise},_scanAmd:function(a,b){var c=new y,d=c.promise;c.resolve(!0);var e=this;v("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&g.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?f.byId(c):u.body();b=b||{};var d=b.template?{template:!0}:{},e=[],h=this,k=this._scanAmd(c,b).then(function(){return h.scan(c,b)}).then(function(a){return h._instantiate(a,
d,b,!0)}).then(function(a){return e=e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});g.mixin(e,k);return e}};k.parser=m;n.parseOnLoad&&a(100,m,"parse");return m})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(r,k,g,s,n,f,u,e,b,c,l,y,d){function v(){}
function h(a){return function(b,c,d,e){return b&&"string"==typeof c&&b[c]==v?b.on(c.substring(2).toLowerCase(),u.hitch(d,e)):a.apply(g,arguments)}}r.around(g,"connect",h);f.connect&&r.around(f,"connect",h);r=s("dijit._Widget",[l,y,d],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(a){this._toConnect={};for(var b in a)this[b]===v&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===v?g.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,
b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?e("[widgetId]",this.containerNode).map(c.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});n("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});return r})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(r,k,g,s){s.extend(k,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:r})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d,v,h,a,p){var q,t,x=new (k([y,u],{curNode:null,activeStack:[],constructor:function(){var a=e.hitch(this,function(a){g.isDescendant(this.curNode,a)&&this.set("curNode",null);g.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});r.before(f,"empty",a);r.before(f,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,e=a.document&&a.document.body;if(e){var f=l("pointer-events")?"pointerdown":l("MSPointer")?
"MSPointerDown":l("touch-events")?"mousedown, touchstart":"mousedown",g=b(a.document,f,function(a){if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),k=b(e,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(h.isFocusable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),p=b(e,"focusout",function(a){d._onBlurNode(c||a.target)});return{remove:function(){g.remove();k.remove();p.remove();e=g=
k=p=null}}}},_onBlurNode:function(a){a=(new Date).getTime();a<q+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(e.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<t+100||(this._clearActiveWidgetsTimer=setTimeout(e.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(b,c){t=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);n.contains(b,"dijitPopup")&&(b=b.firstChild);var e=[];try{for(;b;){var f=s.get(b,"dijitPopupParent");if(f)b=a.byId(f).domNode;else if(b.tagName&&"body"==b.tagName.toLowerCase()){if(b===d.body())break;b=v.get(b.ownerDocument).frameElement}else{var g=b.getAttribute&&b.getAttribute("widgetId"),h=g&&a.byId(g);h&&!("mouse"==c&&h.get("disabled"))&&e.unshift(g);b=b.parentNode}}}catch(k){}this._setStack(e,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(q=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(b,c){var d=this.activeStack,e=d.length-1,f=b.length-1;if(b[f]!=d[e]){this.set("activeStack",b);var g;for(g=e;0<=g&&d[g]!=b[g];g--)if(e=a.byId(d[g]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),
this.emit("widget-blur",e,c);for(g++;g<=f;g++)if(e=a.byId(b[g]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));c(function(){var a=x.registerWin(v.get(document));l("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});p.focus=function(a){x.focus(a)};for(var w in x)/^_/.test(w)||(p.focus[w]="function"==typeof x[w]?e.hitch(x,w):x[w]);x.watch(function(a,b,c){p.focus[a]=c});return x})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(r,k,g,s,n,f,u,e,b,c,l,y,d){r=r(y,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(b,c){this._handler=k.hitch(this,this._handler);this._relationshipQueryHandler=k.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=k.hitch(this,this._executeForIdsHandler);this._countHandler=k.hitch(this,this._countHandler);
this._extentHandler=k.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(b,c,a,d,f){var g=f.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json"},b.toJson(g&&g[0])));var l=this._handler,r=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=n.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,d){l(b,d,c,a,f.dfd)},error:function(b){r(b,a,f.dfd)},callbackSuffix:d},this.requestOptions)},executeRelationshipQuery:function(c,
d,a){c=this._encode(k.mixin({},this._url.query,{f:"json"},c.toJson()));var f=this._relationshipQueryHandler,g=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var l=new s(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(b,c){f(b,c,d,a,l)},error:function(b){g(b,a,l)}},this.requestOptions);return l},executeForIds:function(b,c,a,d){var f=d.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
b.toJson(f&&f[0])));var g=this._executeForIdsHandler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},b.layer=n.toJson(f));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,c,a,d.dfd)},error:function(b){l(b,a,d.dfd)}},this.requestOptions)},executeForCount:function(b,c,a,d){var f=d.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(f&&
f[0])));var g=this._countHandler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},b.layer=n.toJson(f));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,c,a,d.dfd)},error:function(b){l(b,a,d.dfd)}},this.requestOptions)},executeForExtent:function(b,c,a,d){var f=d.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(f&&f[0])));
var g=this._extentHandler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},b.layer=n.toJson(f));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,c,a,d.dfd)},error:function(b){l(b,a,d.dfd)}},this.requestOptions)},_handler:function(b,c,a,e,f){try{var g=new d(b);this._successHandler([g],"onComplete",a,f)}catch(k){this._errorHandler(k,e,f)}},_relationshipQueryHandler:function(b,c,a,e,
f){try{var k=b.geometryType,l=b.spatialReference,n={};g.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=k;b.spatialReference=l;b.features=a.relatedRecords;b=new d(b);if(null!=a.objectId)n[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(n[a[c]]=b)});this._successHandler([n],"onExecuteRelationshipQueryComplete",a,f)}catch(m){this._errorHandler(m,e,f)}},_executeForIdsHandler:function(b,c,a,d,e){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",
a,e)}catch(f){this._errorHandler(f,d,e)}},_countHandler:function(b,c,a,d,e){try{var f,g=b.features,k=b.objectIds;if(k)f=k.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");f=b.count}this._successHandler([f],"onExecuteForCountComplete",a,e)}catch(l){this._errorHandler(l,d,e)}},_extentHandler:function(b,d,a,e,f){try{b.extent&&(b.extent=new c(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,f)}catch(g){this._errorHandler(g,e,f)}}});l._createWrappers(r);
f("extend-esri")&&k.setObject("tasks.QueryTask",r,u);return r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(r,k,g){return g("dijit.Destroyable",null,{destroy:function(g){this._destroyed=!0},own:function(){var g=["destroyRecursive","destroy","remove"];r.forEach(arguments,function(n){function f(){e.remove();r.forEach(b,function(b){b.remove()})}var u,e=k.before(this,"destroy",function(b){n[u](b)}),b=[];n.then?(u="cancel",n.then(f,f)):r.forEach(g,
function(c){"function"===typeof n[c]&&(u||(u=c),b.push(k.after(n,c,f,!0)))})},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,k,g,s){r=r(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(g){g&&k.isObject(g)&&(this.objectId=g.objectId,this.success=g.success,g.success||(g=g.error,this.error=Error(),this.error.code=g.code,this.error.message=g.description))}});g("extend-esri")&&
k.setObject("layers.FeatureEditResult",r,s);return r})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(r){return r.cache})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(r,k,g,s,n,f,u,e,b,c,l){r=r(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){k.mixin(this,b);var d=
this.features,f=b.spatialReference,h=c.getGeometryType(b.geometryType),f=this.spatialReference=new e(f);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);g.forEach(d,function(a,b){var c=a.geometry&&a.geometry.spatialReference;d[b]=new u(h&&a.geometry?new h(a.geometry):null,a.symbol&&l.fromJson(a.symbol),a.attributes);d[b].geometry&&!c&&d[b].geometry.setSpatialReference(f)})}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(e){var d=
{};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=c.getJsonType(this.features[0].geometry)),d.features=b._encodeGraphics(this.features,e));d.exceededTransferLimit=this.exceededTransferLimit;return f.fixJson(d)}});
s("extend-esri")&&k.setObject("tasks.FeatureSet",r,n);return r})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(r,k,g,s,n,f){r=r(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(g){g&&k.isObject(g)&&(this.name=g.name,this.description=g.description,this.drawingTool=g.drawingTool,g=g.prototype,this.prototype=new f(g.geometry,null,g.attributes))},toJson:function(){return n.fixJson({name:this.name,
description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});k.mixin(r,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",
TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});g("extend-esri")&&k.setObject("layers.FeatureTemplate",r,s);return r})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,k,g,s){r=r(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});g("extend-esri")&&k.setObject("tasks.StatisticDefinition",r,s);return r})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),
function(r,k,g,s,n,f,u,e){r=r([f,u],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,c){k.mixin(this,c);this.initialize(b,c)},getTitle:function(b){var c;this.info&&(c=this.titleHasRelatedFields?"":this._getPopupValues(b,!0).title);return c||""},getContent:function(b){return this.info?(new e({template:this,graphic:b,chartTheme:this.chartTheme},s.create("div"))).domNode:""}});g("extend-esri")&&k.setObject("dijit.PopupTemplate",r,n);return r})},
"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct ../kernel ../config ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(r,
k,g,s,n,f,u,e,b,c,l,y,d,v,h,a,p,q,t,x,w,m,z,A,O,L,F,H,Z){function P(a){return v({url:M.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function X(a,b){var c={f:"json"};b&&(c.token=b);return v({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function $(a){a.itemProperties.layerDefinition&&(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),
d.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),d.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);
d.isDefined(a.itemProperties.showLabels)&&!d.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);d.isDefined(a.itemProperties.showLegend)&&!d.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);d.isDefined(a.itemProperties.refreshInterval)&&!d.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function Q(a){$(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!d.isDefined(a.layerDefinition.maximumTrackPoints)&&d.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&
(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&(a.purgeOptions=a.itemProperties.purgeOptions)}function B(a,c){var e=new n,f=a.itemData,h=[],k=[];g.forEach(f.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();
-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(k.push(a),h.push(P(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!d.isDefined(a.minScale)&&!d.isDefined(a.maxScale))?(k.push(a),h.push(P(a))):-1<b.indexOf("/imageserver")&&!d.isDefined(a.minScale)&&!d.isDefined(a.maxScale)?(k.push(a),h.push(P(a))):-1<b.indexOf("/streamserver")&&(k.push(a),h.push(P(a)))}});f.baseMap&&f.baseMap.baseMapLayers&&g.forEach(f.baseMap.baseMapLayers,function(a){a.itemId&&(k.push(a),
h.push(P(a)))});if(0<h.length){var l={};(new b(h)).addCallback(function(b){g.forEach(k,function(a,c){var e=b[c][1];if(e&&!(e instanceof Error)&&(l[a.itemId]=e,!a.type)){var f=a.url.toLowerCase();if((-1<f.indexOf("/featureserver")||-1<f.indexOf("/mapserver/"))&&e.layers)g.forEach(e.layers,function(b){if(f.endsWith("/featureserver/"+b.id)||f.endsWith("/mapserver/"+b.id))a.itemProperties=b,$(a)});else if(-1<f.indexOf("/streamserver"))a.itemProperties=e,Q(a);else if(-1<f.indexOf("/mapserver"))e.layers&&
!a.layers&&(a.layers=e.layers),d.isDefined(e.minScale)&&!d.isDefined(a.minScale)&&(a.minScale=e.minScale),d.isDefined(e.maxScale)&&!d.isDefined(a.maxScale)&&(a.maxScale=e.maxScale),d.isDefined(e.refreshInterval)&&!d.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval);else if(-1<f.indexOf("/imageserver")&&(d.isDefined(e.minScale)&&!d.isDefined(a.minScale)&&(a.minScale=e.minScale),d.isDefined(e.maxScale)&&!d.isDefined(a.maxScale)&&(a.maxScale=e.maxScale),d.isDefined(e.refreshInterval)&&
!d.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval),e.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=e.popupInfo),e.renderingRule&&!a.renderingRule&&(a.renderingRule=e.renderingRule,e.renderingRule.functionName&&(a.renderingRule.rasterFunction=e.renderingRule.functionName)),e.bandIds&&!a.bandIds&&(a.bandIds=e.bandIds),e.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=e.mosaicRule),e.format&&!a.format&&(a.format=e.format),d.isDefined(e.compressionQuality)&&!d.isDefined(a.compressionQuality)&&
(a.compressionQuality=e.compressionQuality),e.layerDefinition&&e.layerDefinition.definitionExpression&&(!d.isDefined(a.layerDefinition)||!d.isDefined(a.layerDefinition.definitionExpression))))a.layerDefinition=a.layerDefinition||{},a.layerDefinition.definitionExpression=e.layerDefinition.definitionExpression}});a.relatedItemsData=l;e.callback(a)})}else e.callback(a);return e}function D(a,b){var c=new n,d=a.itemData,e=d.baseMap.baseMapLayers[0];if("BingMapsAerial"===e.type||"BingMapsRoad"===e.type||
"BingMapsHybrid"===e.type)if(e.portalUrl&&l.id)delete b.bingMapsKey,l.id.checkSignInStatus(p.urlToObject(M.arcgisUrl).path).then(k.hitch(null,function(a,b,c,d,f){X(e.portalUrl,f.token).then(k.hitch(null,C,a,b,c,d),k.hitch(null,N,a,b,c,d))},a,b,d,c),k.hitch(null,function(a,b,c,d,f){X(e.portalUrl).then(k.hitch(null,C,a,b,c,d),k.hitch(null,N,a,b,c,d))},a,b,d,c));else if(b.bingMapsKey){var f=new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL});s.connect(f,"onLoad",k.hitch(this,function(){c.callback([a,
b])}));s.connect(f,"onError",function(f){delete b.bingMapsKey;a.itemData=J(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});c.callback([a,b])})}else a.itemData=J(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),
c.callback([a,b]);else c.callback([a,b]);return c}function C(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL}),s.connect(e,"onLoad",k.hitch(this,function(){d.callback([a,b])})),s.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=J(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,
b])})):N(a,b,c,d)}function N(a,b,c,d){delete b.bingMapsKey;a.itemData=J(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])}function J(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:
"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};
return a}function E(a,b,c,e){var f=a.dynamicLayerInfos||a.layerInfos,h=b.layers;if(h&&f)if(e.usePopupManager){var k;g.forEach(f,function(a){var b=a.id;if(!a.subLayerIds)for(a=0;a<h.length;a++){var d=h[a];if(d.id===b&&d.popupInfo){k||(k={});k[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});k&&a.setInfoTemplates(k)}else{var l=[],m=[],p=[],n=[],r=[],q=[];g.forEach(f,function(b){var c=b.id;if(!b.subLayerIds&&-1!==g.indexOf(a.visibleLayers,c))for(b=0;b<h.length;b++){var e=h[b];if(e.id===
c){m.push(c);l.push(e.popupInfo);p.push(e.layerUrl||"");e.layerDefinition&&e.layerDefinition.definitionExpression?n.push(e.layerDefinition.definitionExpression):n.push("");r.push(d.isDefined(e.minScale)?e.minScale:null);q.push(d.isDefined(e.maxScale)?e.maxScale:null);break}}});l.length&&(a.__popups=l,a.__popupIds=m,a.__popupUrls=p,a.__popupWhereClauses=n,a.__popupMinScales=r,a.__popupMaxScales=q,a.__resourceInfo=b.resourceInfo)}}function I(a){if(!a)return!1;var b=(new u(M.arcgisUrl)).authority;return-1!==
a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function Y(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function G(a){if("https:"===location.protocol&&(I(a)||Y(a)))a=a.replace("http:","https:");return a}function T(a,b,c){var d=[],e;a.displayLevels||(d=g.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=k.clone(a.exclusionAreas),e=g.map(e,function(a){a.geometry=new t(a.geometry);return a}));d=new F(G(a.url),
{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});c.ignorePopups||E(d,a,b,c);return d}function R(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&
-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function U(a,b,c){var d=new Ta;d.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&(d.format="png32");var d=new Sa(G(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var f="";g.forEach(d.layerInfos,
function(a){a.defaultVisibility&&(f+=(0<f.length?",":"")+a.id)});e=f}if(a.layers&&0<a.layers.length){var h=[],l=[],m,p=[],n,r;g.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(h[b.id]=b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){m=null;r=b.layerDefinition.source;if("mapLayer"===r.type){var c=g.filter(a.resourceInfo.layers,function(a){return a.id===r.mapLayerId});c.length&&(m=k.mixin(c[0],b))}else m=k.mixin({},b);m&&
(m.source=r,delete m.popupInfo,m=new Ua(m),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<g.indexOf(c,b.id)?m.defaultVisibility=!0:m.defaultVisibility=!1),l.push(m))}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(n=new Va(b.layerDefinition.drawingInfo),p[b.id]=n)},this);0<h.length&&d.setLayerDefinitions(h);0<l.length?(d.setDynamicLayerInfos(l,!0),0<p.length&&d.setLayerDrawingOptions(p,!0)):(e=R(d.layerInfos,e),d.setVisibleLayers(e))}else e=
R(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||E(d,a,b,c);return d}function ua(a,b,c){var e=new Wa;e.bandIds=a.bandIds;null!=a.format&&(e.format=a.format,null!=a.compressionQuality&&(e.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var f=new Xa(a.renderingRule);e.renderingRule=f}a.mosaicRule&&(f=new Ya(a.mosaicRule),e.mosaicRule=f);d.isDefined(a.noData)&&(e.noData=a.noData);d.isDefined(a.noDataInterpretation)&&(e.noDataInterpretation=a.noDataInterpretation);
d.isDefined(a.interpolation)&&(e.interpolation=a.interpolation);e=new Za(G(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:e,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});a.layerDefinition&&a.layerDefinition.definitionExpression&&e.setDefinitionExpression(a.layerDefinition.definitionExpression,!0);!c.ignorePopups&&a.popupInfo&&e.setInfoTemplate(new b(a.popupInfo));return e}function aa(a,b,c){var e=[102113,102100,
3857],f=c||new h(b[0].layerObject.fullExtent.spatialReference),k=new h(a.resourceInfo.fullExtent.spatialReference);return f.wkt==k.wkt&&(f.wkid==k.wkid||d.isDefined(f.latestWkid)&&f.latestWkid==k.wkid||d.isDefined(k.latestWkid)&&f.wkid==k.latestWkid||d.isDefined(f.latestWkid)&&f.latestWkid==k.latestWkid)||f.wkid&&k.wkid&&g.some(e,function(a){return a===k.wkid})&&g.some(e,function(a){return a===f.wkid})?!0:!1}function ba(a,b){if(!b[0].layerObject.tileInfo)return!1;var c=[];g.forEach(b,function(a){a.baseMapLayer&&
a.layerObject.tileInfo&&(c=c.concat(g.map(a.layerObject.tileInfo.lods,function(a){return a.scale})))});return g.some(a.resourceInfo.tileInfo.lods,function(a){return g.some(c,function(b){return b===a.scale})})}function ca(a,b,c,n,r){var q,u=c._clazz;if("OpenStreetMap"===a.type)q=new $a({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var v=[],x=[];g.forEach(a.layers,function(a){x.push(new ab({name:a.name,title:a.title,legendURL:a.legendURL}));
v.push(a.name)},this);a.visibleLayers&&(v=a.visibleLayers);n={extent:new t(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new h({wkid:4326})),layerInfos:x,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};q=new bb(a.url,{id:a.id,visibleLayers:v,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,visible:null!==
a.visibility?a.visibility:!0,resourceInfo:n,refreshInterval:a.refreshInterval});q.spatialReference.wkid=n.spatialReferences[0]}else if("KML"===a.type){c=a.url;if(l.id&&(u=l.id.findCredential(p.urlToObject(M.arcgisUrl).path))){var y=M.arcgisUrl.substring(M.arcgisUrl.indexOf("//")+2,M.arcgisUrl.indexOf("/",M.arcgisUrl.indexOf("//")+3)),S=y.split("."),S=S[S.length-2]+"."+S[S.length-1];b=c.indexOf(S);-1<b&&(c="https://"+y+c.substring(b+S.length),c+="?token\x3d"+u.token)}q=new cb(c,{id:a.id,visible:null!==
a.visibility?a.visibility:!0,outSR:n,refreshInterval:a.refreshInterval});s.connect(q,"onLoad",function(){(a.opacity||0===a.opacity)&&q.setOpacity(a.opacity);d.isDefined(a.minScale)&&d.isDefined(a.maxScale)&&q.setScaleRange(a.minScale,a.maxScale);a.visibleFolders&&g.forEach(q.folders,function(b){-1<g.indexOf(a.visibleFolders,b.id)?q.setFolderVisibility(b,!0):q.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(q=new db(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,
opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new t(a.fullExtent),initialExtent:a.fullExtent&&new t(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new eb(a.tileInfo):null,refreshInterval:a.refreshInterval}),s.connect(q,"onLoad",function(){(d.isDefined(a.minScale)||d.isDefined(a.maxScale))&&q.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(q=new fb(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:n,refreshInterval:a.refreshInterval}),s.connect(q,"onLoad",
function(){!1===a.visibility&&q.hide();d.isDefined(a.minScale)&&d.isDefined(a.maxScale)&&q.setScaleRange(a.minScale,a.maxScale);var b=q.getFeatureLayers();g.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=w.fromJson(a.pointSymbol),1===b.length&&(q.pointSymbol=w.fromJson(a.pointSymbol))):a.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=w.fromJson(a.lineSymbol),1===b.length&&(q.polylineSymbol=w.fromJson(a.lineSymbol))):a.polygonSymbol&&
"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=w.fromJson(a.polygonSymbol),1===b.length&&(q.polygonSymbol=w.fromJson(a.polygonSymbol)))})})):"CSV"==a.type&&a.url?(n={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(n.latitudeFieldName=a.locationInfo.latitudeFieldName,n.longitudeFieldName=a.locationInfo.longitudeFieldName),c.ignorePopups||
(n.infoTemplate=new z(a.popupInfo?a.popupInfo:gb.generateDefaultPopupInfo(a))),q=new hb(a.url,n)):a.layerDefinition&&!a.url?(n=f.fromJson(f.toJson(a)),delete n.id,delete n.opacity,delete n.visibility,q=new H(n,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],autoGeneralize:!0}),!c.ignorePopups&&n.popupInfo&&q.setInfoTemplate(new u(n.popupInfo))):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?c.bingMapsKey?(n=V.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===
a.type?n=V.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(n=V.MAP_STYLE_ROAD),q=new V({bingMapsKey:c.bingMapsKey,mapStyle:n,opacity:a.opacity,id:a.id}),s.connect(q,"onError",k.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+
a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?q=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||aa(a,b,n)&&ba(a,r))?T(a,u,c):U(a,u,c):a.resourceInfo&&a.resourceInfo.pixelSizeX?q=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||aa(a,b,n)&&ba(a,r))?T(a,u,c):ua(a,u,c):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type?(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),q=new H(G(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,
mode:I(a.url)?H.MODE_AUTO:d.isDefined(a.mode)?a.mode:H.MODE_ONDEMAND,editable:!1===c.editable?!1:void 0,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval}),!c.ignorePopups&&a.popupInfo&&q.setInfoTemplate(new u(a.popupInfo)),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(n=m.fromJson(a.layerDefinition.drawingInfo.renderer),n.isMaxInclusive=!0,q.setRenderer(n)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&(n=
g.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new ib(a)}),q.setLabelingInfo(n)),a.layerDefinition.definitionExpression&&q.setDefinitionExpression(a.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.minScale)&&q.setMinScale(a.layerDefinition.minScale),d.isDefined(a.layerDefinition.maxScale)&&q.setMaxScale(a.layerDefinition.maxScale))):a.resourceInfo&&a.resourceInfo.streamUrls&&(n={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id},a.layerDefinition&&
(S=a.layerDefinition.drawingInfo,a.layerDefinition.definitionGeometry&&(y=y||{},y.geometry=a.layerDefinition.definitionGeometry),d.isDefined(a.layerDefinition.definitionExpression)&&(y=y||{},y.where=a.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.maximumTrackPoints)&&(n.maximumTrackPoints=a.layerDefinition.maximumTrackPoints)),y&&(n.filter=y),a.purgeOptions&&(n.purgeOptions=a.purgeOptions),q=new jb(G(a.url),n),S&&S.renderer&&(n=S.renderer,q.setRenderer(m.fromJson(n))),!c.ignorePopups&&
a.popupInfo&&q.setInfoTemplate(new u(a.popupInfo)),e.once(q,"error",function(b){a.errors.push({message:"Error loading stream layer. Check websocket url"})}));q&&(q.arcgisProps={title:a.title},a.baseMapLayer&&(q._basemapGalleryLayerType=a.isReference?"reference":"basemap"));return q}function da(a,b,c,d){g.forEach(a,function(e,f){if(e.url&&!e.type){if(0===f||a[0].layerObject)e.layerObject=ca(e,a,b,c,d)}else e.layerObject=ca(e,a,b,c,d)});var e=g.filter(a,function(a){return!a.isReference}),f=g.filter(a,
function(a){return!!a.isReference});return a=e.concat(f)}function ea(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new h,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new h({wkid:102100}):"WMS"==a.type&&(b=new h({wkid:a.spatialReferences[0]}));return b}function K(a,b,c,d,e,f,h){g.forEach(b,function(b,
c){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});f=f||ea(b);b=da(b,c,f,h);e.callback(b);return e}function Fa(a,b){var c=G(a);return v({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);y.defaults.io.errorHandler(a,d)}})}function Ga(a){var b=M.arcgisUrl+"/"+a.itemId+"/data";return v({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?
c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);y.defaults.io.errorHandler(c,d)}})}function Ha(a,b,c){var e=new n;if((!c.featureCollection||!c.featureCollection.layers)&&!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),e.errback(),e;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,d.isDefined(c.showLegend)&&
(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));Ia(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?g.forEach(c.featureCollection.layers,function(b,c){var e=a.featureCollection.layers[c];if(!e.poupInfo&&!e.layerDefinition)e.popupInfo=b.popupInfo,e.layerDefinition=b.layerDefinition;else if(e.layerDefinition){if(d.isDefined(e.layerDefinition.minScale)&&d.isDefined(e.layerDefinition.maxScale)&&(e.layerDefinition.minScale!==
b.layerDefinition.minScale||e.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;e.layerDefinition.drawingInfo&&f.toJson(e.layerDefinition.drawingInfo)!==f.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;e.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;e.layerDefinition=k.mixin(e.layerDefinition,b.layerDefinition)}else e.layerDefinition=b.layerDefinition;
e.featureSet=b.featureSet;e.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=k.mixin(a.featureCollection,c.featureCollection));e.callback(a)});return e}function Ia(a,c,e){var f=new n;r(["./csv"],function(h){var k=[];g.forEach(c.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=k.length,k.push(h.projectFeatureCollection(a,
e,a.featureSet.features[0].geometry.spatialReference)))});(new b(k)).addCallback(function(){g.forEach(c.layers,function(b){d.isDefined(b.deferredsPos)&&(k[b.deferredsPos].results&&k[b.deferredsPos].results.length?b=k[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});f.callback(c)})});
return f}function fa(a,c,d,f){var h=new n,l=new n,m=[],p;g.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&m.push(Ga(a).then(k.hitch(null,Ha,a,d)))});0===m.length?Ja(a,c,d,f,l):(p=new b(m),p.addCallback(function(b){Ja(a,c,d,f,l)}));l.then(function(a){m=[];g.forEach(a,function(a){a=a.layerObject;if(a instanceof H&&!a.loaded&&!a.loadError){var b=new n;e.once(a,"load, error",function(){b.callback(a)});m.push(b)}});if(m.length){var c=new n;p=new b(m);p.addCallback(function(){c.callback(a)});
return c.promise}return a}).then(function(a){var b=[];g.forEach(a,function(a){if(a.layerObject instanceof H){var c=a.layerObject;c.loaded&&(c.labelingInfo&&(a.showLabels||c._collection))&&b.push(c)}});b.length?r(["../layers/LabelLayer"],function(c){var d=new c;g.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});h.callback(a)}):h.callback(a)});return h}function Ja(a,c,d,e,f){var h=[],k=[],l=[];g.forEach(a.operationalLayers,function(a,b){a.featureCollection?g.forEach(a.featureCollection.layers,
function(c,d){var e=!0;a.visibleLayers&&-1==g.indexOf(a.visibleLayers,d)&&(e=!1);c.visibility=a.visibility&&e;c.opacity=a.opacity;c.id=(a.id||"operational"+b)+"_"+d;l.push(c)},this):l.push(a)});g.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;h.push(a)});g.forEach(l,function(a,b){a.id=a.id||"operational"+b;h.push(a)});g.forEach(h,function(a){a.url&&!a.type&&(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(Fa(a.url,a.errors)))});0===k.length?(d=d||ea(h),h=
da(h,c,d,e),f.callback(h)):(new b(k)).addCallback(function(a){K(a,h,c,k,f,d,e)});return f}function ga(a,b,c,d){var e=a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(g.forEach(a.layerInfos,function(a){a.id==
d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||0,a.maxScale||0))}),c.setScaleRange(e,f))}function ha(a,b,c,e){var f=a.url,h=a.__popupIds,l=a.__popupUrls,m=a.__popupWhereClauses,n=a.__popupMinScales,p=a.__popupMaxScales,q=a.__resourceInfo,r=[];g.forEach(a.__popups,function(e,k){if(e){var t,u=[];g.forEach(e.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var v=
g.filter(a.dynamicLayerInfos,function(a){return h[k]==a.id})[0].source;t=new H(f+"/dynamicLayer",{id:a.id+"_"+h[k],source:v,outFields:u,mode:H.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,autoGeneralize:!0});var w=function(c,e){0<m[c].length&&e.setDefinitionExpression(m[c]);if(!d.isDefined(n[c])&&!d.isDefined(p[c]))ga(a,b||q.layers,e,h[c]);else if(d.isDefined(a.minScale)||d.isDefined(a.maxScale)){var f=a.minScale,g=a.maxScale;0==f&&0<n[c]?f=n[c]:0<f&&0==n[c]||0<f&&0<n[c]&&
(f=Math.min(f,n[c]));g=Math.max(g||0,p[c]||0);e.setScaleRange(f,g)}else e.setScaleRange(n[c],p[c])};t.loaded?w(k,t):s.connect(t,"onLoad",function(a){w(k,t)})}else{var x=null,y=f+"/"+h[k];if(l[k].length)y=l[k];else if(b)for(v=0;v<b.length;v++)if(b[v].id===h[k]){x=b[v];break}t=new H(G(y),{id:a.id+"_"+h[k],outFields:u,mode:H.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,resourceInfo:x,autoGeneralize:!0});t.loaded?(0<m[k].length&&t.setDefinitionExpression(m[k]),ga(a,b||q.layers,
t,h[k])):s.connect(t,"onLoad",function(c){0<m[k].length&&t.setDefinitionExpression(m[k]);ga(a,b||q.layers,c,h[k])})}r.push(t)}});0<r.length&&(s.connect(a,"onVisibilityChange",k.hitch(this,function(a,b){g.forEach(a,function(a){b?a.show():a.hide()})},r)),s.connect(e,"onLayerRemove",k.hitch(this,function(a,b,c){a.id===c.id&&g.forEach(b,function(a){e.removeLayer(a)})},a,r)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;
delete a.__resourceInfo;return r}function Ka(a){return v({url:G(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function La(a,c,d){var e=[];g.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=e.length,e.push(Ka(a)))});var f=[];0<e.length?(new b(e)).addCallback(function(b){g.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(f=f.concat(ha(a,b[a.__deferredsPos][1].layers,d,c)),delete a.__deferredsPos):
f=f.concat(ha(a,null,d,c)))});c.addLayers(f)}):(g.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(f=f.concat(ha(a,null,d,c)))}),c.addLayers(f))}function Ma(a){g.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&(b.name&&-1<b.name.indexOf("Text"))&&g.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);
d.setAttributes(a.attributes)}},this))})}function Na(a){var b=6;g.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&g.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});
return b}function va(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];g.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("FeatureLayer")&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a)});g.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||
d){var f=Na(e),h=a.screenPoint,k=b.toMap(new q(h.x-f,h.y+f)),f=b.toMap(new q(h.x+f,h.y-f)),k=new t(k.x,k.y,f.x,f.y,b.spatialReference),l=new O;l.geometry=k;l.timeExtent=b.timeExtent;var m=!0,k=g.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(l,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));
return c});d&&(f=new n,f.callback([d]),k.splice(0,0,f));if(!g.some(k,function(a){return-1===a.fired})){var p=d?1:0;g.forEach(e,function(a){p=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?p+a.getVisibleRasters().length:p+a.getSelectedFeatures().length});if(!p)return}c.setFeatures(k);c.show(a.mapPoint,{closestFirst:m})}}}function kb(b,e){var f=e.mapOptions||{},g;f.infoWindow||(g=new A({visibleWhenEmpty:!1},c.create("div")),f.infoWindow=g);!d.isDefined(f.showInfoWindowOnClick)&&!e.usePopupManager&&
(f.showInfoWindowOnClick=!1);f=new a(b,f);s.connect(f,"onLayersAddResult",Ma);return f}function W(a,b,c,d,e,f){var h,k,l,m;d.map?(h=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(h=kb(d,e),!e.ignorePopups&&(!e.disableClickBehavior&&!e.usePopupManager)&&(k=s.connect(h,"onClick",va),l=va));h.addLayers(a);!e.ignorePopups&&!e.usePopupManager&&La(a,h,e._clazz);var n=m||[];g.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);h.loaded?f.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,
clickEventListener:l}):s.connect(h,"onLoad",function(){f.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l})})}function ia(a,b,c,d,e){var f=[];g.forEach(e,function(a){k.isArray(a.layerObject)?g.forEach(a.layerObject,function(a){f.push(a)}):f.push(a.layerObject)});if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var h=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(h),Pa(a,b,c,d,e,f);else if(e[0].errors){clearInterval(h);
var g="";e[0].errors&&e[0].errors.length&&(g=" ("+e[0].errors[0].message+")");d.errback(Error(Z.arcgis.utils.baseLayerError+g))}},10);else if(!f[0]&&e[0].baseMapLayer){var l="";e[0].errors&&e[0].errors.length&&(l=" ("+e[0].errors[0].message+")");d.errback(Error(Z.arcgis.utils.baseLayerError+l))}else Pa(a,b,c,d,e,f)}function Pa(a,b,c,e,f,k){try{var l=c.mapOptions||{};c.mapOptions=l;var m=a.item;k=g.filter(k,d.isDefined);if(m)if(m.extent&&m.extent.length)if(l.extent)W(k,f,a,b,c,e);else{var n=new t(m.extent[0][0],
m.extent[0][1],m.extent[1][0],m.extent[1][1],new h({wkid:4326})),p=k[0].spatialReference;4326===p.wkid?(l.extent=n,W(k,f,a,b,c,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,89.99),l.extent=x.geographicToWebMercator(n),W(k,f,a,b,c,e)):c.geometryServiceURL||y.defaults.geometryService?(c.geometryServiceURL?new L(c.geometryServiceURL):y.defaults.geometryService).project([n],p,function(d){d=
d[0];l.extent=l.extent||d;W(k,f,a,b,c,e)},function(){W(k,f,a,b,c,e)}):e.errback(Error(Z.arcgis.utils.geometryServiceError))}else W(k,f,a,b,c,e);else W(k,f,a,b,c,e)}catch(q){e.errback(q)}}function Oa(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);g.forEach(a,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&g.forEach(a.featureCollection.layers,function(d){!1!==d.showLegend&&(c={layer:d.layerObject,title:a.title,defaultSymbol:d.renderer&&
d.renderer.defaultSymbol&&d.renderer.defaultLabel?!0:!1},1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name),b.push(c))});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===e)||"esri.layers.ArcGISImageServiceLayer"===
e)d=!0;c={layer:a.layerObject,title:a.title,defaultSymbol:d};a.layers&&(e=g.map(g.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(c.hideLayers=e));b.push(c)}});return b}function lb(a,b){var c=new n,d=a.itemData,e=[];d.baseMap&&d.baseMap.baseMapLayers&&(e=e.concat(d.baseMap.baseMapLayers));d.operationalLayers&&(e=e.concat(d.operationalLayers));for(var d=g.map(e,function(a){return a&&a.layerType}),f=[],e=!1,h=0;h<d.length;h++){switch(d[h]){case "ArcGISFeatureLayer":-1===
g.indexOf(f,ja)&&f.push(ja);break;case "ArcGISImageServiceLayer":-1===g.indexOf(f,ka)&&(f.push(ka),f.push(wa),f.push(xa),f.push(ya));break;case "ArcGISMapServiceLayer":-1===g.indexOf(f,la)&&(f.push(la),f.push(za),f.push(Aa),f.push(Ba));break;case "ArcGISStreamLayer":-1===g.indexOf(f,ma)&&f.push(ma);break;case "ArcGISTiledImageServiceLayer":case "ArcGISTiledMapServiceLayer":break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===g.indexOf(f,na)&&f.push(na);break;case "CSV":-1===
g.indexOf(f,oa)&&(f.push(oa),f.push(Ca));break;case "GeoRSS":-1===g.indexOf(f,pa)&&f.push(pa);break;case "KML":-1===g.indexOf(f,qa)&&f.push(qa);break;case "OpenStreetMap":-1===g.indexOf(f,ra)&&f.push(ra);break;case "WebTiledLayer":-1===g.indexOf(f,sa)&&(f.push(sa),f.push(Da));break;case "WMS":-1===g.indexOf(f,ta)&&(f.push(ta),f.push(Ea));break;default:e=!0}if(e)break}e&&(f=mb);f.length?r(f,function(){var a=arguments;g.forEach(f,function(b,c){switch(b){case la:Sa=a[c];break;case ka:Za=a[c];break;case Ca:gb=
a[c];break;case oa:hb=a[c];break;case za:Ua=a[c];break;case pa:fb=a[c];break;case Aa:Ta=a[c];break;case wa:Wa=a[c];break;case qa:cb=a[c];break;case ja:ib=a[c];break;case Ba:Va=a[c];break;case xa:Ya=a[c];break;case ra:$a=a[c];break;case ya:Xa=a[c];break;case ma:jb=a[c];break;case Da:eb=a[c];break;case na:V=a[c];break;case sa:db=a[c];break;case ta:bb=a[c];break;case Ea:ab=a[c]}});c.resolve()}):c.resolve();return c}function Qa(a,b,c,d){lb(d,b).then(function(){D(d,b).then(function(b){var d=b[0],e=b[1];
if(!d.itemData.operationalLayers||0===d.itemData.operationalLayers.length)B(d,e).addCallback(function(b){fa(b.itemData,e).addCallback(k.hitch(null,ia,b,a,e,c))});else{var f=new n,h=d.itemData.baseMap.baseMapLayers.slice(),l=g.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:l}}};d.itemData.baseMap.baseMapLayers=g.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});B(b,e).addCallback(function(b){fa(b.itemData,
e).addCallback(k.hitch(null,ia,b,a,e,f))});f.then(function(a){B(d,e).addCallback(function(b){fa(b.itemData,e,a.map.spatialReference,l).addCallback(function(d){b.itemData.baseMap.baseMapLayers=h;ia(b,a,e,c,d)})})},k.hitch(c,c.errback))}})})}function Ra(a){M._arcgisUrl&&0<M._arcgisUrl.length&&(M.arcgisUrl=M._arcgisUrl);var b=M.arcgisUrl+"/"+a,c={},d=new n;v({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;v({url:b+"/data",content:{f:"json"},callbackParamName:"callback",
load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});return d}String.prototype.endsWith=function(a){return this.match(a+"$")==a};var M,Sa,Za,gb,hb,Ua,fb,Ta,Wa,cb,ib,Va,Ya,$a,Xa,jb,eb,V,db,bb,ab,la="../layers/ArcGISDynamicMapServiceLayer",ka="../layers/ArcGISImageServiceLayer",Ca="./csv",oa="../layers/CSVLayer",za="../layers/DynamicLayerInfo",pa="../layers/GeoRSSLayer",Aa="../layers/ImageParameters",wa="../layers/ImageServiceParameters",
qa="../layers/KMLLayer",ja="../layers/LabelClass",Ba="../layers/LayerDrawingOptions",xa="../layers/MosaicRule",ra="../layers/OpenStreetMapLayer",ya="../layers/RasterFunction",ma="../layers/StreamLayer",Da="../layers/TileInfo",na="../virtualearth/VETiledLayer",sa="../layers/WebTiledLayer",ta="../layers/WMSLayer",Ea="../layers/WMSLayerInfo",mb=[la,ka,Ca,oa,za,pa,Aa,wa,qa,ja,Ba,xa,ra,ya,ma,Da,na,sa,ta,Ea];M={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:Ra,createMap:function(a,
b,c){var d=new n;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(k.isObject(e)?e:k.getObject(e))||z;k.isString(a)?Ra(a).addCallback(k.hitch(null,Qa,b,c,d)).addErrback(k.hitch(d,d.errback)):Qa(b,c,d,a);return d},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Oa(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:B,_getItemData:P,_getBingKey:X,_portalUrlResponse:C,_portalUrlFailure:N,_processFSItemProperties:$,_processSSItemProperties:Q,_getLayers:fa,_preBuildLayerObjects:K,
_buildLayerObjects:da,_preCreateMap:ia,_getMapSR:ea,_createMap:W,_addSelectionLayers:La,_createSelectionFeatureLayers:ha,_getServiceInfo:Fa,_getFeatureCollectionItem:Ga,_mergeFeatureCollectionItem:Ha,_projectFeatureCollection:Ia,_getLayersInfo:Ka,_initLayer:ca,_loadAsCached:T,_loadAsDynamic:U,_processPopups:E,_onLayersAddResult:Ma,_sameSpatialReferenceAsBasemap:aa,_sameTilingSchemeAsBasemap:ba,_showPopup:va,_calculateClickTolerance:Na,_getVisibleFeatureLayers:R,_updateLayerScaleInfo:ga,_checkUrl:G,
_isHostedService:I,_isAgolService:Y,_getLegendLayers:Oa};k.setObject("arcgis.utils",M,l);return M});