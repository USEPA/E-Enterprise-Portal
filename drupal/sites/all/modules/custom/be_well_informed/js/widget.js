(function($,window,UNDEFINED){var convertNulls=false;function get_state_selection(){console.log("Populate Widget with state content");$state=$("#bwi-state").find("option:selected");if($state.val()){$.ajax({url:"be_well_informed/get_state_information",method:"POST",data:{state:$state.val()},before:function(){console.log("before: get_state_information")},success:function(response_xml){console.log("success get_state_information",response_xml);Drupal.settings.be_well_informed.state_xml=response_xml;build_state_form()}})}}function build_widget_state_info(){$state_xml=Drupal.settings.be_well_informed.state_xml;if(!$state_xml){console.error("State XML does not exist. Expect Drupal.settings.be_well_informed.state_xml to have a value")}$template=$(Drupal.settings.be_well_informed.templates.widget_state_content);$template.prepend($state_xml.find("State Widget Description").html());$template.prepend($state_xml.find("State Widget SourceLink").html());$widget_content_area=$("#bwi-widget-state-content");$widget_content_area.html($template)}function build_state_form(){$.ajax({url:"be_well_informed/generate_state_form",method:"POST",data:{state_xml:"test xml"},before:function(){console.log("before: generate_state_form")},success:function(state_form_html){console.log("success: generate_state_form");$("#be-well-informed-modal-state-form").remove();$state_form_modal=$('<div id="be-well-informed-modal-state-form"></div>').appendTo("#be-well-informed-widget-template-wrapper");$state_form_modal.html(state_form_html).dialog({modal:true,width:"auto",title:"Be Well Informed Water Analysis Tool",position:{my:"center",at:"center"},dialogClass:"be-well-informed-modal-state-form",autoOpen:true,draggable:false,resizable:false,create:function(event,ui){console.log("$state_form_modal");$("#bwi-tabs").tabs();var $form=$("#water_analysis_results_form");$form.on("field:validated",function(){var ok=$(".parsley-error").length===0;$(".bs-callout-info").toggleClass("hidden",!ok);$(".bs-callout-warning").toggleClass("hidden",ok)}).on("form:submit",function(){return false});$("#water_analysis_reset").click(function(){resetBWIForm();resizeModal()});$(":radio[value=absent]").click(function(){$(this).parent().parent().parent().find("input.column").val("")});$(".microbiology input.column").on("keyup, keydown, click",function(){$(this).on("blur",function(){if($(this).val()>0){$(this).siblings(".row").find(":radio[value=present]").prop("checked",true)}})});$("#water_analysis_submit").on("click",submit_water_sample);$(window).resize(function(){resizeModal()})},close:function(event,ui){}})}})}$("#be-well-informed-modal-state-selection").html(Drupal.settings.be_well_informed.templates.state_selection).dialog({modal:true,width:"auto",title:"Be Well Informed State Selection",position:{my:"center",at:"center"},dialogClass:"be-well-informed-modal-state-selection",autoOpen:false,draggable:false,resizable:false,create:function(event,ui){$("#bwi-state-confirm-button").click(function(){close_state_selection()});$(window).resize(function(){resizeModal()})},close:function(event,ui){}});$(".state-selection-link").click(function(){console.log("state-selection-link");$("#be-well-informed-modal-state-selection").dialog("open")});$("#bwi-check-water-btn").click(function(){get_state_selection()});function submit_water_sample(){console.log("water submit");var $form=$("#water_analysis_results_form");if(!$form.parsley().validate()){return false}var $loading_wrapper=$("#be-well-informed-loading-wrapper");var $results_wrapper=$("#be-well-informed-results-wrapper");var $form_wrapper=$("#be-well-informed-form-wrapper");var $all_wrappers=$(".be-well-informed-modal-wrapper");var formData=$form.serializeObject();var data=formatFormData(formData,convertNulls);bwi_log(JSON.stringify(data));showElementOutOfMany($loading_wrapper,$all_wrappers);$("#entry-tab").text("Entry");$.ajax({url:"be_well_informed/form_submission",method:"POST",data:data,success:function(be_well_response_json){if(!be_well_response_json.error){$("#routine-contaminants, .or").removeClass("hide");$("#interactive-prompts, #additional-contaminant-requests, .interactive-prompt, .additional-contaminant-requests").addClass("hide");$(".treatment-header, .treatment-content, .treatment-step, .box-main, .instruction-icon, .caret, .system-type-house, .system-type-water").addClass("hide");$("#water_analysis_reset").addClass("invisible");$(".bs-callout-info, .bs-callout-warning").toggleClass("hidden",true);convertNulls=true;if(!!be_well_response_json.data.InteractivePrompts.length||!!be_well_response_json.data.AdditionalContaminantRequests.length){$("#routine-contaminants").addClass("hide");$interactive_prompts=$("#interactive-prompts");if(!!be_well_response_json.data.InteractivePrompts.length){be_well_response_json.data.InteractivePrompts.map(function(item,index,prompts){var interaction_string=item.Interaction.replace(/"/g,"");var $item=$('[data-interaction="'+interaction_string+'"]');var exists=!!$item.length;if(!exists){var $prompt=$('<div class="section row interactive-prompt"></div>').attr("data-interaction",interaction_string).appendTo($interactive_prompts);var $title=$('<div class="column usa-width-one-half"><p class="interaction">'+interaction_string+"</p></div>").appendTo($prompt);var $inputs=$('<div class="column usa-width-one-half btn-group">'+'<button for="" class="usa-button-outline" type="button"><input type="radio" value="true">Yes</button>'+'<button for="" class="usa-button-outline" type="button"><input type="radio" value="false">No</button>'+"</div>").appendTo($prompt).on("click","button",function(e){$inputs.find("button").not(e.currentTarget).removeClass("usa-button-primary").addClass("usa-button-outline");$(e.currentTarget).addClass("usa-button-primary").removeClass("usa-button-outline");$(this).find("input:radio").prop("checked",true)});$inputs.find("input").attr("name","InteractivePromptResponses["+index+"][Interaction]");var $hidden_symbol=$('<input type="hidden">').attr("name","InteractivePromptResponses["+index+"][Symbol]").val(item.Symbol).prependTo($inputs);var $hidden_identifier=$('<input type="hidden">').attr("name","InteractivePromptResponses["+index+"][InteractionIdentifier]").val(item.InteractionIdentifier).prependTo($inputs)}else{$item.removeClass("hide")}});$interactive_prompts.removeClass("hide")}if(!!be_well_response_json.data.AdditionalContaminantRequests.length){be_well_response_json.data.AdditionalContaminantRequests.map(function(item,index,prompts){var interaction_string=item.Interaction.replace(/"/g,"");var $item=$('[data-interaction="'+interaction_string+'"]');var exists=!!$item.length;if(!exists){var $prompt=$('<div class="section row additional-contaminant-requests"></div>').attr("data-interaction",interaction_string).appendTo($interactive_prompts);var $title=$('<div class="column usa-width-one-half"><p class="interaction">'+interaction_string+"</p></div>").appendTo($prompt);var $column=$('<div class="column usa-width-one-half"></div>').appendTo($prompt);var contaminantType="RoutineContaminants";if(item.Symbol=="Ecoli"||item.Symbol=="Bac"){contaminantType="BacterialContaminants"}else if(item.Symbol=="Ur"){contaminantType="RadionuclideContaminants"}var $input=$('<input class="one-third offset-one-third" type="number" step="0.001">').on("change",function(){$('[name="'+contaminantType+"["+item.Symbol+'][Value]"]').val($(this).val())}).appendTo($column);var $select=$('<select class="one-third" ></select>').html($('[name="'+contaminantType+"["+item.Symbol+'][Unit]"]').html()).on("change",function(){$('[name="'+contaminantType+"["+item.Symbol+'][Unit]"]').val($(this).val())}).appendTo($column)}else{$item.removeClass("hide")}});$interactive_prompts.removeClass("hide")}showElementOutOfMany($form_wrapper,$all_wrappers);$("#entry-tab").text("Entry")}else if(!!be_well_response_json.data.ResultEvaluations){$("#interactive-prompts").html("");var default_datatable_result_details_options={dom:"t",bLengthChange:false,bAutoWidth:false,bSort:false,columnDefs:[{className:"small-screen-td-header",targets:[0]}],createdRow:function(row,data,dataIndex){$(row).find("td:eq(0)").attr("data-title","Result");$(row).find("td:eq(1)").attr("data-title","Element");$(row).find("td:eq(2)").attr("data-title","Your Entry");$(row).find("td:eq(3)").attr("data-title","Limit");$(row).find("td:eq(4)").attr("data-title","About Your Well Water")},data:be_well_response_json.data.result_summary,paging:false};var default_datatable_result_summary_options={dom:"t",bLengthChange:false,bAutoWidth:false,bSort:false,columnDefs:[{className:"small-screen-td-header",targets:[0]}],createdRow:function(row,data,dataIndex){$(row).find("td:eq(0)").attr("data-title","Result");$(row).find("td:eq(1)").attr("data-title","Element");$(row).find("td:eq(2)").attr("data-title","Your Entry");$(row).find("td:eq(3)").attr("data-title","Limit");$(row).find("td:eq(4)").attr("data-title","About Your Well Water")},data:be_well_response_json.data.result_summary,paging:false};$table=$('<table id="be-well-informed-results-table" class="eportal-responsive-table usa-table-borderless"> <thead> <tr> <th>Result</th> <th>Element</th> <th>Your Entry</th> <th>Limit</th> <th>About Your Well Water</th> </tr> </thead> <tbody></tbody> </table>');$table.appendTo(".be-well-informed-results").DataTable(default_datatable_result_summary_options);$table.find(".bwi-hide-row").closest("tr").remove();$table.find('td:contains("Total Coliform (Bac)")').text("Total Coliform");$table=$('<table id="be-well-informed-result-details-table" class="eportal-responsive-table usa-table-borderless"> <thead> <tr> <th>Result</th> <th>Element</th> <th>Your Entry</th> <th>Limit</th> <th>About Your Well Water</th> </tr> </thead> <tbody></tbody> </table>');$table.appendTo(".be-well-informed-result-details").DataTable(default_datatable_result_details_options);$table.find('td:contains("Total Coliform (Bac)")').text("Total Coliform");var result;var row_index=1;var titles=["Interpretation of Results:","Health Concerns:","Treatment Options:"];$.each(be_well_response_json.data.result_details,function(index,detail_obj){result=detail_obj.result;if(detail_obj.data_array.length>0){for(var i=0;i<detail_obj.data_array.length;i++){if(detail_obj.data_array[i]!==""){$("#be-well-informed-result-details-table").find("tr:eq("+(row_index+index)+")").after('<tr><td class="bwi-detail-td '+result+'" colspan="5"><h4>'+titles[i]+"</h4>"+detail_obj.data_array[i]+"</td></tr>");row_index++}}}});var steps_count=Object.keys(be_well_response_json.data.TreatmentSteps).length;if(be_well_response_json.data.TreatmentSteps&&steps_count>0){$(".treatment-header, .treatment-content").removeClass("hide");$("#treatment_order_title").show();var contaminants=[];var excluded=["NO2","Bac","Ecoli"];for(var contaminate in be_well_response_json.data.ResultEvaluations){if(excluded.indexOf(contaminate)==-1&&(be_well_response_json.data.ResultEvaluations[contaminate].GuidelineColor=="font-red"||be_well_response_json.data.ResultEvaluations[contaminate].TreatmentMessages)){contaminants.push(be_well_response_json.data.ResultEvaluations[contaminate].ContaminantFullName)}}if(be_well_response_json.data.TreatmentSteps.hasOwnProperty(5)){var tier_5a=be_well_response_json.data.TreatmentSteps[5].OrInstructions.reduce(function(p,c,i,a){return c.Recommendation=="Point-of-Use (POU) Arsenic Adsorption Media Filter System"?i:p},-1);var tier_5b=be_well_response_json.data.TreatmentSteps[5].OrInstructions.reduce(function(p,c,i,a){return c.Recommendation=="Point-of-Use (POU) Reverse Osmosis (RO) System"?i:p},-1);if(tier_5a!=-1&&tier_5b!=-1){be_well_response_json.data.TreatmentSteps[5].OrInstructions.splice(tier_5a,1);if(!be_well_response_json.data.TreatmentSteps[5].OrInstructions.length){delete be_well_response_json.data.TreatmentSteps[5];steps_count=Object.keys(be_well_response_json.data.TreatmentSteps).length}}}if(!(be_well_response_json.data.TreatmentSteps.hasOwnProperty(3)||be_well_response_json.data.TreatmentSteps.hasOwnProperty(4))&&be_well_response_json.data.TreatmentSteps.hasOwnProperty(2)&&be_well_response_json.data.TreatmentSteps[2].OrInstructions.length==1&&be_well_response_json.data.TreatmentSteps[2].OrInstructions[0].Recommendation=="Whole House Anion Exchange Water Treatment System followed by an Acid Neutralizer"&&be_well_response_json.data.TreatmentSteps.hasOwnProperty(5)){var index=be_well_response_json.data.TreatmentSteps[5].OrInstructions.reduce(function(p,c,i,a){return c.Recommendation=="Point-of-Use (POU) Arsenic Adsorption Media Filter System"?i:p},-1);if(index!=-1){be_well_response_json.data.TreatmentSteps[2].OrInstructions.push(be_well_response_json.data.TreatmentSteps[5].OrInstructions[index]);be_well_response_json.data.TreatmentSteps[5].OrInstructions.splice(index,1);if(!be_well_response_json.data.TreatmentSteps[5].OrInstructions.length){delete be_well_response_json.data.TreatmentSteps[5];steps_count=Object.keys(be_well_response_json.data.TreatmentSteps).length}}}if(contaminants.length>1){var last=contaminants.pop();var title=contaminants.join(", ");title+=" and "+last}else{title=contaminants.pop()}$(".treatment-text").html(title);var step_label=1;var toShow=[];for(var tier in be_well_response_json.data.TreatmentSteps){var $treatment=$(".treatment-step").eq(tier-1);var $steps_span=$treatment.find(".step span");$steps_span.show();$treatment.removeClass("hide").find(".step span").html("Step "+step_label);if($steps_span.hasClass("no-step")){$steps_span.removeClass("no-step");$steps_span.addClass("fill-step")}if(steps_count<=1){$steps_span.removeClass("fill-step");$steps_span.addClass("no-step");$steps_span.html("")}be_well_response_json.data.TreatmentSteps[tier].OrInstructions.map(function(item,index,list){$treatment.find('[title="'+item.Recommendation+'"]').removeClass("hide");var cssClass=".system-type-"+item.SystemType.toLowerCase();if(toShow.indexOf(cssClass)==-1){toShow.push(cssClass)}});step_label++}if(steps_count<=1){$("#treatment_order_title").hide()}$(toShow.join(", ")).removeClass("hide");jQuery(".or + .box-main.hide").each(function(){var $this=jQuery(this);$this.prev().addClass("hide")});$(".treatment-step:visible").eq(0).find(".caret").addClass("hide")}$(".contaminant-link").click(function(){var $this=$(this);$("[id="+$this.attr("data-contaminant")+"]",$(this).parents("td")).slideToggle()});showElementOutOfMany($results_wrapper,$all_wrappers);$("#entry-tab").text("Results")}resizeModal()}else{showElementOutOfMany($results_wrapper,$all_wrappers);$("#entry-tab").text("Results")}resizeModal()}})}})(jQuery,window);
//# sourceMappingURL=src/widget.js.map