{"version":3,"sources":["manage_my_topics_component.js"],"names":["updatingUserTopics","still_updating","$anchor","$","text","update_anchor_text","addClass","html","handleError","error_message","console","log","saveTopic","$checkbox","tid","val","ajax","url","data","method","beforeSend","success","response","parseJSON","error","msg","removeClass","anchor_text","failure","removeTopic","from_unfollow","showLGCResourcesView","document","ready","on","this","prop","jQuery"],"mappings":"AAWA,QAASA,sBACPC,gBACA,IAAIC,GAAUC,EAAE,wBACZD,GAAQE,QAAUC,oBACpBH,EAAQI,SAAS,YAAYC,KAAKF,mBAAqB,8DAQ3D,QAASG,aAAYC,GACnBC,QAAQC,IAAIF,GAOd,QAASG,WAAUC,GACjB,GAAIC,GAAMD,EAAUE,MAChBb,EAAUC,EAAE,wBAEhBA,GAAEa,MACAC,IAAK,8BACLC,MAAOJ,IAAKA,GACZK,OAAQ,OACRC,WAAY,WACVpB,sBAEFqB,QAAS,SAAUC,GACjBrB,iBACAqB,EAAWnB,EAAEoB,UAAUD,EACvB,IAAIE,GAAQF,EAASE,KAChBA,IAA2B,GAAlBvB,eAIZO,YAAYc,EAASG,KAHrBvB,EAAQwB,YAAY,YAAYtB,KAAKuB,cAMzCC,QAAS,SAAUN,GACjBd,YAAYc,MAUlB,QAASO,aAAYhB,EAAWiB,GAC9B,GAAIhB,GACAZ,EAAUC,EAAE,wBAGdW,GADEgB,EACIjB,EAEAA,EAAUE,MAGlBZ,EAAEa,MACAC,IAAK,gCACLC,MAAOJ,IAAKA,GACZK,OAAQ,OACRC,WAAY,WACVpB,sBAEFqB,QAAS,SAAUC,GACjBrB,iBACAqB,EAAWnB,EAAEoB,UAAUD,EACvB,IAAIE,GAAQF,EAASE,KAChBA,IAA2B,GAAlBvB,eAQZO,YAAYc,EAASG,MAPjBK,GACFC,uBAGF7B,EAAQwB,YAAY,YAAYtB,KAAKuB,eAMzCC,QAAS,SAAUN,GACjBd,YAAYc,MA3FlB,GAAIK,aAAc,OACdtB,mBAAqB,iBAErBJ,eAAiB,GA6FrB,SAAWE,GAGTA,EAAE6B,UAAUC,MAAM,WAChB9B,EAAE,QAAQ+B,GAAG,QACX,2FACA,WACE,GAAIrB,GAAYV,EAAEgC,KACdtB,GAAUuB,KAAK,WACjBxB,UAAUC,GAEVgB,YAAYhB,QAKnBwB","file":"manage_my_topics_component.js","sourcesContent":["/**\r\n * Created by bmatkin on 4/13/2016.\r\n */\r\n\r\n\r\n// Text of Back anchor, for simplicity if we change the text down the line.\r\nvar anchor_text = \"Back\";\r\nvar update_anchor_text = \"Saving changes\";\r\n// Count to track topics that are still saving changes\r\nvar still_updating = 0;\r\n\r\nfunction updatingUserTopics() {\r\n  still_updating++;\r\n  var $anchor = $('.back-to-lgc-widget a');\r\n  if ($anchor.text() != update_anchor_text) {\r\n    $anchor.addClass('disabled').html(update_anchor_text + '  <i class=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i>');\r\n  }\r\n}\r\n\r\n/**\r\n * Handles error  in saving or deleting topic\r\n * @param {string} error_message\r\n */\r\nfunction handleError(error_message) {\r\n  console.log(error_message);\r\n}\r\n\r\n/**\r\n * Send tid from checkbox elem to db for saving new topic\r\n * @param $checkbox\r\n */\r\nfunction saveTopic($checkbox) {\r\n  var tid = $checkbox.val();\r\n  var $anchor = $('.back-to-lgc-widget a');\r\n\r\n  $.ajax({\r\n    url: 'manage_my_topics/save_topic',\r\n    data: {tid: tid},\r\n    method: 'POST',\r\n    beforeSend: function () {\r\n      updatingUserTopics();\r\n    },\r\n    success: function (response) {\r\n      still_updating--;\r\n      response = $.parseJSON(response);\r\n      var error = response.error;\r\n      if (!error && still_updating == 0) {\r\n        $anchor.removeClass('disabled').text(anchor_text);\r\n      }\r\n      else {\r\n        handleError(response.msg);\r\n      }\r\n    },\r\n    failure: function (response) {\r\n      handleError(response);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Send tid from checkbox elem to db for removing prev saved topic\r\n * from_unfollow means the $checbkbox value is a tid, not a dom element\r\n * @param $checkbox\r\n */\r\nfunction removeTopic($checkbox, from_unfollow) {\r\n  var tid;\r\n  var $anchor = $('.back-to-lgc-widget a');\r\n\r\n  if (from_unfollow) {\r\n    tid = $checkbox;\r\n  } else {\r\n    tid = $checkbox.val();\r\n  }\r\n\r\n  $.ajax({\r\n    url: 'manage_my_topics/remove_topic',\r\n    data: {tid: tid},\r\n    method: 'POST',\r\n    beforeSend: function () {\r\n      updatingUserTopics();\r\n    },\r\n    success: function (response) {\r\n      still_updating--;\r\n      response = $.parseJSON(response);\r\n      var error = response.error;\r\n      if (!error && still_updating == 0) {\r\n        if (from_unfollow) {\r\n          showLGCResourcesView();\r\n          //favorite_local_resources_table.updateTopics([]);\r\n        }\r\n        $anchor.removeClass('disabled').text(anchor_text);\r\n      }\r\n      else {\r\n        handleError(response.msg);\r\n      }\r\n    },\r\n    failure: function (response) {\r\n      handleError(response);\r\n    }\r\n  });\r\n}\r\n\r\n(function ($) {\r\n\r\n\r\n  $(document).ready(function () {\r\n    $('body').on('click',\r\n      '#manage-my-topics .term-name-checkboxes, #manage-my-topics-wrapper .term-name-checkboxes',\r\n      function () {\r\n        var $checkbox = $(this);\r\n        if ($checkbox.prop('checked')) // Check if user checked the topic\r\n          saveTopic($checkbox);\r\n        else\r\n          removeTopic($checkbox);\r\n      });\r\n  });\r\n\r\n\r\n})(jQuery);"]}