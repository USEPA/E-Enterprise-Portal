{"version":3,"sources":["chemical_rules.js"],"names":["repair_chemical_rules_profile","cr_showElementOutOfMany","$wrapper_to_show","$common_selector","hide","show","cr_resizeModal","jQuery","dialog","position","my","at","width","$","window","height","css","replace","length","create_favlaw_heart","epaintnum","law_in_favorites","find_matching_favorites","fav_law_holder","check_id","check_type","match_found","favs","Drupal","settings","chemical_rules","profile","i","favID","ID","is_valid_cas_number","stringToCheck","cas","casgroup","exec","checkDigit","split","reduce","previousValue","currentValue","currentIndex","array","lookup_chemical","lookup_value","$body","find","val","trigger","populate_substance_modal","chemical_rules_response_json","json","data","error","prop","remove","Substance","CASRegistryNumber","EPAChemicalRegistryName","text","$list","$synonyms","$image","$propertiestable","$substance_lists","html_to_add","substance_lists","favorite_exists","EPAChemicalInternalNumber","attr","ChemicalSubstanceSystematicName","parent","html","cfr_id","SubstanceList","Object","keys","push","index","LawsRegs","fav_holder","attributes","URL","Title","append","join","synonym_list","Synonym","each","this","sort","Image","tr_start","tr_end","properties","MolecularWeight","Solubility","VaporPressure","LogP","Stability","pKA","addClass","before","render_favorite_chemicals","num_chem_faves","Chemicals","favorite_chemicals","CAS","link_casnum","include_commonname","CommonName","SysName","render_favorite_laws","num_rules_faves","Laws","favorite_laws","Citation","reset_cr_form","$form","trigger_law_qTip","findLink","hideQtip","findQtip","err","update_clicked_heart","this_link","filled_if_true","removeClass","update_favorite_lists","type","isValidCasNumber","console","log","originalDialog","tabs","on","render_favorites","$cr_empty","$cr_avail","modal","title","closeOnEscape","dialogClass","draggable","autoOpen","resizable","create","event","ui","resize","open","close","ev","chem_search_form_data","serialize","chem_search_input","preventDefault","stopPropagation","ajax","url","method","beforeSend","complete","success","chemicalNameOrNum","removeAttr","is_valid_chemical","error_message","insertBefore","cas_clicked","chem_name","clicked_favorite_ID","clicked_favorite_type","updatedFavs","item","hasClass","update_chem_profile","favorite","cas_num","law_text","prev","law_pieces","citation","trim","undefined","basePath","dataType","JSON","stringify","done","arguments","fail","$chemical_loading","$all_wrappers","sticky_gap","offset","top","scroll","scrollTop","toc_bottom","target_top","hash","scroll_amount","animate"],"mappings":"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","file":"chemical_rules.js","sourcesContent":["var originalDialog;\nvar favs = (Drupal.settings.chemical_rules.profile) ? Drupal.settings.chemical_rules.profile : {'Chemicals':[],'Laws':[]};\n\nfunction repair_chemical_rules_profile() {\n\n}\nfunction cr_showElementOutOfMany($wrapper_to_show, $common_selector) {\n  $common_selector.hide();\n  $wrapper_to_show.show();\n  cr_resizeModal()\n}\n\nfunction cr_resizeModal() {\n  jQuery('#chemical-rules-modal').dialog({\n    position: { 'my': 'center', 'at': 'center' },\n    width: $(window).width()-180,\n    height: $(window).height()-180,\n  });\n  if(jQuery('.chemical-rules-modal').css('top').replace('px', '') < 1){\n    jQuery('.chemical-rules-modal').css('top', 0);\n  }\n  if (jQuery('.sticky-toc').length > 0) {\n    jQuery('#cr-modal-toc-icons').css('width', jQuery('#chemical-rules-modal').width()+6);\n  }\n}\n\nfunction create_favlaw_heart(epaintnum) {\n\n  var law_in_favorites = find_matching_favorites(epaintnum, \"Laws\");\n  var fav_law_holder = '';\n\n  if (law_in_favorites === false) {\n    fav_law_holder = '<a href=\"javascript:void(0);\" class=\"fa fa-heart empty save-favorite\" data-epaintnum=\"' + epaintnum + '\" data-favtype=\"Law\"><span class=\"sr-only\">Click to favorite.</span></a>';\n  }\n  else {\n    fav_law_holder = '<a href=\"javascript:void(0);\" class=\"fa fa-heart filled remove-link remove-favorite\" data-epaintnum=\"' + epaintnum + '\" data-favtype=\"Law\"><span class=\"sr-only\">Favorited. Click to unfavorite.</span></a>';\n  }\n\n  return fav_law_holder;\n\n}\n\nfunction find_matching_favorites(check_id, check_type) {\n  var match_found = false,\n    favs = Drupal.settings.chemical_rules.profile;\n  var length = (favs[check_type]) ? favs[check_type].length : 0;\n\n  for (var i = 0; i < length; i++) {\n  \tfavID = favs[check_type][i].ID;\n    if (favID == check_id) {\n      match_found = true;\n  \t  return i;\n  \t}\n  }\n  if (match_found == false) {\n  \treturn false;\n  }\n}\n\nfunction is_valid_cas_number(stringToCheck) {\n  var cas = /(\\d{2,7}).{0,2}(\\d{2}).{0,2}(\\d)/g;\n  var casgroup = cas.exec(stringToCheck);\n  if(casgroup){\n    var checkDigit = (casgroup[1] + casgroup[2]).split('').reduce(function(previousValue, currentValue, currentIndex, array) {\n      return ((previousValue + (array[array.length - currentIndex -1] * (currentIndex + 1))) % 10)\n    }, 0)\n    return(checkDigit == casgroup[3])\n  }\n  return false\n}\n\nfunction lookup_chemical(lookup_value) {\n\n  var $body = $('body');\n  $body.find('#cr-search_input').val(lookup_value);\n  $body.find('#cr-search-chems-btn').trigger('click');\n\n}\n\nfunction populate_substance_modal(chemical_rules_response_json) {\n  var $body = $('body');\n  var json = chemical_rules_response_json;\n\n  if(json.data !== null && json.error === false){\n    if ($body.find('#search-message').length > 0) {\n      $body.find('#cr-search_input').prop('aria-describedby', false);\n      $body.find('#search-message').remove();\n    }\n    \n    if (json.data.Substance.CASRegistryNumber !== '' && json.data.Substance.CASRegistryNumber !== null) {\n      var cas_reg_num = json.data.Substance.CASRegistryNumber + ': ';\n    }\n    else {\n      var cas_reg_num = '';\n    }\n    if (json.data.Substance.EPAChemicalRegistryName !== null && json.data.Substance.EPAChemicalRegistryName !== '') {\n      var chem_reg_name = \" (\" + json.data.Substance.EPAChemicalRegistryName + \")\";\n    }\n    else {\n      var chem_reg_name = '';\n    }\n\n    // populate our modal\n    $body.find('.cr-chemical-name').text(json.data.Substance.EPAChemicalRegistryName);\n\n    var $list = $body.find('#cr-laws-regs-substances');\n    var $programs = $body.find('#cr-programs-list');\n    var $synonyms = $body.find('#cr-synonyms-list');\n    var $image = $body.find('.cr-structure_image');\n    var $propertiestable = $body.find('#cr-properties-table > tbody');\n    var $substance_lists = $body.find('#cr-substances-list');\n    var lists = [];\n    var cfrs = [];\n    var html_to_add = [];\n    var substance_lists = [];\n    var favorite_exists = find_matching_favorites(json.data.Substance.EPAChemicalInternalNumber, \"Chemicals\");\n    var count_all_cfrs = 0;\n    \n    //@TODO - Only show Save to My Chemicals link (#cr-save-favorite) if NOT in favs\n\n    $body.find('#cr-save-favorite').attr('data-epaintnum', json.data.Substance.EPAChemicalInternalNumber).attr('data-sysname', json.data.Substance.ChemicalSubstanceSystematicName);\n    $body.find('#metadata-sys-name').text(json.data.Substance.ChemicalSubstanceSystematicName);\n    if (json.data.Substance.EPAChemicalRegistryName !== null) {\n          $body.find('#cr-save-favorite').attr('data-commonname', json.data.Substance.EPAChemicalRegistryName);\n          $body.find('#metadata-common-name').text(json.data.Substance.EPAChemicalRegistryName);\n    }\n    if (json.data.Substance.CASRegistryNumber !== null) {\n          $body.find('#cr-save-favorite').attr('data-casnum', json.data.Substance.CASRegistryNumber);\n          $body.find('#metadata-cas-num').text(json.data.Substance.CASRegistryNumber);\n    }\n    $body.find('#cr-remove-favorite').attr('data-epaintnum', json.data.Substance.EPAChemicalInternalNumber).attr('data-favtype', 'Chemical');\n\n    if (favorite_exists === false) {\n      $body.find('#cr-save-favorite').parent('li').show();\n      $body.find('#cr-remove-favorite').parent('li').hide();\n    }\n    else {\n      $body.find('#cr-save-favorite').parent('li').hide();\n      $body.find('#cr-remove-favorite').parent('li').show();\n    }\n\n    $list.html('');\n    // Check whether Substance Lists exist.\n    // If so, for each,\n    //    1) get SubstanceList name data.SubstanceList[].substanceListName\n    //    2) then get list of CFRs\n    //    3) loop thru CFRs and look up CFR name and URL (LawsRegs.[variableforcfrnumber].cfrId, attributes.USC Citation, attributes.Title, attributes.URL\n\n    var cfr_id = '';\n    if(!!json.data.SubstanceList && Object.keys(json.data.SubstanceList).length) {\n      html_to_add.push('<ul class=\"cr-lists\">');\n      for(var index in json.data.LawsRegs) {\n        cfr_id = json.data.LawsRegs[index][cfr_id];\n        fav_holder = create_favlaw_heart(cfr_id);\n        html_to_add.push('<li><span class=\"law-entry\"><a data-favtype=\"Law\" data-epaintnum=\"' + cfr_id + '\" href=\"'+ json.data.LawsRegs[index].attributes.URL +'\" target=\"_blank\">' + json.data.LawsRegs[index].attributes[\"Citation\"] + \" &mdash; \" + json.data.LawsRegs[index].attributes.Title+'</a>' + fav_holder + '</span>');\n        html_to_add.push('<span class=\"law-citation\">Authority: ' + json.data.LawsRegs[index].attributes[\"CFR Authority\"] + '</span>');\n        html_to_add.push('<span class=\"law-lists\">Substance Lists: ' + json.data.LawsRegs[index]['substanceList'] + '</span></li>');\n      }\n      html_to_add.push('</ul>');\n      $list.append(html_to_add.join(\"\"));\n      $body.find('#count-all-cfrs').text(Object.keys(json.data.LawsRegs).length);\n    }\n    else {\n      // No laws regulations found\n\n    }\n    \n/*  //@TODO Future - If Programs do Exist\n    $programs.html('');\n    if (json.data.Programs.length > 0) {\n      $(json.data.Programs).each(function(index){\n        //$('#cr-programs-count').text(json.data.Programs.length);\n        $programs.append('<li><a href=\"'+this.source+'\" target=\"_blank\">'+this.name+'</a></li>');\n      });\n    }\n    else {\n      // No programs found   \n    }\n*/\n    var synonym_list = [];\n    $synonyms.html('');\n    if (json.data.Substance.Synonym.length > 0) {\n      $(json.data.Substance.Synonym).each(function(index) {\n        //$('#cr-synonyms-count').text(json.data.Substance.Synonym.length);\n        synonym_list.push('<li>'+this+'</li>');\n      });\n      $synonyms.append(synonym_list.sort());\n    }\n    else {\n      // No synonyms found\n    }\n    \n    $image.html('');\n    if (json.data.Image != null && json.data.Image != '') {\n      $image.append('<img src=\"' + json.data.Image + '\" alt=\"A structure of ' + json.data.Substance.EPAChemicalRegistryName + '\"><p>Powered by <a href=\"https://pubchem.ncbi.nlm.nih.gov\" rel=\"external\" target=\"_blank\">PubChem</a></p>');\n    }\n    else {\n      // No images found\n      $image.append('No image available for this substance.');\n    }\n    \n    var tr_start = '<tr><th scope=\"row\">',\n        tr_end = '</td></tr>';\n\n    $propertiestable.html('');\n    var properties = tr_start + \"Molecular Weight <span class='cr-definition'></span></th><td>\" + json.data.Substance.MolecularWeight + tr_end;\n        properties += tr_start + \"Solubility <span class='cr-definition'>The solubility of a substance is the amount of that substance that will dissolve in a given amount of solvent. The default solvent is water, if not indicated.</span></th><td>\" + json.data.Substance.Solubility + tr_end;\n        properties += tr_start + \"Vapor Pressure <span class='cr-definition'>Vapor pressure is the pressure of a vapor in thermodynamic equilibrium with its condensed phases in a closed system.</span></th><td>\" + json.data.Substance.VaporPressure + tr_end;\n        properties += tr_start + \"LogP <span class='cr-definition'>Octanol/Water Partition Coefficient, used as a measure of molecular lipophilicity</span></th><td>\" + json.data.Substance.LogP + tr_end;\n        properties += tr_start + \"Stability <span class='cr-definition'>Tendency of a material to resist change or decomposition due to internal reaction, or due to the action of air, heat, light, pressure, etc. (See also Stability and Reactivity section under Safety and Hazards)</span></th><td>\" + json.data.Substance.Stability + tr_end;\n        properties += tr_start + \"pKA <span class='cr-definition'></span></th><td>\" + json.data.Substance.pKA + tr_end;\n             \n    $propertiestable.append(properties);\n    \n    $substance_lists.html('');\n    if (Object.keys(json.data.SubstanceList).length > 0) {\n      $substance_lists.append(substance_lists.sort());\n    }\n    else {\n      $substance_lists.html('<p>No substance lists found for this chemical.</p>');\n    }\n    \n    $body.addClass('fixed-modal-open');\n  }\n  else {\n    //@TODO Add error msg for when there is bad data\n    $body.find('#cr-search_description').before('<div id=\"search-message\" class=\"has-error\">No chemicals found.  Please try a different name or CAS #.</div>');\n    $body.find('#cr-search_input').prop('aria-describedby', 'search-message');\n  }\n\n}\n\nfunction render_favorite_chemicals(favs) {\n\n  var $body = $('body');\n  var num_chem_faves = (favs.Chemicals) ? favs.Chemicals.length: 0;\n\n  if (num_chem_faves) {\n    var favorite_chemicals = [];\n    $body.find('#cr-count-chemicals').text(num_chem_faves);\n    $.each(favs.Chemicals, function(index, val) {\n      var cas = '';\n      if (val.CAS != null && val.CAS != \"\") {\n        cas = val.CAS;\n        var link_casnum = \" data-casnum='\" + cas + \"' \";\n        cas = cas + \": \";\n      }\n      else {\n        link_casnum = '';\n      }\n      var include_commonname = '';\n      if (val.CommonName != null && val.CommonName != '') {\n        include_commonname = ' ('+ val.CommonName + ')';\n      }\n      favorite_chemicals.push('<li><a class=\"favorite-chemical cr-favorite\" href=\"javascript:void(0);\" data-favtype=\"Chemical\" data-epaintnum=\"' + val.ID + '\" ' + link_casnum + 'data-commonname=\"' + val.CommonName + '\">' + cas + val.SysName + include_commonname +'</a><a class=\"favorite-chemical-remove remove-link\" data-favtype=\"Chemical\" data-epaintnum=\"' + val.ID + '\" data-commonname=\"' + val.CommonName + '\">Remove<span class=\"sr-only\"> ' + val.SysName + ' from favorites</span></a></li>');\n    });\n    $body.find('.cr-chemicals').show();\n    $body.find('.cr-favorite-chemicals').html(favorite_chemicals).show();\n  }\n\n  else {\n    $body.find('.cr-chemicals').hide();\n    $body.find('.cr-favorite-chemicals').html('').hide();\n  }\n}\n\nfunction render_favorite_laws(favs) {\n\n  var $body = $('body');\n  var num_rules_faves = (favs.Laws) ? favs.Laws.length : 0;\n\n  if (num_rules_faves) {\n    var favorite_laws = [];\n    $body.find('#cr-count-laws').text(num_rules_faves);\n    $.each(favs.Laws, function(index, val) {\n      favorite_laws.push('<li><a class=\"favorite-law cr-favorite\" href=\"' + val.URL + '\" data-favtype=\"Law\" data-epaintnum=\"' + val.ID + '\" target=\"_blank\">' + val.Citation + ':  ' + val.Title + '</a><a class=\"favorite-law-remove remove-link\" data-favtype=\"Law\" data-epaintnum=\"' + val.ID + '\">Remove<span class=\"sr-only\"> ' + val.Title + ' from favorites</span></a></li>');\n    });\n    $body.find('.cr-laws').show();\n    $body.find('.cr-favorite-laws').html(favorite_laws).show();\n  }\n  else {\n    $body.find('.cr-laws').hide();\n    $body.find('.cr-favorite-laws').html('').hide();\n  }\n}\n\n/**\n * Clear form inputs and hide warning messages\n */\nfunction reset_cr_form() {\n  var $form = $('#cr-search_input');\n  $form.val('');\n}\n\n/**\n * Manually trigger qTip that holds favorite heart icon to improve accessibility\n */\nfunction trigger_law_qTip(findLink, hideQtip) {\n    try {\n        if (hideQtip == true) {\n            $(findLink).trigger('mouseover');\n            findQtip = '#' + $(findLink).attr('aria-describedby');\n            return findQtip;\n        }\n        else {\n            $(findLink).trigger('mouseout');\n        }\n    }\n    catch (err) {\n        //console.log(\"Error on triggerQtip: \" + err);\n    }\n}\n\nfunction update_clicked_heart(this_link, filled_if_true) {\n\n  if (filled_if_true === true) {\n    this_link.removeClass('empty save-favorite');\n    this_link.addClass('filled remove-favorite remove-link'); \n  }\n  else if (filled_if_true === false) {\n    this_link.addClass('empty save-favorite');\n    this_link.removeClass('filled remove-favorite remove-link');     \n  }\n  \n}\n\nfunction update_favorite_lists(type) {\n  if (type == 'Chemical') {\n    render_favorite_chemicals(Drupal.settings.chemical_rules.profile);\n  }\n  else if (type == 'Law') {\n    render_favorite_laws(Drupal.settings.chemical_rules.profile);\n  }\n  else {\n\n  }\n\n}\n\nfunction isValidCasNumber(stringToCheck) {\n  var cas = /(\\d{2,7}).{0,2}(\\d{2}).{0,2}(\\d)/g;\n  var casgroup = cas.exec(stringToCheck);\n  if(casgroup){\n    var checkDigit = (casgroup[1] + casgroup[2]).split('').reduce(function(previousValue, currentValue, currentIndex, array) {\n      return ((previousValue + (array[array.length - currentIndex -1] * (currentIndex + 1))) % 10)\n    }, 0)\n    return(checkDigit == casgroup[3])\n  }\n  console.log('invalid string')\n  return false\n}\n\n(function($) {\n  var $body = $('body'),\n      $cr_tabs = $('#cr-tabs').tabs(),\n      sampleSetIndex = 0,\n      num_chem_faves = 0,\n      num_rules_faves = 0;\n\n  $('#chem_search_form').on('submit', function() {\n    $('#cr-search-chems-btn').trigger('click');\n    return false;\n  })\n  \n\n  // CHEMICAL ATTRIBUTES\n  // ID = EPAChemicalInternalNumber\n  // CAS = CASRegistryNumber\n  // SysName = ChemicalSubstanceSystematicName (e.g., 2-Propanone)\n  // CommonName = EPAChemicalRegistryName (e.g., Acetone)\n\n  // LAW ATTRIBUTES\n  // ID = LRS ID = cfrID (e.g., 3874781)\n  // Citation (e.g., 40 CFR 711)\n  // Title (e.g., TSCA CHEMICAL DATA REPORTING REQUIREMENTS)\n  // URL (e.g., https:\\/\\/gpo.gov...)\n\n//   var favs = Drupal.settings.chemical_rules.profile;\n\n  // 1) Get favorites\n  // 2) Count number of favorite Chemicals and Laws\n\n  var render_favorites = function(favs) {\n    num_chem_faves = (favs.Chemicals) ? favs.Chemicals.length : 0;\n    num_rules_faves = (favs.Laws) ? favs.Laws.length : 0;\n    $cr_empty = $('.cr-tabs_favorites_empty');\n    $cr_avail = $('.cr-tabs_favorites_available')\n\n    if (num_chem_faves === 0 && num_rules_faves === 0) {\n      $cr_empty.show();\n      $cr_avail.hide();\n    }\n    else {\n      $cr_empty.hide();\n      $cr_avail.show();\n\n      render_favorite_chemicals(favs);\n      render_favorite_laws(favs);\n    }\n  }\n  // If no favorites exist, show Search tab\n\n  render_favorites(favs);\n\n  // Initialize and open dialog\n  $('#chemical-rules-modal')\n    .html(Drupal.settings.chemical_rules.modal)\n    .dialog({\n      title: 'Results',\n      modal: true,\n      width: $(window).width()-180,\n      height: $(window).width()-180,\n      closeOnEscape: true,\n      position: { 'my': 'left top', 'at': 'left top' },\n      dialogClass: 'chemical-rules-modal',\n      draggable: false,\n      autoOpen: false,\n      resizable: false,      \n      create: function(event, ui) {\n        $(window).resize(function(){cr_resizeModal();})\n      },\n      open: function(event, ui) {\n        $('#chemical-rules-modal').parent().css('position', 'fixed');\n      },\n      close: function(event, ui) {\n        reset_cr_form();\n        $('#chemical-rules-modal').html(originalDialog);\n        $body.removeClass('fixed-modal-open');\n      }\n    });\n\n  // Handle Search chemicals button click\n  $body.on('click', '#cr-search-chems-btn', function(ev) {\n    var chem_search_form_data = $('#chem_search_form').serialize(),\n        chem_search_input = $body.find('#cr-search_input').val();\n    ev.preventDefault();\n    ev.stopPropagation();\n\n    if (chem_search_input !== '') {\n\n      //********\n      //@TODO - Call Create New Node function - may be part of form_submission\n      //********\n\n      $.ajax({\n        url: 'chemical_rules/form_submission',\n        method: 'POST',\n        data: chem_search_form_data,\n        beforeSend: function() {\n          $('#chemical-rules-modal').dialog('option','title', 'Searching for ' + chem_search_input);\n          $body.find('#searching-chemical-name').text(chem_search_input);      \n          $('#chemical-rules-modal').dialog(\"open\");          \n          cr_showElementOutOfMany($('#chemical-rules-loading-wrapper'), $('.chemical-rules-modal-wrapper'));    \n        },\n        complete: function() {\n          $('#chemical-rules-modal').dialog('option','title', 'Search results for ' + chem_search_input);\n          cr_showElementOutOfMany($('#chemical-rules-results-wrapper'), $('#chemical-rules-loading-wrapper'));\n          originalDialog = $body.find('#chemical-rules-modal').html();\n        },\n        success: populate_substance_modal\n      });\n  \n      var chemicalNameOrNum = $body.find('#cr-search_input').val();\n      if ($body.find('#chemical-error').length > 0) {\n        $body.find('#chemical-error').remove();\n        $body.find('#cr-search_input').removeAttr('aria-describedby');\n      }\n      \n      var is_valid_chemical = true;\n      if (!is_valid_chemical) {\n        error = true;\n        var error_message = '<p class=\"has-error\" id=\"chemical-error\">No results were found for <b>' + chemicalNameOrNum + '</b>.  Please try another variation.</p>';\n        $(error_message).insertBefore('#cr-search_description');\n        $body.find('#cr-search_input').attr('aria-describedby', 'chemical-error');\n      }  \n      \n      cr_resizeModal();\n    } \n    else {\n      // @TODO Error message - please enter value;\n    }\n    \n  });\n  \n  if ($body.find('.favorite-chemical').length > 0) {\n    $body.on('click', '.favorite-chemical', function(ev) {\n      var cas_clicked = $(this).attr('data-casnum');\n      if (typeof cas_clicked !== typeof undefined && cas_clicked !== false) {\n        lookup_chemical($(this).attr('data-casnum'));\n      }\n      else {\n        var chem_name = $(this).text();\n        lookup_chemical(chem_name); \n      }\n      $('#chemical-rules-modal').dialog(\"open\");\n      $('#searching-chemical-name').text($(this).text());\n      $('#chemical-rules-modal').dialog(\"option\", \"title\", $(this).text());      \n      $body.addClass('fixed-modal-open');\n    });\n  }\n  \n  if ($body.find('.remove-link').length > 0) {\n    $body.on('click', '.remove-link', function(ev) {\n      ev.preventDefault();\n      var clicked_favorite_ID = $(this).data('epaintnum');\n      var clicked_favorite_type = $(this).data('favtype') + 's';\n\n      var updatedFavs = Drupal.settings.chemical_rules.profile[clicked_favorite_type].reduce(function(before, item, index, array){\n        (item.ID != clicked_favorite_ID) ? before.push(item) : before;\n        return before;\n      }, []);\n\n      Drupal.settings.chemical_rules.profile[clicked_favorite_type] = (updatedFavs) ? updatedFavs : [];\n\n      if ($(this).attr('id') == 'cr-remove-favorite') {\n        $body.find('#cr-save-favorite').parent('li').show();\n        $body.find('#cr-remove-favorite').parent('li').hide();\n      }\n      else if ($(this).hasClass('fa-heart')) {\n        update_clicked_heart($(this), false);\n      }\n\n      // Post updated array to Profile and re-render lists\n      render_favorites(Drupal.settings.chemical_rules.profile);\n      update_chem_profile(Drupal.settings.chemical_rules.profile);\n\n    });\n  }\n\n  if ($body.find('.save-favorite').length > 0) {\n    $body.on('click', '.save-favorite', function(ev) {\n    \t//ev.preventDefault();\n    \t//alert(\"Clicked the favorite: \" + $(this).data('chemicalid'));\n    \tvar type = $(this).data('favtype') + 's';\n\n    \tvar favorite = [];\n    \tif (type == 'Chemicals') {\n      \tif (($(this).data('casnum') !== '') && ($(this).data('casnum') !== null)) {\n        \tvar cas_num = $(this).data('casnum');\n      \t}\n      \telse {\n        \tvar cas_num = '';\n      \t}\n      \tif (($(this).data('commonname') !== '') && ($(this).data('commonname') !== null)) {\n        \tvar common_name = $(this).data('commonname');\n      \t}\n      \telse {\n        \tvar common_name = '';\n      \t}\n        favorite = {\n        \tID: $(this).data('epaintnum'),\n          CAS: cas_num,\n          SysName: $(this).data('sysname'),\n          CommonName: $(this).data('commonname')\n        };\n        if ($(this).attr('id') == 'cr-save-favorite') {\n          $body.find('#cr-save-favorite').parent('li').hide();\n          $body.find('#cr-remove-favorite').parent('li').show();\n        }\n      }\n      else if (type == 'Laws') {\n        //@TODO - Add button holder container for favorite link heart like other links - or use FavoriteLink.js functionality\n        var law_text = $(this).prev(\"a\").text();\n        var law_pieces = law_text.split('\\u2014');\n        var citation = law_pieces[0].trim();\n        var title = law_pieces[1].trim();\n        favorite = {\n        \tID: $(this).data('epaintnum'),\n          Citation: citation,\n          Title: title,\n          URL: $(this).prev(\"a\").attr('href')\n        };\n        update_clicked_heart($(this), true);\n      }\n      if (favorite != '') {\n        if(Drupal.settings.chemical_rules.profile[type] === undefined) {Drupal.settings.chemical_rules.profile[type] = []}\n        Drupal.settings.chemical_rules.profile[type].push(favorite);\n        update_chem_profile(Drupal.settings.chemical_rules.profile);\n      }\n    });\n  }\n\n  update_chem_profile = function(profile) {\n    $.ajax({\n      method: \"POST\",\n      url: Drupal.settings.basePath + \"chemical_rules/update_chem_profile\",\n      dataType: 'json',\n      data: {\n        profile: JSON.stringify(profile)\n      },\n    }).done(function() {\n      console.log('done', arguments)\n      render_favorites(favs);\n      //render_favorite_chemicals(favs);\n      //render_favorite_laws(favs);\n      // @TODO - Update Modal List - call populate_substance_modal or subset of it!\n\n    }).fail(function() {\n      console.log('fail', arguments)\n    });\n  };\n\n  /**\n   * Close Listener on Chemical Rules Modal\n   * -  Remove Previous Results ?\n   * -  Cancel Pending Form submission\n   */\n  $('#chemical-rules-modal').on('dialogclose', function() {\n    var $chemical_loading = $('#chemical-rules-loading-wrapper');\n    var $all_wrappers = $('.chemical-rules-modal-wrapper');\n\n    cr_showElementOutOfMany($chemical_loading, $all_wrappers);\n    cr_resizeModal();\n  });\n\n  var sticky_gap = $('#cr-modal-toc-icons').offset().top;\n  $('#chemical-rules-modal').scroll(function() {\n    if ($('#chemical-rules-modal').scrollTop() > sticky_gap) {\n      $('#cr-modal-toc-icons').addClass('sticky-toc');\n      $('#cr-modal-toc-icons').css('width', $('#chemical-rules-modal').width()+6).css('top', $('#chemical-rules-modal').offset().top);\n    } \n    else {\n      $('#cr-modal-toc-icons').removeClass('sticky-toc').removeAttr('style');\n    }\n  });\n  \n  var sticky_gap = $('#cr-modal-toc-icons').offset().top;\n  $('#cr-modal-toc-icons li a').on('click', function(ev) {\n    ev.preventDefault();\n    // Scroll the modal to the anchor clicked\n    if (!$('#cr-modal-toc-icons').hasClass('sticky-toc')) {\n      $('#cr-modal-toc-icons').addClass('sticky-toc');\n      $('#cr-modal-toc-icons').css('width', $('#chemical-rules-modal').width()).css('top', $('#chemical-rules-modal').offset().top);\n    }\n    // Use the Laws and Regs heading as a landmark for gauging offset and scrolled amount\n    var toc_bottom = $('#cr-laws-regs').offset().top;\n    var target_top = $(this.hash).offset().top;\n    var scroll_amount = target_top - toc_bottom;\n    $(\"#chemical-rules-modal\").animate({ scrollTop: scroll_amount}, 500);\n  });\n  \n\n})(jQuery);\n\n"]}