{"version":3,"sources":["chemical_rules.js"],"names":["repair_chemical_rules_profile","cr_showElementOutOfMany","$wrapper_to_show","$common_selector","hide","show","cr_resizeModal","jQuery","dialog","position","my","at","width","window","height","css","replace","length","cr_resizeLMModal","create_favlaw_heart","epaintnum","favs","Drupal","settings","chemical_rules","profile","Chemicals","Laws","NAICS","law_in_favorites","Object","keys","find_matching_favorites","fav_law_holder","check_id","check_type","match_found","i","favID","ID","is_valid_cas_number","stringToCheck","cas","casgroup","exec","checkDigit","split","reduce","previousValue","currentValue","currentIndex","array","lookup_chemical","lookup_value","$","$body","chem_search_input","ajax","url","basePath","method","data","cr-search_input","beforeSend","find","text","complete","originalDialog","html","success","populate_substance_modal","chemical_rules_response_json","json","cas_reg_num","error","prop","remove","substance","cas_number","chemical_substance_systematic_name","$list","$synonyms","$image","$substance_lists","html_to_add","substance_lists","favorite_exists","epa_chemical_internal_number","attr","epa_chemical_registry_name","iupac_name","parent","cfr_id","substance_list","laws_regs","push","index","fav_holder","attributes","citation","title","meta_data","year","cfr_authority","append","join","synonym_list","synonyms","each","this","sort","molecular_formula","addClass","before","render_favorite_chemicals","num_chem_faves","favorite_chemicals","val","CAS","link_casnum","include_commonname","CommonName","SysName","render_naics_codes","num_naics_faves","favorite_codes","URL","render_favorite_laws","num_rules_faves","favorite_laws","Citation","Title","reset_cr_form","$form","trigger_law_qTip","findLink","hideQtip","trigger","findQtip","err","update_clicked_heart","this_link","filled_if_true","removeClass","update_favorite_lists","type","isValidCasNumber","console","log","$cr_tabs","tabs","on","render_favorites","$cr_empty","$cr_avail","path","location","pathname","page","modal","closeOnEscape","dialogClass","draggable","autoOpen","resizable","create","event","ui","resize","open","sticky_gap","offset","top","scroll","scrollTop","removeAttr","ev","preventDefault","hasClass","toc_bottom","target_top","hash","scroll_amount","animate","close","learnmore","stopPropagation","is_valid_chemical","chemicalNameOrNum","error_message","insertBefore","cas_clicked","clicked_favorite_ID","clicked_favorite_type","updatedFavs","item","update_chem_profile","favorite","cas_num","law_text","prev","law_pieces","trim","undefined","dataType","JSON","stringify","done","arguments","fail","$chemical_loading","$all_wrappers"],"mappings":"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","file":"chemical_rules.js","sourcesContent":["var originalDialog;\nvar favs = (Drupal.settings.chemical_rules.profile) ? Drupal.settings.chemical_rules.profile : {'Chemicals':[],'Laws':[], 'NAICS':[]};\n\nfunction repair_chemical_rules_profile() {\n\n}\n\nfunction cr_showElementOutOfMany($wrapper_to_show, $common_selector) {\n  $common_selector.hide();\n  $wrapper_to_show.show();\n  cr_resizeModal();\n}\n\nfunction cr_resizeModal() {\n  jQuery('#chemical-rules-modal').dialog({\n    position: { 'my': 'center', 'at': 'center' },\n    width: jQuery(window).width()-180,\n    height: jQuery(window).height()-180,\n  });\n  if(jQuery('.chemical-rules-modal').css('top').replace('px', '') < 1){\n    jQuery('.chemical-rules-modal').css('top', 0);\n  }\n  if (jQuery('.sticky-toc').length > 0) {\n    jQuery('#cr-modal-toc-icons').css('width', jQuery('#chemical-rules-modal').width()+6);\n  }\n}\n\nfunction cr_resizeLMModal() {\n  \n  jQuery('#chemical-rules-learnmore').dialog({\n    position: { 'my': 'center', 'at': 'center' },\n    width: 0.75 * (jQuery(window).width()),\n    height: 'auto',\n  });\n  if(jQuery('.chemical-rules-modal').css('top').replace('px', '') < 1){\n    jQuery('.chemical-rules-modal').css('top', 0);\n  }\n}\n\nfunction create_favlaw_heart(epaintnum) {\n\n  var favs = (Drupal.settings.chemical_rules.profile) ? Drupal.settings.chemical_rules.profile : {'Chemicals':[],'Laws':[], 'NAICS':[]};\n  var law_in_favorites = (Object.keys(favs.Laws).length > 0) ? find_matching_favorites(epaintnum, \"Laws\") : false;\n  var fav_law_holder = '';\n\n  if (law_in_favorites === false) {\n    fav_law_holder = '<a href=\"javascript:void(0);\" class=\"fa fa-heart empty save-favorite\" data-epaintnum=\"' + epaintnum + '\" data-favtype=\"Law\"><span class=\"sr-only\">Click to favorite.</span></a>';\n  }\n  else {\n    fav_law_holder = '<a href=\"javascript:void(0);\" class=\"fa fa-heart filled remove-link remove-favorite\" data-epaintnum=\"' + epaintnum + '\" data-favtype=\"Law\"><span class=\"sr-only\">Favorited. Click to unfavorite.</span></a>';\n  }\n\n  return fav_law_holder;\n\n}\n\nfunction find_matching_favorites(check_id, check_type) {\n  var match_found = false,\n    favs = (Drupal.settings.chemical_rules.profile) ? Drupal.settings.chemical_rules.profile : {'Chemicals':[],'Laws':[], 'NAICS':[]};\n  var length = (favs[check_type]) ? favs[check_type].length : 0;\n\n  for (var i = 0; i < length; i++) {\n  \tfavID = favs[check_type][i].ID;\n    if (favID == check_id) {\n      match_found = true;\n  \t  return i;\n  \t}\n  }\n  if (match_found == false) {\n  \treturn false;\n  }\n}\n\nfunction is_valid_cas_number(stringToCheck) {\n  var cas = /(\\d{2,7}).{0,2}(\\d{2}).{0,2}(\\d)/g;\n  var casgroup = cas.exec(stringToCheck);\n  if(casgroup){\n    var checkDigit = (casgroup[1] + casgroup[2]).split('').reduce(function(previousValue, currentValue, currentIndex, array) {\n      return ((previousValue + (array[array.length - currentIndex -1] * (currentIndex + 1))) % 10)\n    }, 0)\n    return(checkDigit == casgroup[3])\n  }\n  return false\n}\n\nfunction lookup_chemical(lookup_value) {\n\n  var $ = jQuery;\n  var $body = jQuery('body');\n  var chem_search_input = lookup_value;\n  \n  $.ajax({\n      url: Drupal.settings.basePath + 'chemical_rules/form_submission',\n      method: 'POST',\n      data: {'cr-search_input': lookup_value},\n      beforeSend: function() {\n        $('#chemical-rules-modal').dialog('option','title', 'Searching for \"' + chem_search_input + '\"');\n        $body.find('#searching-chemical-name').text(chem_search_input);      \n        $('#chemical-rules-modal').dialog(\"open\");          \n        cr_showElementOutOfMany($('#chemical-rules-loading-wrapper'), $('.chemical-rules-modal-wrapper'));    \n      },\n      complete: function() {\n        $('#chemical-rules-modal').dialog('option','title', 'Search results for \"' + chem_search_input + '\"');\n        cr_showElementOutOfMany($('#chemical-rules-results-wrapper'), $('#chemical-rules-loading-wrapper'));\n        originalDialog = $body.find('#chemical-rules-modal').html();\n      },\n      success: populate_substance_modal\n    });\n  \n}\n\nfunction populate_substance_modal(chemical_rules_response_json) {\n  var $body = jQuery('body');\n  var json = chemical_rules_response_json;\n  var cas_reg_num = 'n/a';\n  var chem_reg_name = 'n/a';\n\n  if(json.data !== null && json.error === false){\n    if ($body.find('#search-message').length > 0) {\n      $body.find('#cr-search_input').prop('aria-describedby', false);\n      $body.find('#search-message').remove();\n    }\n    \n    if (json.data.substance.cas_number !== '' && json.data.substance.cas_number !== null) {\n      cas_reg_num = json.data.substance.cas_number + ': ';\n    }\n    \n    // populate our modal\n    $body.find('.cr-chemical-name').text(json.data.substance.chemical_substance_systematic_name);\n\n    var $list = $body.find('#cr-laws-regs-substances');\n    var $programs = $body.find('#cr-programs-list');\n    var $synonyms = $body.find('#cr-synonyms-list');\n    var $image = $body.find('.cr-structure_image');\n    var $substance_lists = $body.find('#cr-substances-list');\n    var lists = [];\n    var cfrs = [];\n    var html_to_add = [];\n    var substance_lists = [];\n    var favorite_exists = (Object.keys(favs.Chemicals).length > 0) ? find_matching_favorites(json.data.substance.epa_chemical_internal_number, \"Chemicals\") : false;\n    var count_all_cfrs = 0;\n    \n    $body.find('#cr-save-favorite').attr('data-epaintnum', json.data.substance.epa_chemical_internal_number).attr('data-sysname', json.data.substance.chemical_substance_systematic_name);\n    $body.find('#metadata-sys-name').text(json.data.substance.chemical_substance_systematic_name);\n    if (json.data.substance.epa_chemical_registry_name !== null) {\n      $body.find('#cr-save-favorite').attr('data-commonname', json.data.substance.epa_chemical_registry_name);\n      $body.find('#metadata-common-name').text(json.data.substance.epa_chemical_registry_name);\n    }\n    else {\n      $body.find('#cr-save-favorite').attr('data-commonname', false);\n      $body.find('#metadata-common-name').text('n/a');  \n    }\n    if (json.data.substance.cas_number !== null) {\n      $body.find('#cr-save-favorite').attr('data-casnum', json.data.substance.cas_number);\n      $body.find('#metadata-cas-num').text(json.data.substance.cas_number);\n    }\n    else {\n      $body.find('#cr-save-favorite').attr('data-casnum', false);\n      $body.find('#metadata-cas-num').text('n/a');      \n    }\n    if (json.data.substance.iupac_name !== null) {\n      $body.find('#metadata-iupac-num').text(json.data.substance.iupac_name);\n    }\n    else {\n      $body.find('#metadata-iupac-num').text('n/a');\n    }\n     \n    $body.find('#cr-remove-favorite').attr('data-epaintnum', json.data.substance.epa_chemical_internal_number).attr('data-favtype', 'Chemical');\n\n    if (favorite_exists === false) {\n      $body.find('#cr-save-favorite').parent('li').show();\n      $body.find('#cr-remove-favorite').parent('li').hide();\n    }\n    else {\n      $body.find('#cr-save-favorite').parent('li').hide();\n      $body.find('#cr-remove-favorite').parent('li').show();\n    }\n\n    $list.html('');\n    // Check whether Substance Lists exist.\n    // If so, for each,\n    //    1) get SubstanceList name data.substance_list[].substance_list_name\n    //    2) then get list of CFRs\n    //    3) loop thru CFRs and look up CFR name and URL (laws_regs.[variableforcfrnumber].cfr_id, attributes.usc_citation, attributes.title, attributes.url\n\n    var cfr_id = '';\n    if(!!json.data.substance_list && Object.keys(json.data.substance_list).length && !!json.data.laws_regs && Object.keys(json.data.laws_regs).length) {\n        html_to_add.push('<ul class=\"cr-lists\">');        \n        for(var index in json.data.laws_regs) {\n          cfr_id = json.data.laws_regs[index].cfr_id;\n          fav_holder = create_favlaw_heart(cfr_id);\n          html_to_add.push('<li><span class=\"law-entry\"><a data-favtype=\"Law\" data-epaintnum=\"' + cfr_id + '\" href=\"'+ json.data.laws_regs[index].attributes.url +'\" target=\"_blank\">' + json.data.laws_regs[index].attributes.citation + \" &mdash; \" + \n              json.data.laws_regs[index].attributes.title + \n              ' (' + json.data.laws_regs[index].meta_data.year + ')</a>' + fav_holder + '</span>');\n          html_to_add.push('<span class=\"law-citation\">Authority: ' + json.data.laws_regs[index].attributes.cfr_authority + '</span>');\n          html_to_add.push('<span class=\"law-lists\">Substance Lists: ' + json.data.laws_regs[index].substance_list + '</span></li>');\n        }\n      html_to_add.push('</ul>');\n      $list.append(html_to_add.join(\"\"));\n      $body.find('#count-all-cfrs').text(Object.keys(json.data.laws_regs).length);\n      $body.find('#results-intro').text('  Relevant laws and regulations include:');\n    }\n    else {\n      // No laws regulations found\n      $body.find('#count-all-cfrs').text('No');\n      $body.find('#results-intro').text('');\n    }\n    \n/*  //@TODO Future - If Programs do Exist\n    $programs.html('');\n    if (json.data.Programs.length > 0) {\n      $(json.data.Programs).each(function(index){\n        //$('#cr-programs-count').text(json.data.Programs.length);\n        $programs.append('<li><a href=\"'+this.source+'\" target=\"_blank\">'+this.name+'</a></li>');\n      });\n    }\n    else {\n      // No programs found   \n    }\n*/\n    var synonym_list = [];\n    $synonyms.html('');\n    if (json.data.substance.synonyms.length > 0) {\n      jQuery(json.data.substance.synonyms).each(function(index) {\n        //$('#cr-synonyms-count').text(json.data.substance.synonyms.length);\n        synonym_list.push('<li>'+this+'</li>');\n      });\n      $synonyms.append(synonym_list.sort());\n    }\n    else {\n      // No synonyms found\n    }\n    \n    $image.html('');\n    if (json.data.substance[\"2d-structure\"] != null && json.data.substance[\"2d-structure\"] != '') {\n      $image.append('<img src=\"' + json.data.substance[\"2d-structure\"] + '\" alt=\"A structure of ' + json.data.substance.epa_chemical_registry_name + '\"><div class=\"cr-structure_name\"><p>' + json.data.substance.molecular_formula + '</p></div>');\n      $body.find('#cr-laws-regs_structure').append('<p class=\"cr-footnote\">Powered by <a href=\"https://pubchem.ncbi.nlm.nih.gov\" rel=\"external\" target=\"_blank\">PubChem</a> and EPA\\'s <a href=\"https://opendata.epa.gov/home.xhtml?view\" rel=\"external\" target=\"_blank\">Linked Open Data Service</a></p>');\n    }\n    else {\n      // No images found\n      $image.append('No image available for this substance.');\n    }\n/*\n    var $molecular_weight = $body.find('.cr-structure_molecular-weight');\n    $molecular_weight.html('');\n    if (json.data.substance.molecular_weight != null && json.data.substance.molecular_weight != '') {\n      $molecular_weight.append('<p>Molecular Weight: ' + json.data.substance.molecular_weight + '</p>');\n    }\n*/\n    \n    var tr_start = '<tr><th scope=\"row\">',\n        tr_end = '</td></tr>';\n    \n    $substance_lists.html('');\n    if (Object.keys(json.data.substance_list).length > 0) {\n      jQuery(Object.keys(json.data.substance_list)).each(function(index) {\n          var substance_list_obj = json.data.substance_list[this];\n          substance_lists.push('<li>'+ this +'</li>');\n      });\n      $substance_lists.append(substance_lists.sort());\n    }\n    else {\n      $substance_lists.html('<p>No substance lists found for this chemical.</p>');\n    }\n    \n    $body.addClass('fixed-modal-open');\n  }\n  else {\n    //@TODO Add error msg for when there is bad data\n    jQuery('#chemical-rules-modal').dialog(\"close\");\n    if (!$body.find('#search-message').length > 0) {\n      $body.find('#cr-search_description').before('<div id=\"search-message\" class=\"has-error\">No chemicals found.  Please try a different name or CAS #.</div>');\n      $body.find('#cr-search_input').prop('aria-describedby', 'search-message');\n    }\n  }\n\n}\n\nfunction render_favorite_chemicals(favs) {\n\n  var $ = jQuery;\n  var $body = $('body');\n  var num_chem_faves = (favs.Chemicals) ? favs.Chemicals.length: 0;\n    \n  if (num_chem_faves) {\n    var favorite_chemicals = [];\n    $body.find('#cr-count-chemicals').text(num_chem_faves);\n    $.each(favs.Chemicals, function(index, val) {\n      var cas = '';\n      if (val.CAS != null && val.CAS != \"\") {\n        cas = val.CAS;\n        var link_casnum = \" data-casnum='\" + cas + \"' \";\n        cas = cas + \": \";\n      }\n      else {\n        link_casnum = '';\n      }\n      var include_commonname = '';\n      if (val.CommonName != null && val.CommonName != '') {\n        include_commonname = ' ('+ val.CommonName + ')';\n      }\n      favorite_chemicals.push('<li><a class=\"favorite-chemical cr-favorite\" href=\"javascript:void(0);\" data-favtype=\"Chemical\" data-sysname=\"' + val.SysName + '\" data-epaintnum=\"' + val.ID + '\" ' + link_casnum + 'data-commonname=\"' + val.CommonName + '\">' + cas + val.SysName + include_commonname +'</a><a class=\"favorite-chemical-remove remove-link\" data-favtype=\"Chemical\" data-epaintnum=\"' + val.ID + '\" data-commonname=\"' + val.CommonName + '\">Remove<span class=\"sr-only\"> ' + val.SysName + ' from favorites</span></a></li>');\n    });\n    if ($body.find('#favorite-chemicals').length > 0) {\n      if (num_chem_faves === 0) {\n        $body.find('#favorite-chemicals').hide();\n      }\n      else {\n        $body.find('#favorite-chemicals').show();\n      }\n    }\n    $body.find('.cr-chemicals').show();\n    $body.find('.cr-favorite-chemicals').html(favorite_chemicals).show();\n  }\n  else {\n    // If the favorite-chemicals div exists, and no faves exist, hide it\n    if ($body.find('#favorite-chemicals').length > 0) {\n      $body.find('#favorite-chemicals').hide();\n    }\n    $body.find('.cr-chemicals').hide();\n    $body.find('.cr-favorite-chemicals').html('').hide();\n  }\n}\n\nfunction render_naics_codes(favs) {\n  var $body = $('body');\n  var num_naics_faves = (favs.NAICS) ? favs.NAICS.length : 0;\n  if(num_naics_faves) {\n    var favorite_codes = [];\n    $.each(favs.NAICS, function(index, val) {\n      favorite_codes.push('<li><a class=\"favorite-code cr-favorite\" href=\"' + val.URL + '\" data-favtype=\"Code\" target=\"_blank\">' + val.ID + '</a></li>');\n    });\n    if ($body.find('#favorite-naics').length > 0) {\n      $body.find('#favorite-naics').show();\n    }\n    $body.find('.cr-codes').show();\n    $body.find('.cr-naics-codes').html(favorite_codes).show();\n  } \n  else {\n    if ($body.find('#favorite-naics').length > 0) {\n      $body.find('#favorite-naics').hide();\n    }    \n    $body.find('.cr-codes').hide();\n    $body.find('.cr-naics-codes').html('').hide();\n  }\n}\n\nfunction render_favorite_laws(favs) {\n\n  var $ = jQuery;\n  var $body = $('body');\n  var num_rules_faves = (favs.Laws) ? favs.Laws.length : 0;\n\n  if (num_rules_faves) {\n    var favorite_laws = [];\n    $body.find('#cr-count-laws').text(num_rules_faves);\n    $.each(favs.Laws, function(index, val) {\n      favorite_laws.push('<li><a class=\"favorite-law cr-favorite\" href=\"' + val.URL + '\" data-favtype=\"Law\" data-epaintnum=\"' + val.ID + '\" target=\"_blank\">' + val.Citation + ':  ' + val.Title + '</a><a class=\"favorite-law-remove remove-link\" data-favtype=\"Law\" data-epaintnum=\"' + val.ID + '\">Remove<span class=\"sr-only\"> ' + val.Title + ' from favorites</span></a></li>');\n    });\n    if ($body.find('#favorite-laws').length > 0) {\n      if (num_rules_faves === 0) {\n        $body.find('#favorite-laws').hide();\n      }\n      else {\n        $body.find('#favorite-laws').show();\n      }\n    }\n    $body.find('.cr-laws').show();\n    $body.find('.cr-favorite-laws').html(favorite_laws).show();\n  }\n  else {\n    if ($body.find('#favorite-laws').length > 0) {\n      $body.find('#favorite-laws').hide();\n    }\n    $body.find('.cr-laws').hide();\n    $body.find('.cr-favorite-laws').html('').hide();\n  }\n}\n\n/**\n * Clear form inputs and hide warning messages\n */\nfunction reset_cr_form() {\n  var $form = jQuery('#cr-search_input');\n  $form.val('');\n}\n\n/**\n * Manually trigger qTip that holds favorite heart icon to improve accessibility\n */\nfunction trigger_law_qTip(findLink, hideQtip) {\n    try {\n        if (hideQtip == true) {\n            $(findLink).trigger('mouseover');\n            findQtip = '#' + $(findLink).attr('aria-describedby');\n            return findQtip;\n        }\n        else {\n            $(findLink).trigger('mouseout');\n        }\n    }\n    catch (err) {\n        //console.log(\"Error on triggerQtip: \" + err);\n    }\n}\n\nfunction update_clicked_heart(this_link, filled_if_true) {\n\n  if (filled_if_true === true) {\n    this_link.removeClass('empty save-favorite');\n    this_link.addClass('filled remove-favorite remove-link'); \n  }\n  else if (filled_if_true === false) {\n    this_link.addClass('empty save-favorite');\n    this_link.removeClass('filled remove-favorite remove-link');     \n  }\n  \n}\n\nfunction update_favorite_lists(type) {\n  if (type == 'Chemical') {\n    render_favorite_chemicals(Drupal.settings.chemical_rules.profile);\n  }\n  else if (type == 'Law') {\n    render_favorite_laws(Drupal.settings.chemical_rules.profile);\n  }\n  else {\n    //render_naics_codes(Drupal.settings.chemical_rules.profile);\n  }\n\n}\n\nfunction isValidCasNumber(stringToCheck) {\n  var cas = /(\\d{2,7}).{0,2}(\\d{2}).{0,2}(\\d)/g;\n  var casgroup = cas.exec(stringToCheck);\n  if(casgroup){\n    var checkDigit = (casgroup[1] + casgroup[2]).split('').reduce(function(previousValue, currentValue, currentIndex, array) {\n      return ((previousValue + (array[array.length - currentIndex -1] * (currentIndex + 1))) % 10)\n    }, 0)\n    return(checkDigit == casgroup[3])\n  }\n  console.log('invalid string')\n  return false\n}\n\n(function($) {\n  var $body = $('body'),\n      sampleSetIndex = 0,\n      num_chem_faves = 0,\n      num_rules_faves = 0;\n\n  if ($body.find('#cr-tabs').length > 0) {\n    $cr_tabs = $('#cr-tabs').tabs();\n  }\n\n  if ($body.find('#chem_search_form').length > 0) {\n    $('#chem_search_form').on('submit', function() {\n      $('#cr-search-chems-btn').trigger('click');\n      return false;\n    });\n  }\n\n  // CHEMICAL ATTRIBUTES\n  // ID = EPAChemicalInternalNumber\n  // CAS = CASRegistryNumber\n  // SysName = ChemicalSubstanceSystematicName (e.g., 2-Propanone)\n  // CommonName = epa_chemical_registry_name (e.g., Acetone)\n\n  // LAW ATTRIBUTES\n  // ID = LRS ID = cfr_id (e.g., 3874781)\n  // Citation (e.g., 40 CFR 711)\n  // Title (e.g., TSCA CHEMICAL DATA REPORTING REQUIREMENTS)\n  // URL (e.g., https:\\/\\/gpo.gov...)\n\n//   var favs = Drupal.settings.chemical_rules.profile;\n\n  // 1) Get favorites\n  // 2) Count number of favorite Chemicals and Laws\n\n  var render_favorites = function(favs) {\n    num_chem_faves = (favs.Chemicals) ? favs.Chemicals.length : 0;\n    num_rules_faves = (favs.Laws) ? favs.Laws.length : 0;\n    $cr_empty = $('.cr-tabs_favorites_empty');\n    $cr_avail = $('.cr-tabs_favorites_available');\n    \n    var path = window.location.pathname;\n    var page = path.split('/')[1];\n\n    if (num_chem_faves === 0 && num_rules_faves === 0) {\n      $cr_empty.show();\n      $cr_avail.hide();\n      if (page === 'user') {\n        $body.find('#favorite-chemicals').hide();\n        $body.find('#favorite-laws').hide();\n      }\n    }\n    else {\n      $cr_empty.hide();\n      $cr_avail.show();\n      if (page === 'user') {\n        if (num_chem_faves === 0) {\n          $body.find('#favorite-chemicals').hide();\n        }\n        if (num_rules_faves === 0) {\n          $body.find('#favorite-laws').show();\n        }\n      }\n\n      render_favorite_chemicals(favs);\n      render_favorite_laws(favs);\n    }\n  }\n\n  render_favorites(favs);\n\n  // Initialize and open dialog\n  $('#chemical-rules-modal')\n    .html(Drupal.settings.chemical_rules.modal)\n    .dialog({\n      title: 'Results',\n      modal: true,\n      width: $(window).width()-180,\n      height: $(window).width()-180,\n      closeOnEscape: true,\n      position: { 'my': 'left top', 'at': 'left top' },\n      dialogClass: 'chemical-rules-modal',\n      draggable: false,\n      autoOpen: false,\n      resizable: false,      \n      create: function(event, ui) {\n        $(window).resize(function(){cr_resizeModal();});\n      },\n      open: function(event, ui) {\n        $('#chemical-rules-modal').parent().css('position', 'fixed');\n        var sticky_gap = $('#cr-modal-toc-icons').offset().top;\n        $('#chemical-rules-modal').scroll(function() {\n          if ($('#chemical-rules-modal').scrollTop() > sticky_gap) {\n            $('#cr-modal-toc-icons').addClass('sticky-toc');\n            $('#cr-modal-toc-icons').css('width', $('#chemical-rules-modal').width()+6).css('top', $('#chemical-rules-modal').offset().top);\n          } \n          else {\n            $('#cr-modal-toc-icons').removeClass('sticky-toc').removeAttr('style');\n          }\n        });\n        \n        var sticky_gap = $('#cr-modal-toc-icons').offset().top;\n        $('#cr-modal-toc-icons li a').on('click', function(ev) {\n          ev.preventDefault();\n          // Scroll the modal to the anchor clicked\n          if (!$('#cr-modal-toc-icons').hasClass('sticky-toc')) {\n            $('#cr-modal-toc-icons').addClass('sticky-toc');\n            $('#cr-modal-toc-icons').css('width', $('#chemical-rules-modal').width()).css('top', $('#chemical-rules-modal').offset().top);\n          }\n          // Use the Laws and Regs heading as a landmark for gauging offset and scrolled amount\n          var toc_bottom = $('#cr-laws-regs').offset().top;\n          var target_top = $(this.hash).offset().top;\n          var scroll_amount = target_top - toc_bottom;\n          $(\"#chemical-rules-modal\").animate({ scrollTop: scroll_amount}, 500);\n        });        \n      },\n      close: function(event, ui) {\n        reset_cr_form();\n        $('#chemical-rules-modal').html(originalDialog);\n        $body.removeClass('fixed-modal-open');\n      }\n    });\n\n  if (Drupal.settings.chemical_rules.learnmore) {\n    $('#chemical-rules-learnmore')\n      .html(Drupal.settings.chemical_rules.learnmore)\n      .dialog({\n        title: 'How the Chemical Laws and Regulations Widget Works',\n        modal: true,\n        width: 'auto',\n        height: 'auto',\n        closeOnEscape: true,\n        position: { 'my': 'center top', 'at': 'center top' },\n        dialogClass: 'chemical-rules-learnmore',\n        draggable: false,\n        autoOpen: false,\n        resizable: false,  \n        create: function(event, ui) {\n          $(window).resize(function(){cr_resizeLMModal();});\n        },          \n        open: function(event, ui) {\n          cr_resizeLMModal();\n        }\n    }); \n    $body.find('#learnmore-link').html('<a href=\"javascript:void(0)\" id=\"cr-learnmore\">Learn how it works</a>.');\n  }\n\n  // Handle Search chemicals button click\n  $body.on('click', '#cr-search-chems-btn', function(ev) {\n//     var chem_search_form_data = $('#chem_search_form').serialize();\n    var chem_search_input = $body.find('#cr-search_input').val();\n    ev.preventDefault();\n    ev.stopPropagation();\n\n    if (chem_search_input !== '') {\n\n      //********\n      //@TODO - Call Create New Node function - may be part of form_submission\n      //********\n\n      var is_valid_chemical = true;\n      lookup_chemical(chem_search_input);\n        \n      var chemicalNameOrNum = $body.find('#cr-search_input').val();\n      if ($body.find('#chemical-error').length > 0) {\n        $body.find('#chemical-error').remove();\n        $body.find('#cr-search_input').removeAttr('aria-describedby');\n      }\n      \n      if (!is_valid_chemical) {\n        error = true;\n        var error_message = '<p class=\"has-error\" id=\"chemical-error\">No results were found for <b>' + chemicalNameOrNum + '</b>.  Please try another variation.</p>';\n        $(error_message).insertBefore('#cr-search_description');\n        $body.find('#cr-search_input').attr('aria-describedby', 'chemical-error');\n      }  \n      \n      cr_resizeModal();\n    } \n    else {\n      // @TODO Error message - please enter value;\n      \n    }\n    \n  });\n  \n  if ($body.find('.favorite-chemical').length > 0) {\n    $body.on('click', '.favorite-chemical', function(ev) {\n      var cas_clicked = $(this).attr('data-casnum');\n      if (typeof cas_clicked !== typeof undefined && cas_clicked !== false) {\n        lookup_chemical($(this).attr('data-casnum'));\n      }\n      else {\n        //var chem_name = $(this).text();\n        lookup_chemical($(this).attr('data-sysname')); \n      }\n      $('#chemical-rules-modal').dialog(\"open\");\n      $('#searching-chemical-name').text($(this).text());\n      $('#chemical-rules-modal').dialog(\"option\", \"title\", $(this).text());      \n      $body.addClass('fixed-modal-open');\n    });\n  }\n  \n  if ($body.find('.remove-link').length > 0) {\n    $body.on('click', '.remove-link', function(ev) {\n      ev.preventDefault();\n      var clicked_favorite_ID = $(this).data('epaintnum');\n      var clicked_favorite_type = $(this).data('favtype') + 's';\n      var updatedFavs = Drupal.settings.chemical_rules.profile[clicked_favorite_type].reduce(function(before, item, index, array){\n        (item.ID != clicked_favorite_ID) ? before.push(item) : before;\n        return before;\n      }, []);\n\n      Drupal.settings.chemical_rules.profile[clicked_favorite_type] = (updatedFavs) ? updatedFavs : [];\n\n      if ($(this).attr('id') == 'cr-remove-favorite') {\n        $body.find('#cr-save-favorite').parent('li').show();\n        $body.find('#cr-remove-favorite').parent('li').hide();\n      }\n      else if ($(this).hasClass('fa-heart')) {\n        update_clicked_heart($(this), false);\n      }\n\n      // Post updated array to Profile and re-render lists\n      render_favorites(Drupal.settings.chemical_rules.profile);\n      update_chem_profile(Drupal.settings.chemical_rules.profile);\n\n    });\n  }\n\n  if ($body.find('.save-favorite').length > 0) {\n    $body.on('click', '.save-favorite', function(ev) {\n      //ev.preventDefault();\n      //alert(\"Clicked the favorite: \" + $(this).data('chemicalid'));\n      var type = $(this).data('favtype') + 's';\n\n      var favorite = [];\n      if (type == 'Chemicals') {\n        if (($(this).data('casnum') !== '') && ($(this).data('casnum') !== null)) {\n          var cas_num = $(this).data('casnum');\n        }\n      \telse {\n        \tvar cas_num = '';\n      \t}\n      \tif (($(this).data('commonname') !== '') && ($(this).data('commonname') !== null)) {\n        \tvar common_name = $(this).data('commonname');\n      \t}\n      \telse {\n        \tvar common_name = '';\n      \t}\n        favorite = {\n        \tID: $(this).data('epaintnum'),\n          CAS: cas_num,\n          SysName: $(this).data('sysname'),\n          CommonName: $(this).data('commonname')\n        };\n        if ($(this).attr('id') == 'cr-save-favorite') {\n          $body.find('#cr-save-favorite').parent('li').hide();\n          $body.find('#cr-remove-favorite').parent('li').show();\n        }\n      }\n      else if (type == 'Laws') {\n        //@TODO - Add button holder container for favorite link heart like other links - or use FavoriteLink.js functionality\n        var law_text = $(this).prev(\"a\").text();\n        var law_pieces = law_text.split('\\u2014');\n        var citation = law_pieces[0].trim();\n        var title = law_pieces[1].trim();\n        favorite = {\n        \tID: $(this).data('epaintnum'),\n          Citation: citation,\n          Title: title,\n          URL: $(this).prev(\"a\").attr('href')\n        };\n        update_clicked_heart($(this), true);\n      }\n      if (favorite != '') {\n        if (!Drupal.settings.chemical_rules.profile) {\n          Drupal.settings.chemical_rules.profile = {'Chemicals':[],'Laws':[]};\n          update_chem_profile(Drupal.settings.chemical_rules.profile);\n        }        \n        if(Drupal.settings.chemical_rules.profile[type] === undefined) {\n          Drupal.settings.chemical_rules.profile[type] = [];\n          update_chem_profile(Drupal.settings.chemical_rules.profile);          \n        }\n        Drupal.settings.chemical_rules.profile[type].push(favorite);\n        update_chem_profile(Drupal.settings.chemical_rules.profile);\n        render_favorites(Drupal.settings.chemical_rules.profile);\n      }\n    });\n  }\n\n  update_chem_profile = function(profile) {\n    $.ajax({\n      method: \"POST\",\n      url: Drupal.settings.basePath + \"chemical_rules/update_chem_profile\",\n      dataType: 'json',\n      data: {\n        profile: JSON.stringify(profile)\n      },\n    }).done(function() {\n      console.log('done', arguments)\n      render_favorites(Drupal.settings.chemical_rules.profile);\n      //render_favorite_chemicals(favs);\n      //render_favorite_laws(favs);\n      //render_naics_codes(favs);\n      // @TODO - Update Modal List - call populate_substance_modal or subset of it!\n\n    }).fail(function() {\n      console.log('fail', arguments)\n    });\n  };\n\n  /**\n   * Close Listener on Chemical Rules Modal\n   * -  Remove Previous Results ?\n   * -  Cancel Pending Form submission\n   */\n  $('#chemical-rules-modal').on('dialogclose', function() {\n    var $chemical_loading = $('#chemical-rules-loading-wrapper');\n    var $all_wrappers = $('.chemical-rules-modal-wrapper');\n\n    cr_showElementOutOfMany($chemical_loading, $all_wrappers);\n    cr_resizeModal();\n  });\n  \n  if ($body.find('#cr-learnmore').length > 0) {\n    $('#cr-learnmore').on('click', function() {\n      $('#chemical-rules-learnmore').dialog(\"open\");\n    });\n  }\n\n})(jQuery);\n\n"]}