{"version":3,"sources":["chemical_rules.js"],"names":["showElementOutOfMany","$wrapper_to_show","$common_selector","hide","show","resizeModal","jQuery","dialog","position","my","at","css","replace","checkValues","previous","current","cIndex","keys","previousKeys","Object","indexOf","Value","reduce","length","resetCRForm","$form","$","val","populate_substance_modal","chemical_rules_response_json","$body","data","error","Substance","CASRegistryNumber","ChemicalSubstanceSystematicName","find","text","EPAChemicalRegistryName","$list","$programs","$synonyms","$image","$propertiestable","$substance_lists","srs_id","EPAChemicalInternalNumber","attr","console","log","html","LawsRegs","each","index","append","this","source","name","Programs","Synonym","Image","tr_start","tr_end","properties","MolecularWeight","Solubility","VaporPressure","LogP","Stability","pKA","SubstanceList","originalDialog","num_chem_faves","tabs","num_rules_faves","$cr_empty","$cr_avail","Drupal","settings","chemical_rules","modal","title","width","height","closeOnEscape","dialogClass","draggable","autoOpen","create","event","ui","close","on","ev","chem_search_form_data","serialize","ajax","url","method","beforeSend","complete","success","chemicalNameOrNum","remove","removeAttr","is_valid_chemical","toc","selectors","container","itemClass","i","heading","$heading","prefix","tagName","toLowerCase","error_message","insertBefore","preventDefault","clickedFavoriteID","alert","$chemical_loading","$all_wrappers"],"mappings":"AAEA,QAASA,sBAAqBC,iBAAkBC,kBAC9CA,iBAAiBC,OACjBF,iBAAiBG,OACjBC,cAGF,QAASA,eACPC,OAAO,yBAAyBC,QAC9BC,UAAYC,GAAM,SAAUC,GAAM,YAEjCJ,OAAO,yBAAyBK,IAAI,OAAOC,QAAQ,KAAM,IAAM,GAChEN,OAAO,yBAAyBK,IAAI,MAAO,GAI/C,QAASE,aAAYC,SAAUC,QAASC,OAAQC,MAC9C,GAAIC,gBAcJ,OAboC,gBAA1BJ,UAASG,KAAKD,WACtBE,aAAeC,OAAOF,KAAKH,SAASG,KAAKD,WAGtCE,aAAaE,QAAQ,UAAW,GAAsC,IAAhCN,SAASG,KAAKD,SAASK,YACzDP,UAASG,KAAKD,UAEb,UAAUI,cAAeN,UAASG,KAAKD,WAAY,IAC3DF,SAASG,KAAKD,SAAWE,aAAaI,OAAOT,YAAaC,SAASG,KAAKD,UACtB,GAA9CG,OAAOF,KAAKH,SAASG,KAAKD,UAAUO,cAC/BT,UAASG,KAAKD,UAGlBF,SAMT,QAASU,eACP,GAAIC,OAAQC,EAAE,mBACdD,OAAME,IAAI,IAGZ,QAASC,0BAAyBC,8BAChC,GAAIC,OAAQJ,EAAE,OAEd,IAAwC,MAArCG,6BAA6BE,MAAsD,GAAtCF,6BAA6BG,MAAe,CAC1FN,EAAE,yBAAyBnB,OAAO,SAAS,QAASsB,6BAA6BE,KAAKE,UAAUC,kBAAoB,KAAQL,6BAA6BE,KAAKE,UAAUE,iCAGxKL,MAAMM,KAAK,qBAAqBC,KAAKR,6BAA6BE,KAAKE,UAAUK,wBAEjF,IAAIC,OAAQT,MAAMM,KAAK,wBACnBI,UAAYV,MAAMM,KAAK,qBACvBK,UAAYX,MAAMM,KAAK,qBACvBM,OAASZ,MAAMM,KAAK,uBACpBO,iBAAmBb,MAAMM,KAAK,gCAC9BQ,iBAAmBd,MAAMM,KAAK,uBAC9BS,OAAShB,6BAA6BE,KAAKE,UAAUa,yBAEzDhB,OAAMM,KAAK,qBAAqBW,KAAK,aAAcF,QACnDG,QAAQC,IAAI,WAAapB,6BAA6BE,KAAKE,UAAUa,2BAErEP,MAAMW,KAAK,IACPrB,6BAA6BE,KAAKoB,SAAS5B,OAAS,GACtDG,EAAEG,6BAA6BE,KAAKoB,UAAUC,KAAK,SAASC,OAC1D3B,EAAE,uBAAuBW,KAAKR,6BAA6BE,KAAKoB,SAAS5B,QACzEgB,MAAMe,OAAO,gBAAgBC,KAAKC,OAAO,qBAAqBD,KAAKE,KAAK,eAO5EjB,UAAUU,KAAK,IACXrB,6BAA6BE,KAAK2B,SAASnC,OAAS,GACtDG,EAAEG,6BAA6BE,KAAK2B,UAAUN,KAAK,SAASC,OAE1Db,UAAUc,OAAO,gBAAgBC,KAAKC,OAAO,qBAAqBD,KAAKE,KAAK,eAOhFhB,UAAUS,KAAK,IACXrB,6BAA6BE,KAAKE,UAAU0B,QAAQpC,OAAS,GAC/DG,EAAEG,6BAA6BE,KAAKE,UAAU0B,SAASP,KAAK,SAASC,OAEnEZ,UAAUa,OAAO,OAAOC,KAAK,WAOjCb,OAAOQ,KAAK,IACmC,MAA3CrB,6BAA6BE,KAAK6B,OAA4D,IAA3C/B,6BAA6BE,KAAK6B,OACvFlB,OAAOY,OAAO,aAAezB,6BAA6BE,KAAK6B,MAAQ,yBAA2B/B,6BAA6BE,KAAKE,UAAUK,wBAA0B,4GAM1K,IAAIuB,UAAW,uBACXC,OAAS,YAEbnB,kBAAiBO,KAAK,GACtB,IAAIa,YAAaF,SAAW,4BAA8BhC,6BAA6BE,KAAKE,UAAU+B,gBAAkBF,MACpHC,aAAcF,SAAW,sBAAwBhC,6BAA6BE,KAAKE,UAAUgC,WAAaH,OAC1GC,YAAcF,SAAW,0BAA4BhC,6BAA6BE,KAAKE,UAAUiC,cAAgBJ,OACjHC,YAAcF,SAAW,gBAAkBhC,6BAA6BE,KAAKE,UAAUkC,KAAOL,OAC9FC,YAAcF,SAAW,qBAAuBhC,6BAA6BE,KAAKE,UAAUmC,UAAYN,OACxGC,YAAcF,SAAW,eAAiBhC,6BAA6BE,KAAKE,UAAUoC,IAAMP,OAEhGnB,iBAAiBW,OAAOS,YAExBnB,iBAAiBM,KAAK,IAClBrB,6BAA6BE,KAAKuC,cAAc/C,OAAS,GAC3DG,EAAEG,6BAA6BE,KAAKuC,eAAelB,KAAK,SAASC,OAE/DT,iBAAiBU,OAAO,OAAOC,KAAK,WAOxC7B,EAAE,yBAAyBnB,OAAO,SAhItC,GAAIgE,iBA0IJ,SAAU7C,GACR,GAAII,OAAQJ,EAAE,QAGV8C,gBAFW9C,EAAE,YAAY+C,OAER,GACjBC,gBAAkB,EAClBC,UAAYjD,EAAE,4BACdkD,UAAYlD,EAAE,+BAOlB8C,gBAAiB,EACM,IAAnBA,gBAA4C,IAApBE,iBAC1BC,UAAUvE,OACVwE,UAAUzE,SAGVwE,UAAUxE,OACVyE,UAAUxE,QASZsB,EAAE,yBACCwB,KAAK2B,OAAOC,SAASC,eAAeC,OACpCzE,QACC0E,MAAO,UACPD,OAAO,EACPE,MAAO,OACPC,OAAQ,IACRC,eAAe,EACf5E,UAAYC,GAAM,WAAYC,GAAM,YACpC2E,YAAa,uBACbC,WAAW,EACXC,UAAU,EACVC,OAAQ,SAASC,MAAOC,MAGxBC,MAAO,SAASF,MAAOC,IACrBlE,cACAE,EAAE,yBAAyBwB,KAAKqB,mBAMtCzC,MAAM8D,GAAG,QAAS,uBAAwB,SAASC,IAEjD,GAAIC,uBAAwBpE,EAAE,qBAAqBqE,WAEnD,IAA6C,KAAzCjE,MAAMM,KAAK,oBAAoBT,MAAc,CAC/CD,EAAEsE,MACAC,IAAK,iCACLC,OAAQ,OACRnE,KAAM+D,sBACNK,WAAYnG,qBAAqB0B,EAAE,mCAAoCA,EAAE,kCACzE0E,SAAU,WACRpG,qBAAqB0B,EAAE,mCAAoCA,EAAE,oCAC7D6C,eAAiBzC,MAAMM,KAAK,yBAAyBc,QAEvDmD,QAASzE,0BAKX,IAAI0E,mBAAoBxE,MAAMM,KAAK,oBAAoBT,KACnDG,OAAMM,KAAK,mBAAmBb,OAAS,IACzCO,MAAMM,KAAK,mBAAmBmE,SAC9BzE,MAAMM,KAAK,oBAAoBoE,WAAW,oBAO5C,IAAIC,oBAAoB,CACxB,IAAKA,kBASA,CACO/E,EAAE,uBAAuBgF,KACjCC,UAAW,KACXC,UAAW,wBACXC,UAAa,SAASC,EAAGC,QAASC,SAAUC,QAC1C,MAAOD,UAAS,GAAGE,QAAQC,gBAM/B9G,mBApBsB,CACtB2B,OAAQ,CACR,IAAIoF,eAAgB,yEAA2Ed,kBAAoB,0CACnH5E,GAAE0F,eAAeC,aAAa,0BAC9BvF,MAAMM,KAAK,oBAAoBW,KAAK,mBAAoB,sBAyB9DrB,EAAE,6BAA6BkE,GAAG,QAAS,SAASC,IAClDA,GAAGyB,gBACH,IAAIC,mBAAoB7F,EAAE6B,MAAMxB,KAAK,gBACrCyF,OAAM,2BAA6BD,mBACnCvE,QAAQC,IAAI,uBAAyBsE,qBAWvC7F,EAAE,yBAAyBkE,GAAG,cAAe,WAC3C,GAAI6B,mBAAoB/F,EAAE,mCACtBgG,cAAgBhG,EAAE,gCAEtB1B,sBAAqByH,kBAAmBC,eACxCrH,iBAGDC","file":"chemical_rules.js","sourcesContent":["var originalDialog;\n\nfunction showElementOutOfMany($wrapper_to_show, $common_selector) {\n  $common_selector.hide();\n  $wrapper_to_show.show();\n  resizeModal()\n}\n\nfunction resizeModal() {\n  jQuery('#chemical-rules-modal').dialog({\n    position: { 'my': 'center', 'at': 'center' }\n  });\n  if(jQuery('.chemical-rules-modal').css('top').replace('px', '') < 1){\n    jQuery('.chemical-rules-modal').css('top', 0)\n  }\n}\n\nfunction checkValues(previous, current, cIndex, keys) {\n  var previousKeys = [];\n  if(typeof previous[keys[cIndex]] == 'object'){\n    previousKeys = Object.keys(previous[keys[cIndex]])\n  }\n\n  if ((previousKeys.indexOf('Value') > -1 && previous[keys[cIndex]].Value == \"\")) {\n    delete previous[keys[cIndex]];\n  }\n  else if (['object'].indexOf(typeof previous[keys[cIndex]]) > -1) {\n    previous[keys[cIndex]] = previousKeys.reduce(checkValues, previous[keys[cIndex]])\n    if (Object.keys(previous[keys[cIndex]]).length == 0) {\n      delete previous[keys[cIndex]];\n    }\n  }\n  return previous\n}\n\n/**\n * Clear form inputs and hide warning messages\n */\nfunction resetCRForm() {\n  var $form = $('#cr-search_input');\n  $form.val('');\n}\n\nfunction populate_substance_modal(chemical_rules_response_json) {\n  var $body = $('body');\n\n  if(chemical_rules_response_json.data != null && chemical_rules_response_json.error == false){\n    $('#chemical-rules-modal').dialog('option','title', chemical_rules_response_json.data.Substance.CASRegistryNumber + ': ' +  chemical_rules_response_json.data.Substance.ChemicalSubstanceSystematicName);\n    \n    // popluate our modal\n    $body.find('.cr-chemical-name').text(chemical_rules_response_json.data.Substance.EPAChemicalRegistryName);\n\n    var $list = $body.find('.cr-rules-regs_lists');\n    var $programs = $body.find('#cr-programs-list');\n    var $synonyms = $body.find('#cr-synonyms-list');\n    var $image = $body.find('.cr-structure_image');\n    var $propertiestable = $body.find('#cr-properties-table > tbody');\n    var $substance_lists = $body.find('#cr-substances-list');\n    var srs_id = chemical_rules_response_json.data.Substance.EPAChemicalInternalNumber;\n    \n    $body.find('#cr-save-chemical').attr('data-srsid', srs_id);\n    console.log('srs id: ' + chemical_rules_response_json.data.Substance.EPAChemicalInternalNumber);\n    \n    $list.html('');\n    if (chemical_rules_response_json.data.LawsRegs.length > 0) {\n      $(chemical_rules_response_json.data.LawsRegs).each(function(index){\n        $('.cr-laws-regs_count').text(chemical_rules_response_json.data.LawsRegs.length);\n        $list.append('<li><a href=\"'+this.source+'\" target=\"_blank\">'+this.name+'</a></li>');\n      });\n    }\n    else {\n      // No laws regulations found\n    }\n    \n    $programs.html('');\n    if (chemical_rules_response_json.data.Programs.length > 0) {\n      $(chemical_rules_response_json.data.Programs).each(function(index){\n        //$('#cr-programs-count').text(chemical_rules_response_json.data.Programs.length);        \n        $programs.append('<li><a href=\"'+this.source+'\" target=\"_blank\">'+this.name+'</a></li>');\n      });\n    }\n    else {\n      // No programs found   \n    }\n    \n    $synonyms.html('');\n    if (chemical_rules_response_json.data.Substance.Synonym.length > 0) {\n      $(chemical_rules_response_json.data.Substance.Synonym).each(function(index) {\n        //$('#cr-synonyms-count').text(chemical_rules_response_json.data.Substance.Synonym.length);\n        $synonyms.append('<li>'+this+'</li>');\n      });\n    }\n    else {\n      // No synonyms found\n    }\n    \n    $image.html('');\n    if (chemical_rules_response_json.data.Image != null && chemical_rules_response_json.data.Image != '') {\n      $image.append('<img src=\"' + chemical_rules_response_json.data.Image + '\" alt=\"A structure of ' + chemical_rules_response_json.data.Substance.EPAChemicalRegistryName + '\"><p>Powered by <a href=\"https://pubchem.ncbi.nlm.nih.gov\" rel=\"external\" target=\"_blank\">PubChem</a></p>');\n    }\n    else {\n      // No synonyms found\n    }\n    \n    var tr_start = '<tr><th scope=\"row\">',\n        tr_end = '</td></tr>';\n\n    $propertiestable.html('');\n    var properties = tr_start + \"Molecular Weight</th><td>\" + chemical_rules_response_json.data.Substance.MolecularWeight + tr_end;\n        properties += tr_start + \"Solubility</th><td>\" + chemical_rules_response_json.data.Substance.Solubility + tr_end;\n        properties += tr_start + \"Vapor Pressure</th><td>\" + chemical_rules_response_json.data.Substance.VaporPressure + tr_end;\n        properties += tr_start + \"LogP</th><td>\" + chemical_rules_response_json.data.Substance.LogP + tr_end;\n        properties += tr_start + \"Stability</th><td>\" + chemical_rules_response_json.data.Substance.Stability + tr_end;\n        properties += tr_start + \"pKA</th><td>\" + chemical_rules_response_json.data.Substance.pKA + tr_end;\n             \n    $propertiestable.append(properties);\n    \n    $substance_lists.html('');\n    if (chemical_rules_response_json.data.SubstanceList.length > 0) {\n      $(chemical_rules_response_json.data.SubstanceList).each(function(index) {\n        //$('#cr-synonyms-count').text(chemical_rules_response_json.data.Substance.Synonym.length);\n        $substance_lists.append('<li>'+this+'</li>');\n      });\n    }\n    else {\n      // No synonyms found\n    }\n    \n    $('#chemical-rules-modal').dialog(\"open\")\n  }\n  else {\n    //@todo Add error msg for then there is bad data\n  }\n\n\n\n}\n\n(function($) {\n  var $body = $('body'),\n      $cr_tabs = $('#cr-tabs').tabs(),\n      sampleSetIndex = 0,\n      num_chem_faves = 0,\n      num_rules_faves = 0,\n      $cr_empty = $('.cr-tabs_favorites_empty'),\n      $cr_avail = $('.cr-tabs_favorites_available');\n  \n  //@TODO Add logic to count number of Chemical Favorites and Law / Rule Favorites\n  //num_chem_faves = ...;\n  //num_rules_faves = ...;\n  \n  // If no favorites exist, show Search tab\n  num_chem_faves = 1;\n  if (num_chem_faves === 0 && num_rules_faves === 0) {\n    $cr_empty.show();\n    $cr_avail.hide();\n  }\n  else {\n    $cr_empty.hide();\n    $cr_avail.show();\n    //@TODO Print Favorite Chemicals\n    //\n    //@TODO Print Favorite Laws/Regs    \n    //count\n    //ul\n  }\n\n  // Initialize and open dialog\n  $('#chemical-rules-modal')\n    .html(Drupal.settings.chemical_rules.modal)\n    .dialog({\n      title: 'Results',\n      modal: true,\n      width: \"auto\",\n      height: 400,\n      closeOnEscape: true,\n      position: { 'my': 'left top', 'at': 'left top' },\n      dialogClass: 'chemical-rules-modal',\n      draggable: false,\n      autoOpen: false,\n      create: function(event, ui) {\n\n      },\n      close: function(event, ui) {\n        resetCRForm();\n        $('#chemical-rules-modal').html(originalDialog);\n        //$('#chemical-rules-loading-wrapper').hide();\n        //$(this).dialog('destroy');\n      }\n    });\n\n  $body.on('click', '#cr-search-chems-btn', function(ev) {\n\n    var chem_search_form_data = $('#chem_search_form').serialize();\n    \n    if ($body.find('#cr-search_input').val() !== '') {\n      $.ajax({\n        url: 'chemical_rules/form_submission',\n        method: 'POST',\n        data: chem_search_form_data,\n        beforeSend: showElementOutOfMany($('#chemical-rules-loading-wrapper'), $('.chemical-rules-modal-wrapper')),\n        complete: function() {\n          showElementOutOfMany($('#chemical-rules-results-wrapper'), $('#chemical-rules-loading-wrapper'));\n          originalDialog = $body.find('#chemical-rules-modal').html();\n        },\n        success: populate_substance_modal\n      })\n  \n      //ev.preventDefault();\n      //ev.stopPropagation();\n      var chemicalNameOrNum = $body.find('#cr-search_input').val();\n      if ($body.find('#chemical-error').length > 0) {\n        $body.find('#chemical-error').remove();\n        $body.find('#cr-search_input').removeAttr('aria-describedby');\n      }\n    \n      //@TODO - Samuel's logic to handle chemical regex and lookup\n      \n      //////\n      \n      var is_valid_chemical = true;\n      if (!is_valid_chemical) {\n        error = true;\n        var error_message = '<p class=\"has-error\" id=\"chemical-error\">No results were found for <b>' + chemicalNameOrNum + '</b>.  Please try another variation.</p>';\n        $(error_message).insertBefore('#cr-search_description');\n        $body.find('#cr-search_input').attr('aria-describedby', 'chemical-error');\n      }  \n      \n      // Simulate the loading results block switching to results block\n      // @TODO - Change this once Ajax / JSON success call returned - \n      else {\n        var toc = $(\"#cr-modal-toc-icons\").toc({ \n          selectors: \"h2\",\n          container: \"#chemical-rules-modal\",\n          'itemClass': function(i, heading, $heading, prefix) { // custom function for item class\n            return $heading[0].tagName.toLowerCase();\n          } \n        });\n        // POST input field value to lookup service\n        // Render out \n  \n        resizeModal();\n      }\n    } \n    else {\n      // @TODO Error message - please enter value;\n    }\n    \n  });   \n  \n  $('.favorite-chemical-remove').on('click', function(ev) {\n    ev.preventDefault();\n    var clickedFavoriteID = $(this).data(\"epachemintnum\");\n    alert(\"clicked favorite id is: \" + clickedFavoriteID);    \n    console.log(\"clickedFavorite is: \" + clickedFavoriteID);\n    \n    //@TODO - Add Logic to find favorite chemical by SRS ID in Drupal and then remove from user's favorites\n     \n  }); \n\n  /**\n   * Close Listener on Chemical Rules Modal\n   * -  Remove Previous Results ?\n   * -  Cancel Pending Form submission\n   */\n  $('#chemical-rules-modal').on('dialogclose', function() {\n    var $chemical_loading = $('#chemical-rules-loading-wrapper');\n    var $all_wrappers = $('.chemical-rules-modal-wrapper');\n\n    showElementOutOfMany($chemical_loading, $all_wrappers);\n    resizeModal();\n  });\n\n})(jQuery);\n"]}