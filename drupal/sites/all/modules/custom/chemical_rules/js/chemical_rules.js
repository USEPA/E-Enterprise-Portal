function repair_chemical_rules_profile(){}function cr_showElementOutOfMany(a,b){b.hide(),a.show(),cr_resizeModal()}function cr_resizeModal(){jQuery("#chemical-rules-modal").dialog({position:{my:"center",at:"center"},width:$(window).width()-180,height:$(window).height()-180}),jQuery(".chemical-rules-modal").css("top").replace("px","")<1&&jQuery(".chemical-rules-modal").css("top",0),jQuery(".sticky-toc").length>0&&jQuery("#cr-modal-toc-icons").css("width",jQuery("#chemical-rules-modal").width()+6)}function create_favlaw_heart(a){var b=Drupal.settings.chemical_rules.profile?Drupal.settings.chemical_rules.profile:{Chemicals:[],Laws:[],NAICS:[]},c=Object.keys(b.Laws).length>0&&find_matching_favorites(a,"Laws"),d="";return d=c===!1?'<a href="javascript:void(0);" class="fa fa-heart empty save-favorite" data-epaintnum="'+a+'" data-favtype="Law"><span class="sr-only">Click to favorite.</span></a>':'<a href="javascript:void(0);" class="fa fa-heart filled remove-link remove-favorite" data-epaintnum="'+a+'" data-favtype="Law"><span class="sr-only">Favorited. Click to unfavorite.</span></a>'}function find_matching_favorites(a,b){for(var c=!1,d=Drupal.settings.chemical_rules.profile?Drupal.settings.chemical_rules.profile:{Chemicals:[],Laws:[],NAICS:[]},e=d[b]?d[b].length:0,f=0;f<e;f++)if(favID=d[b][f].ID,favID==a)return c=!0,f;if(0==c)return!1}function is_valid_cas_number(a){var b=/(\d{2,7}).{0,2}(\d{2}).{0,2}(\d)/g,c=b.exec(a);if(c){var d=(c[1]+c[2]).split("").reduce(function(a,b,c,d){return(a+d[d.length-c-1]*(c+1))%10},0);return d==c[3]}return!1}function lookup_chemical(a){var b=$("body");b.find("#cr-search_input").val(a),b.find("#cr-search-chems-btn").trigger("click")}function populate_substance_modal(a){var b=$("body"),c=a,d="n/a";if(null!==c.data&&c.error===!1){b.find("#search-message").length>0&&(b.find("#cr-search_input").prop("aria-describedby",!1),b.find("#search-message").remove()),""!==c.data.Substance.CASRegistryNumber&&null!==c.data.Substance.CASRegistryNumber&&(d=c.data.Substance.CASRegistryNumber+": "),b.find(".cr-chemical-name").text(c.data.Substance.ChemicalSubstanceSystematicName);var e=b.find("#cr-laws-regs-substances"),f=(b.find("#cr-programs-list"),b.find("#cr-synonyms-list")),g=b.find(".cr-structure_image"),h=b.find("#cr-properties-table > tbody"),i=b.find("#cr-substances-list"),j=[],k=[],l=Object.keys(favs.Chemicals).length>0&&find_matching_favorites(c.data.Substance.EPAChemicalInternalNumber,"Chemicals");b.find("#cr-save-favorite").attr("data-epaintnum",c.data.Substance.EPAChemicalInternalNumber).attr("data-sysname",c.data.Substance.ChemicalSubstanceSystematicName),b.find("#metadata-sys-name").text(c.data.Substance.ChemicalSubstanceSystematicName),null!==c.data.Substance.EPAChemicalRegistryName?(b.find("#cr-save-favorite").attr("data-commonname",c.data.Substance.EPAChemicalRegistryName),b.find("#metadata-common-name").text(c.data.Substance.EPAChemicalRegistryName)):(b.find("#cr-save-favorite").attr("data-commonname",!1),b.find("#metadata-common-name").text("n/a")),null!==c.data.Substance.CASRegistryNumber?(b.find("#cr-save-favorite").attr("data-casnum",c.data.Substance.CASRegistryNumber),b.find("#metadata-cas-num").text(c.data.Substance.CASRegistryNumber)):(b.find("#cr-save-favorite").attr("data-casnum",!1),b.find("#metadata-cas-num").text("n/a")),b.find("#cr-remove-favorite").attr("data-epaintnum",c.data.Substance.EPAChemicalInternalNumber).attr("data-favtype","Chemical"),l===!1?(b.find("#cr-save-favorite").parent("li").show(),b.find("#cr-remove-favorite").parent("li").hide()):(b.find("#cr-save-favorite").parent("li").hide(),b.find("#cr-remove-favorite").parent("li").show()),e.html("");var m="";if(c.data.SubstanceList&&Object.keys(c.data.SubstanceList).length&&c.data.LawsRegs&&Object.keys(c.data.LawsRegs).length){j.push('<ul class="cr-lists">');for(var n in c.data.LawsRegs)m=c.data.LawsRegs[n].cfrId,fav_holder=create_favlaw_heart(m),j.push('<li><span class="law-entry"><a data-favtype="Law" data-epaintnum="'+m+'" href="'+c.data.LawsRegs[n].attributes.URL+'" target="_blank">'+c.data.LawsRegs[n].attributes.Citation+" &mdash; "+c.data.LawsRegs[n].attributes.Title+"</a>"+fav_holder+"</span>"),j.push('<span class="law-citation">Authority: '+c.data.LawsRegs[n].attributes["CFR Authority"]+"</span>"),j.push('<span class="law-lists">Substance Lists: '+c.data.LawsRegs[n].substanceList+"</span></li>");j.push("</ul>"),e.append(j.join("")),b.find("#count-all-cfrs").text(Object.keys(c.data.LawsRegs).length),b.find("#results-intro").text("  Relevant laws and regulations include:")}else b.find("#count-all-cfrs").text("No"),b.find("#results-intro").text("");var o=[];f.html(""),c.data.Substance.Synonym.length>0&&($(c.data.Substance.Synonym).each(function(a){o.push("<li>"+this+"</li>")}),f.append(o.sort())),g.html(""),null!=c.data.Image&&""!=c.data.Image?g.append('<img src="'+c.data.Image+'" alt="A structure of '+c.data.Substance.EPAChemicalRegistryName+'"><p>Powered by <a href="https://pubchem.ncbi.nlm.nih.gov" rel="external" target="_blank">PubChem</a></p>'):g.append("No image available for this substance.");var p='<tr><th scope="row">',q="</td></tr>";h.html("");var r=p+"Molecular Weight <span class='cr-definition'></span></th><td>"+c.data.Substance.MolecularWeight+q;r+=p+"Solubility <span class='cr-definition'>The solubility of a substance is the amount of that substance that will dissolve in a given amount of solvent. The default solvent is water, if not indicated.</span></th><td>"+c.data.Substance.Solubility+q,r+=p+"Vapor Pressure <span class='cr-definition'>Vapor pressure is the pressure of a vapor in thermodynamic equilibrium with its condensed phases in a closed system.</span></th><td>"+c.data.Substance.VaporPressure+q,r+=p+"LogP <span class='cr-definition'>Octanol/Water Partition Coefficient, used as a measure of molecular lipophilicity</span></th><td>"+c.data.Substance.LogP+q,r+=p+"Stability <span class='cr-definition'>Tendency of a material to resist change or decomposition due to internal reaction, or due to the action of air, heat, light, pressure, etc. (See also Stability and Reactivity section under Safety and Hazards)</span></th><td>"+c.data.Substance.Stability+q,r+=p+"pKA <span class='cr-definition'></span></th><td>"+c.data.Substance.pKA+q,h.append(r),i.html(""),Object.keys(c.data.SubstanceList).length>0?($(Object.keys(c.data.SubstanceList)).each(function(a){c.data.SubstanceList[this];k.push("<li>"+this+"</li>")}),i.append(k.sort())):i.html("<p>No substance lists found for this chemical.</p>"),b.addClass("fixed-modal-open")}else $("#chemical-rules-modal").dialog("close"),!b.find("#search-message").length>0&&(b.find("#cr-search_description").before('<div id="search-message" class="has-error">No chemicals found.  Please try a different name or CAS #.</div>'),b.find("#cr-search_input").prop("aria-describedby","search-message"))}function render_favorite_chemicals(a){var b=$("body"),c=a.Chemicals?a.Chemicals.length:0;if(c){var d=[];b.find("#cr-count-chemicals").text(c),$.each(a.Chemicals,function(a,b){var c="";if(null!=b.CAS&&""!=b.CAS){c=b.CAS;var e=" data-casnum='"+c+"' ";c+=": "}else e="";var f="";null!=b.CommonName&&""!=b.CommonName&&(f=" ("+b.CommonName+")"),d.push('<li><a class="favorite-chemical cr-favorite" href="javascript:void(0);" data-favtype="Chemical" data-sysname="'+b.SysName+'" data-epaintnum="'+b.ID+'" '+e+'data-commonname="'+b.CommonName+'">'+c+b.SysName+f+'</a><a class="favorite-chemical-remove remove-link" data-favtype="Chemical" data-epaintnum="'+b.ID+'" data-commonname="'+b.CommonName+'">Remove<span class="sr-only"> '+b.SysName+" from favorites</span></a></li>")}),b.find(".cr-chemicals").show(),b.find(".cr-favorite-chemicals").html(d).show()}else b.find(".cr-chemicals").hide(),b.find(".cr-favorite-chemicals").html("").hide()}function render_naics_codes(a){var b=$("body"),c=a.NAICS?a.NAICS.length:0;if(c){var d=[];$.each(a.NAICS,function(a,b){d.push('<li><a class="favorite-code cr-favorite" href="'+b.URL+'" data-favtype="Code" target="_blank">'+b.ID+"</a></li>")}),b.find(".cr-codes").show(),b.find(".cr-naics-codes").html(d).show()}else b.find(".cr-codes").hide(),b.find(".cr-naics-codes").html("").hide()}function render_favorite_laws(a){var b=$("body"),c=a.Laws?a.Laws.length:0;if(c){var d=[];b.find("#cr-count-laws").text(c),$.each(a.Laws,function(a,b){d.push('<li><a class="favorite-law cr-favorite" href="'+b.URL+'" data-favtype="Law" data-epaintnum="'+b.ID+'" target="_blank">'+b.Citation+":  "+b.Title+'</a><a class="favorite-law-remove remove-link" data-favtype="Law" data-epaintnum="'+b.ID+'">Remove<span class="sr-only"> '+b.Title+" from favorites</span></a></li>")}),b.find(".cr-laws").show(),b.find(".cr-favorite-laws").html(d).show()}else b.find(".cr-laws").hide(),b.find(".cr-favorite-laws").html("").hide()}function reset_cr_form(){var a=$("#cr-search_input");a.val("")}function trigger_law_qTip(a,b){try{if(1==b)return $(a).trigger("mouseover"),findQtip="#"+$(a).attr("aria-describedby"),findQtip;$(a).trigger("mouseout")}catch(a){}}function update_clicked_heart(a,b){b===!0?(a.removeClass("empty save-favorite"),a.addClass("filled remove-favorite remove-link")):b===!1&&(a.addClass("empty save-favorite"),a.removeClass("filled remove-favorite remove-link"))}function update_favorite_lists(a){"Chemical"==a?render_favorite_chemicals(Drupal.settings.chemical_rules.profile):"Law"==a?render_favorite_laws(Drupal.settings.chemical_rules.profile):render_naics_codes(Drupal.settings.chemical_rules.profile)}function isValidCasNumber(a){var b=/(\d{2,7}).{0,2}(\d{2}).{0,2}(\d)/g,c=b.exec(a);if(c){var d=(c[1]+c[2]).split("").reduce(function(a,b,c,d){return(a+d[d.length-c-1]*(c+1))%10},0);return d==c[3]}return console.log("invalid string"),!1}var originalDialog,favs=Drupal.settings.chemical_rules.profile?Drupal.settings.chemical_rules.profile:{Chemicals:[],Laws:[],NAICS:[]};!function(a){var b=a("body"),c=(a("#cr-tabs").tabs(),0),d=0;a("#chem_search_form").on("submit",function(){return a("#cr-search-chems-btn").trigger("click"),!1});var e=function(b){c=b.Chemicals?b.Chemicals.length:0,d=b.Laws?b.Laws.length:0,$cr_empty=a(".cr-tabs_favorites_empty"),$cr_avail=a(".cr-tabs_favorites_available"),0===c&&0===d?($cr_empty.show(),$cr_avail.hide()):($cr_empty.hide(),$cr_avail.show(),render_favorite_chemicals(b),render_favorite_laws(b))};e(favs),a("#chemical-rules-modal").html(Drupal.settings.chemical_rules.modal).dialog({title:"Results",modal:!0,width:a(window).width()-180,height:a(window).width()-180,closeOnEscape:!0,position:{my:"left top",at:"left top"},dialogClass:"chemical-rules-modal",draggable:!1,autoOpen:!1,resizable:!1,create:function(b,c){a(window).resize(function(){cr_resizeModal()})},open:function(b,c){a("#chemical-rules-modal").parent().css("position","fixed")},close:function(c,d){reset_cr_form(),a("#chemical-rules-modal").html(originalDialog),b.removeClass("fixed-modal-open")}}),b.on("click","#cr-search-chems-btn",function(c){var d=a("#chem_search_form").serialize(),e=b.find("#cr-search_input").val();if(c.preventDefault(),c.stopPropagation(),""!==e){var f=!0;a.ajax({url:"chemical_rules/form_submission",method:"POST",data:d,beforeSend:function(){a("#chemical-rules-modal").dialog("option","title","Searching for "+e),b.find("#searching-chemical-name").text(e),a("#chemical-rules-modal").dialog("open"),cr_showElementOutOfMany(a("#chemical-rules-loading-wrapper"),a(".chemical-rules-modal-wrapper"))},complete:function(){a("#chemical-rules-modal").dialog("option","title","Search results for "+e),cr_showElementOutOfMany(a("#chemical-rules-results-wrapper"),a("#chemical-rules-loading-wrapper")),originalDialog=b.find("#chemical-rules-modal").html()},success:populate_substance_modal});var g=b.find("#cr-search_input").val();if(b.find("#chemical-error").length>0&&(b.find("#chemical-error").remove(),b.find("#cr-search_input").removeAttr("aria-describedby")),!f){error=!0;var h='<p class="has-error" id="chemical-error">No results were found for <b>'+g+"</b>.  Please try another variation.</p>";a(h).insertBefore("#cr-search_description"),b.find("#cr-search_input").attr("aria-describedby","chemical-error")}cr_resizeModal()}}),b.find(".favorite-chemical").length>0&&b.on("click",".favorite-chemical",function(c){var d=a(this).attr("data-casnum");lookup_chemical("undefined"!=typeof d&&d!==!1?a(this).attr("data-casnum"):a(this).attr("data-sysname")),a("#chemical-rules-modal").dialog("open"),a("#searching-chemical-name").text(a(this).text()),a("#chemical-rules-modal").dialog("option","title",a(this).text()),b.addClass("fixed-modal-open")}),b.find(".remove-link").length>0&&b.on("click",".remove-link",function(c){c.preventDefault();var d=a(this).data("epaintnum"),f=a(this).data("favtype")+"s",g=Drupal.settings.chemical_rules.profile[f].reduce(function(a,b,c,e){return b.ID!=d?a.push(b):a,a},[]);Drupal.settings.chemical_rules.profile[f]=g?g:[],"cr-remove-favorite"==a(this).attr("id")?(b.find("#cr-save-favorite").parent("li").show(),b.find("#cr-remove-favorite").parent("li").hide()):a(this).hasClass("fa-heart")&&update_clicked_heart(a(this),!1),e(Drupal.settings.chemical_rules.profile),update_chem_profile(Drupal.settings.chemical_rules.profile)}),b.find(".save-favorite").length>0&&b.on("click",".save-favorite",function(c){var d=a(this).data("favtype")+"s",f=[];if("Chemicals"==d){if(""!==a(this).data("casnum")&&null!==a(this).data("casnum"))var g=a(this).data("casnum");else var g="";if(""!==a(this).data("commonname")&&null!==a(this).data("commonname")){a(this).data("commonname")}else;f={ID:a(this).data("epaintnum"),CAS:g,SysName:a(this).data("sysname"),CommonName:a(this).data("commonname")},"cr-save-favorite"==a(this).attr("id")&&(b.find("#cr-save-favorite").parent("li").hide(),b.find("#cr-remove-favorite").parent("li").show())}else if("Laws"==d){var h=a(this).prev("a").text(),i=h.split("—"),j=i[0].trim(),k=i[1].trim();f={ID:a(this).data("epaintnum"),Citation:j,Title:k,URL:a(this).prev("a").attr("href")},update_clicked_heart(a(this),!0)}""!=f&&(Drupal.settings.chemical_rules.profile||(Drupal.settings.chemical_rules.profile={Chemicals:[],Laws:[]},update_chem_profile(Drupal.settings.chemical_rules.profile)),void 0===Drupal.settings.chemical_rules.profile[d]&&(Drupal.settings.chemical_rules.profile[d]=[],update_chem_profile(Drupal.settings.chemical_rules.profile)),Drupal.settings.chemical_rules.profile[d].push(f),update_chem_profile(Drupal.settings.chemical_rules.profile),e(Drupal.settings.chemical_rules.profile))}),update_chem_profile=function(b){a.ajax({method:"POST",url:Drupal.settings.basePath+"chemical_rules/update_chem_profile",dataType:"json",data:{profile:JSON.stringify(b)}}).done(function(){console.log("done",arguments),e(Drupal.settings.chemical_rules.profile)}).fail(function(){console.log("fail",arguments)})},a("#chemical-rules-modal").on("dialogclose",function(){var b=a("#chemical-rules-loading-wrapper"),c=a(".chemical-rules-modal-wrapper");cr_showElementOutOfMany(b,c),cr_resizeModal()});var f=a("#cr-modal-toc-icons").offset().top;a("#chemical-rules-modal").scroll(function(){a("#chemical-rules-modal").scrollTop()>f?(a("#cr-modal-toc-icons").addClass("sticky-toc"),a("#cr-modal-toc-icons").css("width",a("#chemical-rules-modal").width()+6).css("top",a("#chemical-rules-modal").offset().top)):a("#cr-modal-toc-icons").removeClass("sticky-toc").removeAttr("style")});var f=a("#cr-modal-toc-icons").offset().top;a("#cr-modal-toc-icons li a").on("click",function(b){b.preventDefault(),a("#cr-modal-toc-icons").hasClass("sticky-toc")||(a("#cr-modal-toc-icons").addClass("sticky-toc"),a("#cr-modal-toc-icons").css("width",a("#chemical-rules-modal").width()).css("top",a("#chemical-rules-modal").offset().top));var c=a("#cr-laws-regs").offset().top,d=a(this.hash).offset().top,e=d-c;a("#chemical-rules-modal").animate({scrollTop:e},500)})}(jQuery);
//# sourceMappingURL=src/chemical_rules.js.map