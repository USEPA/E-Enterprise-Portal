!function(a){"use strict";function b(b){b?(a(".masthead").attr("aria-hidden","true"),a(".region-navigation").attr("aria-hidden","true"),a(".main-content").attr("aria-hidden","true"),a("#footer").attr("aria-hidden","true")):(a(".masthead").removeAttr("aria-hidden"),a(".region-navigation").removeAttr("aria-hidden"),a(".main-content").removeAttr("aria-hidden"),a("#footer").removeAttr("aria-hidden"))}function c(){var b=L.map("my-air-quality-air-now-map-container");b.on("load",function(a){}),b.setView([32.505,-96.09],13),a("a",b.getContainer()).addClass("favorites-ignore"),L.esri.basemapLayer("Gray").addTo(b);L.esri.dynamicMapLayer({url:"https://gispub.epa.gov/arcgis/rest/services/OAR_OAQPS/AirNowNationalAQI/MapServer",opacity:.3,position:"back"}).addTo(b);j=L.esri.dynamicMapLayer({url:"https://gispub.epa.gov/arcgis/rest/services/OEI/FRS_AQSTemp/MapServer",opacity:1,position:"front"}),b.addLayer(j),j.bindPopup(function(a,b){return!a&&0!==b.features.length&&"Querying Current Air Quality - Please Wait."});var c=L.esri.dynamicMapLayer({url:"https://gispub.epa.gov/arcgis/rest/services/ORD/ROE_StateBoundaries/MapServer",opacity:.9,position:"front"}).addTo(b);b.fitBounds(c._map.getBounds());var d=new Date,e=d.getDate(),f=d.getMonth()+1,g=d.getFullYear();e<10&&(e="0"+e),f<10&&(f="0"+f);var h=g+"-"+f+"-"+e;return b.on("click",function(c){b.getZoom()>9&&j.identify().on(b).at(c.latlng).run(function(d,e){if(e.features.length>0){var f=e.features[0].properties.LONGITUDE83,g=e.features[0].properties.LATITUDE83,i=e.features[0].properties.CITY_NAME,j=e.features[0].properties.STATE_CODE;a.ajax({type:"GET",url:Drupal.settings.basePath+"my_air_quality_map_view/api/current/latLong/",async:!0,data:{format:"application/json",latitude:g,longitude:f,date:h,distance:"50"},success:function(d,e,f){var g=JSON.parse(d);"NOT IN A CITY"==i&&(i="RURAL AREA");for(var h=i+", "+j+"</br>Current Air Quality<table><tbody><tr><td><b>Parameter</b></td><td><b>Category</b></td></tr>",k=0;k<g.length;k++){var l=g[k].ParameterName,m=g[k].Category.Name,n="<tr><td>"+l+"</td><td>"+m+"</td></tr>";h+=n}h+="</tbody></table>";L.popup().setLatLng(c.latlng).setContent(h).openOn(b);a("html, body").css("cursor","auto")}}).fail(function(b,c){if("error"==c)return a("html, body").css("cursor","auto"),console.log("Error in AirNow API request."),"Sorry but there was an error: "+b.status+" "+b.statusText})}else a("html, body").css("cursor","auto")})}),a("#my-air-quality-air-now-map-container .leaflet-bottom .leaflet-control-attribution a").addClass("favorites-ignore"),b}function d(){if(h&&h.latitude&&h.longitude){f.invalidateSize();var a=[h.latitude,h.longitude],b=L.marker(a).addTo(g);b.bindPopup("<b>"+h.string+"</b>"+(i?"<br/>Today's Air Quality: "+i:""),{minWidth:150,maxWidth:500,className:"favorites-ignore"}),f.setView(new L.LatLng(Number(h.latitude),Number(h.longitude)),14),b.openPopup()}}function e(a,b){var c=""+(a.getMonth()+1),d=""+a.getDate(),e=a.getFullYear();return c.length<2&&(c="0"+c),d.length<2&&(d="0"+d),[e,c,d].join(b)}var f,g,h,i,j,k,l,m,n,o="",p=!1;a(document).ready(function(){function e(c,d,e){a("body").addClass("modal-open"),0===a(c).text().length?(a(c).html(e),a(c).dialog({title:d,width:500,modal:!0,maxHeight:300,close:function(){b(!1),a("body").removeClass("modal-open"),a(c).dialog("destroy"),a(c).text("")}})):a(c).dialog("open"),b(!0),a(".ui-dialog").focus()}var i=a("#first-time-user-block");i.length>0&&(p=!0),a(document).on("ee:first_time_user_complete",function(){p=!1});var j=a("#my-air-quality-chart-tabs");f=c(),j.tabs({activate:function(a,b){"my-air-quality-air-now-maps"==b.newPanel[0].id&&d()}}),a("#my-air-quality-chart-tabs").find(".ui-corner-top").on("click",function(b){a(this).focus()}),a(document).on("ee:zipCodeQueried",function(a,b){p||(h=b,s(h.zip,h.string),g?(f.removeLayer(g),g=new L.FeatureGroup,f.addLayer(g),d()):(g=new L.FeatureGroup,f.addLayer(g)))}),a("#sr-aqi-data-toggle").on("click",function(a){a.stopPropagation(),m="#sr-aqi-data",n="Air Quality Index Chart",e(m,n,o)}),a("#aqi-explained-toggle").on("click",function(a){a.stopPropagation(),m="#aqi-explained",n="Air Quality Index Explained",e(m,n,l)})});var q=function(b,c){function d(a){return a=a.split("-"),new Date(a[0],parseInt(a[1])-1,a[2])}function e(a,b){var c=864e5,d=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),e=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((e-d)/c)}function f(a){for(var b=0;b<H.length-1;b++)if(a>=H[b]&&a<H[b+1])return b;return H.length-2}function g(a){for(var b=0;b<I.length-1;b++)if(a>=H[b]&&a<H[b+1])return"<abbr class='ee-bootstrap-tooltip' title='"+D[b].body+"'>"+D[b].header+"</abbr>";return"No AQI is available"}function h(a,b){j(a,f(b))}function j(b,c){var d=d3.select(".popover"),e=a(d.node()),f=b.getBoundingClientRect(),g=D[c];d.html('<div class="arrow"></div><h3 class="popover-title">'+g.header+'</h3><div class="popover-content">'+g.body+"</div>"),d.style({left:f.left+b.clientWidth+40+"px",top:f.top-50+"px"}),e.show()}function m(){a(".popover").hide()}function n(a){var b=d3.select(this),c=b.text().split("/");b.text("");for(var d=0,e=0;d<c.length;d++)if(c[d]){var f=b.append("tspan").text(c[d]);e>0&&f.attr("x",0).attr("dy","18"),e++}else b.attr("y",27)}function p(a){return a<200?a:a<300?.5*(a-200)+200:.25*(a-300)+250}function q(a){return V(d(a.DateForecast))}function s(a){return W(a.visualAQI)}r("");var t,u,v,w,x,y,z,A,B,C,D=[{header:"Good",body:"Air quality is considered satisfactory, and air pollution poses little or no risk. ",cssClass:"section-good"},{header:"Moderate",body:"Air quality is acceptable; however, for some pollutants there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution. ",cssClass:"section-moderate"},{header:"Unhealthy for sensitive groups",body:"Members of sensitive groups may experience health effects. The general public is not likely to be affected. ",cssClass:"section-unhealthy-for-sensitive"},{header:"Unhealthy",body:"Everyone may begin to experience health effects; members of sensitive groups may experience more serious health effects. ",cssClass:"section-unhealthy"},{header:"Very unhealthy",body:"Health warnings of emergency conditions. The entire population is more likely to be affected. ",cssClass:"section-very-unhealthy"},{header:"Hazardous",body:"Health alert: everyone may experience more serious health effects. ",cssClass:"section-hazardous"}],E=[35,40,80,175],F="My Air",G={"-1":"Yesterday",0:"Today",1:"Tomorrow"},H=[0,51,101,151,201,251,301],I=[0,51,101,151,201,301,500],J=d(b[0].DateForecast),K=d(b[b.length-1].DateForecast),L=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=["January","February","March","April","May","June","July","August","September","October","November","December"],N=(new Date,0);k="";for(var O in b)N<b[O].AQI&&(N=b[O].AQI),b[O].visualAQI=p(b[O].AQI),u=d(b[O].DateForecast),w=L[u.getDay()],v=u.getDate(),x=u.getMonth(),y=M[x],z=u.getFullYear(),A=w+", "+y+" "+v+", "+z,B=b[O].AQI,C=g(B),k=k+"The AQI for "+A+" is "+B+" in the "+C+" range.  ";o+=k,l="<div tabindex='0'><p>Think of the AQI as a yardstick that runs from 0 to 500. The higher the AQI value, the greater the level of air pollution and the greater the health concern. For example, an AQI value of 50 represents good air quality with little potential to affect public health, while an AQI value over 300 represents hazardous air quality.  Each category corresponds to a different level of health concern. The six levels of health concern and what they mean are:</p><ul><li>A <b>Good</b> AQI is 0 to 50. Air quality is considered satisfactory, and air pollution poses little or no risk.</li><li>A <b>Moderate</b> AQI is 51 to 100. Air quality is acceptable; however, for some pollutants there may be a moderate health concern for a very small number of people. For example, people who are unusually sensitive to ozone may experience respiratory symptoms.</li><li>An <b>Unhealthy for Sensitive Groups</b> AQI is 101 to 150. Although general public is not likely to be affected at this AQI range, people with lung disease, older adults and children are at a greater risk from exposure to ozone, whereas persons with heart and lung disease, older adults and children are at greater risk from the presence of particles in the air.</li><li>An Unhealthy AQI is 151 to 200. Everyone may begin to experience some adverse health effects, and members of the sensitive groups may experience more serious effects.</li><li>A <b>Very Unhealthy</b> AQI is 201 to 300. This would trigger a health alert signifying that everyone may experience more serious health effects.</li><li>A <b>Hazardous</b> AQI is greater than 300. This would trigger a health warnings of emergency conditions. The entire population is more likely to be affected.</li></ul></div>";for(var O in b)if(0==e(new Date,d(b[O].DateForecast))){t=b[O],i=t.AQI;break}var P=H,Q=P[P.length-1],R=Q+25,S=50*b.length+E[1]+E[3],T=S-E[1]-E[3],U=R-E[0]-E[2];P.length>3&&(E[3]+=150),t&&t.AQI>50&&(E[2]+=100);var V=d3.time.scale().domain([J,K]).range([0,T]),W=d3.scale.linear().domain([0,Q]).range([U,0]),X=d3.svg.line().x(function(a,b){return V(d(a.DateForecast))}).y(function(a){return W(a.visualAQI)}),Y=d3.select("#my-air-quality-chart").append("div").attr("class","my-air-quality-chart-container");Y.style("padding-bottom",100*(U+E[0]+E[2])/(T+E[1]+E[3])+"%");var Z=Y.append("svg:svg").style({width:"100%",height:"100%",position:"absolute",left:0,top:0}).style("max-width",T+E[1]+E[3]+"px").attr("viewBox","0 0 "+(T+E[1]+E[3])+" "+(U+E[0]+E[2])).attr("aria-labelledby","my-air-quality-chart-title").attr("version","1.1").append("svg:g").attr("transform","translate("+E[3]+","+E[0]+")");Z.append("svg:title").attr("id","my-air-quality-chart-title").text(F),Z.append("svg:desc").attr("id","my-air-quality-chart-description").text(k);var $=d3.svg.area().interpolate("basis").y(function(a){return W(a)}).x0(-E[3]+E[1]).x1(T+E[1]);if(t){var _=f(t.AQI),aa=D[_];Z.append("path").datum([H[_],H[_+1]]).attr("transform","translate(-10,0)").attr("class",aa.cssClass).attr("d",$)}var ba=d3.svg.axis().scale(V).ticks(d3.time.days,1).tickFormat(function(a){var b=G[e(new Date,a)];return(b?b:"")+"/"+d3.time.format("%a/%b %d")(a)});Z.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+U+")").call(ba);Z.selectAll("g.x.axis g text").each(n),Z.selectAll("g.x.axis g text").attr("class",function(a,b){return t&&0==e(a,d(t.DateForecast))?" active-date-text":""});var ca=d3.svg.axis().scale(W).tickValues(H).orient("left").tickSize(-T-E[3]).tickFormat(function(a,b){return I[b]}),da=Z.append("svg:g").attr("class","y axis").attr("transform","translate(-"+(E[3]-E[1]+10)+",0)").call(ca);da.append("text").attr("y",U+E[0]+20).attr("class","aqi-note").text("Note: These are forecasted values./Graph is not drawn to scale.").each(n),Z.selectAll(".y.axis line.tick").attr("transform","translate(10,0)"),Z.selectAll(".y.axis g").append("text").text(function(a,b){return b<P.length-1?D[b].header:""}).attr("transform",function(a,b){var c=P[P.length-1]/U;return b+1>=H.length?"":"translate(25, -"+((H[b+1]-H[b])/2*c-20)+")"}).attr("alignment-baseline","middle").attr("class",function(a,b){return"category-label"+(t&&b==f(t.AQI)?" active-category-text":"")}).on("mouseover",function(a,b){j(this,b)}).on("focus",function(a,b){b<P.length-1&&j(this,b)}).on("focusout",function(){m()}).on("mouseout",function(){m()}),Z.append("svg:path").attr("d",X(b));var ea=Z.selectAll("g.gnode").data(b).enter().append("g").classed("gnode",!0);ea.append("text").attr("x",function(a){return V(d(a.DateForecast))}).attr("y",function(a){return W(a.visualAQI)-20}).attr("class",function(a){return t&&a.DateForecast==t.DateForecast?"active-category-text":""}).attr("tabindex","0").attr("text-anchor","middle").on("focus",function(a,b){h(this,a.AQI)}).on("focusout",function(){m()}).text(function(a){return a.ShowAQILabel?a.AQI:""}),ea.append("circle").attr("fill","#454545").attr("r",5).attr("stroke","white").attr("stroke-width",40).attr("stroke-opacity",0).attr("cx",q).attr("cy",s).on("mouseover",function(a){h(this,a.AQI)}).on("mouseout",function(){m()}),Z.append("text").attr("x",T/2).attr("y",-E[0]/2).attr("tabindex","0").attr("text-anchor","middle").attr("class","aqi-location").text(c);d3.select("#my-air-quality-chart").style("max-width",T+E[1]+E[3]+"px").append("div").attr("class","popover right").style("position","fixed")},r=function(a){d3.select("#my-air-quality-chart").html(a)},s=function(b,c){function d(a){for(var b=[],c=-1,d=0;d<a.length;d++)if(a[d].AQI>c&&(c=a[d].AQI),d+1==a.length||a[d].DateForecast!=a[d+1].DateForecast){var e=c!=-1;k+=e,c==-1&&(c=f[a[d].Category.Number]);var g={DateForecast:a[d].DateForecast,AQI:c,ReportingArea:a[d].ReportingArea,StateCode:a[d].StateCode,ShowAQILabel:e};b.push(g),c=-1}return b}var f={1:25,2:75,3:125,4:175,5:250,6:400};r('<p class="widget-note">Loading...</p>');var g=Drupal.settings.basePath+"my_air_quality_chart_view/api/forecast/zipCode/",h=new Date;h.setDate(h.getDate()-1);var i={format:"application/json",zipCode:b,date:e(h,"-"),distance:100};a.getJSON(g,i,function(a){var b=d(a);b.length>0?q(b,c):r("<p>Air quality information is not available for "+c+".</p>")})}}(jQuery);
//# sourceMappingURL=src/air_now_js.js.map