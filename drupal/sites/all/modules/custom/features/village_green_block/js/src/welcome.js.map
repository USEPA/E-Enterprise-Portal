{"version":3,"sources":["welcome.js"],"names":["$","currentIntervalID","VillageGreen","STI","namespace","VillageGreenDAL","currentInterval","windDirectionMap","N","S","E","W","NE","SE","NW","SW","","PageController","initializeMap","map_canvas","document","getElementById","latlng","google","maps","LatLng","val","map_options","center","zoom","mapTypeId","MapTypeId","SATELLITE","marker","Marker","position","title","text","map","Map","setMap","getWindDirection","degree","renderCurrentDataTable","data","html","curPmValue","curOzoneValue","curWSValue","curHumValue","curTempValue","windDirection","curWDValue","attr","currentDateString","currentDateTime","timezone","checkIfImageExists","src","img","Image","onload","backstretch","VG","config","baseUrl","onerror","setIntervalTimerForCurrentData","window","clearInterval","setInterval","getDataForCurrentMinuteWelcomePage","responseJSON","ready","on","evt","siteID","response","trigger","jQuery"],"mappings":"CAAC,SAASA,GAEN,GAGIC,GAHAC,EAAeC,IAAIC,UAAU,gBAC7BC,EAAkBH,EAAaG,gBAC/BC,EAAkB,GAGlBC,GACAC,EAAG,QACHC,EAAG,QACHC,EAAG,OACHC,EAAG,OACHC,GAAI,YACJC,GAAI,YACJC,GAAI,YACJC,GAAI,YACJC,GAAI,IAGJC,GACAC,cAAgB,WACZ,GAAIC,GAAaC,SAASC,eAAe,cACrCC,EAAS,GAAIC,QAAOC,KAAKC,OAAOzB,EAAE,YAAY0B,MAAO1B,EAAE,YAAY0B,OACnEC,GACAC,OAAQN,EACRO,KAAM,GACNC,UAAWP,OAAOC,KAAKO,UAAUC,WAEjCC,EAAS,GAAIV,QAAOC,KAAKU,QACzBC,SAAUb,EACVc,MAAOpC,EAAE,eAAeqC,SAGxBC,EAAM,GAAIf,QAAOC,KAAKe,IAAIpB,EAAYQ,EAC1CM,GAAOO,OAAOF,IAGlBG,iBAAmB,SAASC,GACxB,MAAIA,IAAU,KAAOA,GAAU,QAAYA,GAAU,GAAKA,GAAU,MACzD,IACDA,EAAS,OAASA,GAAU,MAC3B,KACDA,EAAS,OAASA,GAAU,OAC3B,IACDA,EAAS,QAAUA,GAAU,OAC5B,KACDA,EAAS,QAAUA,GAAU,OAC5B,IACDA,EAAS,QAAUA,GAAU,OAC5B,KACDA,EAAS,QAAUA,GAAU,OAC5B,IACDA,EAAS,QAAUA,GAAU,OAC5B,KAEJ,IAGXC,uBAAyB,SAASC,GAE9B5C,EAAE,iBAAiB6C,KAAKD,EAAKE,YAE7B9C,EAAE,oBAAoB6C,KAAKD,EAAKG,eAChC/C,EAAE,iBAAiB6C,KAAKD,EAAKI,YAC7BhD,EAAE,oBAAoB6C,KAAKD,EAAKK,aAChCjD,EAAE,mBAAmB6C,KAAKD,EAAKM,aAE/B,IAAIC,GAAgBlC,EAAewB,iBAAiBG,EAAKQ,WAEzDpD,GAAE,iBAAiB6C,KAAKM,GACxBnD,EAAE,iBAAiBqD,KAAK,sBAAuB9C,EAAiB4C,GAEhE,IAAIG,GAAoBV,EAAKW,eAC7BD,GAAoBA,EAAoB,IAAMV,EAAKY,SAEnDxD,EAAE,mBAAmB6C,KAAKS,IAM9BG,mBAAqB,SAASC,GAC1B,GAAIC,GAAM,GAAIC,MACdD,GAAIE,OAAS,WACT7D,EAAE,WAAW8D,YAAYC,GAAGC,OAAOC,QAAU,wBAAyBjE,EAAE,mBAAmB0B,MAAO,SAEtGiC,EAAIO,QAAU,WACVlE,EAAE,WAAW8D,YAAYC,GAAGC,OAAOC,QAAU,mCAEjDN,EAAID,IAAMA,GAGdS,+BAAiC,WAC7BC,OAAOC,cAAcpE,GAErBA,EAAoBqE,YAAY,WAE5BhE,GAAkC,EAEX,IAApBA,GAECD,EAAgBkE,mCAAmCvE,EAAE,kBAAkB0B,MAAO,SAASkB,GACnF3B,EAAe0B,uBAAuBC,EAAK4B,eAQpC,IAAnBlE,EACHN,EAAE,uBAAuB6C,KAAKvC,EAAkB,WAGxCN,EAAE,uBAAuB6C,KAAKvC,EAAkB,YAE7CA,GAAmB,IACnBA,EAAkB,KAEvB,MAKXN,GAAEoB,UAAUqD,MAAM,WAEdzE,EAAE,kBAAkB0E,GAAG,SAAU,SAASC,GAEtC,GAAIC,GAAS5E,EAAE,kBAAkB0B,KAEjC1B,GAAE,iCACGqD,KAAK,OAAQ,qDAAqDuB,GAClEvC,KAAK,sBAAwBrC,EAAE,kCAAkCqC,QAGtEhC,EAAgBkE,mCAAmCK,EAAQ,SAASC,GAChE5D,EAAe0B,uBAAuBkC,EAASL,gBAGnDvD,EAAekD,iCACf7D,EAAkB,KAGtBN,EAAE,kBAAkB8E,QAAQ,aAGlCC","file":"welcome.js","sourcesContent":["(function($) {\r\n    \r\n    var VillageGreen = STI.namespace('VillageGreen');\r\n    var VillageGreenDAL = VillageGreen.VillageGreenDAL;    \r\n    var currentInterval = 60;\r\n    var currentIntervalID;\r\n\r\n    var windDirectionMap = {\r\n        N: \"North\",\r\n        S: \"South\",\r\n        E: \"East\",\r\n        W: \"West\",\r\n        NE: \"Northeast\",\r\n        SE: \"Southeast\",\r\n        NW: \"Northwest\",\r\n        SW: \"Southwest\",\r\n        \"\": \"\"\r\n    }\r\n  \r\n    var PageController = {\r\n        initializeMap : function() {\r\n            var map_canvas = document.getElementById('map_canvas');\r\n            var latlng = new google.maps.LatLng($(\"#siteLat\").val(), $(\"#siteLon\").val());\r\n            var map_options = {\r\n                center: latlng,\r\n                zoom: 17,\r\n                mapTypeId: google.maps.MapTypeId.SATELLITE\r\n            };\r\n            var marker = new google.maps.Marker({\r\n                position: latlng,\r\n                title: $(\"#citiesMenu\").text()\r\n            });\r\n            \r\n            var map = new google.maps.Map(map_canvas, map_options);     \r\n            marker.setMap(map);\r\n        },\r\n          \r\n        getWindDirection : function(degree) {\r\n            if((degree <= 360 && degree >= 348.75) || (degree >= 0 && degree <= 33.75)) {\r\n                return \"N\";\r\n            } else if(degree > 33.75 && degree <= 78.75) {\r\n                return \"NE\";\r\n            } else if(degree > 78.75 && degree <= 123.75) {\r\n                return \"E\";\r\n            } else if(degree > 123.75 && degree <= 168.75) {\r\n                return \"SE\";\r\n            } else if(degree > 168.75 && degree <= 213.75) {\r\n                return \"S\";\r\n            } else if(degree > 213.75 && degree <= 258.75) {\r\n                return \"SW\";\r\n            } else if(degree > 258.75 && degree <= 303.75) {\r\n                return \"W\";\r\n            } else if(degree > 303.75 && degree <= 348.75) {\r\n                return \"NW\";\r\n            }\r\n            return \"\";\r\n        },\r\n        \r\n        renderCurrentDataTable : function(data) {\r\n\r\n            $(\".curPMReading\").html(data.curPmValue);\r\n        \r\n            $(\".curOzoneReading\").html(data.curOzoneValue);        \r\n            $(\".curWSReading\").html(data.curWSValue);\r\n            $(\".curHumidReading\").html(data.curHumValue);\r\n            $(\".curTempReading\").html(data.curTempValue);\r\n\r\n            var windDirection = PageController.getWindDirection(data.curWDValue);\r\n\r\n            $(\".curWDReading\").html(windDirection);\r\n            $(\".curWDReading\").attr(\"data-original-title\", windDirectionMap[windDirection]);\r\n\r\n            var currentDateString = data.currentDateTime;\r\n            currentDateString = currentDateString + ' ' + data.timezone;\r\n            \r\n            $(\".currentObsDate\").html(currentDateString);  \r\n\r\n            // After current data section is rendered, set the background\r\n            //PageController.checkIfImageExists( VG.config.baseUrl + \"/images/site_banners/\"+ $(\"#currentFullAQS\").val() +\".jpg\");\r\n        },\r\n      \r\n        checkIfImageExists : function(src) {\r\n            var img = new Image();\r\n            img.onload = function() {\r\n                $(\"#topRow\").backstretch(VG.config.baseUrl + \"/images/site_banners/\"+ $(\"#currentFullAQS\").val() +\".jpg\");                          \r\n            };\r\n            img.onerror = function() {\r\n                $(\"#topRow\").backstretch(VG.config.baseUrl + \"/images/site_backgrounds/0.jpg\");                \r\n            };\r\n            img.src = src;\r\n        },\r\n        \r\n        setIntervalTimerForCurrentData : function() {\r\n            window.clearInterval(currentIntervalID);\r\n\r\n            currentIntervalID = setInterval(function() {\r\n\r\n                currentInterval = currentInterval-1;\r\n\r\n                if(currentInterval === 0) {\r\n                           \r\n                    VillageGreenDAL.getDataForCurrentMinuteWelcomePage($(\"#currentSiteID\").val(), function(data) {\r\n                        PageController.renderCurrentDataTable(data.responseJSON);\r\n                    });     \r\n                 \r\n                }\r\n\r\n\r\n                var percentProgress = (60 - currentInterval)/60 * 100;\r\n\r\n\t\t\t\t\t\t\t\tif (currentInterval == 1) {\r\n\t\t\t\t\t\t\t\t\t$(\".countdownContainer\").html(currentInterval + \" second\");\r\n\t\t\t\t\t\t\t\t}\r\n                else {\r\n                \t$(\".countdownContainer\").html(currentInterval + \" seconds\");\r\n                }\r\n                if (currentInterval <= 0) {\r\n                    currentInterval = 60;\r\n                }                                                                      \r\n            }, 1000);             \r\n        }\r\n\r\n    };         \r\n\r\n    $(document).ready(function() {\r\n\r\n        $(\"#currentSiteID\").on('change', function(evt) {\r\n\r\n            var siteID = $(\"#currentSiteID\").val();\r\n\r\n            $(\"a.village-green-external-link\")\r\n                .attr(\"href\", \"http://villagegreen.airnowtech.org/welcome?siteID=\"+siteID)\r\n                .text(\"View more data for \" + $(\"#currentSiteID option:selected\").text());\r\n\r\n            // On load, populate the data sections\r\n            VillageGreenDAL.getDataForCurrentMinuteWelcomePage(siteID, function(response) {\r\n                PageController.renderCurrentDataTable(response.responseJSON);\r\n            });\r\n\r\n            PageController.setIntervalTimerForCurrentData();\r\n            currentInterval = 61;\r\n        });\r\n\r\n        $(\"#currentSiteID\").trigger('change');\r\n    });\r\n    \r\n}(jQuery));"]}