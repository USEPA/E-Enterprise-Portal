!function(a){a(function(){a("#myMapsFiltering").tabs(),a("#myMapsFiltering").find(".ui-corner-top").on("click",function(b){a(this).focus()}),a.getJSON("./map_dataset",function(b){function c(){var a=y.jcarousel("first").index(),b=y.find(".load-thumbnail").eq(0).index();a===b&&B.addClass("inactive")}function d(b,c){b.unbind("jcarouselcontrol:active").unbind("jcarouselcontrol:inactive").on("jcarouselcontrol:active",function(){a(this).removeClass("inactive")}).on("jcarouselcontrol:inactive",function(){a(this).addClass("inactive")}).click(function(){e()}).jcarouselControl({target:c})}function e(){var b=a(".thumb").find("li").not(":hidden");try{start=a.inArray(y.jcarousel("visible")[0],b)}catch(c){}try{end=start+6}catch(d){}try{b.slice(start,end).each(function(){var b=a(this).find(".thumbnailImg").attr("src");b||a(this).find(".thumbnailImg").attr("src",a(this).find(".thumbnailImg").attr("data-map-source"))})}catch(e){}}function f(){var a=y.find("li"),b=y.innerWidth();b>=1100?(width=b/5-4,t=5):b>=850?(width=b/4-4,t=4):b>=600?(width=b/3-4,t=3):b>=350&&(width=b/2-4,t=2),a.css("width",Math.ceil(width)+"px"),a.hasClass("load-thumbnail")&&e(),y.find(".load-thumbnail").removeClass("active").slice(0,t).addClass("active"),d(B,"-="+t),d(A,"+="+t),w()}function g(b){var d=a(".jcarousel ul li");d.removeClass("active hide-thumbnail").addClass("load-thumbnail"),d.each(function(c){a(this).show();var e=a(this).find("a").data("tags").toLowerCase();switch(b){case"mapsAll":d.filter(":visible").addClass("load-thumbnail");break;case"mapsAir":;(e.indexOf("air")==-1&&e.indexOf("oaqps")==-1||e.indexOf("impair")>-1)&&a(this).removeClass("load-thumbnail").addClass("hide-thumbnail");break;case"mapsWater":;e.indexOf("water")==-1&&e.indexOf("ocean")==-1&&a(this).removeClass("load-thumbnail").addClass("hide-thumbnail");break;case"mapsLand":;e.indexOf("land")==-1&&e.indexOf("rcra")==-1&&a(this).removeClass("load-thumbnail").addClass("hide-thumbnail")}}),j(o),c(),f()}function h(b){a.each(b,function(b,c){var d="";c.id=c.url.match(/\/\/(.*).maps.arcgis.com/)[1],"noaa"==c.id&&(d=q),a.ajax({type:"GET",url:c.url+"/sharing/rest/search",async:!0,data:{q:"orgid:"+c.orgid+" "+d+' -type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" (type:"Web Mapping Application" OR type:"Mobile Application")',f:"json",num:"100"},mapset:c,success:function(a,b,c){var d=JSON.parse(a);i(d,this.mapset)}}).fail(function(a,b){if("error"==b)return"Sorry but there was an error: "+a.status+" "+a.statusText})})}function i(b,c){var d=0,e=0;a.each(b.results,function(){var b;if(this.url.indexOf("http")>-1&&null!==this.url){var f=this.url.split("://");b=!(f[1].indexOf(":")>-1)}else b=!1;if("thumbnail/ago_downloaded.png"!=this.thumbnail&&null!==this.thumbnail&&null!==this.description&&"jquacken_EPA"!=this.owner&&b===!0){var g=this.tags.toString();e+=1,d+=1;var h,i=c.url+"/sharing/rest/content/items/"+this.id+"/info/"+this.thumbnail,j="<p>"+this.description+"</p>",l=this.url;h=l.indexOf("http://")>-1&&l.indexOf("maps.arcgis.com")>-1?l.replace("http://","https://"):l;var m=a('<li class="load-thumbnail">').append(a("<div>",{"class":"thumbitem-border"}).append(a("<a>",{"class":"thumbhyperlink","data-accessinfo":c.alias,"data-contactemail":c.contactemail,"data-tags":g,href:h,title:this.title,target:"_blank"}).append(a("<img>",{"class":"thumbnailImg","data-map-source":i,alt:this.title,title:this.title,"aria-describedby":"thumbnail-desc-"+c.id+"-"+e+" thumbnail-source-"+c.id+"-"+e+" thumbnail-contact-"+e})),a("<p>",{"data-toggle":"tooltip","class":"ee-bootstrap-tooltip mapAppTitle ellipsis",title:this.title,html:this.title}),a("<p>",{"data-toggle":"tooltip","class":"ee-bootstrap-tooltip mapAppDesc ellipsis",id:"thumbnail-desc-"+c.id+"-"+e,title:k(a(j).text(),1e3),html:a(j).text(),tabindex:"0"}),a("<p>",{"data-toggle":"tooltip","class":"ee-bootstrap-tooltip mapAppSource ellipsis",id:"thumbnail-source-"+c.id+"-"+e,title:c.alias,html:c.alias}),a("<p>",{"data-toggle":"tooltip","class":"mapAppContact",id:"thumbnail-contact-"+c.id+"-"+e,title:c.contactemail,html:'<a href="mailto:'+c.contactemail+'">'+c.contactemail+"</a>"})));a(".jcarousel ul").append(m)}}),v+=d,a(".thumb").randomize("li"),a(".ellipsis").dotdotdot({watch:"window"}),a(".ellipsis").trigger("update.dot");var f="all";j(f),g(f)}function j(b){var c="#"+b+"-maps-carousel .thumb > li.load-thumbnail";s=a(c).length,a("#map-count").html(s.toString())}function k(a,b){if(a.length<=b)return a;var c=a.substr(0,b),d=c.lastIndexOf(" ");return d===-1?c+"...":c.substring(0,d)+"..."}function l(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}var m=b.mapsets,n="mapsAll",o="all",p="myMapsFilterAll",q='tags:"oceans"',r=0,s=0,t=0,u=0,v=0,w=l(function(){a(".jcarousel").jcarousel("reload").jcarousel("scroll",0),e()},300);if("state_admin"==Drupal.settings.userrole){var x=a("#numThumbnails").find(".widget-note");x.append('<a href="/agency-map-list" id="manage-maps" class="favorites-ignore last">Manage agency map collections</a>')}var y=a(".jcarousel"),z=a("<ul>",{"class":"thumb"});y.html(z),h(m),y.jcarousel();var A=a(".jcarousel-control-next"),B=a(".jcarousel-control-prev");y.on("jcarousel:reloadend",function(){}).on("jcarousel:visiblein","li",function(b,c){a(this).hasClass("load-thumbnail")&&a(this).addClass("active")}).on("jcarousel:visibleout","li",function(b,c){a(this).removeClass("active")}),a("#myMapsFiltering").on("tabsbeforeactivate",function(a,b){r=0,p=b.newTab.attr("id"),n=b.newTab.find("a").attr("id"),g(n)}),a.fn.randomize=function(b){return(b?this.find(b):this).parent().each(function(){a(this).children(b).sort(function(){return Math.random()-.5}).detach().appendTo(this)}),this};var C=y.find(".load-thumbnail.active a");C.on("focus",function(){C.on("keyup",function(a){a.stopImmediatePropagation();var b=a.which||a.keyChar||a.keyCode;27===b?y.focus():37===b?(B.hasClass("inactive")||B.trigger("click"),C.eq(0).focus()):39===b&&(A.hasClass("inactive")||A.trigger("click"),C.eq(0).focus())})}),y.on("focus",function(){y.on("keyup",function(b){b.stopImmediatePropagation();var c=b.which||b.keyChar||b.keyCode;if(u=s-1,37===c)B.hasClass("inactive")||(B.trigger("click"),y.focus());else if(39===c)A.hasClass("inactive")||(A.trigger("click"),y.focus());else if(27===c){var d="#"+p;a(d).focus()}})})})})}(jQuery);
//# sourceMappingURL=MyMaps.js.map