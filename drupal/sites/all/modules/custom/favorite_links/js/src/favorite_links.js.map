{"version":3,"sources":["favorite_links.js"],"names":["$","reloadView","trigger","load_links","async_setting","hide","ajax","url","Drupal","settings","basePath","method","async","data","json","success","parseJSON","url_data","favorite_urls","urls","favorite_url_mapping","url_mapping","id_label_mapping","label_mapping","processPageAnchors","ignore_panels","join","each","this","closest","attr","hasClass","linkControl","FavoriteLink","addFavoriteButton","text","length","setUrl","setTitle","qtip_postion","my","at","target","triggerQtip","findLink","hideQtip","findQtip","err","refocusLink","focus_link_id","find","focus","processFavoriteLink","button","action","unparsed_url","label","id","old_link","isNumeric","encodeURIComponent","type","title","unbind","removeClass","addClass","next","row","row_num","rowIndex","row_total","children","next_link","previous_link","prev","remove","widget_button","document","ready","body","on","string_array","split","$this","ajaxSuccess","event","xhr","not","keydown","which","stopImmediatePropagation","linkQtip","imgQtip","ctrlKey","qTipSpan","e","jQuery"],"mappings":"CAAA,SAAWA,GAMP,QAASC,cACLD,EAAE,0BAA0BE,QAAQ,SAGxC,QAASC,YAAWC,eAChBJ,EAAE,cAAcK,OAChBL,EAAEM,MACEC,IAAKC,OAAOC,SAASC,SAAW,aAChCC,OAAQ,MACRC,MAAOR,cACPS,MAAOC,MAAM,GACbC,QAAS,SAAUF,MACf,GAAIA,MAAOb,EAAEgB,UAAUH,KACF,UAAjBA,KAAKI,WACLC,cAAgBL,KAAKM,KACrBC,qBAAuBP,KAAKQ,YAC5BC,iBAAmBT,KAAKU,kBAMxC,QAASC,sBACL,GAAIC,gBAAiB,4CAA6C,uCAAwC,4BAE1GzB,GAAE,mBAAqByB,cAAcC,KAAK,KAAO,SAASC,KAAK,WAEvD,GAAyC,KAArC3B,EAAE4B,MAAMC,QAAQ,KAAKC,KAAK,SACc,IAArC9B,EAAE4B,MAAMC,QAAQ,KAAKC,KAAK,UACzB9B,EAAE4B,MAAMC,QAAQ,KAAKE,SAAS,kBAC9B/B,EAAE4B,MAAMC,QAAQ,KAAKE,SAAS,sBAAuB,CACzD,GAAIC,aAAc,GAAIC,cAAajC,EAAE4B,MACrCI,aAAYE,uBAMxBlC,EAAE,mBAAqByB,cAAcC,KAAK,KAAO,yIAAyIC,KAAK,WAC3L,GAAI3B,EAAE4B,MAAMO,OAAOC,OAAS,GAA6B,KAAxBpC,EAAE4B,MAAME,KAAK,SACf,KAAxB9B,EAAE4B,MAAME,KAAK,SACW,UAAxB9B,EAAE4B,MAAME,KAAK,UACZ9B,EAAE4B,MAAMG,SAAS,kBACjB/B,EAAE4B,MAAMG,SAAS,uBACM,IAAxB/B,EAAE4B,MAAME,KAAK,QAClB,CACE,GAAIE,aAAc,GAAIC,cAAajC,EAAE4B,MACrCI,aAAYK,OAAOrC,EAAE4B,MAAME,KAAK,SAChCE,YAAYM,SAAStC,EAAE4B,MAAMO,QAC7BH,YAAYO,cACRC,GAAI,cACJC,GAAI,eACJC,OAAQ1C,EAAE4B,OAEdI,YAAYE,uBAQxB,QAASS,aAAYC,SAAUC,UAC3B,IACI,GAAgB,GAAZA,SAGA,MAFA7C,GAAE4C,UAAU1C,QAAQ,aACpB4C,SAAW,IAAM9C,EAAE4C,UAAUd,KAAK,mBAIlC9B,GAAE4C,UAAU1C,QAAQ,YAG5B,MAAO6C,OAKX,QAASC,aAAYC,eACI,IAAjBA,cACAjD,EAAE,gCAAgCkD,KAAKD,eAAeE,QAGtDnD,EAAE,gCAAgCkD,KAAK,qBAAqBC,QAIpE,QAASC,qBAAoBC,OAAQC,OAAQC,aAAcC,OACvD,GAAIC,IAEAlD,IADAmD,UAAW,CAEX1D,GAAE2D,UAAUJ,eACZE,GAAKF,aACLG,UAAW,EACXnD,IAAM,MAGNA,IAAMqD,mBAAmBL,cAE7BvD,EAAEM,MACEC,IAAKC,OAAOC,SAASC,SAAW,wBAChCmD,KAAM,OACNjD,OAAO,EACPC,MAAON,IAAKA,IAAK+C,OAAQA,OAAQQ,MAAON,MAAOC,GAAIA,IACnD1C,QAAS,SAAUF,MAEf,GADAwC,OAAOU,OAAO,SACA,OAAVT,OACArD,aACAE,YAAW,GACXkD,OAAOW,YAAY,YACdA,YAAY,YACZA,YAAY,YACZA,YAAY,UACZA,YAAY,SACZlC,KAAK,QAAS,mBACdmC,SAAS,+BACTnC,KAAK,KAAMV,qBAAqBmC,cAAgB,mBACrDF,OAAOa,KAAK,YAAY/B,KAAK,+CAE5B,CACD,GAAIkB,OAAOtB,SAAS,aAAc,CAC9BwB,aAAevD,EAAEqD,QAAQxB,QAAQ,MAAMqB,KAAK,KAAKpB,KAAK,OAEtD,IAAIqC,KAAMnE,EAAEqD,QAAQxB,QAAQ,MACxBuC,QAAUD,IAAI,GAAGE,SAAW,EAE5BC,UAAYtE,EAAE,gCAAgCkD,KAAK,SAASA,KAAK,SAASqB,SAAS,MAAMnC,OAAS,CAGtG,IAAIgC,QAAUE,UAAW,CACrB,GAAIE,WAAYL,IAAID,OAAOhB,KAAK,IAChCD,eAAgB,IAAMuB,UAAU,GAAGf,OAGlC,IAAIW,SAAWE,WAA0B,GAAbA,UAAgB,CAC7C,GAAIG,eAAgBN,IAAIO,OAAOxB,KAAK,IACpCD,eAAgB,IAAMwB,cAAc,GAAGhB,OAIvCR,eAAgB,EAEpBjD,GAAEqD,QAAQxB,QAAQ,MAAM8C,aAEvB,CACD,GAAIC,eAAgB5E,EAAE,SAAWyD,GAAK,8BACtCF,cAAevD,EAAE4E,eAAe/C,QAAQ,MAAMqB,KAAK,mBAAmBpB,KAAK,QAG/EuB,OAASrD,EAAE,SAAWyD,GAAK,qBAC3BD,MAAQlC,iBAAiBmC,IACzBxD,aACAoD,OAAOvB,KAAK,KAAMyB,aAAe,KAAOC,OACxCH,OAAOW,YAAY,eAAeA,YAAY,YAAYA,YAAY,YAAYA,YAAY,UAAUA,YAAY,SACpHX,OAAOvB,KAAK,QAAS,gBACrBuB,OAAOY,SAAS,4BAChBZ,OAAOa,KAAK,YAAY/B,KAAK,yCAEjCa,YAAYC,kBAlKxB,GAAIA,eACAL,SACAE,QAqKJ9C,GAAE6E,UAAUC,MAAM,WAGd9E,EAAE6E,SAASE,MAAMC,GAAG,QAAS,YAAa,WACtC,GAEI1B,QAFA2B,aAAejF,EAAE4B,MAAME,KAAK,MAAMoD,MAAM,MACxCzB,GAAKwB,aAAa,GAElBE,MAAQnF,EAAE4B,KAEV0B,QADA6B,MAAMpD,SAAS,YACN,MAGA,SAEbqB,oBAAoB+B,MAAO7B,OAAQG,GAAI,IACnC0B,MAAMpD,SAAS,eACf5B,YAAW,KAInBH,EAAE6E,SAASE,MAAMC,GAAG,QAAS,YAAa,WACtC,GAGI1B,QAHA2B,aAAejF,EAAE4B,MAAME,KAAK,MAAMoD,MAAM,MACxC3E,IAAM0E,aAAa,GACnBzB,MAAQyB,aAAa,GAErBE,MAAQnF,EAAE4B,KAEV0B,QADA6B,MAAMpD,SAAS,YACN,MAGA,SAEbqB,oBAAoB+B,MAAO7B,OAAQ/C,IAAKiD,OACpC2B,MAAMpD,SAAS,eACf5B,YAAW,KAKnBH,EAAE6E,UAAUO,YAAY,SAAUC,MAAOC,IAAK7E,UACtB,4BAAhBA,SAASF,IACTyC,YAAYC,eAEZzB,uBAGRxB,EAAE6E,UAAUG,GAAG,0BAA2B,WACtCxD,uBAQJxB,EAAE,KAAKuF,IAAI,aAAc,oBAAqB,aAAc,oBAAqB,mBAAoB,gBAAiB,iBAAkB,qBAAsB,gBAAgBpC,MAAM,WAChLnD,EAAE,KAAKuF,IAAI,aAAc,oBAAqB,aAAc,oBAAqB,mBAAoB,gBAAiB,iBAAkB,qBAAsB,gBAAgBC,QAAQ,SAAUH,OAC5L,IACI,GAAoB,KAAhBA,MAAMI,MAAc,CACpB,GAAoB,IAAhBJ,MAAMI,MAGN,MAFAJ,OAAMK,4BAEC,CAEP,IAAIC,UAAW3F,EAAE4B,MAAME,KAAK,gBACxB8D,QAAU5F,EAAE4B,MAAMsB,KAAK,OAAOpB,KAAK,eAUvC,OATI6D,UAAW,GACXN,MAAMK,2BACN9C,SAAW5C,EAAE4B,MACbe,YAAYC,UAAU,IACfgD,QAAU,IACjBP,MAAMK,2BACN9C,SAAW5C,EAAE4B,MAAMsB,KAAK,OACxBP,YAAYC,UAAU,KAEnB,EAGV,GAAoB,KAAhByC,MAAMI,OAAgBJ,MAAMQ,QAAS,CAC1CR,MAAMK,0BACN,IAAIC,UAAW3F,EAAE4B,MAAME,KAAK,eAExBc,UADA+C,SAAW,EACA3F,EAAE4B,MAEF5B,EAAE4B,MAAMsB,KAAK,OAE5BP,YAAYC,UAAU,EACtB,IAAIkD,UAAWhD,SAAW,kBAI1B,OAHA9C,GAAE8F,UAAU5F,QAAQ,SACpByC,YAAYC,UAAU,GACtB5C,EAAE4B,MAAMmC,OAAO,UACR,GAGb,MAAOgC,YAKtBC","file":"favorite_links.js","sourcesContent":["(function ($) {\n\n    var focus_link_id;\n    var findLink;\n    var findQtip;\n\n    function reloadView() {\n        $('#reload_favorite_links').trigger('click');\n    }\n\n    function load_links(async_setting) {\n        $('#load_more').hide();\n        $.ajax({\n            url: Drupal.settings.basePath + 'load_links',\n            method: 'GET',\n            async: async_setting,\n            data: {json: true},\n            success: function (data) {\n                var data = $.parseJSON(data);\n                if (data.url_data != 'false') {\n                    favorite_urls = data.urls;\n                    favorite_url_mapping = data.url_mapping;\n                    id_label_mapping = data.label_mapping;\n                }\n            }\n        });\n    }\n\n    function processPageAnchors() {\n        var ignore_panels = ['.pane-views-cdx-facility-management-block', '.pane-views-progress-tracker-block-1', '.pane-views-to-do-block-1'];\n        // process img links\n        $('.panel-pane:not(' + ignore_panels.join(',') + ') img').each(function () {\n\n                if ($(this).closest('a').attr('href') != '#'\n                    && $(this).closest('a').attr('href') != ''\n                    && !$(this).closest('a').hasClass('about-widget')\n                    && !$(this).closest('a').hasClass('processed-favorite')) {\n                    var linkControl = new FavoriteLink($(this));\n                    linkControl.addFavoriteButton();\n                }\n\n            }\n        );\n        // process anchor tags\n        $('.panel-pane:not(' + ignore_panels.join(',') + ') a:not(.favorites-ignore, .menu-link, .skip-link, .paginate_button, [href^=mailto], [href^=javascript], .remove-link, .about-widget)').each(function () {\n            if ($(this).text().length > 0 && $(this).attr('href') != '#'\n                && $(this).attr('href') != '/'\n                && $(this).attr('href') != '#close'\n                && !$(this).hasClass('about-widget')\n                && !$(this).hasClass('processed-favorite')\n                && $(this).attr('href') != ''\n            ) {\n                var linkControl = new FavoriteLink($(this));\n                linkControl.setUrl($(this).attr('href'));\n                linkControl.setTitle($(this).text());\n                linkControl.qtip_postion = {\n                    my: 'left center',  // Position my top left...\n                    at: 'right center', // at the bottom right of...\n                    target: $(this) // my target\n                };\n                linkControl.addFavoriteButton();\n            }\n        });\n    }\n\n    // Show tooltip on <a> element, but only when\n  // focused and Shift key pressed.\n\n    function triggerQtip(findLink, hideQtip) {\n        try {\n            if (hideQtip == true) {\n                $(findLink).trigger('mouseover');\n                findQtip = '#' + $(findLink).attr('aria-describedby');\n                return findQtip;\n            }\n            else {\n                $(findLink).trigger('mouseout');\n            }\n        }\n        catch (err) {\n            //console.log(\"Error on triggerQtip: \" + err);\n        }\n    }\n\n    function refocusLink(focus_link_id) {\n        if (focus_link_id != \"\") {\n            $('#favorite_links-ajax-wrapper').find(focus_link_id).focus();\n        }\n        else {\n            $('#favorite_links-ajax-wrapper').find('.favorites-ignore').focus();\n        }\n    }\n\n    function processFavoriteLink(button, action, unparsed_url, label) {\n        var id;\n        var old_link = false;\n        var url;\n        if ($.isNumeric(unparsed_url)) {\n            id = unparsed_url;\n            old_link = true;\n            url = 'id';\n        }\n        else {\n            url = encodeURIComponent(unparsed_url);\n        }\n        $.ajax({\n            url: Drupal.settings.basePath + 'process_favorite_link',\n            type: 'POST',\n            async: false,\n            data: {url: url, action: action, title: label, id: id},\n            success: function (data) {\n                button.unbind(\"click\");\n                if (action == 'add') {\n                    reloadView();\n                    load_links(false);\n                    button.removeClass('add_link')\n                        .removeClass('new_link')\n                        .removeClass('old_link')\n                        .removeClass('filled')\n                        .removeClass('empty')\n                        .attr('title', 'Remove favorite')\n                        .addClass('remove_link old_link filled')\n                        .attr('id', favorite_url_mapping[unparsed_url] + '__favorite_link');\n                    button.next('.sr-only').text('Favorited. Press Ctrl + D to unfavorite');\n                }\n                else {\n                    if (button.hasClass('in-widget')) {\n                        unparsed_url = $(button).closest('tr').find('a').attr('href');\n                        // $anchor = $(button).closest('tr').find('a');\n                        var row = $(button).closest('tr');\n                        var row_num = row[0].rowIndex - 1;\n                        //Count # rows in table, subtract for first row that's a holder\n                        var row_total = $('#favorite_links-ajax-wrapper').find('table').find('tbody').children('tr').length - 1;\n\n                        //If current row isn't last row, focus next row favorite\n                        if (row_num < row_total) {\n                            var next_link = row.next().find('a');\n                            focus_link_id = \"#\" + next_link[0].id;\n                        }\n                        //If no next rows, focus previous row favorite\n                        else if (row_num == row_total && row_total != 1) {\n                            var previous_link = row.prev().find('a');\n                            focus_link_id = \"#\" + previous_link[0].id;\n                        }\n                        //If only row left, focus Edit Profile link\n                        else {\n                            focus_link_id = \"\";\n                        }\n                        $(button).closest('tr').remove();\n                    }\n                    else {\n                        var widget_button = $('*[id=\"' + id + '__favorite_link\"].in-widget')\n                        unparsed_url = $(widget_button).closest('tr').find('.favorites-link').attr('href');\n                    }\n\n                    button = $('*[id=\"' + id + '__favorite_link\"]');\n                    label = id_label_mapping[id];\n                    reloadView();\n                    button.attr('id', unparsed_url + '__' + label);\n                    button.removeClass('remove_link').removeClass('new_link').removeClass('old_link').removeClass('filled').removeClass('empty');\n                    button.attr('title', 'Add favorite');\n                    button.addClass('add_link new_link empty ');\n                    button.next('.sr-only').text('Press Ctrl + D to favorite this link.');\n                }\n                refocusLink(focus_link_id);\n            }\n        });\n    }\n\n    $(document).ready(function () {\n\n        // Only run if favorite links module is active\n        $(document.body).on('click', '.old_link', function () {\n            var string_array = $(this).attr('id').split('__');\n            var id = string_array[0];\n            var action;\n            var $this = $(this);\n            if ($this.hasClass('add_link')) {\n                action = 'add';\n            }\n            else {\n                action = 'remove';\n            }\n            processFavoriteLink($this, action, id, '');\n            if ($this.hasClass('.in-widget')) {\n                load_links(true);\n            }\n        });\n\n        $(document.body).on('click', '.new_link', function () {\n            var string_array = $(this).attr('id').split('__');\n            var url = string_array[0];\n            var label = string_array[1];\n            var action;\n            var $this = $(this);\n            if ($this.hasClass('add_link')) {\n                action = 'add';\n            }\n            else {\n                action = 'remove';\n            }\n            processFavoriteLink($this, action, url, label);\n            if ($this.hasClass('.in-widget')) {\n                load_links(true);\n            }\n        });\n\n\n        $(document).ajaxSuccess(function (event, xhr, settings) {\n            if (settings.url == 'favorite_sites-ajax/ajax')\n                refocusLink(focus_link_id);\n            else\n                processPageAnchors();\n        });\n\n        $(document).on(\"ee:new_links_to_process\", function () {\n            processPageAnchors();\n        });\n\n\n// If a link that's favorite-able is focused, watch for key presses\n// Shift (16) triggers qTip\n// Escape (27) or blur hide qTip\n// Ctrl + D (68) toggles the favorite and shows the qTip\n        $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \".about-widget\", \"[href^=mailto]\", \"[href^=javascript]\", \".remove-link\").focus(function () {\n            $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \".about-widget\", \"[href^=mailto]\", \"[href^=javascript]\", \".remove-link\").keydown(function (event) {\n                try {\n                    if (event.which === 16) {\n                        if (event.which === 9) {\n                            event.stopImmediatePropagation();\n                            // Ignore shift + tab (9)\n                            return false;\n                        } else {\n                            var linkQtip = $(this).attr('data-hasqtip');\n                            var imgQtip = $(this).find('img').attr('data-hasqtip');\n                            if (linkQtip > 0) {\n                                event.stopImmediatePropagation();\n                                findLink = $(this);\n                                triggerQtip(findLink, true);\n                            } else if (imgQtip > 0) {\n                                event.stopImmediatePropagation();\n                                findLink = $(this).find('img');\n                                triggerQtip(findLink, true);\n                            }\n                            return false;\n                        }\n                    }\n                    else if (event.which === 68 && event.ctrlKey) {\n                        event.stopImmediatePropagation();\n                        var linkQtip = $(this).attr('data-hasqtip');\n                        if (linkQtip > 0) {\n                            findLink = $(this);\n                        } else {\n                            findLink = $(this).find('img');\n                        }\n                        triggerQtip(findLink, true);\n                        var qTipSpan = findQtip + ' .favorite_hover';\n                        $(qTipSpan).trigger('click');\n                        triggerQtip(findLink, true);\n                        $(this).unbind(\"click\");\n                        return false;\n                    } else {\n                    }\n                } catch (e) {\n                }\n            }); //End keyup function\n        }); //End focus function\n    });\n})(jQuery);\n"]}