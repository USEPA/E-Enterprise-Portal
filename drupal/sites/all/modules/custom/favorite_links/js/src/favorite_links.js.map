{"version":3,"sources":["favorite_links.js"],"names":["$","reloadView","trigger","load_links","async_setting","hide","ajax","url","Drupal","settings","basePath","method","async","data","json","success","parseJSON","url_data","favorite_urls","urls","favorite_url_mapping","url_mapping","id_label_mapping","label_mapping","processPageAnchors","ignore_panels","join","each","this","closest","attr","hasClass","linkControl","FavoriteLink","addFavoriteButton","text","length","setUrl","setTitle","qtip_postion","my","at","target","triggerQtip","findLink","hideQtip","findQtip","err","refocusLink","focus_link_id","find","focus","processFavoriteLink","button","action","unparsed_url","label","id","old_link","isNumeric","encodeURIComponent","type","title","unbind","removeClass","addClass","next","row","row_num","rowIndex","row_total","children","next_link","previous_link","prev","remove","widget_button","document","ready","body","on","string_array","split","$this","ajaxSuccess","event","xhr","not","keydown","which","stopImmediatePropagation","linkQtip","imgQtip","ctrlKey","qTipSpan","e","jQuery"],"mappings":"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","file":"favorite_links.js","sourcesContent":["(function ($) {\r\n\r\n    var focus_link_id;\r\n    var findLink;\r\n    var findQtip;\r\n\r\n    function reloadView() {\r\n        $('#reload_favorite_links').trigger('click');\r\n    }\r\n\r\n    function load_links(async_setting) {\r\n        $('#load_more').hide();\r\n        $.ajax({\r\n            url: Drupal.settings.basePath + 'load_links',\r\n            method: 'GET',\r\n            async: async_setting,\r\n            data: {json: true},\r\n            success: function (data) {\r\n                var data = $.parseJSON(data);\r\n                if (data.url_data != 'false') {\r\n                    favorite_urls = data.urls;\r\n                    favorite_url_mapping = data.url_mapping;\r\n                    id_label_mapping = data.label_mapping;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function processPageAnchors() {\r\n        var ignore_panels = ['.pane-views-cdx-facility-management-block', '.pane-views-progress-tracker-block-1', '.pane-views-to-do-block-1'];\r\n        // process img links\r\n        $('.panel-pane:not(' + ignore_panels.join(',') + ') img').each(function () {\r\n\r\n                if ($(this).closest('a').attr('href') != '#'\r\n                    && $(this).closest('a').attr('href') != ''\r\n                    && !$(this).closest('a').hasClass('processed-favorite')) {\r\n                    var linkControl = new FavoriteLink($(this));\r\n                    linkControl.addFavoriteButton();\r\n                }\r\n\r\n            }\r\n        );\r\n        // process anchor tags\r\n        $('.panel-pane:not(' + ignore_panels.join(',') + ') a:not(.favorites-ignore, .menu-link, .skip-link, .paginate_button,[href^=mailto], [href^=javascript])').each(function () {\r\n            if ($(this).text().length > 0 && $(this).attr('href') != '#'\r\n                && $(this).attr('href') != '/'\r\n                && $(this).attr('href') != '#close'\r\n                && !$(this).hasClass('processed-favorite')\r\n                && $(this).attr('href') != ''\r\n            ) {\r\n                var linkControl = new FavoriteLink($(this));\r\n                linkControl.setUrl($(this).attr('href'));\r\n                linkControl.setTitle($(this).text());\r\n                linkControl.qtip_postion = {\r\n                    my: 'left center',  // Position my top left...\r\n                    at: 'right center', // at the bottom right of...\r\n                    target: $(this) // my target\r\n                };\r\n                linkControl.addFavoriteButton();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Show tooltip on <a> element, but only when\r\n  // focused and Shift key pressed.\r\n\r\n    function triggerQtip(findLink, hideQtip) {\r\n        try {\r\n            if (hideQtip == true) {\r\n                $(findLink).trigger('mouseover');\r\n                findQtip = '#' + $(findLink).attr('aria-describedby');\r\n                return findQtip;\r\n            }\r\n            else {\r\n                $(findLink).trigger('mouseout');\r\n            }\r\n        }\r\n        catch (err) {\r\n            //console.log(\"Error on triggerQtip: \" + err);\r\n        }\r\n    }\r\n\r\n    function refocusLink(focus_link_id) {\r\n        if (focus_link_id != \"\") {\r\n            $('#favorite_links-ajax-wrapper').find(focus_link_id).focus();\r\n        }\r\n        else {\r\n            $('#favorite_links-ajax-wrapper').find('.favorites-ignore').focus();\r\n        }\r\n    }\r\n\r\n    function processFavoriteLink(button, action, unparsed_url, label) {\r\n        var id;\r\n        var old_link = false;\r\n        var url;\r\n        if ($.isNumeric(unparsed_url)) {\r\n            id = unparsed_url;\r\n            old_link = true;\r\n            url = 'id';\r\n        }\r\n        else {\r\n            url = encodeURIComponent(unparsed_url);\r\n        }\r\n        $.ajax({\r\n            url: Drupal.settings.basePath + 'process_favorite_link',\r\n            type: 'POST',\r\n            async: false,\r\n            data: {url: url, action: action, title: label, id: id},\r\n            success: function (data) {\r\n                button.unbind(\"click\");\r\n                if (action == 'add') {\r\n                    reloadView();\r\n                    load_links(false);\r\n                    button.removeClass('add_link')\r\n                        .removeClass('new_link')\r\n                        .removeClass('old_link')\r\n                        .removeClass('filled')\r\n                        .removeClass('empty')\r\n                        .attr('title', 'Remove favorite')\r\n                        .addClass('remove_link old_link filled')\r\n                        .attr('id', favorite_url_mapping[unparsed_url] + '__favorite_link');\r\n                    button.next('.sr-only').text('Favorited. Press Ctrl + D to unfavorite');\r\n                }\r\n                else {\r\n                    if (button.hasClass('in-widget')) {\r\n                        unparsed_url = $(button).closest('tr').find('a').attr('href');\r\n                        // $anchor = $(button).closest('tr').find('a');\r\n                        var row = $(button).closest('tr');\r\n                        var row_num = row[0].rowIndex - 1;\r\n                        //Count # rows in table, subtract for first row that's a holder\r\n                        var row_total = $('#favorite_links-ajax-wrapper').find('table').find('tbody').children('tr').length - 1;\r\n\r\n                        //If current row isn't last row, focus next row favorite\r\n                        if (row_num < row_total) {\r\n                            var next_link = row.next().find('a');\r\n                            focus_link_id = \"#\" + next_link[0].id;\r\n                        }\r\n                        //If no next rows, focus previous row favorite\r\n                        else if (row_num == row_total && row_total != 1) {\r\n                            var previous_link = row.prev().find('a');\r\n                            focus_link_id = \"#\" + previous_link[0].id;\r\n                        }\r\n                        //If only row left, focus Edit Profile link\r\n                        else {\r\n                            focus_link_id = \"\";\r\n                        }\r\n                        $(button).closest('tr').remove();\r\n                    }\r\n                    else {\r\n                        var widget_button = $('*[id=\"' + id + '__favorite_link\"].in-widget')\r\n                        unparsed_url = $(widget_button).closest('tr').find('.favorites-link').attr('href');\r\n                    }\r\n\r\n                    button = $('*[id=\"' + id + '__favorite_link\"]');\r\n                    label = id_label_mapping[id];\r\n                    reloadView();\r\n                    button.attr('id', unparsed_url + '__' + label);\r\n                    button.removeClass('remove_link').removeClass('new_link').removeClass('old_link').removeClass('filled').removeClass('empty');\r\n                    button.attr('title', 'Add favorite');\r\n                    button.addClass('add_link new_link empty ');\r\n                    button.next('.sr-only').text('Press Ctrl + D to favorite this link.');\r\n                }\r\n                refocusLink(focus_link_id);\r\n            }\r\n        });\r\n    }\r\n\r\n    $(document).ready(function () {\r\n\r\n        // Only run if favorite links module is active\r\n        $(document.body).on('click', '.old_link', function () {\r\n            var string_array = $(this).attr('id').split('__');\r\n            var id = string_array[0];\r\n            var action;\r\n            var $this = $(this);\r\n            if ($this.hasClass('add_link')) {\r\n                action = 'add';\r\n            }\r\n            else {\r\n                action = 'remove';\r\n            }\r\n            processFavoriteLink($this, action, id, '');\r\n            if ($this.hasClass('.in-widget')) {\r\n                load_links(true);\r\n            }\r\n        });\r\n\r\n        $(document.body).on('click', '.new_link', function () {\r\n            var string_array = $(this).attr('id').split('__');\r\n            var url = string_array[0];\r\n            var label = string_array[1];\r\n            var action;\r\n            var $this = $(this);\r\n            if ($this.hasClass('add_link')) {\r\n                action = 'add';\r\n            }\r\n            else {\r\n                action = 'remove';\r\n            }\r\n            processFavoriteLink($this, action, url, label);\r\n            if ($this.hasClass('.in-widget')) {\r\n                load_links(true);\r\n            }\r\n        });\r\n\r\n\r\n        $(document).ajaxSuccess(function (event, xhr, settings) {\r\n            if (settings.url == 'favorite_sites-ajax/ajax')\r\n                refocusLink(focus_link_id);\r\n            else\r\n                processPageAnchors();\r\n        });\r\n\r\n        $(document).on(\"ee:new_links_to_process\", function () {\r\n            processPageAnchors();\r\n        });\r\n\r\n\r\n// If a link that's favorite-able is focused, watch for key presses\r\n// Shift (16) triggers qTip\r\n// Escape (27) or blur hide qTip\r\n// Ctrl + D (68) toggles the favorite and shows the qTip\r\n        $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \"[href^=mailto]\", \"[href^=javascript]\").focus(function () {\r\n            $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \"[href^=mailto]\", \"[href^=javascript]\").keydown(function (event) {\r\n                try {\r\n                    if (event.which === 16) {\r\n                        if (event.which === 9) {\r\n                            event.stopImmediatePropagation();\r\n                            // Ignore shift + tab (9)\r\n                            return false;\r\n                        } else {\r\n                            var linkQtip = $(this).attr('data-hasqtip');\r\n                            var imgQtip = $(this).find('img').attr('data-hasqtip');\r\n                            if (linkQtip > 0) {\r\n                                event.stopImmediatePropagation();\r\n                                findLink = $(this);\r\n                                triggerQtip(findLink, true);\r\n                            } else if (imgQtip > 0) {\r\n                                event.stopImmediatePropagation();\r\n                                findLink = $(this).find('img');\r\n                                triggerQtip(findLink, true);\r\n                            }\r\n                            return false;\r\n                        }\r\n                    }\r\n                    else if (event.which === 68 && event.ctrlKey) {\r\n                        event.stopImmediatePropagation();\r\n                        var linkQtip = $(this).attr('data-hasqtip');\r\n                        if (linkQtip > 0) {\r\n                            findLink = $(this);\r\n                        } else {\r\n                            findLink = $(this).find('img');\r\n                        }\r\n                        triggerQtip(findLink, true);\r\n                        var qTipSpan = findQtip + ' .favorite_hover';\r\n                        $(qTipSpan).trigger('click');\r\n                        triggerQtip(findLink, true);\r\n                        $(this).unbind(\"click\");\r\n                        return false;\r\n                    } else {\r\n                    }\r\n                } catch (e) {\r\n                }\r\n            }); //End keyup function\r\n        }); //End focus function\r\n    });\r\n})(jQuery);\r\n"]}