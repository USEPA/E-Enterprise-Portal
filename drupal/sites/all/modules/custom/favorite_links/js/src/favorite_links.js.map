{"version":3,"sources":["favorite_links.js"],"names":["$","reloadView","trigger","load_links","async_setting","hide","ajax","url","Drupal","settings","basePath","method","async","data","json","success","parseJSON","url_data","favorite_urls","urls","favorite_url_mapping","url_mapping","id_label_mapping","label_mapping","processDataTablePageAnchors","each","linkControl","FavoriteLink","this","setUrl","attr","setTitle","text","qtip_postion","my","at","target","addFavoriteButton","processPageAnchors","ignore_panels","join","closest","hasClass","length","triggerQtip","findLink","hideQtip","findQtip","err","refocusLink","focus_link_id","find","focus","processFavoriteLink","button","action","unparsed_url","label","id","old_link","isNumeric","encodeURIComponent","type","title","unbind","removeClass","addClass","next","row","row_num","rowIndex","row_total","children","next_link","previous_link","prev","remove","widget_button","document","ready","body","on","string_array","split","$this","ajaxSuccess","event","xhr","waitUntilExists","delay","setTimeout","not","keydown","which","stopImmediatePropagation","linkQtip","imgQtip","ctrlKey","qTipSpan","e","jQuery"],"mappings":"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","file":"favorite_links.js","sourcesContent":["(function ($) {\n\n  var focus_link_id;\n  var findLink;\n  var findQtip;\n\n  function reloadView() {\n    $('#reload_favorite_links').trigger('click');\n  }\n\n  function load_links(async_setting) {\n    $('#load_more').hide();\n    $.ajax({\n      url: Drupal.settings.basePath + 'load_links',\n      method: 'GET',\n      async: async_setting,\n      data: {json: true},\n      success: function (data) {\n        var data = $.parseJSON(data);\n        if (data.url_data != 'false') {\n            favorite_urls = data.urls;\n            favorite_url_mapping = data.url_mapping;\n            id_label_mapping = data.label_mapping;\n        }\n      }\n    });\n  }\n\n  function processDataTablePageAnchors() {\n    $('.dataTables_wrapper .resource-title a').each(function () {\n      var linkControl = new FavoriteLink($(this));\n          linkControl.setUrl($(this).attr('href'));\n          linkControl.setTitle($(this).text());    \n          linkControl.qtip_postion = {\n            my: 'left center',  // Position my top left...\n            at: 'right center', // at the bottom right of...\n            target: $(this) // my target\n          };            \n          linkControl.addFavoriteButton();   \n    });\n  }\n  \n  function processPageAnchors() {\n    var ignore_panels = ['.pane-views-cdx-facility-management-block', '.pane-views-progress-tracker-block-1', '.pane-views-to-do-block-1'];\n    // process img links\n    $('.panel-pane:not(' + ignore_panels.join(',') + ') img').each(function () {\n      if ($(this).closest('a').attr('href') != '#'\n        && $(this).closest('a').attr('href') != ''\n        && !$(this).closest('a').hasClass('about-widget')\n        && !$(this).closest('a').hasClass('processed-favorite')) {\n        var linkControl = new FavoriteLink($(this));\n        linkControl.addFavoriteButton();\n      }\n    });\n    // process anchor tags\n    $('.panel-pane:not(' + ignore_panels.join(',') + ') a:not(.favorites-ignore, .menu-link, .skip-link, .paginate_button, [href^=mailto], [href^=javascript], .remove-link, .about-widget)').each(function () {\n      if ($(this).text().length > 0 && $(this).attr('href') != '#'\n        && $(this).attr('href') != '/'\n        && $(this).attr('href') != '#close'\n        && !$(this).hasClass('about-widget')\n        && !$(this).hasClass('favorite-law')\n        && !$(this).hasClass('processed-favorite')\n        && $(this).attr('href') != ''\n      ) {\n        var linkControl = new FavoriteLink($(this));\n        linkControl.setUrl($(this).attr('href'));\n        linkControl.setTitle($(this).text());\n        linkControl.qtip_postion = {\n          my: 'left center',  // Position my top left...\n          at: 'right center', // at the bottom right of...\n          target: $(this) // my target\n        };\n        linkControl.addFavoriteButton();\n      }\n    });\n  }\n\n// Show tooltip on <a> element, but only when\n// focused and Shift key pressed.\n  function triggerQtip(findLink, hideQtip) {\n    try {\n      if (hideQtip == true) {\n        $(findLink).trigger('mouseover');\n        findQtip = '#' + $(findLink).attr('aria-describedby');\n        return findQtip;\n      }\n      else {\n        $(findLink).trigger('mouseout');\n      }\n    }\n    catch (err) {\n      //console.log(\"Error on triggerQtip: \" + err);\n    }\n  }\n\n  function refocusLink(focus_link_id) {\n    if (focus_link_id != \"\") {\n      $('#favorite_links-ajax-wrapper').find(focus_link_id).focus();\n    }\n    else {\n      $('#favorite_links-ajax-wrapper').find('.favorites-ignore').focus();\n    }\n  }\n\n  function processFavoriteLink(button, action, unparsed_url, label) {\n    var id;\n    var old_link = false;\n    var url;\n    if ($.isNumeric(unparsed_url)) {\n      id = unparsed_url;\n      old_link = true;\n      url = 'id';\n    }\n    else {\n      url = encodeURIComponent(unparsed_url);\n    }\n    $.ajax({\n      url: Drupal.settings.basePath + 'process_favorite_link',\n      type: 'POST',\n      async: false,\n      data: {url: url, action: action, title: label, id: id},\n      success: function (data) {\n        button.unbind(\"click\");\n        if (action == 'add') {\n          reloadView();\n          load_links(false);\n          button.removeClass('add_link new_link old_link filled empty')\n              .attr('title', 'Remove favorite')\n              .addClass('remove_link old_link filled')\n              .attr('id', favorite_url_mapping[unparsed_url] + '__favorite_link');\n          button.next('.sr-only').text('Favorited. Press Ctrl + D to unfavorite');\n        }\n        else {\n          if (button.hasClass('in-widget')) {\n            unparsed_url = $(button).closest('tr').find('a').attr('href');\n            // $anchor = $(button).closest('tr').find('a');\n            var row = $(button).closest('tr');\n            var row_num = row[0].rowIndex - 1;\n            //Count # rows in table, subtract for first row that's a holder\n            var row_total = $('#favorite_links-ajax-wrapper').find('table').find('tbody').children('tr').length - 1;\n\n            //If current row isn't last row, focus next row favorite\n            if (row_num < row_total) {\n              var next_link = row.next().find('a');\n              focus_link_id = \"#\" + next_link[0].id;\n            }\n            //If no next rows, focus previous row favorite\n            else if (row_num == row_total && row_total != 1) {\n              var previous_link = row.prev().find('a');\n              focus_link_id = \"#\" + previous_link[0].id;\n            }\n            //If only row left, focus Edit Profile link\n            else {\n              focus_link_id = \"\";\n            }\n            $(button).closest('tr').remove();\n          }\n          else {\n            var widget_button = $('*[id=\"' + id + '__favorite_link\"].in-widget')\n            unparsed_url = $(widget_button).closest('tr').find('.favorites-link').attr('href');\n          }\n\n          button = $('*[id=\"' + id + '__favorite_link\"]');\n          label = id_label_mapping[id];\n          reloadView();\n          button.attr('id', unparsed_url + '__' + label);\n          button.removeClass('remove_link new_link old_link filled empty');\n          button.attr('title', 'Add favorite');\n          button.addClass('add_link new_link empty ');\n          button.next('.sr-only').text('Press Ctrl + D to favorite this link.');\n        }\n      refocusLink(focus_link_id);\n      }\n    });\n  }\n\n  $(document).ready(function () {\n\n    // Only run if favorite links module is active\n    $(document.body).on('click', '.old_link', function () {\n      var string_array = $(this).attr('id').split('__');\n      var id = string_array[0];\n      var action;\n      var $this = $(this);\n      if ($this.hasClass('add_link')) {\n        action = 'add';\n      }\n      else {\n        action = 'remove';\n      }\n      processFavoriteLink($this, action, id, '');\n      if ($this.hasClass('.in-widget')) {\n        load_links(true);\n      }\n    });\n\n    $(document.body).on('click', '.new_link', function () {\n      var string_array = $(this).attr('id').split('__');\n      var url = string_array[0];\n      var label = string_array[1];\n      var action;\n      var $this = $(this);\n      if ($this.hasClass('add_link')) {\n        action = 'add';\n      }\n      else {\n          action = 'remove';\n      }\n      processFavoriteLink($this, action, url, label);\n      if ($this.hasClass('.in-widget')) {\n        load_links(true);\n      }\n    });\n\n    $(document).ajaxSuccess(function (event, xhr, settings) {\n      if (settings.url == Drupal.settings.basePath + 'favorite_sites-ajax/ajax') {\n        refocusLink(focus_link_id);\n      }\n      else\n        processPageAnchors();\n    });\n\n    $(document).on(\"ee:new_links_to_process\", function () {\n      processPageAnchors();\n    });\n    \n    $('#local-resources-tabs .pager__link').waitUntilExists(function() {\n      $('#local-resources-tabs .pager__link').on('click', function() {\n        var delay = 500;\n        setTimeout(function() {\n           processDataTablePageAnchors();\n          }, delay);\n        });\n    });\n\n    // If a link that's favorite-able is focused, watch for key presses\n    // Shift (16) triggers qTip\n    // Escape (27) or blur hide qTip\n    // Ctrl + D (68) toggles the favorite and shows the qTip\n    $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \".about-widget\", \"[href^=mailto]\", \"[href^=javascript]\", \".remove-link\", \".favorite-law\").focus(function () {\n      $(\"a\").not(\".menu-link\", \".ctools-use-modal\", \".skip-link\", \".favorites-ignore\", \".paginate_button\", \".about-widget\", \"[href^=mailto]\", \"[href^=javascript]\", \".remove-link\", \".favorite-law\").keydown(function (event) {\n        try {\n          if (event.which === 16) {\n            if (event.which === 9) {\n              event.stopImmediatePropagation();\n              // Ignore shift + tab (9)\n              return false;\n            } \n            else {\n              var linkQtip = $(this).attr('data-hasqtip');\n              var imgQtip = $(this).find('img').attr('data-hasqtip');\n              if (linkQtip > 0) {\n                event.stopImmediatePropagation();\n                findLink = $(this);\n                triggerQtip(findLink, true);\n              } \n              else if (imgQtip > 0) {\n                event.stopImmediatePropagation();\n                findLink = $(this).find('img');\n                triggerQtip(findLink, true);\n              }\n              return false;\n            }\n          }\n          else if (event.which === 68 && event.ctrlKey) {\n            event.stopImmediatePropagation();\n            var linkQtip = $(this).attr('data-hasqtip');\n            if (linkQtip > 0) {\n              findLink = $(this);\n            } \n            else {\n              findLink = $(this).find('img');\n            }\n            triggerQtip(findLink, true);\n            var qTipSpan = findQtip + ' .favorite_hover';\n            $(qTipSpan).trigger('click');\n            triggerQtip(findLink, true);\n            $(this).unbind(\"click\");\n            return false;\n          } \n          else {\n          }\n        } \n        catch (e) {\n        }\n      }); //End keyup function\n    }); //End focus function\n  });\n})(jQuery);\n"]}