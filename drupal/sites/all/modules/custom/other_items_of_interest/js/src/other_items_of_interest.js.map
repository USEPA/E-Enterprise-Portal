{"version":3,"sources":["other_items_of_interest.js"],"names":["$","return_location_name","location","index","indexOf","trim","substr","ItemsOfInterestTable","$wrapper","ajax_url","hide","datatable_options","bLengthChange","iDisplayLength","sPageButton","oLanguage","sSearch","pagingType","dom","fnDrawCallback","pageInfo","this","fnPagingInfo","pageNo","iPage","totalPages","iTotalPages","$current_li","class","html","find","after","cached","wrapper","state_code","split","hideTable","update_current_location","ajax_request","ajax","beforeSend","url","method","data","state","success","table","newId","each","Math","max","parseInt","attr","length","$table","DataTable","removeClass","addClass","showTable","show","document","ready","$tabs","tabs","on","ev","focus","$location_select","guest_user","text","change","current_state_table","e","queryResponse","city","favorite_states_table","all_states_resource_table","epa_table","click","hasClass","jQuery"],"mappings":"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","file":"other_items_of_interest.js","sourcesContent":["(function($) {\r\n\r\n  var ItemsOfInterestTable = function($wrapper, ajax_url, location) {\r\n\r\n    $wrapper.hide();\r\n\r\n    var datatable_options = {\r\n      \"bLengthChange\": false,\r\n      \"iDisplayLength\": 3,\r\n      \"sPageButton\": \"favorites-ignore\",\r\n      \"oLanguage\": {\r\n        \"sSearch\": \"Filter:\"\r\n      },\r\n      \"pagingType\": \"simple\",\r\n      \"dom\": 'iftp',\r\n      \"fnDrawCallback\": function() {\r\n        var pageInfo = this.fnPagingInfo();\r\n        var pageNo = pageInfo.iPage + 1;\r\n        var totalPages = pageInfo.iTotalPages + 1;\r\n\r\n        if (totalPages > 1) {\r\n          var $current_li = $('<li />', {\r\n            class: 'pager-current'\r\n          })\r\n            .html(pageNo + ' of ' + totalPages);\r\n          $wrapper.find('.dataTables_paginate li:first').after($current_li);\r\n        }\r\n      }\r\n    };\r\n\r\n    var cached = false;\r\n    this.wrapper = $wrapper;\r\n    this.ajax_url = ajax_url;\r\n\r\n    if (location) {\r\n      // find if in city, state code pattern\r\n      if (location.indexOf(',') === -1)\r\n        this.state_code = location;\r\n      else\r\n        this.state_code = $.trim(location.split(',')[1]);\r\n    }\r\n    else {\r\n      this.state_code = false;\r\n    }\r\n\r\n\r\n    this.hideTable = function() {\r\n      $wrapper.hide();\r\n    };\r\n\r\n    this.update_current_location = function(location) {\r\n      // find if in city, state code pattern\r\n      if (location.indexOf(',') === -1)\r\n        this.state_code = location;\r\n      else\r\n        this.state_code = $.trim(location.split(',')[1]);\r\n      this.ajax_request();\r\n    };\r\n\r\n    this.ajax_request = function() {\r\n      var state_code = this.state_code;\r\n      $.ajax({\r\n        beforeSend: function() {\r\n          $wrapper.html('<p>Loading&hellip;</p>');\r\n        },\r\n        url: ajax_url,\r\n        method: \"POST\",\r\n        data: {state: state_code},\r\n        success: function(table) {\r\n          /**\r\n           * TODO: refactor - duplicate code block in the following files:\r\n           * recommended_resources/js/LocalResourcesTable.js\r\n           * other_items_of_interest/js/ItemsOfInterestTable.js\r\n           */\r\n            // alter the datatable id, one digit larger than the largest id\r\n          var newId = 0;\r\n          $(\"table[id^='datatable-']\").each(function() {\r\n            newId = Math.max(newId, parseInt($(this).attr('id').substr('datatable-'.length), 10));\r\n          });\r\n          newId++;\r\n          var $table = $('<div>' + table + '</div>'); // wrap contents in a div for now, will unwrap later\r\n          $table.find('table').attr('id', 'datatable-' + newId);\r\n          $wrapper.html($table.html()); // unwrap\r\n\r\n          $table = $wrapper.find('table');\r\n          if ($table.length > 0) {\r\n            $table.DataTable(datatable_options);\r\n            $table.removeClass(\"dataTable display no-footer\").addClass('views-table responsive-table usa-table-borderless');\r\n          }\r\n          cached = true;\r\n        }\r\n      });\r\n    };\r\n\r\n    this.showTable = function() {\r\n      if (cached) {\r\n        $wrapper.show();\r\n      }\r\n      else {\r\n        this.ajax_request();\r\n        $wrapper.show();\r\n      }\r\n    }\r\n\r\n  };\r\n\r\n\r\n  function return_location_name(location) {\r\n    var index = location.indexOf('(');\r\n    if (index > 0) {\r\n      return $.trim(location.substr(0, location.indexOf('(')));\r\n    }\r\n    else {\r\n      return location;\r\n    }\r\n  }\r\n\r\n\r\n  $(document).ready(function() {\r\n\r\n    var $tabs = $(\"#other-areas-tabs\");\r\n    $tabs.tabs();\r\n    $tabs.find('.ui-corner-top').on('click', function(ev) {\r\n      $(this).focus();\r\n    });\r\n\r\n    var $location_select;\r\n    var guest_user;\r\n    var location;\r\n\r\n    if ($('#location-select').length > 0) {\r\n      $location_select = $('#location-select');\r\n      guest_user = false;\r\n      location = $('#location-select').find('option:selected').text();\r\n      location = return_location_name(location);\r\n      $location_select.change(function() {\r\n        var location = $('#location-select option:selected').text();\r\n        location = return_location_name(location);\r\n        $('#restrict-to-current-button a').text(location);\r\n        current_state_table.update_current_location(location);\r\n        current_state_table.ajax_request();\r\n      });\r\n    }\r\n    else {\r\n      $location_select = $('#location-input-guests');\r\n      guest_user = true;\r\n      location = $location_select.text();\r\n      location = return_location_name(location);\r\n    }\r\n\r\n    if (guest_user) {\r\n      $(document).on('ee:zipCodeQueried', function(e, queryResponse) {\r\n        location = queryResponse.city + ', ' + queryResponse.state;\r\n        $('#restrict-to-current-button a').text(location);\r\n        current_state_table.update_current_location(location);\r\n        current_state_table.ajax_request();\r\n\r\n      });\r\n    }\r\n\r\n    var current_state_table = new ItemsOfInterestTable($(\"#current-state-resources\"), 'generateCurrentAreaOfInterestTable', location);\r\n    if (!guest_user) {\r\n      var favorite_states_table = new ItemsOfInterestTable($(\"#favorite-state-resources\"), 'generateFavoriteAreasOfInterestTable');\r\n    }\r\n    var all_states_resource_table = new ItemsOfInterestTable($(\"#all-state-resources\"), 'generateAllAreasOfInterestTable');\r\n    // Generating EPA by using current location as EPA\r\n    var epa_table = new ItemsOfInterestTable($(\"#epa-resources\"), 'generateCurrentAreaOfInterestTable', 'US EPA');\r\n\r\n\r\n    if (!guest_user) {\r\n      $('#restrict-to-states-button').click(function() {\r\n        if ($(this).hasClass('inactive')) {\r\n          $(this).removeClass('inactive');\r\n          $(\"#all-states-button\").addClass('inactive');\r\n          $('#restrict-to-current-button').addClass('inactive');\r\n          $(\"#epa-button\").addClass('inactive');\r\n          all_states_resource_table.hideTable();\r\n          current_state_table.hideTable();\r\n          epa_table.hideTable();\r\n          favorite_states_table.showTable();\r\n        }\r\n      });\r\n    }\r\n\r\n    $(\"#all-states-button\").click(function() {\r\n      if ($(this).hasClass('inactive')) {\r\n        $(this).removeClass('inactive');\r\n        $('#restrict-to-states-button').addClass('inactive');\r\n        $('#restrict-to-current-button').addClass('inactive');\r\n        $(\"#epa-button\").addClass('inactive');\r\n\r\n        all_states_resource_table.showTable();\r\n        current_state_table.hideTable();\r\n        if (!guest_user) {\r\n          favorite_states_table.hideTable();\r\n        }\r\n        epa_table.hideTable();\r\n      }\r\n    });\r\n\r\n    $('#restrict-to-current-button').click(function() {\r\n      if ($(this).hasClass('inactive')) {\r\n        $(this).removeClass('inactive');\r\n        $('#restrict-to-states-button').addClass('inactive');\r\n        $(\"#all-states-button\").addClass('inactive');\r\n        $(\"#epa-button\").addClass('inactive');\r\n        current_state_table.showTable();\r\n        if (!guest_user) {\r\n          favorite_states_table.hideTable();\r\n        }\r\n        all_states_resource_table.hideTable();\r\n        epa_table.hideTable();\r\n      }\r\n    });\r\n\r\n    $('#epa-button').click(function() {\r\n      if ($(this).hasClass('inactive')) {\r\n        $(this).removeClass('inactive');\r\n        $('#restrict-to-states-button').addClass('inactive');\r\n        $('#restrict-to-current-button').addClass('inactive');\r\n        $(\"#all-states-button\").addClass('inactive');\r\n        current_state_table.hideTable();\r\n        if (!guest_user) {\r\n          favorite_states_table.hideTable();\r\n        }\r\n        all_states_resource_table.hideTable();\r\n        epa_table.showTable();\r\n      }\r\n    });\r\n\r\n\r\n    // Dynamically set button text for currently selected location\r\n    $('#restrict-to-current-button a').text(location);\r\n\r\n\r\n    current_state_table.showTable();\r\n    if (!guest_user) {\r\n      favorite_states_table.ajax_request();\r\n    }\r\n    all_states_resource_table.ajax_request();\r\n    epa_table.ajax_request();\r\n\r\n  });\r\n\r\n\r\n}(jQuery));"]}