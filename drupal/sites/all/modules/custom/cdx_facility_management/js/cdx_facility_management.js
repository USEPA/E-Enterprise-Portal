!function(a){function b(){var b={};return a.ajax({url:"/return_cdx_facility_management_token",async:!1,success:function(c){var d={};""==c?d.expired=!0:d=a.parseJSON(c),d.expired?b.expired=!0:(b.token=d.token,b.expired=!1,b.ip=d.server_ip,b.url=d.url,b.user_session_logout=d.user_session_logout,b.user_login_time=d.user_login_time)}}),b}function c(b){var c=a("#fmw-program-select"),e=a("#fmw-program-select-holder"),f=a("#fmw-program-single"),g=a("#fmw-type-select-holder"),h=a("#launch-facility-management"),j="",k=0;c.html('<option value="">Select&hellip;</option>'),a.each(b,function(a){c.append('<option value="'+a+'" >'+a+"</option>"),k+=1,j=a}),k>1?(c.show(),f.hide()):(c.val(j).hide(),f.html(j).show(),d(b[j])),e.show(),c.unbind("change").change(function(){var c=a(this).val();h.hide(),g.hide(),""!=c&&d(b[c]),i()})}function d(b){var c=a("#fmw-type-select"),d=a("#fmw-type-single"),e=a("#fmw-type-select-holder"),f=0,g="",h="",j=a("#launch-facility-management");c.html('<option value="">Select a Role Type</option>'),a.each(b,function(a,b){c.append('<option value="'+b.userRoleId+'" >'+b.type+"</option>"),f+=1,g=b.userRoleId,h=b.type}),f>1?(c.show(),d.hide()):(c.val(g).hide(),d.html(h).show(),j.show()),c.unbind("change").change(function(){""==a(this).val()?j.hide():j.show(),i()}),e.show()}function e(){a.ajax({url:"/retrieve_cdx_user_data",success:function(d){var e=a.parseJSON(d);if(e.error)console.log("CDX Error",e),a("#fmw-organization-select-holder").html("Unable to receive user data.");else{var h=e.organizations_to_roles;if(0==h.length){var i="<p>You do not have any facilities to manage in CDX through this widget at this time.</p>";a("#fmw-organization-select-holder").html(i)}else{var k=a("#fmw-organization-select"),l=a("#fmw-organization-single"),m=a("#launch-facility-management"),n=a("#fmw-type-select-holder"),o=a("#fmw-program-select-holder"),p=b();if(p.expired)g();else{var q=p.token,r=p.ip,s=p.url,t=p.user_login_time,u=p.user_session_logout,v=0;a.each(h,function(b,c){c.roles&&a.each(c.roles,function(a,b){if(0==v){var c=b[0].userRoleId;f(c,q,r,s,t,u,0),v=1}})}),k.append('<option value="">Select an Organization</option>');var w=0,x="",y="";a.each(h,function(a,b){b.roles&&(k.append('<option value="'+a+'" >'+b.name+"</option>"),w+=1,x=a,y=b.name)}),1==w?(k.val(x).hide(),l.html(y).show(),c(h[x].roles)):k.show(),k.change(function(){var b=a(this).val();o.hide(),n.hide(),m.hide(),""!=b&&c(h[b].roles)}),m.click(function(){var b=a("#fmw-type-select").val();f(b,q,r,s,t,u,0),a("#facility-widget").length>0&&(j.dialog("open"),a(".ui-dialog").focus())})}}}}})}function f(c,d,e,i,n,o,p){a("#facility-widget").html(""),Date.now||(Date.now=function(){return(new Date).getTime()});var q=Date.now(),r=1e3*n,s=Math.abs((q-r)/6e4);return s>=o?(g(),void j.remove()):l?(k=c,void(m=!0)):(l=!0,void a.initFacilityManagementWidget({autoScroll:!1,widgetDisplayType:"Edit My Facilities",baseServiceUrl:i,ImagesFolderPath:i+"/ContentFramework/FRS%20Widget/images",userRoleId:c,NASSToken:d,NAASip:e,onInvalidSession:function(){var a=b();if(a.expired)g();else{var d=a.token;""===d?h("CDX Facility- Blank Token"):p>2?h("CDX Facility- Max attempts."):(l=!1,f(c,d,e,i,n,o,p+1))}},onServiceCall:function(){j.dialog("option","position",{my:"center",at:"center",of:window})},onWidgetDataLoaded:function(){l=!1,m&&(f(k,d,e,i,n,o,p),m=!1)}}))}function g(){var b=a("#cdx-logged-in-options"),c=a("#cdx-logged-out-options"),d=a("#cdx-logged-out-log-out");b.remove(),c.show(),d.click(function(){window.location.href="/user/logout"})}function h(b){console.log(b);var c=a("#cdx-logged-in-options"),d=a("#cdx-unable-to-load");c.remove(),d.show()}function i(){var b=0,c=a(".pane-views-cdx-facility-management-block");a("#cdx-logged-in-options").find("div").each(function(){b+=a(this).outerWidth(!0)}),b>c.width()&&(c.parent().hasClass("expanded")&&"none"==a("#launch-facility-management").css("display")?(c.parent().height("-=40"),c.parent().removeClass("expanded")):a(".pane-views-cdx-facility-management-block").parent().hasClass("expanded")||(c.parent().height("+=40"),c.parent().addClass("expanded")))}var j,k,l=!1,m=!1;a(document).ready(function(){j=a("#facility-widget");var b=a("#first-time-user-block");j.length>0&&j.dialog({title:"My Facility Manager",modal:!0,autoOpen:!1,width:"auto",height:"auto",maxWidth:"1000px",minWidth:"1000px",dialogClass:"cdx_facility_management_block",resizable:!1,position:{my:"center",at:"center",of:window}}),a(window).resize(function(){j.dialog("option","position",{my:"center",at:"center",of:window})}),b.length>0?a(document).on("ee:first_time_user_complete",function(){e()}):e()})}(jQuery);
//# sourceMappingURL=cdx_facility_management.js.map