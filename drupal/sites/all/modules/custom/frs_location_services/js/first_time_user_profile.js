!function(a){a(document).ready(function(){function b(){D.show(),E.show(),F.hide()}function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(d):alert("Geolocation is not supported by this browser.")}function d(a){var b=a.coords.latitude,c=a.coords.longitude;clearTimeout(M),e(b,c)}function e(c,d){a.ajax({url:Drupal.settings.basePath+"return_location_data_lat_long",type:"GET",async:!1,data:{latitude:c,longitude:d},success:function(c){var c=a.parseJSON(c);return c.error?b():f(c),c},failure:function(){alert("Unable to connect to service")}})}function f(a){E.text("Until you choose a location, the default location will be the location detected by the browser.").show(),u=a.city,v=a.state,t=a.zip,s=u+", "+v,C.text(u+", "+v+" ("+t+")"),n=t,p=v,o=u,w=1,D.show(),F.hide()}function g(b){y&&b in y&&y[b].urban?(r=s&&x&&s in x?x[s].pop:y[b].pop,q=y[b].urban,"urban"===q.toLowerCase()?a('input[name=community-type][value="urban"]').prop("checked",!0):"rural"===q.toLowerCase()?a('input[name=community-type][value="rural"]').prop("checked",!0):a('input[name=community-type][value="_none"]').prop("checked",!0),r<5e3?a("#community-size option:contains(0 - 5,000)").prop("selected",!0):r<1e4?a("#community-size option:contains(5,000 - 10,000)").prop("selected",!0):r<25e3?a("#community-size option:contains(10,000 - 25,000)").prop("selected",!0):r<1e5?a("#community-size option:contains(25,000 - 100,000)").prop("selected",!0):r<1e6?a("#community-size option:contains(100,000 - 1,000,000)").prop("selected",!0):a("#community-size option:contains(1,000,000+)").prop("selected",!0)):(a("input[name=community-type]").prop("checked",!1),a("#community-size").val(""))}function h(){var a=G,b=a.val(),c=/(^\d{5}$)|(^\d{5}-\d{4}$)|(^\d{5}-\d{5}$)/.test(b),d=/^[\w\s]+,\s*\w{2}$/.test(b);c!==!0&&d!==!0||i(b,a)}function i(b,c){a("#location-error-message").remove(),c.removeClass("input-error"),j(b,c)}function j(b,c){var d="";a.ajax({url:Drupal.settings.basePath+"return_location_data",type:"POST",data:{location:b,initial_login:!0},success:function(e){var f=a.parseJSON(e);if(f.name_city_state){var h=f.city.length;if(0==h)0===a("#location-error-message").length&&(d='<span id="location-error-message">The ZIP code you entered could not be found.</span>',H.append(d),c.addClass("input-error"));else if(1==h){z="yes",p=f.state;var i=f.zip;y=f.zip_attr,x=f.city_attr,C.text(f.city[0]+" ("+i+")"),n=i,s=f.city[0],g(n),B.show(),H.hide(),K.hide()}else{n=f.zip,p=f.state,y=f.zip_attr,x=f.city_attr;var j='<select id="zip-lookup-city-state">';a.each(f.city,function(a,b){j=j+'<option value="'+b+'">'+b+"</option>"}),j+="</select>",G.val(n),a("#choose-city").html(j),a("#typed-in-city-state").text(b),K.show(),a("#zip-lookup-city-state").focus()}}else{var k=f.zip_array,l=k.length;if(0==l)0===a("#location-error-message").length&&(d='<span id="location-error-message">No ZIP codes returned. Are you sure the city and state code were entered correctly? (e.g., Durham, NC)</span>',H.append(d));else if(1==l)z="yes",o=f.city,p=f.state,y=f.zip_attr,x=f.city_attr,s=p?o+", "+p:o,n=k[0],D.show(),C.text(s+" ("+n+")"),g(n),B.show(),H.hide(),G.val("");else{o=f.city,p=f.state,s=p?o+", "+p:o,y=f.zip_attr,x=f.city_attr;var m='<select id="city-state-lookup-zips">';a.each(f.zip_array,function(a,b){m=m+'<option value="'+b+'">'+b+"</option>"}),m+="</select>",a("#choose-zip").html(m),a("#typed-in-city-state").text(b),I.show(),a("#city-state-lookup-zips").focus()}}},failure:function(){alert("Was unable to connect to service")}})}function k(){G.removeClass("input-error"),a("#location-error-message").remove()}function l(){return 0==w&&"no"==z?(t="27705",s="Durham, NC"):t=n,a.ajax({url:Drupal.settings.basePath+"save_first_time_user_preferences",type:"POST",data:{skip:1,zip:"",geolocation_used:w,geolocation_zip:t,preferred_name:s},success:function(){a(document).trigger("ee:first_time_user_complete"),a("#location-select").html('<option value="'+n+'" selected>'+s+" ("+n+")</option>").trigger("change"),a(".pane-views-first-time-user-profile-block").dialog("close")}}),!1}var m=a("#first-time-user-block");if(m.length>0){var n="27705",o="Durham",p="NC",q="Urban",r=228330,s="Durham, NC",t="27705",u="Durham",v="NC",w=0,x=[],y=[],z="no",A=a("#select-organization"),B=a("#zip_container"),C=a("#nearest-location"),D=a("#location-description-user"),E=a("#location-description-na"),F=a("#loading-user-location"),G=a("#new-location-input"),H=a("#location-add-new"),I=a("#choose-zip-holder"),J=a("#cancel-zip-select"),K=a("#choose-city-holder");C.text(o+", "+p+" ("+n+")");var L=0;a(".term-name-checkboxes").on("keyup",function(b){13==b.which&&1==L?a(this).trigger("click"):13==b.which&&0==L&&(L+=1)}),a("#change-location").on("click",function(){return B.hide(),G.val(""),H.show(),I.hide(),J.show(),K.hide(),a("#new-location-input").focus(),!1}),a("#confirm-zip-select").on("click",function(){z="yes",n=a("#city-state-lookup-zips").val();var b=y[n].city;g(n),D.show(),C.text(b+" ("+n+")"),B.show(),H.hide(),a("#nearest-location").prop("tabindex",0),a("#nearest-location").focus()}),a("#confirm-city-select").on("click",function(){z="yes",s=a("#zip-lookup-city-state").val();var b=G.val();g(b),D.show(),C.text(s+" ("+b+")"),B.show(),H.hide(),a("#nearest-location").prop("tabindex",0),a("#nearest-location").focus()}),J.on("click",function(){B.show(),H.hide(),I.hide(),K.hide(),k(),J.hide(),a("#change-location").focus()}),G.on("keypress",function(b){a(this);13===b.keyCode&&(b.stopImmediatePropagation(),G.val().length>4&&h())}),a("#add-location").on("click",function(){h()}),A.change(function(){var b=a(this).find("option:selected").text();$local_govern_opts=a("#local-government-options"),"Local government"==b?$local_govern_opts.show():$local_govern_opts.hide()}),a("#save-preferences").click(function(){var b=[],c=A.val(),d=A.find("option:selected").text(),e=a("#select-role").val(),f=0,g=0;if("Local government"==d){var h=a("#community-size").val(),i=a("input[name=community-type]:checked");""!=h&&(f=h),i.length>0&&(g=i.val())}a(".term-name-checkboxes:checked").each(function(){var c=a(this);b.push(c.val())}),a.ajax({url:Drupal.settings.basePath+"save_first_time_user_preferences",type:"POST",data:{skip:0,zip:n,preferred_name:s,geolocation_used:w,geolocation_zip:t,org:c,role:e,comm_size:f,comm_type:g,interests:b},success:function(b){var c=a.parseJSON(b);a(document).trigger("ee:first_time_user_complete"),c.success?a("#location-select").html('<option value="'+n+'" selected>'+s+" ("+n+")</option>").trigger("change"):console.log(c.error_msg),m.dialog("close")}})}),m.dialog({title:"<span>Getting Started</span>What matters to you?",modal:!0,autoOpen:!0,width:1100,height:600,dialogClass:"first-time-user-dialog",closeOnEscape:!1}),a("body").find(".first-time-user-dialog").focus(),a("#skip-preferences").on("click",l),a(m).on("keydown",function(a){27===a.which&&(a.stopImmediatePropagation(),a.preventDefault(),l(),m.dialog("close"))}),a(m).parent().on("keydown",function(a){27===a.which&&(a.stopImmediatePropagation(),a.preventDefault(),l(),m.dialog("close"))}),a("#switch-to-interests").click(function(b){b.preventDefault(),b.stopPropagation(),a(".first-time-first-page").hide(),a(".first-time-second-page").show(),a(".term-name-checkboxes").filter(":first").focus(),a(".term-name-checkboxes").filter(":first").attr("checked",!1)}),a("#switch-to-first-page").click(function(){a(".first-time-first-page").show(),a(".first-time-second-page").hide(),A.focus()}),a(window).resize(function(){m.dialog("option","position",{my:"center",at:"center",of:window})});var M=setTimeout(function(){b()},1e3);c()}})}(jQuery);
//# sourceMappingURL=src/first_time_user_profile.js.map