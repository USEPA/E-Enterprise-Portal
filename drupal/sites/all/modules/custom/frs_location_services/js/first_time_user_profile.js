!function(a){a(document).ready(function(){function b(){B.show(),C.show(),D.hide()}function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(d):alert("Geolocation is not supported by this browser.")}function d(a){var b=a.coords.latitude,c=a.coords.longitude;clearTimeout(K),e(b,c)}function e(c,d){a.ajax({url:Drupal.settings.basePath+"return_location_data_lat_long",type:"GET",async:!1,data:{latitude:c,longitude:d},success:function(c){var c=a.parseJSON(c);return c.error?b():f(c),c},failure:function(){alert("Unable to connect to service")}})}function f(a){C.text("Until you choose a location, the default location will be the location detected by the browser.").show(),s=a.city,t=a.state,r=a.zip,q=s+", "+t,A.text(s+", "+t+" ("+r+")"),l=r,n=t,m=s,u=1,B.show(),D.hide()}function g(b){w&&b in w&&w[b].urban?(p=q&&v&&q in v?v[q].pop:w[b].pop,o=w[b].urban,"urban"===o.toLowerCase()?a('input[name=community-type][value="urban"]').prop("checked",!0):"rural"===o.toLowerCase()?a('input[name=community-type][value="rural"]').prop("checked",!0):a('input[name=community-type][value="_none"]').prop("checked",!0),p<5e3?a("#community-size option:contains(0 - 5,000)").prop("selected",!0):p<1e4?a("#community-size option:contains(5,000 - 10,000)").prop("selected",!0):p<25e3?a("#community-size option:contains(10,000 - 25,000)").prop("selected",!0):p<1e5?a("#community-size option:contains(25,000 - 100,000)").prop("selected",!0):p<1e6?a("#community-size option:contains(100,000 - 1,000,000)").prop("selected",!0):a("#community-size option:contains(1,000,000+)").prop("selected",!0)):(a("input[name=community-type]").prop("checked",!1),a("#community-size").val(""))}function h(b,c){var d="";a.ajax({url:Drupal.settings.basePath+"return_location_data",type:"POST",data:{location:b,initial_login:!0},success:function(e){var f=a.parseJSON(e);if(f.name_city_state){var h=f.city.length;if(0==h)d='<span id="location-error-message">The ZIP code you entered could not be found.</span>',F.append(d),c.addClass("input-error");else if(1==h){x="yes",n=f.state;var i=f.zip;w=f.zip_attr,v=f.city_attr,A.text(f.city[0]+" ("+i+")"),l=i,q=f.city[0],g(l),z.show(),F.hide(),I.hide()}else{l=f.zip,n=f.state,w=f.zip_attr,v=f.city_attr;var j='<select id="zip-lookup-city-state">';a.each(f.city,function(a,b){j=j+'<option value="'+b+'">'+b+"</option>"}),j+="</select>",E.val(l),a("#choose-city").html(j),a("#typed-in-city-state").text(b),I.show(),a("#zip-lookup-city-state").focus()}}else{var k=f.zip_array,o=k.length;if(0==o)d='<span id="location-error-message">No ZIP codes returned. Are you sure the city and state code were entered correctly? (e.g., Durham, NC)</span>',F.append(d);else if(1==o)x="yes",m=f.city,n=f.state,w=f.zip_attr,v=f.city_attr,q=n?m+", "+n:m,l=k[0],B.show(),A.text(q+" ("+l+")"),g(l),z.show(),F.hide(),E.val("");else{m=f.city,n=f.state,q=n?m+", "+n:m,w=f.zip_attr,v=f.city_attr;var p='<select id="city-state-lookup-zips">';a.each(f.zip_array,function(a,b){p=p+'<option value="'+b+'">'+b+"</option>"}),p+="</select>",a("#choose-zip").html(p),a("#typed-in-city-state").text(b),G.show(),a("#city-state-lookup-zips").focus()}}},failure:function(){alert("Was unable to connect to service")}})}function i(){E.removeClass("input-error"),a("#location-error-message").remove()}function j(){return 0==u&&"no"==x?(r="27705",q="Durham, NC"):r=l,a.ajax({url:Drupal.settings.basePath+"save_first_time_user_preferences",type:"POST",data:{skip:1,zip:"",geolocation_used:u,geolocation_zip:r,preferred_name:q},success:function(){a(document).trigger("ee:first_time_user_complete"),a("#location-select").html('<option value="'+l+'" selected>'+q+" ("+l+")</option>").trigger("change"),a(".pane-views-first-time-user-profile-block").dialog("close")}}),!1}var k=a("#first-time-user-block");if(k.length>0){var l="27705",m="Durham",n="NC",o="Urban",p=228330,q="Durham, NC",r="27705",s="Durham",t="NC",u=0,v=[],w=[],x="no",y=a("#select-organization"),z=a("#zip_container"),A=a("#nearest-location"),B=a("#location-description-user"),C=a("#location-description-na"),D=a("#loading-user-location"),E=a("#new-location-input"),F=a("#location-add-new"),G=a("#choose-zip-holder"),H=a("#cancel-zip-select"),I=a("#choose-city-holder");A.text(m+", "+n+" ("+l+")");var J=0;a(".term-name-checkboxes").on("keyup",function(b){13==b.which&&1==J?a(this).trigger("click"):13==b.which&&0==J&&(J+=1)}),a("#change-location").click(function(){return z.hide(),E.val(""),F.show(),G.hide(),H.show(),I.hide(),a("#new-location-input").focus(),!1}),a("#confirm-zip-select").click(function(){x="yes",l=a("#city-state-lookup-zips").val();var b=w[l].city;g(l),B.show(),A.text(b+" ("+l+")"),z.show(),F.hide(),a("#nearest-location").prop("tabindex",0),a("#nearest-location").focus()}),a("#confirm-city-select").click(function(){x="yes",q=a("#zip-lookup-city-state").val();var b=E.val();g(b),B.show(),A.text(q+" ("+b+")"),z.show(),F.hide(),a("#nearest-location").prop("tabindex",0),a("#nearest-location").focus()}),H.click(function(){z.show(),F.hide(),G.hide(),I.hide(),i(),H.hide(),a("#change-location").focus()}),a("#add-location").click(function(){var b=E,c=b.val();/(^\d{5}$)|(^\d{5}-\d{4}$)|(^\d{5}-\d{5}$)/.test(c),/^[\w\s]+,\s*\w{2}$/.test(c);a("#location-error-message").remove(),b.removeClass("input-error"),h(c,b)}),y.change(function(){var b=a(this).find("option:selected").text();$local_govern_opts=a("#local-government-options"),"Local government"==b?$local_govern_opts.show():$local_govern_opts.hide()}),a("#save-preferences").click(function(){var b=[],c=y.val(),d=y.find("option:selected").text(),e=a("#select-role").val(),f=0,g=0;if("Local government"==d){var h=a("#community-size").val(),i=a("input[name=community-type]:checked");""!=h&&(f=h),i.length>0&&(g=i.val())}a(".term-name-checkboxes:checked").each(function(){var c=a(this);b.push(c.val())}),a.ajax({url:Drupal.settings.basePath+"save_first_time_user_preferences",type:"POST",data:{skip:0,zip:l,preferred_name:q,geolocation_used:u,geolocation_zip:r,org:c,role:e,comm_size:f,comm_type:g,interests:b},success:function(b){var c=a.parseJSON(b);a(document).trigger("ee:first_time_user_complete"),c.success?a("#location-select").html('<option value="'+l+'" selected>'+q+" ("+l+")</option>").trigger("change"):console.log(c.error_msg),k.dialog("close")}})}),k.dialog({title:"<span>Getting Started</span>What matters to you?",modal:!0,autoOpen:!0,width:1100,height:600,dialogClass:"first-time-user-dialog",closeOnEscape:!1}),a("body").find(".first-time-user-dialog").focus(),a("#skip-preferences").on("click",j),a(k).on("keydown",function(a){27===a.which&&(a.stopImmediatePropagation(),a.preventDefault(),j(),k.dialog("close"))}),a(k).parent().on("keydown",function(a){27===a.which&&(a.stopImmediatePropagation(),a.preventDefault(),j(),k.dialog("close"))}),a("#switch-to-interests").click(function(b){b.preventDefault(),b.stopPropagation(),a(".first-time-first-page").hide(),a(".first-time-second-page").show(),a(".term-name-checkboxes").filter(":first").focus(),a(".term-name-checkboxes").filter(":first").attr("checked",!1)}),a("#switch-to-first-page").click(function(){a(".first-time-first-page").show(),a(".first-time-second-page").hide(),y.focus()}),a(window).resize(function(){k.dialog("option","position",{my:"center",at:"center",of:window})});var K=setTimeout(function(){b()},1e3);c()}})}(jQuery);
//# sourceMappingURL=src/first_time_user_profile.js.map