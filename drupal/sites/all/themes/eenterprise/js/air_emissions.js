!function(a){"use strict";function b(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("x"),i=c.attr("y")?c.attr("y"):0,j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",h).attr("y",i).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("x",h).attr("y",i).attr("dy",++f*g+j+"em").text(a))})}function c(a){a.each(function(){var a=d3.select(this),b=a.text().split("/");a.text("");for(var c=a.attr("text-anchor"),d=a.attr("x")?a.attr("x"):0,f=a.attr("y")?a.attr("y"):0,g=0;g<b.length;g++){var h=a.append("tspan").html(b[g]).attr("text-anchor",c).attr("x",d).attr("y",f).attr("dy","0");g>0&&h.attr("text-anchor",c).attr("x",d).attr("y",f).attr("dy",e*g)}})}function d(a){a.each(function(){var a=d3.select(this),b=a.text().match(/(.*)([0-9])(.*)/);if(b){a.text("");for(var c=1;c<b.length;c++){var d=a.append("tspan").text(b[c]);2==c&&(d.attr("baseline-shift","sub"),d.style("font-size","80%"))}}})}a(document).ready(function(){h()});var e=18,f=function(a,c,d,f,g){var h=d3.format(",.0f"),i=Math.min(d,f)/2,j=d3.scale.ordinal().range(["#857e00","#f69000","#a55d8c"]),k=0;a.Facilities.forEach(function(a){k+=a.TotEmissCO2E});var l=d3.svg.arc().outerRadius(.7*i).innerRadius(.5*i),m=d3.svg.arc().outerRadius(i).innerRadius(i),n=d3.layout.pie().sort(null).value(function(a){return a.TotEmissCO2E}),c=d3.select("#air-emissions-chart").append("svg").attr("viewBox","0 0 "+g+" "+f).attr("preserveAspectRatio","xMidYMid").style("max-width",g+"px"),o=c.append("g").attr("transform","translate("+g/2+","+f/2+")"),p=o.selectAll(".arc").data(n(a.Facilities)).enter().append("g").attr("class","arc");p.append("path").attr("d",l).style("fill",function(a){return j(a.data.TotEmissCO2E)});var q=p.append("text").attr({x:function(a,b){var c=m.centroid(a),d=Math.atan2(c[1],c[0]),e=Math.cos(d)*i,f=e>0?1:-1,g=e+5*f;return g},y:function(a,b){var c=m.centroid(a),d=Math.atan2(c[1],c[0]),e=Math.sin(d)*i;return e},"text-anchor":function(a,b){var c=m.centroid(a),d=Math.atan2(c[1],c[0]),e=Math.cos(d)*i;return e>0?"start":"end"},dy:0}).text(function(a){return a.data.FacName}).call(b,g/2-i),r=q.append("tspan").attr("x",function(){return d3.select(this.parentNode).attr("x")}).attr("dy",e).attr("class","emissions-watch-donut-small-subtitle");r.append("tspan").text(function(a){return h(a.data.TotEmissCO2E)+" metric tons CO"}),r.append("tspan").attr("baseline-shift","sub").style("font-size","80%").text("2"),r.append("tspan").text("e"),q.append("tspan").text(function(a){return a.data.FacDistMi+" miles away"}).attr("x",function(){return d3.select(this.parentNode).attr("x")}).attr("dy",e).attr("class","emissions-watch-donut-small-subtitle");var s=o.append("text").attr("text-anchor","middle").attr("dy",0).attr("y",-9).attr("x",0).text(h(k));s.append("tspan").attr("dy",e).attr("x",0).attr("class","emissions-watch-donut-small-subtitle").text("metric tons"),s.append("tspan").attr("dy",e).attr("x",0).attr("class","emissions-watch-donut-small-subtitle").text("CO"),s.append("tspan").attr("baseline-shift","sub").style("font-size","64%").attr("class","emissions-watch-donut-small-subtitle").text("2"),s.append("tspan").attr("class","emissions-watch-donut-small-subtitle").text("e");var t;q.each(function(){(!t||this.getBoundingClientRect().bottom>t.getBoundingClientRect().bottom)&&(t=this)}),c.attr("viewBox","0 0 "+g+" "+(f+t.clientHeight))},g=function(a){var g=d3.format(",.0f"),h=0,i=0,j={},k={};a.Facilities.forEach(function(a,b){j[a.FacID]=b,a.FacDistMi>h&&(h=a.FacDistMi),a.TotEmissCO2E>i&&(i=a.TotEmissCO2E),a.Pollutants&&a.Pollutants.forEach(function(a){k[a.PollutantName]=1});var c=0;a.sections=a.Pollutants.map(function(a){return{name:a.PollutantName,y0:c,y1:c+=+a.AmtCO2E}})});var l={PFC:"gas-pfc",HFC:"gas-hfc",NF3:"gas-nf3",SF6:"gas-sf6",N2O:"gas-n2o",CH4:"gas-ch4",CO2:"gas-co2"},m={top:0,right:20,bottom:100,left:140},n=650-m.left-m.right,o=300-m.top-m.bottom,p=8*e;m.top+=p;var q=200,r=200,s=n+m.left+m.right,t=o+m.top+m.bottom;f(a,y,q,r,s);var u=d3.scale.ordinal().rangeRoundBands([0,n],.1).domain(a.Facilities.map(function(a){return a.FacID})),v=d3.scale.linear().domain([0,i]).range([o,0]),w=(d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),d3.svg.axis().scale(u).tickFormat(function(b){return a.Facilities[j[b]].FacName}).orient("bottom")),x=d3.svg.axis().scale(v).orient("left").ticks(5).tickSize(-n).tickFormat(d3.format(".2s")),y=d3.select("#air-emissions-chart").append("svg").attr("viewBox","0 0 "+s+" "+t).attr("preserveAspectRatio","xMidYMid").style("max-width",s+"px"),z=y.append("g").attr("transform","translate("+m.left+","+m.top+")"),A=z.append("g").attr("class","y axis").call(x),B=z.selectAll(".facility").data(a.Facilities).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+u(a.FacID)+",0)"}),C=(B.selectAll("rect").data(function(a){return a.sections}).enter().append("rect").attr("width",u.rangeBand()).attr("y",function(a){return v(a.y1)}).attr("height",function(a){return v(a.y0)-v(a.y1)}).attr("class",function(a){return l[a.name]}),z.append("g").attr("class","x axis").attr("transform","translate("+-u.rangeBand()/2+","+o+")").call(w).selectAll(".tick text").style("text-anchor","start").call(b,u.rangeBand())),D=C.append("tspan").attr("x",function(){return d3.select(this.parentNode).attr("x")}).attr("dy",e).attr("text-anchor","start").attr("class","emissions-watch-donut-small-subtitle");D.append("tspan").text(function(b){return g(a.Facilities[j[b]].TotEmissCO2E)+" metric tons CO"}),D.append("tspan").attr("baseline-shift","sub").style("font-size","80%").text("2"),D.append("tspan").text("e"),C.append("tspan").text(function(b){return a.Facilities[j[b]].FacDistMi+" miles away"}).attr("x",function(){return d3.select(this.parentNode).attr("x")}).attr("dy",e).attr("text-anchor","start").attr("class","emissions-watch-donut-small-subtitle");var E=C.append("tspan").text(function(b){return a.Facilities[j[b]].Pollutants.reverse().map(function(a){return a.PollutantName+": "}).join("/")}).attr("x",function(){return 0}).attr("y",function(b){return-v(i-a.Facilities[j[b]].TotEmissCO2E)-e*a.Facilities[j[b]].Pollutants.length}).attr("text-anchor","start").attr("class","emissions-watch-bar-chart-small-subtitle").call(c);E.selectAll("tspan").call(d),C.append("tspan").text(function(b){return a.Facilities[j[b]].Pollutants.map(function(a){return g(a.AmtCO2E)}).join("/")}).attr("x",function(){return u.rangeBand()}).attr("y",function(b){return-v(i-a.Facilities[j[b]].TotEmissCO2E)-e*a.Facilities[j[b]].Pollutants.length}).attr("text-anchor","end").attr("class","emissions-watch-bar-chart-small-subtitle").call(c),A.append("text").text("Emissions").attr("transform","translate(-140,0)").style("font-size","80%").append("tspan").text("(metric tons CO2e)").attr("x",0).attr("dy",e).attr("class","emissions-watch-bar-chart-small-subtitle").call(d);var F=A.append("g").attr("transform","translate(-140, 50)").attr("class","legend");F.append("text").text("Legend").attr("x",0).attr("y",0).style("fill","black");var G=e/2,H=F.selectAll("g").data(Object.keys(k)).enter().append("g");H.append("rect").attr("width",u.rangeBand()/3).attr("x",0).attr("y",function(a,b){return G+b*e}).attr("height",e).attr("class",function(a){return l[a]}),H.append("text").text(function(a){return a}).attr("x",0).attr("y",function(a,b){return G+(b+1)*e-e/3}).attr("text-anchor","middle").attr("transform","translate("+u.rangeBand()/6+",0)").call(d)},h=function(){var a={ZipCentLat83:32.8,ZipCentLong83:-96.8,BuffRadiusMi:10,Facilities:[{FacID:1001398,FacName:"Atmos Energy Corporation - Texas",FacLat83:32.925488,FacLong83:-96.816137,FacDistMi:8.72,TotEmissCO2E:544204,Pollutants:[{PollutantName:"CH4",AmtCO2E:543549},{PollutantName:"CO2",AmtCO2E:655}]},{FacID:1006817,FacName:"McCommas Bluff Landfill",FacLat83:32.67628,FacLong83:-96.73391,FacDistMi:9.37,TotEmissCO2E:420239.25,Pollutants:[{PollutantName:"CH4",AmtCO2E:420239.25}]},{FacID:1003945,FacName:"TEXAS INSTRUMENTS NORTH CAMPUS",FacLat83:32.93311,FacLong83:-96.7537,FacDistMi:9.58,TotEmissCO2E:531866.507,Pollutants:[{PollutantName:"PFC",AmtCO2E:399276.483},{PollutantName:"HFC",AmtCO2E:8872.334},{PollutantName:"NF3",AmtCO2E:31682.4},{PollutantName:"SF6",AmtCO2E:29906.76},{PollutantName:"N2O",AmtCO2E:12737.414},{PollutantName:"CH4",AmtCO2E:23},{PollutantName:"CO2",AmtCO2E:49340.7}]}]};g(a)}}(jQuery);
//# sourceMappingURL=air_emissions.js.map