// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.11/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,p,g,q,h,c){n=q("dijit._OnDijitClickMixin",null,{connect:function(g,b,v){return this.inherited(arguments,[g,"ondijitclick"==b?c:b,v])}});n.a11yclick=c;return n})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(n,p,g,q,h,c,t){var b={_isElementShown:function(b){var a=
q.get(b);return"hidden"!=a.visibility&&"collapsed"!=a.visibility&&"none"!=a.display&&"hidden"!=g.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return g.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var a;try{var c=b.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;a=c.body}catch(q){try{a=b.contentWindow.document.body}catch(p){return!1}}return a&&("true"==a.contentEditable||
a.firstChild&&"true"==a.firstChild.contentEditable);default:return"true"==b.contentEditable}},effectiveTabIndex:function(c){return g.get(c,"disabled")?void 0:g.has(c,"tabIndex")?+g.get(c,"tabIndex"):b.hasDefaultTabStop(c)?0:void 0},isTabNavigable:function(c){return 0<=b.effectiveTabIndex(c)},isFocusable:function(c){return-1<=b.effectiveTabIndex(c)},_getTabNavigable:function(v){function a(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}
var m,q,p,h,t,n,z={},E=b._isElementShown,B=b.effectiveTabIndex,s=function(r){for(r=r.firstChild;r;r=r.nextSibling)if(!(1!=r.nodeType||9>=c("ie")&&"HTML"!==r.scopeName||!E(r))){var k=B(r);if(0<=k){if(0==k)m||(m=r),q=r;else if(0<k){if(!p||k<h)h=k,p=r;if(!t||k>=n)n=k,t=r}k=a(r);g.get(r,"checked")&&k&&(z[k]=r)}"SELECT"!=r.nodeName.toUpperCase()&&s(r)}};E(v)&&s(v);return{first:z[a(m)]||m,last:z[a(q)]||q,lowest:z[a(p)]||p,highest:z[a(t)]||t}},getFirstInTabbingOrder:function(c,a){var g=b._getTabNavigable(p.byId(c,
a));return g.lowest?g.lowest:g.first},getLastInTabbingOrder:function(c,a){var g=b._getTabNavigable(p.byId(c,a));return g.last?g.last:g.highest}};h.mixin(t,b);return b})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(n,p,g,q){function h(b){if((b.keyCode===n.ENTER||b.keyCode===n.SPACE)&&!/input|button|textarea/i.test(b.target.nodeName))for(b=b.target;b;b=b.parentNode)if(b.dojoClick)return!0}var c;g(document,"keydown",function(b){h(b)?(c=b.target,b.preventDefault()):
c=null});g(document,"keyup",function(b){h(b)&&b.target==c&&(c=null,g.emit(b.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:b.ctrlKey,shiftKey:b.shiftKey,metaKey:b.metaKey,altKey:b.altKey,_origType:b.type}))});var t=function(b,c){b.dojoClick=!0;return g(b,"click",c)};t.click=t;t.press=function(b,c){var a=g(b,q.press,function(a){("mousedown"!=a.type||p.isLeft(a))&&c(a)}),m=g(b,"keydown",function(a){(a.keyCode===n.ENTER||a.keyCode===n.SPACE)&&c(a)});return{remove:function(){a.remove();m.remove()}}};
t.release=function(b,c){var a=g(b,q.release,function(a){("mouseup"!=a.type||p.isLeft(a))&&c(a)}),m=g(b,"keyup",function(a){(a.keyCode===n.ENTER||a.keyCode===n.SPACE)&&c(a)});return{remove:function(){a.remove();m.remove()}}};t.move=q.move;return t})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),function(n,p,g,q,h,c){n=n([c],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(c){h.isDefined(this.visibility)&&
(this.visible=!!this.visibility)}});g("extend-esri")&&p.setObject("layers.KMLGroundOverlay",n,q);return n})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(n,p,g,q,h,c,t,b,v,a){function m(e,d,l){return C&&l?function(e,f){return c(e,l,f)}:z?function(l,y){var k=c(l,d,function(e){y.call(this,e);f=(new Date).getTime()}),a=c(l,e,function(e){(!f||(new Date).getTime()>f+1E3)&&y.call(this,e)});return{remove:function(){k.remove();
a.remove()}}}:function(f,d){return c(f,e,d)}}function x(e){do if(void 0!==e.dojoClick)return e;while(e=e.parentNode)}function D(f,y,z){var b=x(f.target);if(B=!f.target.disabled&&b&&b.dojoClick)if(r=(s="useTarget"==B)?b:f.target,s&&f.preventDefault(),k=f.changedTouches?f.changedTouches[0].pageX-a.global.pageXOffset:f.clientX,A=f.changedTouches?f.changedTouches[0].pageY-a.global.pageYOffset:f.clientY,d=("object"==typeof B?B.x:"number"==typeof B?B:0)||4,l=("object"==typeof B?B.y:"number"==typeof B?B:
0)||4,!E){E=!0;var m=function(e){B=s?g.isDescendant(a.doc.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-a.global.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-a.global.pageYOffset:e.clientY),r):B&&(e.changedTouches?e.changedTouches[0].target:e.target)==r&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-a.global.pageXOffset:e.clientX)-k)<=d&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-a.global.pageYOffset:e.clientY)-A)<=l};a.doc.addEventListener(y,function(e){m(e);
s&&e.preventDefault()},!0);a.doc.addEventListener(z,function(f){m(f);if(B){e=(new Date).getTime();var d=s?r:f.target;"LABEL"===d.tagName&&(d=g.byId(d.getAttribute("for"))||d);var l=f.changedTouches?f.changedTouches[0]:f,y=document.createEvent("MouseEvents");y._dojo_click=!0;y.initMouseEvent("click",!0,!0,f.view,f.detail,l.screenX,l.screenY,l.clientX,l.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,0,null);setTimeout(function(){c.emit(d,"click",y);e=(new Date).getTime()},0)}},!0);f=function(f){a.doc.addEventListener(f,
function(d){!d._dojo_click&&((new Date).getTime()<=e+1E3&&!("INPUT"==d.target.tagName&&q.contains(d.target,"dijitOffScreen")))&&(d.stopPropagation(),d.stopImmediatePropagation&&d.stopImmediatePropagation(),"click"==f&&(("INPUT"!=d.target.tagName||"radio"==d.target.type||"checkbox"==d.target.type)&&"TEXTAREA"!=d.target.tagName&&"AUDIO"!=d.target.tagName&&"VIDEO"!=d.target.tagName)&&d.preventDefault())},!0)};f("click");f("mousedown");f("mouseup")}}var w=5>t("ios"),C=t("pointer-events")||t("MSPointer"),
u=function(){var e={},f;for(f in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[f]=t("MSPointer")?"MSPointer"+f.charAt(0).toUpperCase()+f.slice(1):"pointer"+f;return e}(),z=t("touch-events"),E,B,s=!1,r,k,A,d,l,e,f,y;C?v(function(){a.doc.addEventListener(u.down,function(e){D(e,u.move,u.up)},!0)}):z&&v(function(){function e(f){var d=h.delegate(f,{bubbles:!0});6<=t("ios")&&(d.touches=f.touches,d.altKey=f.altKey,d.changedTouches=f.changedTouches,d.ctrlKey=f.ctrlKey,d.metaKey=f.metaKey,d.shiftKey=f.shiftKey,
d.targetTouches=f.targetTouches);return d}y=a.body();a.doc.addEventListener("touchstart",function(e){f=(new Date).getTime();var d=y;y=e.target;c.emit(d,"dojotouchout",{relatedTarget:y,bubbles:!0});c.emit(y,"dojotouchover",{relatedTarget:d,bubbles:!0});D(e,"touchmove","touchend")},!0);c(a.doc,"touchmove",function(d){f=(new Date).getTime();var l=a.doc.elementFromPoint(d.pageX-(w?0:a.global.pageXOffset),d.pageY-(w?0:a.global.pageYOffset));l&&(y!==l&&(c.emit(y,"dojotouchout",{relatedTarget:l,bubbles:!0}),
c.emit(l,"dojotouchover",{relatedTarget:y,bubbles:!0}),y=l),c.emit(l,"dojotouchmove",e(d))||d.preventDefault())});c(a.doc,"touchend",function(d){f=(new Date).getTime();var l=a.doc.elementFromPoint(d.pageX-(w?0:a.global.pageXOffset),d.pageY-(w?0:a.global.pageYOffset))||a.body();c.emit(l,"dojotouchend",e(d))})});p={press:m("mousedown","touchstart",u.down),move:m("mousemove","dojotouchmove",u.move),release:m("mouseup","dojotouchend",u.up),cancel:m(b.leave,"touchcancel",C?u.cancel:null),over:m("mouseover",
"dojotouchover",u.over),out:m("mouseout","dojotouchout",u.out),enter:b._eventHandler(m("mouseover","dojotouchover",u.over)),leave:b._eventHandler(m("mouseout","dojotouchout",u.out))};return n.touch=p})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,p,g,q,h,c,t,b,v){var a=h.delegate(b,{mouseenter:c.enter,mouseleave:c.leave,keypress:g._keypress}),m;g=q("dijit._AttachMixin",
null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var b=a;;)if(1==b.nodeType&&(this._processTemplateNode(b,function(a,b){return a.getAttribute(b)},this._attach)||this.searchContainerNode)&&b.firstChild)b=b.firstChild;else{if(b==a)break;for(;!b.nextSibling;)if(b=b.parentNode,b==a)return;b=
b.nextSibling}},_processTemplateNode:function(a,b,c){var g=!0,m=this.attachScope||this,z=b(a,"dojoAttachPoint")||b(a,"data-dojo-attach-point");if(z)for(var E=z.split(/\s*,\s*/);z=E.shift();)h.isArray(m[z])?m[z].push(a):m[z]=a,g="containerNode"!=z,this._attachPoints.push(z);if(b=b(a,"dojoAttachEvent")||b(a,"data-dojo-attach-event")){z=b.split(/\s*,\s*/);for(E=h.trim;b=z.shift();)if(b){var B=null;-1!=b.indexOf(":")?(B=b.split(":"),b=E(B[0]),B=E(B[1])):b=E(b);B||(B=b);this._attachEvents.push(c(a,b,h.hitch(m,
B)))}}return g},_attach:function(b,c,g){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?m||(m=n("./a11yclick")):a[c]||c;return t(b,c,g)},_detachTemplateNodes:function(){var a=this.attachScope||this;p.forEach(this._attachPoints,function(b){delete a[b]});this._attachPoints=[];p.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});h.extend(v,{dojoAttachEvent:"",dojoAttachPoint:""});return g})},
"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,p,g,q,h,c,t,b,v,a,m,x,D,w,C,u){n=n(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){p.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels=
{},s=this._fieldsMap={};a.fieldInfos&&g.forEach(a.fieldInfos,function(a){c[a.fieldName]=a.label;s[a.fieldName]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return q.fromJson(q.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(a){var b=this.info,c=new t,s,r;b.fieldInfos&&(r=g.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},
this));r&&0<r.length&&(s=this._getRelatedRecords({graphic:a,fieldsInfo:r}));s?s.always(p.hitch(this,function(){c.resolve(this._getPopupValues(a))})):c.resolve(this._getPopupValues(a));return c.promise},_getPopupValues:function(b,c){var m=this.info,s=b.getLayer(),r=p.clone(b.attributes)||{},k=p.clone(r),A=m.fieldInfos,d="",l="",e,f,y,K,H,q=s&&s._getDateOpts&&s._getDateOpts().properties,h={dateFormat:{properties:q,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(K in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(K)){var v=
this._relatedInfo[K],t=this._relatedLayersInfo[K];v&&(g.forEach(v.relatedFeatures,function(e){for(H in e.attributes)if(e.attributes.hasOwnProperty(H)&&"esriRelCardinalityOneToOne"===t.relation.cardinality){var f=this._toRelatedFieldName([t.relation.id,H]);r[f]=k[f]=e.attributes[H]}},this),g.forEach(v.relatedStatsFeatures,function(e){for(H in e.attributes)if(e.attributes.hasOwnProperty(H)){var f=this._toRelatedFieldName([t.relation.id,H]);r[f]=k[f]=e.attributes[H]}},this))}A&&g.forEach(A,function(e){f=
e.fieldName;k[f]=this._formatValue(k[f],f,h);q&&(e.format&&e.format.dateFormat)&&(e=g.indexOf(q,f),-1<e&&q.splice(e,1))},this);if(s){K=s.types;var n=(v=s.typeIdField)&&r[v];for(f in r)if(r.hasOwnProperty(f)&&-1===f.indexOf(this._relatedFieldPrefix)&&(y=r[f],a.isDefined(y))){var u=this._getDomainName(s,K,n,f,y);a.isDefined(u)?k[f]=u:f===v&&(u=this._getTypeName(s,y),a.isDefined(u)&&(k[f]=u))}}m.title&&(d=this._processFieldsInLinks(this._fixTokens(m.title),r),d=p.trim(a.substitute(k,d,h)||""));if(c)return{title:d};
m.description&&(l=this._processFieldsInLinks(this._fixTokens(m.description),r),l=p.trim(a.substitute(k,l,h)||""));A&&(e=[],g.forEach(A,function(d){(f=d.fieldName)&&d.visible&&e.push([d.label||f,a.substitute(k,"${"+f+"}",h)||""])}));var w,x;m.mediaInfos&&(w=[],g.forEach(m.mediaInfos,function(e){x=0;y=e.value;switch(e.type){case "image":var f=y.sourceURL,f=f&&p.trim(a.substitute(r,this._fixTokens(f)));x=!!f;break;case "piechart":case "linechart":case "columnchart":case "barchart":x=g.some(y.fields,
function(e){return a.isDefined(r[e])||-1!==e.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(x){e=p.clone(e);y=e.value;var f=e.title?this._processFieldsInLinks(this._fixTokens(e.title),r):"",d=e.caption?this._processFieldsInLinks(this._fixTokens(e.caption),r):"";e.title=f?p.trim(a.substitute(k,f,h)||""):"";e.caption=d?p.trim(a.substitute(k,d,h)||""):"";if("image"===e.type)y.sourceURL=a.substitute(r,this._fixTokens(y.sourceURL)),y.linkURL&&(y.linkURL=p.trim(a.substitute(r,
this._fixTokens(y.linkURL))||""));else{var l,b;g.forEach(y.fields,function(e,f){if(-1!==e.indexOf(this._relatedFieldPrefix))b=this._getRelatedChartInfos(e,y,r,h),b instanceof Array?y.fields=b:y.fields[f]=b;else{var d=r[e],d=void 0===d?null:d;l=r[y.normalizeField]||0;d&&l&&(d/=l);y.fields[f]={y:d,tooltip:(this._fieldLabels[e]||e)+":\x3cbr/\x3e"+this._formatValue(d,e,h,!!l)}}},this)}w.push(e)}},this));return{title:d,description:l,fields:e&&e.length?e:null,mediaInfos:w&&w.length?w:null,formatted:k,editSummary:s&&
s.getEditSummary?s.getEditSummary(b):""}},_getRelatedChartInfos:function(a,b,c,s){var r,k,A,d,l,e;r=[];e=this._fromRelatedFieldName(a);l=e[0];k=this._relatedInfo[l];l=this._relatedLayersInfo[l];k&&g.forEach(k.relatedFeatures,function(f){f=f.attributes;var l,k;for(k in f)if(f.hasOwnProperty(k)&&k===e[1]){l={};d=f[k];b.normalizeField&&(A=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?f[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);d&&A&&(d/=A);if(b.tooltipField)if(-1!==
b.tooltipField.indexOf(this._relatedFieldPrefix)){var g=this._fromRelatedFieldName(b.tooltipField)[1];l.tooltip=f[g]+":\x3cbr/\x3e"+this._formatValue(d,f[g],s,!!A)}else l.tooltip=(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(d,b.tooltipField,s,!!A);else l.tooltip=d;l.y=d;r.push(l)}},this);return"esriRelCardinalityOneToMany"===l.relation.cardinality||"esriRelCardinalityManyToMany"===l.relation.cardinality?r:r[0]},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&
(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",
shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"[^\"]+\"/ig,_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_processFieldsInLinks:function(b,c){return b&&b.replace(this._reHref,function(b){return b=a.substitute(c,b)})},_formatValue:function(b,c,m,
s){var r=this._fieldsMap[c],k=r&&r.format;c="number"===typeof b&&-1===g.indexOf(m.dateFormat.properties,c)&&(!k||!k.dateFormat);if(!a.isDefined(b)||!r||!a.isDefined(k))return c?this._forceLTR(b):b;var A="",d=[],r=k.hasOwnProperty("places")||k.hasOwnProperty("digitSeparator"),l=k.hasOwnProperty("digitSeparator")?k.digitSeparator:!0;if(r)A="NumberFormat",d.push("places: "+(a.isDefined(k.places)&&(!s||0<k.places)?Number(k.places):"Infinity")),d.length&&(A+="("+d.join(",")+")");else if(k.dateFormat)A=
"DateFormat"+this._insertOffset(this._dateFormats[k.dateFormat]||this._dateFormats.shortDateShortTime);else return c?this._forceLTR(b):b;b=a.substitute({myKey:b},"${myKey:"+A+"}",m)||"";r&&!l&&u.group&&(b=b.replace(RegExp("\\"+u.group,"g"),""));return c?this._forceLTR(b):b},_forceLTR:function(a){var c=b("ie");return c&&10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(b){b&&(b=a.isDefined(this.utcOffset)?b.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):
b);return b},_getDomainName:function(b,c,m,s,r){var k,A;c&&a.isDefined(m)&&g.some(c,function(d){if(d.id==m){if((k=d.domains&&d.domains[s])&&"inherited"===k.type)k=this._getLayerDomain(b,s),A=!0;return!0}return!1},this);!A&&!k&&(k=this._getLayerDomain(b,s));if(k&&k.codedValues){var d;g.some(k.codedValues,function(l){return l.code==r?(d=l.name,!0):!1});return d}},_getLayerDomain:function(a,b){var c=a.fields;if(c){var s;g.some(c,function(a){return a.name===b?(s=a.domain,!0):!1});return s}},_getTypeName:function(a,
b){var c=a.types;if(c){var s;g.some(c,function(a){return a.id==b?(s=a.name,!0):!1});return s}},_getRelatedRecords:function(a){var b=a.graphic,c=new t,g;this._relatedLayersInfo?this._queryRelatedLayers(b).then(p.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),p.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(p.hitch(this,function(a){for(g in a)a.hasOwnProperty(g)&&a[g]&&(this._relatedLayersInfo[g].relatedLayerInfo=a[g]);this._queryRelatedLayers(b).then(p.hitch(this,
function(a){this._setRelatedRecords(b,a);c.resolve(a)}),p.hitch(this,this._handlerErrorResponse,c))}),p.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var b=a.fieldsInfo,c,m,r={};c=a.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});g.forEach(b,function(a){var b,d,l,e;b=this._fromRelatedFieldName(a.fieldName);d=b[0];b=b[1];d&&(this._relatedLayersInfo[d]||(g.some(c.relationships,function(f){if(f.id==d)return e=f,!0}),e&&(this._relatedLayersInfo[d]=
{relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[d]&&(this._relatedLayersInfo[d].relatedFields.push(b),a.statisticType&&(l=new C,l.statisticType=a.statisticType,l.onStatisticField=b,l.outStatisticFieldName=b,this._relatedLayersInfo[d].outStatistics.push(l))))},this);for(m in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(m)&&this._relatedLayersInfo[m]&&(a=this._relatedLayersInfo[m].relation,a=c.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[m].relatedLayerUrl=
a,r[m]=x({url:a,content:{f:"json"},callbackParamName:"callback"}));return v(r)},_queryRelatedLayers:function(a){var b={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&(b[c]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[c]}));return v(b)},_queryRelatedLayer:function(a){var b,c,m,r,k,A,d,l,e,f;b=a.graphic;c=b.getLayer().url.match(/[0-9]+$/g)[0];l=a.relatedInfo;d=l.relatedLayerInfo;e=l.relatedLayerUrl;f=l.relation;g.some(d.relationships,function(e){if(e.relatedTableId===
parseInt(c,10))return m=e,!0},this);m&&(a=new D,g.some(d.fields,function(e){if(e.name===m.keyField)return k=-1!==g.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],e.type)?"number":"string",!0}),r="string"===k?m.keyField+"\x3d'"+b.attributes[f.keyField]+"'":m.keyField+"\x3d"+b.attributes[f.keyField],a.where=r,a.outFields=l.relatedFields,l.outStatistics&&(0<l.outStatistics.length&&d.supportsStatistics)&&(A=new D,A.where=a.where,A.outFields=a.outFields,
A.outStatistics=l.outStatistics),b=new w(e),r=[],r.push(b.execute(a)),A&&r.push(b.execute(A)));return v(r)},_setRelatedRecords:function(b,c){this._relatedInfo=[];for(var m in c)if(c.hasOwnProperty(m)&&c[m]){var g=c[m];this._relatedInfo[m]={};this._relatedInfo[m].relatedFeatures=g[0].features;a.isDefined(g[1])&&(this._relatedInfo[m].relatedStatsFeatures=g[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&
(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});c("extend-esri")&&(m.PopupInfo=m.PopupInfoTemplate=n);return n})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(n,p,g,q,h,c,
t,b,v,a,m,x,D,w,C,u,z){var E,B,s=new (p([x,t],{curNode:null,activeStack:[],constructor:function(){var a=b.hitch(this,function(a){g.isDescendant(this.curNode,a)&&this.set("curNode",null);g.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});n.before(c,"empty",a);n.before(c,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var d=this,l=a.document&&a.document.body;if(l){var e=m("pointer-events")?"pointerdown":m("MSPointer")?"MSPointerDown":
m("touch-events")?"mousedown, touchstart":"mousedown",f=v(a.document,e,function(e){if(!e||!(e.target&&null==e.target.parentNode))d._onTouchNode(b||e.target,"mouse")}),y=v(l,"focusin",function(e){if(e.target.tagName){var f=e.target.tagName.toLowerCase();"#document"==f||"body"==f||(C.isFocusable(e.target)?d._onFocusNode(b||e.target):d._onTouchNode(b||e.target))}}),c=v(l,"focusout",function(e){d._onBlurNode(b||e.target)});return{remove:function(){f.remove();y.remove();c.remove();l=f=y=c=null}}}},_onBlurNode:function(a){a=
(new Date).getTime();a<E+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(b.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<B+100||(this._clearActiveWidgetsTimer=setTimeout(b.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){B=(new Date).getTime();this._clearActiveWidgetsTimer&&
(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);h.contains(a,"dijitPopup")&&(a=a.firstChild);var d=[];try{for(;a;){var l=q.get(a,"dijitPopupParent");if(l)a=u.byId(l).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===D.body())break;a=w.get(a.ownerDocument).frameElement}else{var e=a.getAttribute&&a.getAttribute("widgetId"),f=e&&u.byId(e);f&&!("mouse"==b&&f.get("disabled"))&&d.unshift(e);a=a.parentNode}}}catch(y){}this._setStack(d,b)},_onFocusNode:function(a){a&&
9!=a.nodeType&&(E=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var d=this.activeStack,l=d.length-1,e=a.length-1;if(a[e]!=d[l]){this.set("activeStack",a);var f;for(f=l;0<=f&&d[f]!=a[f];f--)if(l=u.byId(d[f]))l._hasBeenBlurred=!0,l.set("focused",!1),l._focusManager==this&&l._onBlur(b),this.emit("widget-blur",l,b);for(f++;f<=
e;f++)if(l=u.byId(a[f]))l.set("focused",!0),l._focusManager==this&&l._onFocus(b),this.emit("widget-focus",l,b)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));a(function(){var a=s.registerWin(w.get(document));m("ie")&&v(window,"unload",function(){a&&(a.remove(),a=null)})});z.focus=function(a){s.focus(a)};for(var r in s)/^_/.test(r)||(z.focus[r]="function"==typeof s[r]?b.hitch(s,r):s[r]);s.watch(function(a,b,d){z.focus[a]=d});return s})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(n,p,g,q,h,c){return n([c,h],{_onMap:function(c){var b=this.constructor._onMap,g;if(!b||!b.FINAL)delete this.constructor._onMap,b=this.registerConnectEvents(),b.FINAL=!0;c=c.toLowerCase();b[c]?g=this[b[c].method]:(c=this._onCamelCase(c),this[c]&&(g=c));return g},on:function(c,b){var g=this._onMap(c),a=c.replace(/\-/g,""),m="on"+a in this.domNode;return g||!m?this.inherited(arguments):this.own(q(this.domNode,a,b))[0]},emit:function(c,b,g){var a,m,q,h=c.toLowerCase(),n=this.constructor._onMap||
this.registerConnectEvents();m=this[this._onMap(h)];b=b||{};b.target||(b.target=this);m&&(n&&n[h])&&(this._onObj2Arr(function(){a=Array.prototype.slice.call(arguments)},n[h].argKeys)(b),q=p.mixin({},arguments),q[2]=a,q[0]=n[h].name.replace(/^on/,""));return this.inherited(q||arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(n,p,g,q,h,c,t,b,v,a,m,x,D,w,C,u){function z(a){return eval("("+a+")")}function E(a){var d=a._nameCaseMap,b=a.prototype;if(!d||d._extendCnt<s){var d=a._nameCaseMap={},e;for(e in b)"_"!==e.charAt(0)&&(d[e.toLowerCase()]=e);d._extendCnt=s}return d}function B(a,d){var b=a.join();if(!r[b]){for(var e=[],f=0,c=a.length;f<c;f++){var k=a[f];e[e.length]=r[k]=r[k]||g.getObject(k)||~k.indexOf("/")&&(d?d(k):n(k))}f=e.shift();r[b]=e.length?f.createSubclass?f.createSubclass(e):f.extend.apply(f,e):f}return r[b]}
new Date("X");var s=0;v.after(g,"extend",function(){s++},!0);var r={},k={_clearCache:function(){s++;r={}},_functionFromScript:function(a,d){var b="",e="",f=a.getAttribute(d+"args")||a.getAttribute("args"),c=a.getAttribute("with"),f=(f||"").split(/\s*,\s*/);c&&c.length&&q.forEach(c.split(/\s*,\s*/),function(a){b+="with("+a+"){";e+="}"});return new Function(f,b+a.innerHTML+e)},instantiate:function(a,d,b){d=d||{};b=b||{};var e=(b.scope||p._scopeName)+"Type",f="data-"+(b.scope||p._scopeName)+"-",c=f+
"type",k=f+"mixins",g=[];q.forEach(a,function(a){var f=e in d?d[e]:a.getAttribute(c)||a.getAttribute(e);if(f){var b=a.getAttribute(k),f=b?[f].concat(b.split(/\s*,\s*/)):[f];g.push({node:a,types:f})}});return this._instantiate(g,d,b)},_instantiate:function(b,d,l,e){function f(e){!d._started&&!l.noStart&&q.forEach(e,function(e){"function"===typeof e.startup&&!e._started&&e.startup()});return e}b=q.map(b,function(e){var a=e.ctor||B(e.types,l.contextRequire);if(!a)throw Error("Unable to resolve constructor for: '"+
e.types.join()+"'");return this.construct(a,e.node,d,l,e.scripts,e.inherited)},this);return e?a(b).then(f):f(b)},construct:function(a,d,l,e,f,c){function k(e){B&&g.setObject(B,e);for(u=0;u<G.length;u++)v[G[u].advice||"after"](e,G[u].method,g.hitch(e,G[u].func),!0);for(u=0;u<N.length;u++)N[u].call(e);for(u=0;u<L.length;u++)e.watch(L[u].prop,L[u].func);for(u=0;u<M.length;u++)C(e,M[u].event,M[u].func);return e}var r=a&&a.prototype;e=e||{};var h={};e.defaults&&g.mixin(h,e.defaults);c&&g.mixin(h,c);var s;
D("dom-attributes-explicit")?s=d.attributes:D("dom-attributes-specified-flag")?s=q.filter(d.attributes,function(e){return e.specified}):(c=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),s=q.map(c.split(/\s+/),function(e){var a=e.toLowerCase();return{name:e,value:"LI"==d.nodeName&&"value"==e||"enctype"==a?d.getAttribute(a):d.getAttributeNode(a).value}}));var n=e.scope||p._scopeName;
c="data-"+n+"-";var t={};"dojo"!==n&&(t[c+"props"]="data-dojo-props",t[c+"type"]="data-dojo-type",t[c+"mixins"]="data-dojo-mixins",t[n+"type"]="dojoType",t[c+"id"]="data-dojo-id");for(var u=0,x,n=[],B,J;x=s[u++];){var F=x.name,I=F.toLowerCase();x=x.value;switch(t[I]||I){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":J=x;break;case "data-dojo-id":case "jsid":B=x;break;case "data-dojo-attach-point":case "dojoattachpoint":h.dojoAttachPoint=x;break;case "data-dojo-attach-event":case "dojoattachevent":h.dojoAttachEvent=
x;break;case "class":h["class"]=d.className;break;case "style":h.style=d.style&&d.style.cssText;break;default:if(F in r||(F=E(a)[I]||F),F in r)switch(typeof r[F]){case "string":h[F]=x;break;case "number":h[F]=x.length?Number(x):NaN;break;case "boolean":h[F]="false"!=x.toLowerCase();break;case "function":""===x||-1!=x.search(/[^\w\.]+/i)?h[F]=new Function(x):h[F]=g.getObject(x,!1)||new Function(x);n.push(F);break;default:I=r[F],h[F]=I&&"length"in I?x?x.split(/\s*,\s*/):[]:I instanceof Date?""==x?new Date(""):
"now"==x?new Date:m.fromISOString(x):I instanceof b?p.baseUrl+x:z(x)}else h[F]=x}}for(s=0;s<n.length;s++)t=n[s].toLowerCase(),d.removeAttribute(t),d[t]=null;if(J)try{J=z.call(e.propsThis,"{"+J+"}"),g.mixin(h,J)}catch(O){throw Error(O.toString()+" in data-dojo-props\x3d'"+J+"'");}g.mixin(h,l);f||(f=a&&(a._noScript||r._noScript)?[]:w("\x3e script[type^\x3d'dojo/']",d));var G=[],N=[],L=[],M=[];if(f)for(u=0;u<f.length;u++)t=f[u],d.removeChild(t),l=t.getAttribute(c+"event")||t.getAttribute("event"),e=
t.getAttribute(c+"prop"),J=t.getAttribute(c+"method"),n=t.getAttribute(c+"advice"),s=t.getAttribute("type"),t=this._functionFromScript(t,c),l?"dojo/connect"==s?G.push({method:l,func:t}):"dojo/on"==s?M.push({event:l,func:t}):h[l]=t:"dojo/aspect"==s?G.push({method:J,advice:n,func:t}):"dojo/watch"==s?L.push({prop:e,func:t}):N.push(t);a=(f=a.markupFactory||r.markupFactory)?f(h,d,a):new a(h,d);return a.then?a.then(k):k(a)},scan:function(a,d){function b(e){if(!e.inherited){e.inherited={};var a=e.node,f=
b(e.parent),a={dir:a.getAttribute("dir")||f.dir,lang:a.getAttribute("lang")||f.lang,textDir:a.getAttribute(r)||f.textDir},d;for(d in a)a[d]&&(e.inherited[d]=a[d])}return e.inherited}var e=[],f=[],c={},k=(d.scope||p._scopeName)+"Type",g="data-"+(d.scope||p._scopeName)+"-",m=g+"type",r=g+"textdir",g=g+"mixins",h=a.firstChild,s=d.inherited;if(!s){var t=function(e,a){return e.getAttribute&&e.getAttribute(a)||e.parentNode&&t(e.parentNode,a)},s={dir:t(a,"dir"),lang:t(a,"lang"),textDir:t(a,r)},v;for(v in s)s[v]||
delete s[v]}for(var s={inherited:s},u,w;;)if(h)if(1!=h.nodeType)h=h.nextSibling;else if(u&&"script"==h.nodeName.toLowerCase())(z=h.getAttribute("type"))&&/^dojo\/\w/i.test(z)&&u.push(h),h=h.nextSibling;else if(w)h=h.nextSibling;else{var z=h.getAttribute(m)||h.getAttribute(k);v=h.firstChild;if(!z&&(!v||3==v.nodeType&&!v.nextSibling))h=h.nextSibling;else{w=null;if(z){var C=h.getAttribute(g);u=C?[z].concat(C.split(/\s*,\s*/)):[z];try{w=B(u,d.contextRequire)}catch(E){}w||q.forEach(u,function(e){~e.indexOf("/")&&
!c[e]&&(c[e]=!0,f[f.length]=e)});C=w&&!w.prototype._noScript?[]:null;s={types:u,ctor:w,parent:s,node:h,scripts:C};s.inherited=b(s);e.push(s)}else s={node:h,scripts:u,parent:s};u=C;w=h.stopParser||w&&w.prototype.stopParser&&!d.template;h=v}}else{if(!s||!s.node)break;h=s.node.nextSibling;w=!1;s=s.parent;u=s.scripts}var G=new x;f.length?(D("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+f.join(", ")),(d.contextRequire||n)(f,function(){G.resolve(q.filter(e,function(e){if(!e.ctor)try{e.ctor=
B(e.types,d.contextRequire)}catch(a){}for(var f=e.parent;f&&!f.types;)f=f.parent;var b=e.ctor&&e.ctor.prototype;e.instantiateChildren=!(b&&b.stopParser&&!d.template);e.instantiate=!f||f.instantiate&&f.instantiateChildren;return e.instantiate}))})):G.resolve(e);return G.promise},_require:function(a,d){var b=z("{"+a.innerHTML+"}"),e=[],f=[],c=new x,k=d&&d.contextRequire||n,h;for(h in b)e.push(h),f.push(b[h]);k(f,function(){for(var a=0;a<e.length;a++)g.setObject(e[a],arguments[a]);c.resolve(arguments)});
return c.promise},_scanAmd:function(a,d){var b=new x,e=b.promise;b.resolve(!0);var f=this;w("script[type\x3d'dojo/require']",a).forEach(function(a){e=e.then(function(){return f._require(a,d)});a.parentNode.removeChild(a)});return e},parse:function(a,d){var b;!d&&a&&a.rootNode?(d=a,b=d.rootNode):a&&g.isObject(a)&&!("nodeType"in a)?d=a:b=a;b=b?c.byId(b):t.body();d=d||{};var e=d.template?{template:!0}:{},f=[],y=this,k=this._scanAmd(b,d).then(function(){return y.scan(b,d)}).then(function(a){return y._instantiate(a,
e,d,!0)}).then(function(a){return f=f.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});g.mixin(f,k);return f}};p.parser=k;h.parseOnLoad&&u(100,k,"parse");return k})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,p,g){return g("dijit.Destroyable",null,{destroy:function(g){this._destroyed=!0},own:function(){var g=["destroyRecursive","destroy","remove"];n.forEach(arguments,function(h){function c(){b.remove();
n.forEach(v,function(a){a.remove()})}var t,b=p.before(this,"destroy",function(a){h[t](a)}),v=[];h.then?(t="cancel",h.then(c,c)):n.forEach(g,function(a){"function"===typeof h[a]&&(t||(t=a),v.push(p.after(h,a,c,!0)))})},this);return arguments}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,p,g,q,h){return g("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,
_beforeFillContent:function(){if(this.widgetsInTemplate){var c=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);h.parse(c,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(q.hitch(this,function(c){this._startupWidgets=c;for(var b=0;b<c.length;b++)this._processTemplateNode(c[b],function(b,a){return b[a]},function(b,a,c){return a in
b?b.connect(b,a,c):b.on(a,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(c,g,b){return g(c,"dojoType")||g(c,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,
function(c){c&&(!c._started&&c.startup)&&c.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,p,g,q,h,c,t,b){var v=p("dijit._TemplatedMixin",b,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var b=this.declaredClass,c=this;return t.substitute(a,this,
function(a,g){"!"==g.charAt(0)&&(a=q.getObject(g.substr(1),!1,c));if("undefined"==typeof a)throw Error(b+" template:"+g);return null==a?"":"!"==g.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=n(this.templatePath,{sanitize:!0}));var a=v.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument),b;if(q.isString(a)){if(b=g.toDom(this._stringRepl(a),this.ownerDocument),1!=b.nodeType)throw Error("Invalid template: "+a);}else b=a.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var b=this.containerNode;if(a&&b)for(;a.hasChildNodes();)b.appendChild(a.firstChild)}});v._templateCache={};v.getCachedTemplate=function(a,b,c){var h=v._templateCache,q=a,n=h[q];
if(n){try{if(!n.ownerDocument||n.ownerDocument==(c||document))return n}catch(u){}g.destroy(n)}a=t.trim(a);if(b||a.match(/\$\{([^\}]+)\}/g))return h[q]=a;b=g.toDom(a,c);if(1!=b.nodeType)throw Error("Invalid template: "+a);return h[q]=b};c("ie")&&h(window,"unload",function(){var a=v._templateCache,b;for(b in a){var c=a[b];"object"==typeof c&&g.destroy(c);delete a[b]}});return v})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,
p,g,q,h){n=n(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(c){p.mixin(this,c);h.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});g("extend-esri")&&p.setObject("layers.KMLFolder",n,q);return n})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(n){return n.cache})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,p,g,q){g(function(){p("highcontrast")&&n.add(q.body(),"dijit_a11y")});return p})},
"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,p,g,q,h,c,t,b){n=n([c,t],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,a){p.mixin(this,a);this.initialize(b,a)},getTitle:function(b){var a;this.info&&(a=this.titleHasRelatedFields?"":this._getPopupValues(b,!0).title);return a||""},getContent:function(c){return this.info?
(new b({template:this,graphic:c,chartTheme:this.chartTheme},q.create("div"))).domNode:""}});g("extend-esri")&&p.setObject("dijit.PopupTemplate",n,h);return n})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(n,p,g,q,h,c,t){h.add("highcontrast",function(){var b=t.doc.createElement("div");b.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+
(p.blankGif||n.toUrl("./resources/blank.gif"))+'");';t.body().appendChild(b);var c=q.getComputedStyle(b),a=c.backgroundImage,c=c.borderTopColor==c.borderRightColor||a&&("none"==a||"url(invalid-url:)"==a);8>=h("ie")?b.outerHTML="":t.body().removeChild(b);return c});c(function(){h("highcontrast")&&g.add(t.body(),"dj_a11y")});return h})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),
function(n,p,g,q,h,c,t){c.extend(n,{waiRole:"",waiState:""});return h("dijit._Templated",[p,g],{widgetsInTemplate:!1,constructor:function(){t.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(b,c){var a=this.inherited(arguments),g=c(b,"waiRole");g&&b.setAttribute("role",g);(g=c(b,"waiState"))&&q.forEach(g.split(/\s*,\s*/),function(a){-1!=a.indexOf("-")&&(a=a.split("-"),b.setAttribute("aria-"+
a[0],a[1]))});return a}})})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(n,p,g,q){q.extend(p,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(n,p,g,q,h,c,t,b,v,a,m,x,D){function w(){}function C(a){return function(b,c,h,s){return b&&"string"==typeof c&&b[c]==w?b.on(c.substring(2).toLowerCase(),t.hitch(h,s)):a.apply(g,arguments)}}n.around(g,"connect",C);c.connect&&n.around(c,"connect",C);n=q("dijit._Widget",[m,x,D],{onClick:w,onDblClick:w,onKeyDown:w,onKeyPress:w,onKeyUp:w,onMouseDown:w,onMouseMove:w,onMouseOut:w,onMouseOver:w,onMouseLeave:w,onMouseEnter:w,onMouseUp:w,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
w&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===w?g.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){c.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){c.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?b("[widgetId]",this.containerNode).map(a.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});h("dijit-legacy-requires")&&v(0,function(){require(["dijit/_base"])});
return n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated ../kernel ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,p,g,q,h,c,t,b,v,a,m,x,D,w,C,u,z,E){var B=0;p=p([z,w,C],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=q.mixin({},
E.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(q.hitch(this,this._handleComponentsSuccess),q.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var b=this._mediaInfos,g=b.length,k=this.domNode,q=this._prevMedia,d=this._nextMedia;if(1<g){var l=0,e=0;h.forEach(b,function(a){"image"===a.type?l++:-1!==a.type.indexOf("chart")&&e++});l&&(a.set(this._imageCount,"innerHTML",l),c.query(".summary .image",k).removeClass("hidden"));e&&(a.set(this._chartCount,"innerHTML",e),c.query(".summary .chart",k).removeClass("hidden"))}else c.query(".summary",
k).addClass("hidden"),m.add(q,"hidden"),m.add(d,"hidden");b=this._mediaPtr;0===b?m.add(q,"hidden"):m.remove(q,"hidden");b===g-1?m.add(d,"hidden"):m.remove(d,"hidden");this._destroyFrame()},_displayMedia:function(){var b=this._mediaInfos[this._mediaPtr],g=b.title,k=b.caption,h=c.query(".mediaSection .hzLine",this.domNode)[0];a.set(this._mediaTitle,"innerHTML",g);m[g?"remove":"add"](this._mediaTitle,"hidden");a.set(this._mediaCaption,"innerHTML",k);m[k?"remove":"add"](this._mediaCaption,"hidden");m[g&&
k?"remove":"add"](h,"hidden");this._rid=null;if("image"===b.type)this._showImage(b.value);else{var d=this,g=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],k=b.value.theme||this.chartTheme;q.isString(k)&&(k=k.replace(/\./gi,"/"),-1===k.indexOf("/")&&(k="dojox/charting/themes/"+k));k||(k="./Rainbow");g.push(k);try{var l=this._rid=B++;n(g,function(a,e,c){l===d._rid&&(d._rid=null,d._showChart(b.type,b.value,a,e,c))})}catch(e){console.log("PopupRenderer: error loading modules")}}},_showImage:function(b){m.add(this._mediaFrame,
"image");var h=D.get(this._gallery,"height"),k="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+b.sourceURL+"' /\x3e";b.linkURL&&(k="\x3ca target\x3d'_blank' href\x3d'"+b.linkURL+"'\x3e"+k+"\x3c/a\x3e");a.set(this._mediaFrame,"innerHTML",k);var q=c.query(".esriPopupMediaImage",this._mediaFrame)[0],d=this,l;l=g.connect(q,"onload",function(){g.disconnect(l);l=null;d._imageLoaded(q,h)})},_showChart:function(a,b,c,g,d){m.remove(this._mediaFrame,"image");c=this._chart=new c(x.create("div",{"class":"chart"},
this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});d&&c.setTheme(d);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});h.forEach(b.fields,function(a,e){a.x=e+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",
gap:3});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new g(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),
this._action=null);a.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),D.set(a,"marginTop",c+"px"))},_attListHandler:function(b,c){if(b===this._dfd){this._dfd=null;var g="";!(c instanceof Error)&&(c&&c.length)&&h.forEach(c,function(a){g+="\x3cli\x3e";g+="\x3ca href\x3d'"+a.url+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";g+="\x3c/li\x3e"});a.set(this._attachmentsList,"innerHTML",g||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},
_handleComponentsSuccess:function(b){if(b){var g=this.showTitle?b.title:"",k=b.description,n=b.fields,d=b.mediaInfos,l=this.domNode,e=this._nls,f=this.template,y=this.graphic;this._prevMedia.title=e.NLS_prevMedia;this._nextMedia.title=e.NLS_nextMedia;a.set(this._title,"innerHTML",g);g||m.add(this._title,"hidden");!k&&n&&(k="",h.forEach(n,function(a){k+="\x3ctr valign\x3d'top'\x3e";k+="\x3ctd class\x3d'attrName'\x3e"+a[0]+"\x3c/td\x3e";k+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,
"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+e.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";k+="\x3c/tr\x3e"}),k&&(k="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+k+"\x3c/table\x3e"));a.set(this._description,"innerHTML",k);k||m.add(this._description,"hidden");c.query("a",this._description).forEach(function(e){a.set(e,"target","_blank")});g&&k?c.query(".mainSection .hzLine",l).removeClass("hidden"):g||k?c.query(".mainSection .hzLine",l).addClass("hidden"):
c.query(".mainSection",l).addClass("hidden");if(g=this._dfd=f.getAttachments(y))g.addBoth(q.hitch(this,this._attListHandler,g)),a.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+e.NLS_searching+"...\x3c/li\x3e"),c.query(".attachmentsSection",l).removeClass("hidden");d&&d.length&&(c.query(".mediaSection",l).removeClass("hidden"),v.setSelectable(this._mediaFrame,!1),this._mediaInfos=d,this._mediaPtr=0,this._updateUI(),this._displayMedia());b.editSummary&&(a.set(this._editSummary,"innerHTML",b.editSummary),
d&&d.length&&m.remove(this._mediaBreak,"hidden"),m.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});t("extend-esri")&&q.setObject("dijit._PopupRenderer",p,u);return p})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(n,p,g,q,h,c,t,b,v,a,m,x,D,w,C,u,z,E,B,s,r,k,A){function d(a){return function(f){b[f?"set":"remove"](this.domNode,a,f);this._set(a,f)}}D.add("dijit-legacy-requires",!w.isAsync);D.add("dojo-bidi",!1);D("dijit-legacy-requires")&&z(0,function(){n(["dijit/_base/manager"])});var l={};q=c("dijit._WidgetBase",[E,r],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:d("lang"),dir:"",_setDirAttr:d("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:q.blankGif||n.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,d=a._setterAttrs=[],a=a._onMap={},c;for(c in b.attributeMap)d.push(c);for(c in b)/^on/.test(c)&&(a[c.substring(2).toLowerCase()]=c),/^_set[A-Z](.*)Attr$/.test(c)&&(c=c.charAt(4).toLowerCase()+c.substr(5,
c.length-9),(!b.attributeMap||!(c in b.attributeMap))&&d.push(c))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=t.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,C.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=s.body(this.ownerDocument);A.add(this);this.buildRendering();var d;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&(c.parentNode&&this.domNode!==c)&&(c.parentNode.replaceChild(this.domNode,c),d=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);p.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var d=this._get(b);d&&this.set(b,d)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(p.map(a,function(a){return a+"Rtl"})));v.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,p.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&C.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(d){d.destroyRecursive?d.destroyRecursive(a):d.destroy&&d.destroy(a)}this._beingDestroyed=!0;this.uninitialize();p.forEach(this._connects,C.hitch(this,"disconnect"));p.forEach(this._supportingWidgets,b);this.domNode&&p.forEach(A.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
A.remove(this.id);this._destroyed=!0},destroyRendering:function(e){this.bgIframe&&(this.bgIframe.destroy(e),delete this.bgIframe);this.domNode&&(e?b.remove(this.domNode,"widgetId"):a.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(e||a.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){p.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;C.isObject(a)?
x.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,d,c){c=3<=arguments.length?c:this.attributeMap[a];p.forEach(C.isArray(c)?c:[c],function(c){var l=this[c.node||c||"domNode"];switch(c.type||"attribute"){case "attribute":C.isFunction(d)&&(d=C.hitch(this,d));c=c.attribute?c.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;l.tagName?b.set(l,c,d):l.set(c,d);break;case "innerText":l.innerHTML="";l.appendChild(this.ownerDocument.createTextNode(d));
break;case "innerHTML":l.innerHTML=d;break;case "class":v.replace(l,d,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var d in a)this.set(d,a[d]);return this}d=this._getAttrNames(a);var c=this[d.s];if(C.isFunction(c))var g=c.apply(this,Array.prototype.slice.call(arguments,1));else{var c=this.focusNode&&!C.isFunction(this.focusNode)?"focusNode":"domNode",h=this[c]&&this[c].tagName,k;if(k=h)if(!(k=
l[h])){k=this[c];var q={},m;for(m in k)q[m.toLowerCase()]=!0;k=l[h]=q}m=k;d=a in this.attributeMap?this.attributeMap[a]:d.s in this?this[d.s]:m&&d.l in m&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?c:null;null!=d&&this._attrToDom(a,b,d);this._set(a,b)}return g||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var d=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+d+"Attr",
g:"_get"+d+"Attr",l:d.toLowerCase()}},_set:function(a,b){var d=this[a];this[a]=b;if(this._created&&!(d===b||d!==d&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,d,b),this.emit("attrmodified-"+a,{detail:{prevValue:d,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,d){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var c,l=this["on"+a];l&&(c=l.apply(this,d?d:[b]));this._started&&!this._beingDestroyed&&
u.emit(this.domNode,a.toLowerCase(),b);return c},on:function(a,b){var d=this._onMap(a);return d?g.after(this,d,b,!0):this.own(u(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,d=b._onMap;if(!d){var d=b._onMap={},c;for(c in b.prototype)/^on/.test(c)&&(d[c.replace(/^on/,"").toLowerCase()]=c)}return d["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):
[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,d){return this.own(h.connect(a,b,this,d))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(B.subscribe(a,C.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:m.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=x.get(this.domNode,"display")},placeAt:function(b,d){var c=!b.tagName&&
A.byId(b);c&&c.addChild&&(!d||"number"===typeof d)?c.addChild(this,d):(c=c&&"domNode"in c?c.containerNode&&!/after|before|replace/.test(d||"")?c.containerNode:c.domNode:t.byId(b,this.ownerDocument),a.place(this.domNode,c,d),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var d=setTimeout(C.hitch(this,function(){d&&(d=null,this._destroyed||C.hitch(this,a)())}),b||0);return{remove:function(){d&&(clearTimeout(d),d=null);return null}}}});D("dojo-bidi")&&
q.extend(k);return q})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,p){var g={};n.setObject("dojo.date.stamp",g);g.fromISOString=function(q,h){g._isoRegExp||(g._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var c=g._isoRegExp.exec(q),n=null;if(c){c.shift();c[1]&&c[1]--;c[6]&&(c[6]*=1E3);h&&(h=new Date(h),p.forEach(p.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(a){return h["get"+a]()}),function(a,b){c[b]=c[b]||a}));n=new Date(c[0]||1970,c[1]||0,c[2]||1,c[3]||0,c[4]||0,c[5]||0,c[6]||0);100>c[0]&&n.setFullYear(c[0]||1970);var b=0,v=c[7]&&c[7].charAt(0);"Z"!=v&&(b=60*(c[8]||0)+(Number(c[9])||0),"-"!=v&&(b*=-1));v&&(b-=n.getTimezoneOffset());b&&n.setTime(n.getTime()+6E4*b)}return n};g.toISOString=function(g,h){var c=function(a){return 10>a?"0"+a:a};h=h||{};var n=[],b=h.zulu?"getUTC":"get",p="";"time"!=h.selector&&(p=g[b+"FullYear"](),p=["0000".substr((p+
"").length)+p,c(g[b+"Month"]()+1),c(g[b+"Date"]())].join("-"));n.push(p);if("date"!=h.selector){p=[c(g[b+"Hours"]()),c(g[b+"Minutes"]()),c(g[b+"Seconds"]())].join(":");b=g[b+"Milliseconds"]();h.milliseconds&&(p+="."+(100>b?"0":"")+c(b));if(h.zulu)p+="Z";else if("time"!=h.selector)var b=g.getTimezoneOffset(),a=Math.abs(b),p=p+((0<b?"-":"+")+c(Math.floor(a/60))+":"+c(a%60));n.push(p)}return n.join("T")};return g})},"*noref":1}});
define("esri/layers/KMLLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(n,p,g,q,h,c,t,b,v,a,m,x,D,w,C,u,z,E,B,s,r,k){var A=p([E],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+
"//utility.arcgis.com/sharing/kml",constructor:function(a,b){a||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=b&&b.outSR||new C({wkid:4326});this._options=q.mixin({},b);x.defaults.kmlService&&(this.serviceUrl=x.defaults.kmlService);var c=this.linkInfo=b&&b.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);(!c||c&&c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=q.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",
!0)},getFeature:function(a){if(a){var b=a.type,c=a.id,f;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(f=q.getObject("_mode._featureMap."+c,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var g=a.getImages(),b=g.length;for(a=0;a<b;a++)if(g[a].id===c){f=g[a];break}}break;case "ScreenOverlay":break;case "NetworkLink":h.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===c?(f=a,!0):!1});break;case "Folder":b=(g=this.folders)?
g.length:0;for(a=0;a<b;a++)if(g[a].id===c){f=g[a];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return f}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&h.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),this._setState(a,b),this._fireUpdateEnd())},onRefresh:function(){},
onOpacityChange:function(){},_parseKml:function(a){var b=this;this._fireUpdateStart();this._io=w({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(a),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:c.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){b._io=null;b._initLayer(a)},error:function(a){b._io=null;a=q.mixin(Error(),a);a.message="Unable to load KML: "+b.url+" "+(a.message||"");b._fireUpdateEnd(a);b.onError(a)}})},_initLayer:function(a){this.loaded&&
this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var b,c,f=this.folders=a.folders,g=[],n;if(f){c=f.length;for(b=0;b<c;b++)n=f[b]=new B(f[b]),-1===n.parentFolderId&&g.push(n)}var f=this._links=a.networkLinks,m;c=f?f.length:0;for(b=0;b<c;b++)f[b].viewRefreshMode&&-1!==f[b].viewRefreshMode.toLowerCase().indexOf("onregion")||(m=q.mixin({},this._options),m.linkInfo=f[b],m.id&&(m.id=m.id+"_"+
b),f[b]=new A(f[b].href,m),f[b]._parentLayer=this,f[b]._parentFolderId=this._getLinkParentId(f[b].linkInfo.id));if((f=a.groundOverlays)&&0<f.length){m=q.mixin({},this._options);m.id&&(m.id+="_mapImage");n=this._groundLyr=new r(m);c=f.length;for(b=0;b<c;b++)n.addImage(new s(f[b]))}if((a=q.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],h.forEach(a,function(a,b){var c=q.getObject("featureSet.features",!1,a);c&&0<c.length&&(m=q.mixin({outFields:["*"],infoTemplate:a.popupInfo?
new z(a.popupInfo):null,editable:!1},this._options),m.id&&(m.id=m.id+"_"+b),a.layerDefinition.capabilities="Query,Data",c=new k(a,m),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;c=g.length;for(b=0;b<c;b++)n=g[b],this._setState(n,n.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();
this._links&&h.forEach(this._links,function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=null,b.visible?b._parseKml(a):b._wMap=a))});var b=a.spatialReference,c=this._outSR,f;if(!b.equals(c))if(b.isWebMercator()&&4326===c.wkid)f=u.geographicToWebMercator;else if(c.isWebMercator()&&4326===b.wkid)f=u.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");
return}this._groundLyr&&(f&&h.forEach(this._groundLyr.getImages(),function(a){a.extent=f(a.extent)}),a.addLayer(this._groundLyr));(b=this._fLayers)&&0<b.length&&h.forEach(b,function(b){if(f){var c=b.graphics,e,g,l=c?c.length:0;for(e=0;e<l;e++)(g=c[e].geometry)&&c[e].setGeometry(f(g))}a.addLayer(b)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&h.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel()});a&&h.forEach(this.getLayers(),
a.removeLayer,a)},_setState:function(a,b){var c=a.featureInfos,f,g,h,k=c?c.length:0,m=b?"show":"hide";for(h=0;h<k;h++)if(f=c[h],g=this.getFeature(f))if("Folder"===f.type)this._setState(g,b&&g.visible);else if("NetworkLink"===f.type)this._setInternalVisibility(g,b);else g[m]()},_areLocalAncestorsVisible:function(a){var b=a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var c=a._parentLayer,
f=a._parentFolderId;for(b=b&&a.visible;b&&c;)b=b&&c.visible,-1<f&&(b=b&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:f}))),f=c._parentFolderId,c=c._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&h.forEach(a.getLayers(),function(c){c.linkInfo?a._setIntState(c,b&&c.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&h.some(this.folders,function(c){return c.networkLinkIds&&
-1!==h.indexOf(c.networkLinkIds,a)?(b=c.id,!0):!1});return b},_checkAutoRefresh:function(){var a=this.linkInfo;if(a)if(this.visible){if(this.loaded&&this._map){var b=a.refreshMode,c=a.refreshInterval,f=a.viewRefreshMode,a=a.viewRefreshTime;b&&(-1!==b.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*c));f&&(-1!==f.toLowerCase().indexOf("onstop")&&0<a)&&!this._extChgHandle&&(this._extChgHandle=g.connect(this._map,"onExtentChange",this,
this._extentChanged))}}else this._stopAutoRefresh(),g.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(a){a=a||this._map;var c={},e=this.linkInfo,f=a&&a.extent,g;this._url.query&&(q.mixin(c,this._url.query),g=!!this._url.query.token);if(m.id&&!g&&(g=m.id.findCredential(this._url.path)))c.token=g.token;if(e){g=e.viewFormat;var h=e.httpQuery,e=e.viewBoundScale;if(f&&g){var k=
f,p=f,r=f.spatialReference;r&&(r.isWebMercator()?k=u.webMercatorToGeographic(f):4326===r.wkid&&(p=u.geographicToWebMercator(f)));f=k.getCenter();p=Math.max(p.getWidth(),p.getHeight());e&&(k=k.expand(e));g=g.replace(/\[bboxWest\]/ig,k.xmin).replace(/\[bboxEast\]/ig,k.xmax).replace(/\[bboxSouth\]/ig,k.ymin).replace(/\[bboxNorth\]/ig,k.ymax).replace(/\[lookatLon\]/ig,f.x).replace(/\[lookatLat\]/ig,f.y).replace(/\[lookatRange\]/ig,p).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,
f.x).replace(/\[lookatTerrainLat\]/ig,f.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,f.x).replace(/\[cameraLat\]/ig,f.y).replace(/\[cameraAlt\]/ig,p).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,a.width).replace(/\[vertPixels\]/ig,a.height).replace(/\[terrainEnabled\]/ig,0);q.mixin(c,b.queryToObject(g))}h&&(h=h.replace(/\[clientVersion\]/ig,m.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,
n.locale),q.mixin(c,b.queryToObject(h)))}a=[];for(var s in c)D.isDefined(c[s])&&a.push(s+"\x3d"+c[s]);return(a=a.join("\x26"))?"?"+a:""},setScaleRange:function(a,b){this.inherited(arguments);h.forEach(this.getLayers(),function(c){c.setScaleRange(a,b)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(a){this.opacity!=a&&(h.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},_setMap:function(b,
c){this.inherited(arguments);this._map=b;var e=this._div=v.create("div",null,c);a.set(e,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return e},_unsetMap:function(a,b){this._io&&this._io.cancel();this._stopAutoRefresh();g.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var c=this._div;c&&(b.removeChild(c),v.destroy(c));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),
this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._parseKml()},getFeatureCollection:function(a){var b,c=[];if(a=this.getFeature({type:"Folder",id:a}))(b=h.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&h.forEach(this._fLayers,
function(a){var d,g;d=a.toJson();d.featureSet.features&&0<d.featureSet.features.length&&(g=h.filter(d.featureSet.features,function(c){if(-1!==h.indexOf(b,c.attributes[a.objectIdField]))return c},this));g&&0<g.length&&(d.featureSet.features=g,c.push(d))},this);return c},getFeatureCount:function(a){a=this.getFeature({type:"Folder",id:a});var b={points:0,polylines:0,polygons:0};a&&h.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=
1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});t("extend-esri")&&q.setObject("layers.KMLLayer",A,m);return A});